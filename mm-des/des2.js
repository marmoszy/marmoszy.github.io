var pycode="IyBtbS1kZXMgLSBkaXNjcmV0ZSBldmVudCBzaW11bGF0b3IKIyAtIGJhc2UgZXZlbnRzOiBHZW5lcmF0b3IsU2VydmljZSxTaW5rLENvbmRpdGlvbmFsRXZlbnQKIyAtIGJwbW4gZXZlbnRzOiBTdGFydCxUYXNrLEVuZCxUaW1lcixYb3JHYXRlLEFuZEdhdGUsQ29uZGl0aW9uLFRlcm1pbmF0ZQojIE1NIDMxLjEuMjAyNCwgMTMuOS4yMDI1IChhZG9wdGVkIGZvciBweW9kaWRlIGluIGpzKQoKIyAtLS0tIHNpbXVsYXRpb24gb24gYW4gYWJzdHJhY3QgZXZlbnQgLS0tLQpjbGFzcyBFdmVudCgpOgogICAgICBjbnQgPSAwICAgICAgICAgICAgICAgICAgICAgICAgICMgdXNlZCBmb3IgZXZlbnQgaWRlbnRpZmllcgogICAgICBkZWYgX19pbml0X18oc2VsZiwgdGltZSwgbmFtZT1Ob25lKToKICAgICAgICAgICAgc2VsZi50aW1lID0gdGltZTsKICAgICAgICAgICAgRXZlbnQuY250ICs9IDEKICAgICAgICAgICAgc2VsZi5pZCA9IEV2ZW50LmNudAogICAgICAgICAgICBzZWxmLm5hbWUgPSAoKG5hbWU9PU5vbmUpIGFuZCAiRXZlbnQiIG9yIG5hbWUpICsgIl8iK3N0cihzZWxmLmlkKQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOiBwYXNzICAgICAgIyBhYnN0cmFjdCAKICAgICAgZGVmIF9fc3RyX18oc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLm5hbWUrICIgIisgc3RyKHNlbGYuaWQpICsiICIrc3RyKHNlbGYudGltZSkKY2xhc3MgU2ltdWxhdG9yKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAgICAgc2VsZi50aW1lID0gMAogICAgICAgICAgICBzZWxmLmV2ZW50cyA9IFtdCiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucyA9IFtdCiAgICAgIGRlZiBub3coc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnRpbWUKICAgICAgZGVmIGFkZChzZWxmLGUpOgogICAgICAgICAgICBzZWxmLmV2ZW50cy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBhZGRfY29uZGl0aW9uKHNlbGYsZSk6CiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgICAgIHdoaWxlIHNlbGYuZXZlbnRzOgogICAgICAgICAgICAgICAgICBlID0gbWluKHNlbGYuZXZlbnRzLCBrZXk9bGFtYmRhIGU6IGUudGltZSkKICAgICAgICAgICAgICAgICAgc2VsZi5ldmVudHMucmVtb3ZlKGUpCiAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IGUudGltZSAgICAgICAgICMgdXBkYXRlIHNpbXVsYXRvciB0aW1lCiAgICAgICAgICAgICAgICAgIGUuZXhlYyhzZWxmKQogICAgICAgICAgICAgICAgICBmb3IgYyBpbiBzZWxmLmNvbmRpdGlvbnM6ICAjIHRlc3QgY29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICBpZiBjLmV4ZWMoc2VsZik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5yZW1vdmUoYykKIyAtLS0tIHV0aWxzIC0tLS0KaW1wb3J0IG1hdGgscmFuZG9tCmRlZiBfcHJpbnQocyk6ICAgICAgICAgICAgICAgICMgb3duIHByaW50CiAgICAgICNwcmludChzKSAgICAgICAgICAgICAgICMgY29tbWVudCBpZiBubyB2ZXJib3VzIHByaW50aW5nCiAgICAgIHBhc3MKZGVmIEUobWVhbj1bMS4wXSk6ICAgICAgICAgICAgIyBleHBvbmVudGlhbCByYW5kb20gZ2VuZXJhdG9yCiAgICAgICMgLW1lYW5bMF0qbWF0aC5sb2cocmFuZG9tLnJhbmRvbSgpKQogICAgICByZXR1cm4gcmFuZG9tLmV4cG92YXJpYXRlKDEvbWVhblswXSkgCmRlZiBVKG1pbm1heD1bMS4wXSk6ICAgICAgICAgICMgdW5pZm9ybSByYW5kb20gZ2VuZXJhdG9yCiAgICAgIHJldHVybiByYW5kb20udW5pZm9ybShtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXSkKZGVmIE4obWVhbnN0ZD1bMy4wXSk6ICAgICAgICAjIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgcmV0dXJuIHJhbmRvbS5ub3JtYWx2YXJpYXRlKG1lYW5zdGRbMF0sbGVuKG1lYW5zdGQpPjEgYW5kIG1lYW5zdGRbMV0gb3IgMS4wKQpkZWYgQihwPTAuNSk6ICAgICAgICAgICAgICAgICMgYmlub21pYWwgKDAsMSkKICAgICAgcmV0dXJuIHJhbmRvbS5yYW5kb20oKTxwCmRlZiBDKHA9WzEsMSwxXSk6ICAgICAgICAgICAgIyBjaG9pY2UgKDAsMSwyLC4uLikKICAgICAgcmV0dXJuIHJhbmRvbS5jaG9pY2VzKGxpc3QocmFuZ2UobGVuKHApKSksd2VpZ2h0cz1wKVswXQpkZWYgVChtaW5tYXg9WzEuMF0pOiAgICAgICAgICAjIHNlbWkgdHJ1bmNhdGVkIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgbWksbWEgPSBtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXQogICAgICBtZWFuLHN0ZCA9IChtYSttaSkvMiwobWEtbWkpLzIKICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgeCA9IE4oW21lYW4sc3RkXSkKICAgICAgICAgICAgaWYgbWkgPD0geCA8PSBtYTogYnJlYWsKICAgICAgcmV0dXJuIHgKCiMgLS0tLSBwcmltaXRpdmUgY2xhc3NlcyAtLS0tCmNsYXNzIEN1c3RvbWVyKCk6ICAgICMgYW5vbnltb3VzIGN1c3RvbWVyIHdpdGggYSBhdXRvbWF0aWMgbmFtZQogICAgICBjbnQgPSAwICAgICAgICAjIGNvdW50ZXIgY2xhc3MgdmFyaWFibGUgZm9yIGN1c3RvbWVyIG5hbWUKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBDdXN0b21lci5jbnQgKz0gMQogICAgICAgICAgICBzZWxmLm5hbWUgPSBzdHIoQ3VzdG9tZXIuY250KQogICAgICAgICAgICBzZWxmLmF0dHIgPSB7ImNuYW1lIjpzZWxmLm5hbWV9ICMgQ3VzdG9tZXIgYXR0cmlidXRlcwogICAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIHN0cihzZWxmLm5hbWUpCmNsYXNzIFF1ZXVlKCk6ICAgICAgICMgZmlmbyBvZiBjdXN0b21lcnMKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBzZWxmLm9iamVjdHMgPSBbXQogICAgICBkZWYgcHVzaChzZWxmLG9iaik6CiAgICAgICAgICAgIHNlbGYub2JqZWN0cy5hcHBlbmQob2JqKQogICAgICBkZWYgcG9wKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5vYmplY3RzLnBvcCgwKQogICAgICBkZWYgX19sZW5fXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIGxlbihzZWxmLm9iamVjdHMpCiAgICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc3RyKFtzdHIobykgZm9yIG8gaW4gc2VsZi5vYmplY3RzXSkKY2xhc3MgUXVldWVkRXZlbnQoRXZlbnQpOgogICAgICBpbnN0YW5jZXM9W10KICAgICAgZGVmIF9faW5pdF9fKHNlbGYsbmFtZT1Ob25lKToKICAgICAgICAgICAgRXZlbnQuX19pbml0X18oc2VsZiwwLjAsbmFtZSkgICMgcHJlaW5pdCB0aW1lCiAgICAgICAgICAgIHNlbGYucXVldWUgPSBRdWV1ZSgpICAgICAgIyBvd24gcXVldWUKICAgICAgICAgICAgc2VsZi5vdXRwdXQgPSBbXSAgICAgICAgICAjIG5vIGNvbm5lY3RlZCBvYmplY3RzCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICAgIyBub25lIGJlaW5nIHNlcnZlZAogICAgICAgICAgICBRdWV1ZWRFdmVudC5pbnN0YW5jZXMuYXBwZW5kKHNlbGYpCiAgICAgIGRlZiBzZXROYW1lKHNlbGYsbmFtZSk6CiAgICAgICAgICAgIHNlbGYubmFtZT1uYW1lKyJfIitzZWxmLm5hbWUuc3BsaXQoIl8iKVsxXSAjLnJlcGxhY2UoIkV2ZW50IixuYW1lKS5yZXBsYWNlKCJBY3Rpdml0eSIsbmFtZSkKICAgICAgZGVmIG91dChzZWxmLHNpbSk6ICAgICAgICAgICAgICAjIHBhc3MgdG8gY29ubmVjdGVkIG9iamVjdHMKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4wIGFuZCBpc2luc3RhbmNlKHNlbGYsWG9yR2F0ZSk6ICAKICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID0gMSAgIyBzZW5kIHRvIHNlY29uZCBvdXRwdXQKICAgICAgICAgICAgICAgICAgICAgICAgI2lmIHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgidmFsdWUiIGluIHNlbGYuY3VzdG9tZXIuYXR0ciBhbmQgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdKSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeD0wICMgc2VuZCByYXRoZXIgdG8gZmlyc3Qgb3V0cHV0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLm91dHB1dCk+MjogICMgbW9yZSB0aGFuIDIgb3V0cHV0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHg9aW50KHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRwdXRbaWR4XS5pbnNlcnQoc2VsZi5jdXN0b21lciwgc2ltKQogICAgICAgICAgICAgICAgICBlbGlmIGxlbihzZWxmLm91dHB1dCk+MSBhbmQgaXNpbnN0YW5jZShzZWxmLE9yR2F0ZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIE4gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBoYXNhdHRyKHNlbGYuY3VzdG9tZXIsIk4iKTogIyB1c2VkIG9ubHkgYnkgT3JHYXRlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLk49W10KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHNlbGYub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGludChzZWxmLmN1c3RvbWVyLmF0dHJbInZhbHVlIl1baV0pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRwdXRbaV0uaW5zZXJ0KHNlbGYuY3VzdG9tZXIsIHNpbSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5OLmFwcGVuZChOKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQoImFwcGVuZDoiLHNlbGYuY3VzdG9tZXIubmFtZSxzZWxmLmN1c3RvbWVyLk4pCiAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihzZWxmLm91dHB1dCkpOiAgIyBzcGxpdCB0byBhbGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRwdXRbaV0uaW5zZXJ0KHNlbGYuY3VzdG9tZXIsc2ltKQogICAgICBkZWYgcHJldihzZWxmKToKICAgICAgICAgICAgZXA9W10KICAgICAgICAgICAgZm9yIGUwIGluIGZpbHRlcihOb25lLFF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlMC5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZTAub3V0cHV0W2ldPT1zZWxmOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcC5hcHBlbmQoZTApCiAgICAgICAgICAgICNwcmludCgicHJldjoiLHN0cihlcCkpCiAgICAgICAgICAgIHJldHVybiBlcAoKIyAtLS0tIGJhc2ljIG1vZGVsIGNsYXNzZXMgKFF1ZXVlRXZlbnQgZGVyaXZlZCkgLS0tLQpjbGFzcyBCcG1uRXZlbnQoUXVldWVkRXZlbnQpOgogICAgICBTID0ge30KICAgICAgZGVmIF9faW5pdF9fKHNlbGYsbmFtZT1Ob25lLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIFF1ZXVlZEV2ZW50Ll9faW5pdF9fKHNlbGYsbmFtZSkKICAgICAgICAgICAgc2VsZi5mdW4sc2VsZi5wYXJhbSxzZWxmLmNvZGUgPSBOb25lLE5vbmUsY29kZQogICAgICAgICAgICBzZWxmLkEsc2VsZi5wcCxzZWxmLnBwMixzZWxmLnRpdGxlID0geyJBLm4iOjB9LFstMSwwXSxbLTEsLTFdLCcnCiAgICAgIGRlZiBfZnVuKHNlbGYpOgogICAgICAgICAgICBwID0gc2VsZi5wYXJhbQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHAsbGlzdCk6CiAgICAgICAgICAgICAgICAgIHAgPSBbZmxvYXQoZXZhbChzZWxmLmF0dHJfcmVwbGFjZShzdHIocykpKSkgZm9yIHMgaW4gcF0KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgcCA9IGZsb2F0KGV2YWwoc2VsZi5hdHRyX3JlcGxhY2Uoc3RyKHApKSkpCiAgICAgICAgICAgICNwcmludCgiX2Z1bjoiLHNlbGYuZnVuLHAsbGVuKHNlbGYucXVldWUpKQogICAgICAgICAgICByZXR1cm4gc2VsZi5mdW4ocCkgaWYgc2VsZi5mdW4hPU5vbmUgZWxzZSBwCiAgICAgIGRlZiBhdHRyX3JlcGxhY2Uoc2VsZixjYyk6CiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIhPU5vbmU6CiAgICAgICAgICAgICAgICAgIGZvciBrLHYgaW4gc2VsZi5jdXN0b21lci5hdHRyLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNjID0gY2MucmVwbGFjZShrLHN0cih2KSkKICAgICAgICAgICAgZm9yIGssdiBpbiBCcG1uRXZlbnQuUy5pdGVtcygpOgogICAgICAgICAgICAgICAgICBjYyA9IGNjLnJlcGxhY2UoayxzdHIodikpCiAgICAgICAgICAgIGZvciBrLHYgaW4gc2VsZi5BLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgIGNjID0gY2MucmVwbGFjZShrLHN0cih2KSkKICAgICAgICAgICAgcmV0dXJuIGNjCiAgICAgIGRlZiBfZXZhbChzZWxmLGNvZGUsbj0tMSk6CiAgICAgICAgICAgIGNvZGVzPWNvZGUuc3BsaXQoIjsiKQogICAgICAgICAgICBpZiBuIT0tMToKICAgICAgICAgICAgICAgICAgY29kZXM9bGVuKGNvZGVzKT5uIGFuZCBbY29kZXNbbl1dIG9yIFtdCiAgICAgICAgICAgIGZvciBjb2RlIGluIGNvZGVzOgogICAgICAgICAgICAgICAgICBjYyA9IGNvZGUuc3BsaXQoIj0iKQogICAgICAgICAgICAgICAgICBjY1swXSA9IGNjWzBdLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgaWYgbGVuKGNjKT09MToKICAgICAgICAgICAgICAgICAgICAgICAgY2M9WyJkdW1teSJdK2NjCiAgICAgICAgICAgICAgICAgIGlmIGxlbihjYyk+MToKICAgICAgICAgICAgICAgICAgICAgICAgY2NbMF0gPSBsZW4oY2NbMF0pPjAgYW5kIGNjWzBdIG9yICJ2YWx1ZSIKICAgICAgICAgICAgICAgICAgICAgICAgY2NbMV0gPSBzZWxmLmF0dHJfcmVwbGFjZSgiPSIuam9pbihjY1sxOl0pKSAjIHJlam9pbgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2PWV2YWwoY2NbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNjWzBdLnN0YXJ0c3dpdGgoIlMuIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJwbW5FdmVudC5TW2NjWzBdXT1ldgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGNjWzBdLnN0YXJ0c3dpdGgoIkEuIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuRVtjY1swXV09ZXYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyW2NjWzBdXT1ldgogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0cltjY1swXV09RmFsc2UKY2xhc3MgQ29uZGl0aW9uYWxFdmVudChCcG1uRXZlbnQpOgogICAgICBkZWYgX19pbml0X18oc2VsZiwgY29kZT1Ob25lKToKICAgICAgICAgICAgQnBtbkV2ZW50Ll9faW5pdF9fKHNlbGYsIE5vbmUsIGNvZGUpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IC0xCiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIgPT0gTm9uZSA6ICMgaWYgZnJlZSBhZGQgdG8gc2ltdWxhdG9yIGNvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IGN1c3QKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdPUZhbHNlCiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKQogICAgICAgICAgICAgICAgICBzaW0uYWRkX2NvbmRpdGlvbihzZWxmKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICBzZWxmLnF1ZXVlLnB1c2goY3VzdCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgZGVmIGV4ZWMoc2VsZiwgc2ltKToKICAgICAgICAgICAgYiA9IEZhbHNlCiAgICAgICAgICAgIGlmIHNlbGYuY29kZSE9Tm9uZToKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUsMCkKICAgICAgICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdPT1UcnVlOgogICAgICAgICAgICAgICAgICAgICAgICBjYz1zZWxmLmNvZGUuc3BsaXQoJzsnKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oY2MpPjE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoIjsiLmpvaW4oY2NbMTpdKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiZSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0KHNpbSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IE5vbmUgICAgIyBtYXJrIHRoYXQgbm93IHRoZSBzZXJ2aWNlIGlzIGZyZWUgISEhCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLnF1ZXVlKT4wIDogICMgYnV0IGlmIGFueWJvZHkgaW4gcXVldWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pbnNlcnQoc2VsZi5xdWV1ZS5wb3AoKSwgc2ltKSAgIyBnZXQgYW5kIGluc2VydCBpbnRvIHNpbXVsYXRvcgogICAgICAgICAgICAgICAgICAgICAgICBiID0gVHJ1ZSAgIyByZWFkeSB0byBiZSByZW1vdmVkIGZyb20gc2ltdWxhdG9yIGNvbmRpdGlvbnMKICAgICAgICAgICAgcmV0dXJuIGIKY2xhc3MgR2VuZXJhdG9yKEJwbW5FdmVudCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmdW4sIHBhcmFtLCB0bWF4PTAuMCwgY29kZT1Ob25lKToKICAgICAgICAgICAgQnBtbkV2ZW50Ll9faW5pdF9fKHNlbGYsIE5vbmUsIGNvZGUpCiAgICAgICAgICAgIHNlbGYuZnVuLCBzZWxmLnBhcmFtLCBzZWxmLnRtYXgsIHNlbGYubiA9IGZ1biwgcGFyYW0sIHRtYXgsIDAKICAgICAgICAgICAgaWYgc2VsZi5jb2RlIT1Ob25lIDoKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUpICAgIyBldmFsdWF0ZSBzY3JpcHQgY29kZSAoW3Zhcl09PHZhbHVlPikKICAgICAgZGVmIGV4ZWMoc2VsZiwgc2ltKToKICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IEN1c3RvbWVyKCkKICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKQogICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgc2VsZi5BWyJBLm4iXSArPSAxCiAgICAgICAgICAgIF9wcmludCgiUmVnaXN0ZXJpbmc6ICIgKyBzdHIoc2VsZi5jdXN0b21lcikgKyAiICgiK3N0cihzZWxmLnRpbWUpKyIpIikKICAgICAgICAgICAgc2VsZi5vdXQoc2ltKSAgICAgICAgICAgICAjIHBhc3MgY3VzdG9tZXIgdG8gY29ubmVjdGVkIG9iamVjdAogICAgICAgICAgICBzZWxmLnRpbWUgKz0gc2VsZi5fZnVuKCkKICAgICAgICAgICAgaWYgc2VsZi50bWF4PjAgYW5kIHNlbGYudGltZSA8PSBzZWxmLnRtYXggb3Igc2VsZi5uPC1zZWxmLnRtYXgtMToKICAgICAgICAgICAgICAgICAgc2VsZi5uICs9IDEKICAgICAgICAgICAgICAgICAgc2ltLmFkZChzZWxmKSAgICAgICAjIG5leHQgb25lIGluIHJhbmRvbSB0aW1lCmNsYXNzIFNlcnZpY2UoQnBtbkV2ZW50KToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIGZ1biwgcGFyYW0sIGNvZGU9Tm9uZSk6IAogICAgICAgICAgICBCcG1uRXZlbnQuX19pbml0X18oc2VsZiwiQWN0aXZpdHkiLGNvZGUpICAKICAgICAgICAgICAgc2VsZi5mdW4sIHNlbGYucGFyYW0gPSBmdW4sIHBhcmFtIAogICAgICAgICAgICBzZWxmLk4gPSAxICMgTiBudW1iZXIgb2YgdG9rZW5zIHRvIHdhaXQgKHVzZWQgZm9yIEFuZEdhdGUsT3JHYXRlKQogICAgICBkZWYgaW5zZXJ0KHNlbGYsIGN1c3QsIHNpbSk6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZixYb3JHYXRlKToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4xIGFuZCBzZWxmLmNvZGU9PU5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29kZT0iPUIoMC41KSIKICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKHNlbGYsT3JHYXRlKToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4xIGFuZCBzZWxmLmNvZGU9PU5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29kZT0iPVsxLCIrIiwiLmpvaW4oWycwJ10qKGxlbihzZWxmLm91dHB1dCktMSkpKyJdIgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyID09IE5vbmU6ICMgaWYgZnJlZSBhZGQgdG8gc2ltdWxhdG9yIHdpdGggZW5kIHRpbWUKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lcix0ID0gY3VzdCxzZWxmLl9mdW4oKQogICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHQsbGlzdCk6ICAjIFtjeWNsZSxiZWdpbj0wXSBjeWNsaWMgdGltZXIgKE1NIDEuMTEuMjAyNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHQpPDI6IHQuYXBwZW5kKDApCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IHRbMV0rbWF0aC5jZWlsKChzaW0ubm93KCktdFsxXSkvdFswXSkqdFswXQogICAgICAgICAgICAgICAgICAgICAgICAjX3ByaW50KCIjICIrc3RyKHNlbGYuY3VzdG9tZXIpKyI6ICIrc3RyKHNpbS5ub3coKSkrIiAiK3N0cihzZWxmLnRpbWUpKQogICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWUgPSBzaW0ubm93KCkgKyB0CiAgICAgICAgICAgICAgICAgIF9wcmludCgiIyIrc3RyKHNlbGYuaWQpKyIgc3RhcnRzIHNlcnZpbmcgIisKICAgICAgICAgICAgICAgICAgICAgICAgIHN0cihjdXN0KSsiICgiK3N0cihzaW0ubm93KCkpKyIsIitzdHIoc2VsZi50aW1lKSsiKSIpCiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXT1zaW0ubm93KCkKICAgICAgICAgICAgICAgICAgaWYgIl9fbiIrc3RyKHNlbGYuaWQpIG5vdCBpbiBzZWxmLmN1c3RvbWVyLmF0dHI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX19uIitzdHIoc2VsZi5pZCldID0gMCAjIGZpcnN0IHRpbWUKICAgICAgICAgICAgICAgICAgaWYgIl9fdCIrc3RyKHNlbGYuaWQpKyJhIiBub3QgaW4gc2VsZi5jdXN0b21lci5hdHRyOgogICAgICAgICAgICAgICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl09c2ltLm5vdygpICMgaWYgbm90IGZyb20gcXVldWUKICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzZWxmLFRpbWVyKSBhbmQgbm90IGlzaW5zdGFuY2UodCxsaXN0KTogICMgbW9kaWZ5IHJlcXVpcmVkIGZpbmFsIGV4ZWN1dGlvbiB0aW1lCiAgICAgICAgICAgICAgICAgICAgICAgIHRhPWN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImEiXSAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRiPWN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXQogICAgICAgICAgICAgICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJiIl0gLT0gKHRiLXRhKSAjIGRlY3JlYXNlIGJlZ2luIHRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lIC09ICh0Yi10YSkgICMgLi4uIGJ5IHRoZSBkaWZmZXJlbmNlIGVsYXBzZWQgYWxyZWFkeQogICAgICAgICAgICAgICAgICAgICAgICAjX3ByaW50KCIjICIrc3RyKHNlbGYuY3VzdG9tZXIpKyI6ICIrc3RyKHNlbGYudGltZSkpCiAgICAgICAgICAgICAgICAgIHNpbS5hZGQoc2VsZikKICAgICAgICAgICAgZWxzZTogICAgICAgICAgICAgICAgICAgICAjIGVsc2UgaW5zZXJ0IGludG8gcXVldWUKICAgICAgICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdPXNpbS5ub3coKSAgIyB3aXRoIGEgcXVldWUgYWRkaW5nIHRpbXN0YW1wCiAgICAgICAgICAgICAgICAgIHNlbGYucXVldWUucHVzaChjdXN0KQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl09c2ltLm5vdygpCiAgICAgICAgICAgICAgICAgIHNlbGYuQVsiQS5uIl0gKz0gMQogICAgICAgICAgICBfcHJpbnQoIiMiK3N0cihzZWxmLmlkKSsiIGZpbmlzaGVkIHNlcnZpbmcgIiArIHN0cihzZWxmLmN1c3RvbWVyKSArICIgYXQgIiArIHN0cihzZWxmLnRpbWUpKQogICAgICAgICAgICBpZiBzZWxmLmNvZGUhPU5vbmUgOiAgICAgIAogICAgICAgICAgICAgICAgICBzZWxmLl9ldmFsKHNlbGYuY29kZSkgICAjIGV2YWx1YXRlIHNjcmlwdCBjb2RlIChbdmFyXT08dmFsdWU+KQogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fbiIrc3RyKHNlbGYuaWQpXSArPSAxCiAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZixPckdhdGUpIGFuZCBsZW4oc2VsZi5vdXRwdXQpPT0xOgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQoc2VsZi5jdXN0b21lci5uYW1lLHNlbGYuY3VzdG9tZXIuTikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5OID0gc2VsZi5jdXN0b21lci5OWy0xXQogICAgICAgICAgICAgICAgICBpZiAoc2VsZi5jdXN0b21lci5hdHRyWyJfX24iK3N0cihzZWxmLmlkKV0lc2VsZi5OKSA9PSAwOiAjc2VsZi5OOgogICAgICAgICAgICAgICAgICAgICAgICBkb19vdXQ9VHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNlbGYsVGFzayk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBlIGluIEVOOiAjIGZpbmQgYm91bmRhcnkgZWxlbWVudHMgYXNpZ25lZCB0byBjdXJyZW50IFRhc2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZS5pZDIlMT4wIGFuZCBzdHIoZS5pZDIpLnNwbGl0KCcuJylbMV09PXN0cihzZWxmLmlkKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZS5jb2RlICE9IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoZS5jb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdCA9IHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXS1zZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJiIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLFRpbWVyKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdPSBkdCA+IGUucGFyYW0gICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmN1c3RvbWVyPXNlbGYuY3VzdG9tZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5vdXQoc2ltKSAjIG91dCB0aGVyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb19vdXQ9RmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZG9fb3V0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm91dChzaW0pICAgICAjIHBhc3MgY3VzdG9tZXIgdG8gY29ubmVjdGVkIG9iamVjdAogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNlbGYsT3JHYXRlKSBhbmQgbGVuKHNlbGYub3V0cHV0KT09MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50KCJwb3A6IixzZWxmLmN1c3RvbWVyLm5hbWUsc2VsZi5jdXN0b21lci5OKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLk4ucG9wKCkKICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IE5vbmUgICAgIyBtYXJrIHRoYXQgbm93IHRoZSBzZXJ2aWNlIGlzIGZyZWUgISEhCiAgICAgICAgICAgIGlmIGxlbihzZWxmLnF1ZXVlKT4wIDogICMgYnV0IGlmIGFueWJvZHkgaW4gcXVldWUKICAgICAgICAgICAgICAgICAgU2VydmljZS5pbnNlcnQoc2VsZixzZWxmLnF1ZXVlLnBvcCgpLCBzaW0pICAjIGdldCBhbmQgaW5zZXJ0IGludG8gc2ltdWxhdG9yCmNsYXNzIFNpbmsoQnBtbkV2ZW50KToKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOiAgICAKICAgICAgICAgICAgX3ByaW50KCJTaW5raW5nICIrc3RyKGN1c3QpKyIgOiAiK3N0cihzaW0ubm93KCkpKQogICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl0gPSBzaW0ubm93KCkgICMgbWFyayB0aW1lIGluIGN1c3RvbWVyIGF0dHJpYnV0ZXMKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdID0gc2ltLm5vdygpICAjIG1hcmsgdGltZSBpbiBjdXN0b21lciBhdHRyaWJ1dGVzCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IHNpbS5ub3coKSAgIyBtYXJrIHRpbWUgaW4gY3VzdG9tZXIgYXR0cmlidXRlcwogICAgICAgICAgICBzZWxmLkFbIkEubiJdICs9IDEKICAgICAgICAgICAgc2VsZi5xdWV1ZS5wdXNoKGN1c3QpICAgICAjIGluc2VydCBvbmx5IHRvIGl0cyBxdWV1ZQogICAgICAgICAgICBzZWxmLmN1c3RvbWVyPWN1c3QKICAgICAgICAgICAgaWYgc2VsZi5jb2RlIT1Ob25lIDoKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUpICAgIyBldmFsdWF0ZSBzY3JpcHQgY29kZQojIC0tLS0gYnBtbiBkZXJpdmVkIGNsYXNzZXMgKGZyb20gR2VuZXJhdG9yLCBTZXJ2aWNlLCBDb25kaXRpb25hbEV2ZW50IG9yIFNpbmspIC0tLS0KY2xhc3MgWG9yR2F0ZShTZXJ2aWNlKTogICAgIyByYW5kb20gb3V0cHV0IGlmIHR3byBvdXRwdXRzIAogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOiAgIyBkZWZhdWx0cyB0byBiaW5hcnkgcmFuZG9tIHNlbGVjdGlvbgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiZXhjbHVzaXZlR2F0ZXdheSIpCmNsYXNzIE9yR2F0ZShTZXJ2aWNlKTogICAgIyBvdXRwdXQgY29uZGl0aW9uIG11c3QgYmUgZGVmaW5lZCBieSBhcnJheSBvZiB2YWx1ZXMhIAogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiaW5jbHVzaXZlR2F0ZXdheSIpCmNsYXNzIEFuZEdhdGUoU2VydmljZSk6ICAgIAogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgicGFyYWxsZWxHYXRld2F5IikKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOgogICAgICAgICAgICBpZHM9W2UuaWQgZm9yIGUgaW4gc2VsZi5wcmV2KCldICMgaWRzIG9mIGlucHV0cwogICAgICAgICAgICBzZWxmLk49bGVuKHNldChpZHMpKSAjIHNldCBudW1iZXIgb2YgaW5wdXRzICh3aXRoIHVuaXF1ZSBpZHMpIHRvIHdhaXQKICAgICAgICAgICAgU2VydmljZS5pbnNlcnQoc2VsZixjdXN0LHNpbSkKY2xhc3MgU3RhcnQoR2VuZXJhdG9yKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsZnVuPUUscGFyYW09WzFdLHRtYXg9NTAuMCxjb2RlPU5vbmUpOgogICAgICAgICAgICBHZW5lcmF0b3IuX19pbml0X18oc2VsZixmdW4scGFyYW0sdG1heCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInN0YXJ0RXZlbnQiKQpjbGFzcyBUYXNrKFNlcnZpY2UpOgogICAgICBkZWYgX19pbml0X18oc2VsZixmdW49VSxwYXJhbT1bMSwyXSxjb2RlPU5vbmUsTT0xKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLGZ1bixwYXJhbSxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInRhc2siKQogICAgICAgICAgICBzZWxmLnNlcnZlcnMsIHNlbGYubnNlcnZlciwgc2VsZi5NID0gW10sIDAsIE0KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2Uoc2VsZi5NLTEpOgogICAgICAgICAgICAgICAgICBFdmVudC5jbnQgLT0xCiAgICAgICAgICAgICAgICAgIHNlbGYuc2VydmVycy5hcHBlbmQoU2VydmljZShmdW4scGFyYW0sY29kZSkpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgaWYoc2VsZi5uc2VydmVyPT0wKTogICMgbXlzZWxmCiAgICAgICAgICAgICAgICAgIFNlcnZpY2UuaW5zZXJ0KHNlbGYsY3VzdCxzaW0pCiAgICAgICAgICAgIGVsc2U6ICAgICAgICAgICAgICAjIG90aGVyc2VsZnMKICAgICAgICAgICAgICAgICAgc2VsZi5zZXJ2ZXJzW3NlbGYubnNlcnZlci0xXS5pbnNlcnQoY3VzdCxzaW0pCiAgICAgICAgICAgIHNlbGYubnNlcnZlciA9IChzZWxmLm5zZXJ2ZXIrMSklc2VsZi5NCmNsYXNzIFRpbWVyKFNlcnZpY2UpOgogICAgICBkZWYgX19pbml0X18oc2VsZixmdW49MSxwYXJhbT1Ob25lLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIGlmIG5vdCBjYWxsYWJsZShmdW4pOiAgIyB3aGVuIHBhc3NpbmcgZml4ZWQgZGVsYXkgdmFsdWUKICAgICAgICAgICAgICAgICAgZnVuLHBhcmFtLGNvZGUgPSBOb25lLGZ1bixwYXJhbQogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsZnVuLHBhcmFtLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiaW50ZXJtZWRpYXRlQ2F0Y2hFdmVudCIpCmNsYXNzIEVuZChTaW5rKToKICAgICAgI2RlZiBfX2luaXRfXyhzZWxmKToKICAgICAgIyAgICAgIFNpbmsuX19pbml0X18oc2VsZikKICAgICAgIyAgICAgIHNlbGYuc2V0TmFtZSgiZW5kRXZlbnQiKQogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTaW5rLl9faW5pdF9fKHNlbGYsImVuZEV2ZW50Iixjb2RlKQpjbGFzcyBUaHJvdyhTZXJ2aWNlKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImludGVybWVkaWF0ZVRocm93RXZlbnQiKQpjbGFzcyBUZXJtaW5hdGUoRW5kKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgRW5kLl9faW5pdF9fKHNlbGYsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJ0ZXJtaW5hdGVFbmRFdmVudCIpCmNsYXNzIFNjcmlwdChTZXJ2aWNlKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInNjcmlwdFRhc2siKQpjbGFzcyBDb25kaXRpb24oQ29uZGl0aW9uYWxFdmVudCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIENvbmRpdGlvbmFsRXZlbnQuX19pbml0X18oc2VsZixjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImludGVybWVkaWF0ZUNhdGNoRXZlbnQiKQoKIyAtLS0tIHV0aWwyIC0tLS0tLS0tICAgICAgCmRlZiBjb25uZWN0KGEsIGIpOgogICAgICBhLm91dHB1dC5hcHBlbmQoYikKICAgICAgaWYgaXNpbnN0YW5jZShhLFRhc2spOgogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oYS5zZXJ2ZXJzKSk6ICAjIGZpcnN0IHNlcnZlciBpcyBhbHJlYWR5IGNvbm5lY3RlZAogICAgICAgICAgICAgICAgICBhLnNlcnZlcnNbaV0ub3V0cHV0LmFwcGVuZChiKQpkZWYgZGljdF90b3N0cmluZyhhKToKICAgICAgcmV0dXJuICJcbiIuam9pbihbaysiOlx0IitzdHIodikgZm9yIGssdiBpbiBhLml0ZW1zKCldKQoiIiIKZGVmIGhpc3QoYT1bMCwxXSwgYj0yMCwgYz0nb3JhbmdlJyk6CiAgICAgIGltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKICAgICAgcGx0Lmhpc3QoYSxiLGNvbG9yPWMpCiAgICAgICNwbHQuc2F2ZWZpZygiZGVzX3Bsb3Quc3ZnIiwgZm9ybWF0PSJzdmciKQogICAgICAjcGx0LnNob3coKQogICAgICBpbXBvcnQgaW8sIGJhc2U2NAogICAgICBidWYgPSBpby5CeXRlc0lPKCkKICAgICAgcGx0LnNhdmVmaWcoYnVmLCBmb3JtYXQ9J3N2ZycpCiAgICAgIGJ1Zi5zZWVrKDApCiAgICAgIHJldHVybiAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgYmFzZTY0LmI2NGVuY29kZShidWYucmVhZCgpKS5kZWNvZGUoJ1VURi04JykKIiIiCmRlZiBmcm9tX2ZpbGUoZm5hbWUpOgogICAgICB3aXRoIG9wZW4oZm5hbWUsInIiKSBhcyBmcDoKICAgICAgICAgICAgcmV0dXJuIGZwLnJlYWQoKQoKIyAtLS0tIGNvbnZlcnNpb25zIC0tLS0tLS0tICAgICAgCmRlZiBhdHRyX3Rvc3RyaW5nKGEpOgogICAgICBzPSJuYW1lOiAiK2FbIm5hbWUiXSsiXG4iCiAgICAgIGZvciBpIGluIHJhbmdlKDEsMTAwKToKICAgICAgICAgICAgdD0iX190IitzdHIoaSkKICAgICAgICAgICAgaWYgdCsiYiIgaW4gYToKICAgICAgICAgICAgICAgICAgcys9dCsiICIrIiUuM2YiJWFbdCsiYiJdKyIgIisiJS4zZiIlYVt0KyJlIl0rIlxuIgogICAgICByZXR1cm4gcwpkZWYgYXR0cl90b3N2Z3N0cmluZyhvLHdtYXgsdz0xNixoPTI0KToKICAgICAgZ2xvYmFsIEVOCiAgICAgIGEscyA9IG8uYXR0ciwiIgogICAgICBjPVsnaG90cGluaycsJ2xpbWVncmVlbicsJ2Nvcm5mbG93ZXJibHVlJywnY29yYWwnLCdtZWRpdW1zZWFncmVlbicsJ21lZGl1bXB1cnBsZSddCiAgICAgIGZvciBpIGluIHJhbmdlKDEwMCk6CiAgICAgICAgICAgIHQ9Il9fdCIrc3RyKGkpCiAgICAgICAgICAgIGlmIHQrImIiIGluIGE6CiAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSI4IiB5PSInK3N0cigzMitoKmkpKyciPicrc3RyKGkpKyc8dGl0bGU+JytzdHIoRU4uZWVbaS0xXS5uYW1lKSsnICcrc3RyKEVOLmVlW2ktMV0udGl0bGUpKyc8L3RpdGxlPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IGNsYXNzPSJ0MSIgc3R5bGU9ImRpc3BsYXk6bm9uZTtmaWxsOmdyYXkiIHg9IjMyIiB5PSInK3N0cigzMitoKmkpKyciPicrc3RyKEVOLmVlW2ktMV0udGl0bGUpKyc8dGl0bGU+JytzdHIoRU4uZWVbaS0xXS5uYW1lKSsnPC90aXRsZT48L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgIHQwLHQxLHQyID0gYVt0KyJhIl0sYVt0KyJiIl0sYVt0KyJlIl0KICAgICAgICAgICAgICAgICAgcys9JzxyZWN0IHk9Iicrc3RyKDIwK2gqaSkrJyIgeD0iJytzdHIoMjArdyp0MSkKICAgICAgICAgICAgICAgICAgcys9JyIgd2lkdGg9Iicrc3RyKHQyLXQxPT0wIGFuZCAxIG9yIHcqKHQyLXQxKSkrJyIgaGVpZ2h0PSInK3N0cihoLTIpKyciIHN0cm9rZT0iYmxhY2siIGZpbGwtb3BhY2l0eT0iMC43IiBmaWxsPSInCiAgICAgICAgICAgICAgICAgIHMrPShjW2ludChhWyJjbmFtZSJdLnNwbGl0KCcgJylbMF0pJWxlbihjKV0pKyciPjx0aXRsZT4nK2FbImNuYW1lIl0rJyBbJysoIiUuMmYsICIldDApKygiJS4yZiwgIiV0MSkrKCIlLjJmIiV0MikrJ10nKyc8L3RpdGxlPjwvcmVjdD5cbicKICAgICAgICAgICAgICAgICAgaWYgdDItdDE+MC41OgogICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoMjArdyp0MSsyKSsnIiB5PSInK3N0cigyMCtoKmkrMTgpKyciPicrYVsiY25hbWUiXSsnPC90ZXh0PicKICAgICAgICAgICAgICAgICAgaWYgdyp0MT53bWF4WzBdOgogICAgICAgICAgICAgICAgICAgICAgICB3bWF4WzBdID0gdyp0MQogICAgICByZXR1cm4gcwpkZWYgdG9fc3ZnKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHcsaCxXLEggPSAxNiwyNCxbMTYwXSw0MCAgIyBXWzBdIGZvciBwYXNzaW5nIGJ5IHJlZmVyZW5jZSEhIQogICAgICBzID0gJzxzdmcgb25jbGljaz0ib25fY2xpY2soKSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iJWQiIGhlaWdodD0iJWQiPlxuJwogICAgICBmb3IgZSBpbiBlZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLEVuZCk6CiAgICAgICAgICAgICAgICAgIGZvciBjIGluIGUucXVldWUub2JqZWN0czoKICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBhdHRyX3Rvc3Znc3RyaW5nKGMsVyx3LGgpCiAgICAgICAgICAgIEggKz0gMjQKICAgICAgSCs9MjQKICAgICAgcys9ICc8cmVjdCB4PSIyMCIgeT0iMTAiIHdpZHRoPSIlZCIgaGVpZ2h0PSIyIi8+XG4nJShXWzBdK3cpCiAgICAgIHMrPSAnPHJlY3QgeD0iMjAiIHk9IiVkIiB3aWR0aD0iJWQiIGhlaWdodD0iMiIvPlxuJyUoSCsxMCxXWzBdK3cpCiAgICAgIGZvciBpIGluIHJhbmdlKGludChXWzBdL3crMikpOgogICAgICAgICAgICBzICs9ICc8cmVjdCB4PSInK3N0cigyMCt3KmkpKyciIHk9IjEwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxMCIvPlxuJwogICAgICAgICAgICBzICs9ICc8cmVjdCB4PSInK3N0cigyMCt3KmkpKyciIHk9IiVkIiB3aWR0aD0iMSIgaGVpZ2h0PSIxMCIvPlxuJyUoSCkKICAgICAgICAgICAgaWYgKGklMTApPT0wOgogICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoMjArdyppLTgpKyciIHk9IjMyIj4nK3N0cihpKSsnPC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoMjArdyppLTgpKyciIHk9IiVkIj4nJShIKStzdHIoaSkrJzwvdGV4dD5cbicKICAgICAgcyArPSAiPHNjcmlwdD5mdW5jdGlvbiBvbl9jbGljaygpIHtbLi4uZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndDEnKV0uZm9yRWFjaChlPT5lLnN0eWxlLmRpc3BsYXk9KGUuc3R5bGUuZGlzcGxheT09J25vbmUnPycnOidub25lJykpO308L3NjcmlwdD4iCiAgICAgIHJldHVybiBzJShXWzBdKzgwLEgrMjApICsgJzwvc3ZnPlxuJwpkZWYgdG9fZG90MChlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMpOgogICAgICBzID0nZGlncmFwaCBCUE1OIHsgcmFua2Rpcj0iTFIiIHJhbmtzZXA9MSBub2Rlc2VwPTFcbicKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6CiAgICAgICAgICAgIHMxID0gJyAge3Jhbms9c2FtZTsgJwogICAgICAgICAgICBmb3IgaiBpbiByYW5nZShsZW4oZWVbaV0ub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgIHMgKz0gIiAgIitzdHIoZWVbaV0uaWQpICsgIiAtPiAiICsgc3RyKGVlW2ldLm91dHB1dFtqXS5pZCkgKyJcbiIKICAgICAgICAgICAgICAgICAgczEgKz0gc3RyKGVlW2ldLm91dHB1dFtqXS5pZCkgKyI7ICIKICAgICAgICAgICAgaWYgbGVuKGVlW2ldLm91dHB1dCk+MToKICAgICAgICAgICAgICAgICAgaWYgYWJzKGVlW2ldLm91dHB1dFswXS5pZC1lZVtpXS5vdXRwdXRbMV0uaWQpPDI6IHMgKz0gczEgKyd9XG4nCiAgICAgIHJldHVybiBzKyd9JwpkZWYgdG9fZG90KGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHMgPSdkaWdyYXBoIEJQTU4yIHsgcmFua2Rpcj0iTFIiIG5vZGVzZXA9MC42XG4nCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgbGFiZWwseGxhYmVsLHNoYXBlLHN0eWxlLGNvbG9yLHBlbiA9IHN0cihlZVtpXS5pZCksIiIsInJlY3QiLCIiLCIiLCIxIgogICAgICAgICAgICBzaXplPSIiCiAgICAgICAgICAgIGlmICJ2ZW50IiBpbiBlZVtpXS5uYW1lOiBzaGFwZT0iY2lyY2xlIgogICAgICAgICAgICBlbGlmICJhdGV3YXkiIGluIGVlW2ldLm5hbWU6IHNoYXBlPSJkaWFtb25kIjsgc2l6ZT0iaGVpZ2h0PTAuNyIKICAgICAgICAgICAgaWYgImludGVybWVkaWF0ZSIgaW4gZWVbaV0ubmFtZTogc2hhcGU9ImRvdWJsZWNpcmNsZSIKICAgICAgICAgICAgaWYgc2hhcGU9PSJyZWN0Ijogc3R5bGU9InJvdW5kZWQsZmlsbGVkIjsgY29sb3I9ImxpZ2h0Ymx1ZSI7IHNpemU9IndpZHRoPTEuMSBoZWlnaHQ9MC44IgogICAgICAgICAgICBlbGlmICJlbmQiIGluIGVlW2ldLm5hbWU6IHN0eWxlPSJmaWxsZWQiOyBwZW49IjMiCiAgICAgICAgICAgIGlmICJleGNsdXNpdmUiIGluIGVlW2ldLm5hbWU6IHhsYWJlbD1sYWJlbDsgbGFiZWw9IlgiCiAgICAgICAgICAgIGVsaWYgInBhcmFsbGVsIiBpbiBlZVtpXS5uYW1lOiB4bGFiZWw9bGFiZWw7IGxhYmVsPSIrIgogICAgICAgICAgICBlbGlmICJpbmNsdXNpdmUiIGluIGVlW2ldLm5hbWU6IHhsYWJlbD1sYWJlbDsgbGFiZWw9Ik8iCiAgICAgICAgICAgIHMgKz0gJyAgJytlZVtpXS5uYW1lICsnIFtsYWJlbD0iJytsYWJlbCsnIiB4bGFiZWw9IicreGxhYmVsCiAgICAgICAgICAgIHMgKz0gJyIgc3R5bGU9Iicrc3R5bGUrJyIgc2hhcGU9Iicrc2hhcGUrJyIgZmlsbGNvbG9yPSInCiAgICAgICAgICAgIHMgKz0gY29sb3IrJyIgcGVud2lkdGg9IicrcGVuKyciICcrc2l6ZSsnXScgKydcbicKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6CiAgICAgICAgICAgIGlmIGVlW2ldPT1Ob25lOiBjb250aW51ZQogICAgICAgICAgICBzMSA9ICcgIHtyYW5rPXNhbWU7ICcKICAgICAgICAgICAgZm9yIGogaW4gcmFuZ2UobGVuKGVlW2ldLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICBzICs9ICIgICIrZWVbaV0ubmFtZSArICIgLT4gIiArIGVlW2ldLm91dHB1dFtqXS5uYW1lICsiXG4iCiAgICAgICAgICAgICAgICAgIHMxICs9IGVlW2ldLm91dHB1dFtqXS5uYW1lICsiOyAiCiAgICAgICAgICAgIGlmIGxlbihlZVtpXS5vdXRwdXQpPjE6CiAgICAgICAgICAgICAgICAgIGlmIGFicyhlZVtpXS5vdXRwdXRbMF0uaWQtZWVbaV0ub3V0cHV0WzFdLmlkKTwyOiBzICs9IHMxICsnfVxuJwogICAgICByZXR1cm4gcysnfScKZGVmIHRvX3Bvc2l0aW9uKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHBwPVtdCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOiAgICMgc2V0IHggcG9zaXRpb24gdG8gdHJlZSBsZXZlbAogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZToKICAgICAgICAgICAgICAgICAgcHAuYXBwZW5kKE5vbmUpCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHgsZXAgPSAwLGVlW2ldLnByZXYoKQogICAgICAgICAgICBmb3IgaWR4IGluIHJhbmdlKGxlbihlcCktMSwtMSwtMSk6CiAgICAgICAgICAgICAgICAgIGlmIGVwW2lkeF0ucHBbMF0hPS0xOgogICAgICAgICAgICAgICAgICAgICAgICB4PWVwW2lkeF0ucHBbMF0rMQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlZVtpXS5wcD1beCwwXQogICAgICAgICAgICBwcC5hcHBlbmQoZWVbaV0ucHApCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pCiAgICAgIGZvciBpIGluIHJhbmdlKDEsbGVuKHBwKSk6ICMgaW5jcmVhc2UgeSBwb3NpdGlvbiBmb3IgYWxsIGF0IHRoZSBzYW1lIGxldmVsCiAgICAgICAgICAgIGlmIHBwW2ldIT1Ob25lIGFuZCBwcFtpLTFdIT1Ob25lIGFuZCBwcFtpXVswXT09cHBbaS0xXVswXToKICAgICAgICAgICAgICAgICAgcHBbaV1bMV0gPSBwcFtpLTFdWzFdKzEKICAgICAgICAgICAgICAgICAgZWVbaV0ucHA9cHBbaV0KICAgICAgI3ByaW50KFtfLnBwIGZvciBfIGluIGVlXSkKICAgICAgIyIiIgogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpLTEsLTEsLTEpOiAgICMgc2V0IHkgcG9zaXRpb24gdG8gdGhlIGxldmVsIG9mIHByZXZpb3VzIAogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgZSA9IGVlW2ldLnByZXYoKQogICAgICAgICAgICBpZiBsZW4oZSk+MCBhbmQgZVswXS5vdXRwdXRbMF09PWVlW2ldOgogICAgICAgICAgICAgICAgICBwcFtpXVsxXSA9IGVbMF0ucHBbMV0KICAgICAgICAgICAgICAgICAgZWVbaV0ucHA9cHBbaV0KICAgICAgICAgICAgaWYgbGVuKGUpPjAgYW5kIGxlbihlWzBdLm91dHB1dCk+MSBhbmQgZVswXS5vdXRwdXRbMV09PWVlW2ldIGFuZCBsZW4oZWVbaV0ub3V0cHV0KT09MDoKICAgICAgICAgICAgICAgICAgcHBbaV1bMF0gPSBlZVtpXS5wcFswXS0xICAjIHdoZW4gaXQgaXMgdGhlIHNlY29uZCBhbmQgaGFzIG5vIG91cHV0CiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwPXBwW2ldCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pCiAgICAgICMiIiIKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKS0xLC0xLC0xKTogIyBtb3ZlIHByZXZpb3VzIHRvIHRoZSBsZXZlbCBvZiBpdHMgZmlyc3QgbmV4dAogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgZXA9ZWVbaV0ucHJldigpCiAgICAgICAgICAgIGlmIGxlbihlcCk+MCBhbmQgZXBbMF0ub3V0cHV0WzBdPT1lZVtpXSBhbmQgZXBbMF0ucHBbMF09PWVlW2ldLnBwWzBdLTE6CiAgICAgICAgICAgICAgICAgIGlmIGVwWzBdLnBwWzFdIT1lZVtpXS5wcFsxXToKICAgICAgICAgICAgICAgICAgICAgICAgZXBbMF0ucHBbMV09ZWVbaV0ucHBbMV0KICAgICAgI3ByaW50KFtfLnBwIGZvciBfIGluIGVlXSkgICAgICAKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6ICAjIGZvcmNlIHBvc2l0aW9uIGZyb20gcHAyCiAgICAgICAgICAgIGlmIGVlW2ldPT1Ob25lOiBjb250aW51ZQogICAgICAgICAgICBpZiBlZVtpXS5wcDJbMF0hPS0xOgogICAgICAgICAgICAgICAgICBlZVtpXS5wcFswXT1lZVtpXS5wcDJbMF0KICAgICAgICAgICAgaWYgZWVbaV0ucHAyWzFdIT0tMToKICAgICAgICAgICAgICAgICAgZWVbaV0ucHBbMV09ZWVbaV0ucHAyWzFdCiAgICAgIGZvciBlIGluIGVlOiAgICMgY29ycmVjdCBwb3NpdGlvbiBvZiBib3VuZGFyeSBldmVudHMKICAgICAgICAgICAgaWYgZT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgI2lmKGUucHBbMF09PTAgYW5kIGUucHBbMV09PTApOgogICAgICAgICAgICBpZihlLmlkIT1lLmlkMik6CiAgICAgICAgICAgICAgICAgIGlkMj1pbnQoc3RyKGUuaWQyKS5zcGxpdCgiLiIpWzFdKQogICAgICAgICAgICAgICAgICBlLnBwWzBdLGUucHBbMV0gPSBlZVtpZDItMV0ucHBbMF0sZWVbaWQyLTFdLnBwWzFdCiAgICAgIHJldHVybiBbZS5wcCBmb3IgZSBpbiBmaWx0ZXIoTm9uZSxlZSldCmRlZiB0b19icG1uKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyxwcD1Ob25lKToKICAgICAgcyA9Jzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ij8+XG4nCiAgICAgIHMrPSc8YnBtbjpkZWZpbml0aW9ucyB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIicKICAgICAgcys9JyB4bWxuczpicG1uPSJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L01PREVMIicKICAgICAgcys9JyB4bWxuczpicG1uZGk9Imh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0JQTU4vMjAxMDA1MjQvREkiJwogICAgICBzKz0nIHhtbG5zOmRjPSJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9EQyInCiAgICAgIHMrPScgeG1sbnM6ZGk9Imh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0RELzIwMTAwNTI0L0RJIicKICAgICAgcys9JyB0YXJnZXROYW1lc3BhY2U9Imh0dHA6Ly9icG1uLmlvL3NjaGVtYS9icG1uIicKICAgICAgcys9JyBpZD0iRGVmaW5pdGlvbnNfMSIgZXhwb3J0ZXI9ImRlcyIgZXhwb3J0ZXJWZXJzaW9uPSIxLjAiPlxuJwogICAgICBzMT0nIDxicG1uOnByb2Nlc3MgaWQ9IlByb2Nlc3NfMSI+XG4nCiAgICAgIHMyPScgPGJwbW5kaTpCUE1ORGlhZ3JhbSBpZD0iQlBNTkRpYWdyYW1fMSI+XG4nCiAgICAgIHMyKz0nICA8YnBtbmRpOkJQTU5QbGFuZSBpZD0iQlBNTlBsYW5lXzEiIGJwbW5FbGVtZW50PSJQcm9jZXNzXzEiPlxuJwogICAgICBzMWE9JycKICAgICAgajEgPSAwICAjIGZsb3cgY291bnRlcgogICAgICBXLEgsVzAsSDAgPSAxMDAsMTAwLDQwLDMwCiAgICAgIGlmIG5vdCBwcDoKICAgICAgICAgICAgcHAgPSBbZS5wcCBmb3IgZSBpbiBmaWx0ZXIoTm9uZSxlZSldCiAgICAgICAgICAgIGlmIHBwWzBdWzBdPT0tMToKICAgICAgICAgICAgICAgICAgcHAgPSB0b19wb3NpdGlvbihmaWx0ZXIoTm9uZSxlZSkpCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgbmFtZSA9IGVlW2ldLm5hbWUKICAgICAgICAgICAgaWYgInRlcm1pbmF0ZSIgaW4gbmFtZToKICAgICAgICAgICAgICAgICAgbmFtZT1uYW1lW2xlbigidGVybWluYXRlIik6XQogICAgICAgICAgICBlbmFtZSA9IGVlW2ldLl9fY2xhc3NfXy5fX25hbWVfXysnXycrc3RyKGVlW2ldLmZ1biBhbmQgZWVbaV0uZnVuLl9fbmFtZV9fIG9yIE5vbmUpKydfJwogICAgICAgICAgICBpbXBvcnQgYmFzZTY0CiAgICAgICAgICAgIGVuYW1lICs9IGJhc2U2NC5iMTZlbmNvZGUoYnl0ZWFycmF5KHN0cihlZVtpXS5wYXJhbSkrJ18nK3N0cihlZVtpXS5jb2RlKSwnYXNjaWknKSkuZGVjb2RlKCdhc2NpaScpICMgcmVxdWlyZXMgZW5jb2RpbmchCiAgICAgICAgICAgIHR5cGU9bmFtZS5zcGxpdCgiXyIpWzBdCiAgICAgICAgICAgIGd0PXsid2kiOjgwLCJoIjo2MCwib3giOjAsIm95IjowLCJlIjooODAsMzApLCJ3IjooMCwzMCksIm4iOig0MCwwKSwicyI6KDQwLDYwKX0KICAgICAgICAgICAgZ2c9eyJ3aSI6MzYsImgiOjM2LCJveCI6MjIsIm95IjoxMiwiZSI6KDU4LDMwKSwidyI6KDIyLDMwKSwibiI6KDQwLDEyKSwicyI6KDQwLDQ4KX0KICAgICAgICAgICAgZzEgPSBndCBpZiAiYXNrIiBpbiB0eXBlIGVsc2UgZ2cKICAgICAgICAgICAgdyxoID0gZzFbIndpIl0sZzFbImgiXSAgIyBpY29uIHNpemUKICAgICAgICAgICAgeGIseWIgPSBXMCtXKnBwW2ldWzBdLCBIMCtIKnBwW2ldWzFdCiAgICAgICAgICAgIHhvLHlvID0geGIrZzFbIm94Il0sIHliK2cxWyJveSJdICMgaWNvbiBvZmZzZXQKICAgICAgICAgICAgaWYgInRhc2siIGluIHR5cGU6CiAgICAgICAgICAgICAgICAgIGlmIGxlbihlZVtpXS5vdXRwdXQpPjE6IHR5cGUgPSAic2VuZFRhc2siCiAgICAgICAgICAgICAgICAgIGlmIGxlbihzZXQoW2UuaWQgZm9yIGUgaW4gZWVbaV0ucHJldigpXSkpPjE6IHR5cGUgPSAicmVjZWl2ZVRhc2siCiAgICAgICAgICAgIGR5byA9IDAKICAgICAgICAgICAgaWYgZWVbaV0uaWQgIT0gZWVbaV0uaWQyOiAgIyBmb3IgYm91bmRhcnkgZXZlbnRzCiAgICAgICAgICAgICAgICAgIGlkMiA9IGludChzdHIoZWVbaV0uaWQyKS5zcGxpdCgnLicpWzFdKQogICAgICAgICAgICAgICAgICB4byx5byA9IGVlW2lkMi0xXS54KzIyLjUsZWVbaWQyLTFdLnkrNDIuNQogICAgICAgICAgICAgICAgICBkeW8gPSAzMAogICAgICAgICAgICAgICAgICB0eXBlID0gImJvdW5kYXJ5RXZlbnQiCiAgICAgICAgICAgIGVlW2ldLngsZWVbaV0ueSA9IHhvLHlvCiAgICAgICAgICAgIHMxKz0nICA8YnBtbjonK3R5cGUrJyBpZD0iJytuYW1lKyciIG5hbWU9IicrbmFtZS5zcGxpdCgiXyIpWzFdKydcbicrZWVbaV0udGl0bGUrJyI+XG4nCiAgICAgICAgICAgIHMyKz0nICAgPGJwbW5kaTpCUE1OU2hhcGUgaWQ9IicrbmFtZSsnXycrZW5hbWUrJyIgYnBtbkVsZW1lbnQ9IicrbmFtZSsnIj5cbicKICAgICAgICAgICAgczIrPScgICAgPGRjOkJvdW5kcyB4PSInK3N0cih4bykrJyIgeT0iJytzdHIoeW8pKyciIHdpZHRoPSInK3N0cih3KSsnIiBoZWlnaHQ9Iicrc3RyKGgpKyciIC8+XG4nCiAgICAgICAgICAgIHMyKz0nICAgPC9icG1uZGk6QlBNTlNoYXBlPlxuJwogICAgICAgICAgICBmb3IgajIgaW4gcmFuZ2UobGVuKGVlW2ldLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICBqMSArPSAxCiAgICAgICAgICAgICAgICAgIGZsb3csZWZsb3c9J0Zsb3dfJytzdHIoajEpLCJkaSIKICAgICAgICAgICAgICAgICAgaWkgPSBlZVtpXS5vdXRwdXRbajJdLmlkLTEKICAgICAgICAgICAgICAgICAgI3ByaW50KGVlW2ldLGoyLGVlW2ldLm91dHB1dFtqMl0saWkscHApCiAgICAgICAgICAgICAgICAgIHhlLHllID0gVzArVypwcFtpaV1bMF0sIEgwK0gqcHBbaWldWzFdCiAgICAgICAgICAgICAgICAgIG5hbWUyPWVlW2ldLm91dHB1dFtqMl0ubmFtZQogICAgICAgICAgICAgICAgICBpZiAidGVybWluYXRlIiBpbiBuYW1lMjoKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTI9bmFtZTJbbGVuKCJ0ZXJtaW5hdGUiKTpdCiAgICAgICAgICAgICAgICAgIHR5cGUyPW5hbWUyLnNwbGl0KCJfIilbMF0KICAgICAgICAgICAgICAgICAgZzIgPSBndCBpZiAiYXNrIiBpbiB0eXBlMiBlbHNlIGdnCiAgICAgICAgICAgICAgICAgIGlmIHhlPnhiOiAjIHR3byBlZGdlcwogICAgICAgICAgICAgICAgICAgICAgICBkeDEsZHkxID0gZzFbInMiXSBpZiB5Yjx5ZSBlbHNlIGcxWyJlIl0KICAgICAgICAgICAgICAgICAgICAgICAgZHgyLGR5MiA9IGcyWyJzIl0gaWYgeWI+eWUgZWxzZSBnMlsidyJdCiAgICAgICAgICAgICAgICAgIGVsc2UgOiAgICAjIHRocmVlIGVkZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgIGR4MSxkeTEgPSBnMVsicyJdIGlmIHliPHllIGVsc2UgZzFbIm4iXQogICAgICAgICAgICAgICAgICAgICAgICBkeDIsZHkyID0gZzJbInMiXSBpZiB5Yj55ZSBlbHNlIGcyWyJuIl0KICAgICAgICAgICAgICAgICAgeDEseTEgPSB4YitkeDEseWIrZHkxCiAgICAgICAgICAgICAgICAgIHgyLHkyID0geGUrZHgyLHllK2R5MgogICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOm91dGdvaW5nPicrZmxvdysnPC9icG1uOm91dGdvaW5nPlxuJwogICAgICAgICAgICAgICAgICBpZiAiaW50ZXJtZWRpYXRlQ2F0Y2giIGluIG5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICJvbmRpdGlvbiIgaW4gZW5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMxKz0nICAgPGJwbW46Y29uZGl0aW9uYWxFdmVudERlZmluaXRpb24vPlxuJwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOnRpbWVyRXZlbnREZWZpbml0aW9uLz5cbicKICAgICAgICAgICAgICAgICAgeTEgKz0gZHlvCiAgICAgICAgICAgICAgICAgIHMxYSs9JyAgICA8YnBtbjpzZXF1ZW5jZUZsb3cgaWQ9IicrZmxvdysnIiBzb3VyY2VSZWY9IicrbmFtZSsnIiB0YXJnZXRSZWY9IicrbmFtZTIrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgczIrPScgICA8YnBtbmRpOkJQTU5FZGdlIGlkPSInK2Zsb3crJ18nK2VmbG93KyciIGJwbW5FbGVtZW50PSInK2Zsb3crJyI+XG4nCiAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MSkrJyIgeT0iJytzdHIoeTEpKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgIHh4LHl5ID0gMCwwCiAgICAgICAgICAgICAgICAgIGlmIHkxIT15MjogIyByZXF1aXJlcyBhZGRpdGlvbmFsIHBvaW50cyAob25lIG9yIHR3byBpbXBsZW1lbnRlZCkKICAgICAgICAgICAgICAgICAgICAgICAgeHgsIHl5ID0geTI+eTEgYW5kIHgxIG9yIHgyLCB5Mj55MSBhbmQgeTIgb3IgeTEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgeDE+eDI6ICMgYmFjayBjb25uZWN0aW9uIHJlcXVpcmVzIHR3byBhZGRpdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHkxPnkyOiAjIGZyb20gbG93ZXIgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeXkgLT0gMzUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgxKSsnIiB5PSInK3N0cih5eSkrJyIgLz5cbicgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgeTE8eTI6ICMgZnJvbSB1cHBlciBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5eSAtPSAyNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeHgpKyciIHk9Iicrc3RyKHl5KSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4eCA9IHgyCiAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4eCkrJyIgeT0iJytzdHIoeXkpKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgIGVsaWYgeTE9PXkyIGFuZCB4MT54MjogIyBsb29wYmFjayAtIHJlcXVpcmVzIHR3byBhZGRpdGlvbmFsIHBvaW50cwogICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDEpKyciIHk9Iicrc3RyKHkxLTMwKSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDIpKyciIHk9Iicrc3RyKHkyLTMwKSsnIiAvPlxuJyAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgaWYgeHghPXgyIG9yIHl5IT15MjoKICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgyKSsnIiB5PSInK3N0cih5MikrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgczIrPScgICA8L2JwbW5kaTpCUE1ORWRnZT5cbicKICAgICAgICAgICAgaWYgInRlcm1pbmF0ZSIgaW4gZWVbaV0ubmFtZToKICAgICAgICAgICAgICAgICAgczErPScgICA8YnBtbjp0ZXJtaW5hdGVFdmVudERlZmluaXRpb24vPlxuJwogICAgICAgICAgICBzMSs9JyAgPC9icG1uOicrdHlwZSsnPlxuJwogICAgICAgICAgICBwYXNzCiAgICAgIHMyKz0nICA8L2JwbW5kaTpCUE1OUGxhbmU+XG4nCiAgICAgIHMyKz0nIDwvYnBtbmRpOkJQTU5EaWFncmFtPlxuJwogICAgICBzMSs9czFhKycgPC9icG1uOnByb2Nlc3M+XG4nCiAgICAgIHJldHVybiBzK3MxK3MyKyc8L2JwbW46ZGVmaW5pdGlvbnM+XG4nCgplbl90aXRsZSA9ICIiCmltcG9ydCByZQpjbGFzcyBFdmVudE5ldHdvcmsoKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYscyk6CiAgICAgICAgICAgIEV2ZW50LmNudCwgQ3VzdG9tZXIuY250ID0gMCwgMAogICAgICAgICAgICBRdWV1ZWRFdmVudC5pbnN0YW5jZXMuY2xlYXIoKQogICAgICAgICAgICBCcG1uRXZlbnQuUyA9IHt9CiAgICAgICAgICAgIHNlbGYuZWUgPSBzZWxmLmZyb21fc3RyaW5nKHMpCiAgICAgICAgICAgIHNlbGYucHAgPSB0b19wb3NpdGlvbihzZWxmLmVlKQogICAgICBkZWYgX19nZXRpdGVtX18oc2VsZixpKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZWVbaV0KICAgICAgZGVmIGZyb21fc3RyaW5nKHNlbGYscyk6CiAgICAgICAgICAgIGdsb2JhbCBlbl90aXRsZQogICAgICAgICAgICBlZSwgRXZlbnQuY250LCB5bGV2ZWwsIGVuX3RpdGxlLCBpZDIgPSBbXSwgMCwgLTEsICcnLCAwCiAgICAgICAgICAgIHNzID0gcy5zcGxpdCgnXG4nKQogICAgICAgICAgICBmb3IgczAgaW4gc3M6CiAgICAgICAgICAgICAgICAgIHMxID0gczAuc3RyaXAoKQogICAgICAgICAgICAgICAgICBpZiBsZW4oczEpPDIgb3IgczFbMF09PScjJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgczE9PXNzWzBdOiAjIHRpdGxlIGluIGZpcnN0IGxpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5fdGl0bGUgPSBzc1swXVsxOl0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgaWYgIi0+IiBpbiBzMTogIyBjb25uZWN0aW9uIGRlZmluaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgeWxldmVsICs9IDEgICAjIHVzZWQgZm9yIG1hcmtpbmcgcmVxdWlyZWQgeSBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgczFhIGluIHMxLnNwbGl0KCI7Iik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI2NvZGUgPSBzMWEuc3RyaXAoKS5zcGxpdCgnLT4nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSByZS5zcGxpdChyJy1bPl0qKD89KD86KD86W15cKFwpXSorKD88IVxcKVtcKFwpXSl7Mn0pKitbXlwoXCldKitcWiknLHMxYS5zdHJpcCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIGxlbihjb2RlKT4xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZVsxXT1jb2RlWzFdLnNwbGl0KCIjIilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvZGVbMF1bMF09PScoJzogY29kZVswXT1jb2RlWzBdWzE6LTFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjb2RlWzFdWzBdPT0nKCc6IGNvZGVbMV09Y29kZVsxXVsxOi0xXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjID0gcmUuc3BsaXQoJ1ssfF0nLGNvZGVbMF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkc3QgPSByZS5zcGxpdCgnWyx8XScsY29kZVsxXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBzIGluIHNyYzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpPXJlLnNwbGl0KCctWz5dKicscykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBkIGluIGRzdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpPXJlLnNwbGl0KCctWz5dKicsZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzaSk9PTE6IGRpPVtzaVswXV0rZGkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihkaSk9PTE6IGRpPVtzaVstMV1dK2RpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgayBpbiByYW5nZShsZW4oZGkpLTEpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGlbaysxXT09Jyc6IHo9ZGlba107IGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkaVtrXT09Jyc6IGRpW2tdPXoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGksaiA9IGludChkaVtrXSktMSwgaW50KGRpW2srMV0pLTEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGk+LTEgYW5kIGo+LTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0KGVlW2ldLGVlW2pdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaT4tMSBhbmQgZWVbaV0ucHAyWzFdPT0tMTogIyBpZiBub3Qgc2V0IHlldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbaV0ucHAyWzFdPXlsZXZlbCAjIGZvcmNlIHkgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGo+LTEgYW5kIGVlW2pdLnBwMlsxXT09LTE6ICMgaWYgbm90IHNldCB5ZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlW2pdLnBwMlsxXT15bGV2ZWwgIyBmb3JjZSB5IHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLnBvcCgwKQogICAgICAgICAgICAgICAgICBlbHNlOiAgICAgICAgICAjIGV2ZW50IGRlZmluaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgczFhPXJlLnNwbGl0KHInJycoKD86W147IiddfCJbXiJdKiJ8J1teJ10qJykrKScnJyxzMSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHMxYiBpbiBzMWE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU9czFiLnN0cmlwKCkuc3BsaXQoIiAiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oY29kZSk+MSBhbmQgbGVuKGNvZGVbMF0pPjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkMiArPSAxICMgaWQgY291bnRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjaWYgbm90IGNvZGVbMF1bOjFdLmlzZGlnaXQoKTogY29kZSA9IFtzdHIoaWQyKV0gKyBjb2RlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUxPSIgIi5qb2luKGNvZGVbMTpdKS5zcGxpdCgnIycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlLmFwcGVuZChldmFsKGNvZGUxWzBdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbLTFdLmlkMj1mbG9hdChjb2RlWzBdLnNwbGl0KCcvJylbMF0pICMgaWQgYXMgd3JpdHRlbiBpbiBzb3VyY2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludChlZVstMV0uaWQyLGVlWy0xXS5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbLTFdLnRpdGxlPWNvZGUxWzFdLnN0cmlwKCkgaWYgbGVuKGNvZGUxKT4xIGVsc2UgJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2M9Y29kZVswXS5zcGxpdCgiLyIpICAjIGNoZWNrIGlkZW50aWZpZXIgZmllbGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbLTFdLnBwMlswXSA9IGZsb2F0KGNjWzFdKS0xIGlmIGxlbihjYyk+MSBhbmQgbGVuKGNjWzFdKT4wIGVsc2UgLTEgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS5wcDJbMV0gPSBmbG9hdChjY1syXSktMSBpZiBsZW4oY2MpPjIgYW5kIGxlbihjY1syXSk+MCBlbHNlIC0xCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNlbGlmIGxlbihjb2RlKT09MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgICAgIGVlLmFwcGVuZChOb25lKSAgIyBlbXB0eSBlbGVtZW50IAogICAgICAgICAgICBpZiBsZW4oc2V0KFtlLnBwMlsxXSBmb3IgZSBpbiBmaWx0ZXIoTm9uZSxlZSldKSk9PTE6ICMgdmVyaWZ5IGlmIG11bHRpLWxpbmUgZGVzY3JpcHRpb24KICAgICAgICAgICAgICAgICAgZm9yIGUgaW4gZmlsdGVyKE5vbmUsZWUpOiAgICAgICMgaWYgeWVzCiAgICAgICAgICAgICAgICAgICAgICAgIGUucHAyWzFdPS0xICMgY2xlYXIgYWxsIHktbGV2ZWxzIHRvIHVua25vd24KICAgICAgICAgICAgcmV0dXJuIGVlCiAgICAgIGRlZiBfX3JlcHJfXyhzZWxmKTogcmV0dXJuIHNlbGYudG9fc3RyaW5nKCkKICAgICAgZGVmIHRvX3N0cmluZyhzZWxmKToKICAgICAgICAgICAgcz0nJwogICAgICAgICAgICBmb3IgZSBpbiBzZWxmLmVlOgogICAgICAgICAgICAgICAgICBzICs9ICIlZyIlKGUuaWQyKSArICIgIiArIGUuX19jbGFzc19fLl9fbmFtZV9fKyIoIgogICAgICAgICAgICAgICAgICAjaWYgZS5fX2NsYXNzX18uX19uYW1lX18hPSdFbmQnOgogICAgICAgICAgICAgICAgICBpZiAiR2F0ZSIgbm90IGluIGUuX19jbGFzc19fLl9fbmFtZV9fOgogICAgICAgICAgICAgICAgICAgICAgICBzICs9IGUuZnVuIGFuZCBlLmZ1bi5fX25hbWVfXyBvciAnTm9uZScKICAgICAgICAgICAgICAgICAgICAgICAgcyArPSIsIitzdHIoZS5wYXJhbSkrIiwiCiAgICAgICAgICAgICAgICAgIGlmIGUuX19jbGFzc19fLl9fbmFtZV9fIT0nU3RhcnQnOgogICAgICAgICAgICAgICAgICAgICAgICBzKz0gZS5jb2RlIT1Ob25lIGFuZCAiXCIiK3N0cihlLmNvZGUpKyJcIiIgb3IgIk5vbmUiCiAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHMrPXN0cihlLnRtYXgpCiAgICAgICAgICAgICAgICAgIHMgKz0iKVxuIgogICAgICAgICAgICBmb3IgZSBpbiBzZWxmLmVlOgogICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZS5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBzdHIoZS5pZCkgKyAiLT4iICsgc3RyKGUub3V0cHV0W2ldLmlkKSArJzsnCiAgICAgICAgICAgIHJldHVybiBzICsgJ1xuJwpkZWYgc3ZnX3JvdW5kZWRQYXRoKHBwLCByKToKICAgICAgaW1wb3J0IG1hdGgKICAgICAgcywgbCA9ICIiLCBsZW4ocHApLTEKICAgICAgZm9yIGkgaW4gcmFuZ2UobCk6CiAgICAgICAgICAgIGEsYiA9IHBwW2ldLCBwcFtpKzFdCiAgICAgICAgICAgIHQgPSBtaW4ociAvIG1hdGguaHlwb3QoYlswXS1hWzBdLCBiWzFdLWFbMV0rMC4wMSksIDAuNSkKICAgICAgICAgICAgaWYgaT09MDoKICAgICAgICAgICAgICAgICAgcyArPSAnTSVnICVnICclKGFbMF0sYVsxXSkKICAgICAgICAgICAgaWYgaT4wOgogICAgICAgICAgICAgICAgICBzICs9ICdRJWcgJWcgJWcgJWcgJyUoYVswXSxhWzFdLGFbMF0qKDEtdCkrYlswXSp0LGFbMV0qKDEtdCkrYlsxXSp0KQogICAgICAgICAgICBpZiBpPT1sLTE6CiAgICAgICAgICAgICAgICAgIHMgKz0gJ0wlZyAlZyAnJShiWzBdLGJbMV0pCiAgICAgICAgICAgIGVsaWYgaTxsLTE6CiAgICAgICAgICAgICAgICAgIHMgKz0gJ0wlZyAlZyAnJShhWzBdKnQrYlswXSooMS10KSxhWzFdKnQrYlsxXSooMS10KSkKICAgICAgcmV0dXJuIHMKI05TX01BUCA9IHsKIyAgICBOb25lOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9NT0RFTCcsCiMgICAgJ2JwbW5kaSc6ICdodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L0RJJywKIyAgICAnb21nZGMnOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREMnLAojICAgICdvbWdkaSc6ICdodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9ESScsCiMgICAgJ3hzaSc6ICdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZScKI30KZGVmIGJwbW5fdG9zdmcwKGJwbW5maWxlLFc9MTAwLEg9ODApOgogICAgICBzID0gJzxkZWZzPjxtYXJrZXIgaWQ9InRyaWFuZ2xlIiB2aWV3Qm94PSIwIDAgMTAgMTAiIHJlZlg9IjEwIiByZWZZPSI1IiBtYXJrZXJVbml0cz0ic3Ryb2tlV2lkdGgiIG1hcmtlcldpZHRoPSIxMCIgbWFya2VySGVpZ2h0PSIxMCIgb3JpZW50PSJhdXRvIj4gPHBhdGggZD0iTSAwIDAgTCAxMCA1IEwgMCAxMCB6IiBmaWxsPSJibGFjayIgLz48L21hcmtlcj48L2RlZnM+XG4nCiAgICAgIGltcG9ydCB4bWwuZXRyZWUuRWxlbWVudFRyZWUgYXMgRVQKICAgICAgZm9yIGUgaW4gRVQucGFyc2UoYnBtbmZpbGUpLmdldHJvb3QoKToKICAgICAgICAgICAgaWYgIkJQTU5EaWFncmFtIiBpbiBlLnRhZzoKICAgICAgICAgICAgICAgICAgZm9yIGQgaW4gZToKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM9W3AgZm9yIHAgaW4gZCBpZiAiQlBNTlBsYW5lIiBpbiBkLnRhZ10KICAgICAgcmV0dXJuIGl0ZW1zCiNkZWYgYnBtbl90b3N2ZyhicG1uZmlsZSxXPTEwMCxIPTgwKToKZGVmIGJwbW5fdG9zdmcoYnBtbnN0cmluZyxpc2FuaW0saXNjb21tZW50cyxpc3NjcmlwdHMsVz0xMDAsSD04MCk6CiAgICAgIHMgPSAnPGRlZnM+PG1hcmtlciBpZD0idHJpYW5nbGUiIHZpZXdCb3g9IjAgMCAxMCAxMCIgcmVmWD0iMTAiIHJlZlk9IjUiIG1hcmtlclVuaXRzPSJzdHJva2VXaWR0aCIgbWFya2VyV2lkdGg9IjEwIiBtYXJrZXJIZWlnaHQ9IjEwIiBvcmllbnQ9ImF1dG8iPiA8cGF0aCBkPSJNIDAgMCBMIDEwIDUgTCAwIDEwIHoiIGZpbGw9ImJsYWNrIiAvPjwvbWFya2VyPjwvZGVmcz5cbicKICAgICAgcyArPSAnPHRleHQgeD0iMTAiIHk9IjEyIj4nK2VuX3RpdGxlKyc8L3RleHQ+XG4nOwogICAgICBpbXBvcnQgeG1sLmV0cmVlLkVsZW1lbnRUcmVlIGFzIEVUCiAgICAgICNmb3IgZSBpbiBFVC5wYXJzZShicG1uZmlsZSkuZ2V0cm9vdCgpOiAgIyBjb2xsZWN0IG5hbWVkIHByb2Nlc3NlcwogICAgICBmb3IgZSBpbiBFVC5mcm9tc3RyaW5nKGJwbW5zdHJpbmcpOiAgIyBjb2xsZWN0IG5hbWVkIHByb2Nlc3NlcwogICAgICAgICAgICBpZiAicHJvY2VzcyIgaW4gZS50YWc6CiAgICAgICAgICAgICAgICAgIGVsZW1zPVtkIGZvciBkIGluIGUgaWYgIm5hbWUiIGluIGQuYXR0cmliXQogICAgICAjZm9yIGUgaW4gRVQucGFyc2UoYnBtbmZpbGUpLmdldHJvb3QoKTogICMgY29sbGVjdCBkaWFncmFtIGVsZW1lbnRzCiAgICAgIGZvciBlIGluIEVULmZyb21zdHJpbmcoYnBtbnN0cmluZyk6ICAjIGNvbGxlY3QgbmFtZWQgcHJvY2Vzc2VzCiAgICAgICAgICAgIGlmICJCUE1ORGlhZ3JhbSIgaW4gZS50YWc6CiAgICAgICAgICAgICAgICAgIGZvciBkIGluIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zPVtwIGZvciBwIGluIGQgaWYgIkJQTU5QbGFuZSIgaW4gZC50YWddCiAgICAgIGZvciBpdCBpbiBpdGVtczoKICAgICAgICAgICAgcHAsbmFtZSA9IFtdLCIiCiAgICAgICAgICAgIGZvciBlIGluIGVsZW1zOgogICAgICAgICAgICAgICAgICBpZiBpdC5hdHRyaWJbImJwbW5FbGVtZW50Il09PWUuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICBuYW1lPSIgIi5qb2luKGUuYXR0cmliWyJuYW1lIl0uc3BsaXQoIiAiKVsxOl0pICMgYXNzdW1lICJpZFxudGV4dCIKICAgICAgICAgICAgZm9yIGogaW4gcmFuZ2UobGVuKGl0KSk6CiAgICAgICAgICAgICAgICAgIHgseSA9IGZsb2F0KGl0W2pdLmF0dHJpYlsieCJdKSxmbG9hdChpdFtqXS5hdHRyaWJbInkiXSkKICAgICAgICAgICAgICAgICAgdyxoID0gKGZsb2F0KGl0W2pdLmF0dHJpYlsid2lkdGgiXSksZmxvYXQoaXRbal0uYXR0cmliWyJoZWlnaHQiXSkpIGlmICJCb3VuZHMiIGluIGl0W2pdLnRhZyBlbHNlICgwLDApCiAgICAgICAgICAgICAgICAgIFcsSCA9IG1heChXLHgrdyksbWF4KEgseStoKQogICAgICAgICAgICAgICAgICAjcHJpbnQoaXQuYXR0cmliWyJpZCJdLCI6Iix4LHksdyxoKQogICAgICAgICAgICAgICAgICBpZiB3PT0wOiAjIGJwbW4gZmxvdwogICAgICAgICAgICAgICAgICAgICAgICBwcC5hcHBlbmQoW3gseV0pCiAgICAgICAgICAgICAgICAgIGVsc2U6ICAgICMgYnBtbiBldmVudAogICAgICAgICAgICAgICAgICAgICAgICBpZHM9aXQuYXR0cmliWyJpZCJdLnNwbGl0KCJfIikKICAgICAgICAgICAgICAgICAgICAgICAgaWQ9aWRzWzFdCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihpZHMpPjQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBiYXNlNjQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRzWzRdPWJhc2U2NC5iMTZkZWNvZGUoaWRzWzRdLCdhc2NpaScpLmRlY29kZSgnYXNjaWknKQogICAgICAgICAgICAgICAgICAgICAgICBpZDI9Il8iLmpvaW4oaWRzWzI6XSkucmVwbGFjZSgnPCcsJyZsdDsnKS5yZXBsYWNlKCc+JywnJmd0OycpCiAgICAgICAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSInK3N0cih4LTYpKyciIHk9Iicrc3RyKHkraCsxMikrJyI+JytpZCsnPC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2NvbW1lbnRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHRleHQgZm9udC1zaXplPSJzbWFsbGVyIiBzdHlsZT0iZmlsbDpncmF5IiB4PSInK3N0cih4LTEyKSsnIiB5PSInK3N0cih5LTYpKyciPjx0c3BhbiB4bWw6c3BhY2U9InByZXNlcnZlIj4nK25hbWUrJzwvdHNwYW4+PC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICAgICAgICBpZDM9aWQyLnNwbGl0KCJfIikKICAgICAgICAgICAgICAgICAgICAgICAgI2lmIGxlbihpZDMpPjMgYW5kIGlkM1szXSAhPSAiTm9uZSIgOiBzKz0nPHRleHQgY2xhc3M9InQxIiBmb250LXNpemU9InNtYWxsZXIiIHN0eWxlPSJmaWxsOmdyYXkiIHg9Iicrc3RyKHgrMTgpKyciIHk9Iicrc3RyKHkraCsxMisoIkV2ZW50IiBpbiBpdC5hdHRyaWJbImlkIl0gYW5kIDEyIG9yIDApKSsnIj48dHNwYW4geG1sOnNwYWNlPSJwcmVzZXJ2ZSI+JytpZDNbM10rJzwvdHNwYW4+PC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc3NjcmlwdHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkM2E9Il8iLmpvaW4oaWRzWzI6XSkuc3BsaXQoIl8iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oaWQzYSk+MyBhbmQgaWQzYVszXSAhPSAiTm9uZSI6IHMrPSc8dGV4dCBjbGFzcz0idDEiIGZvbnQtc2l6ZT0ic21hbGxlciIgc3R5bGU9ImZpbGw6Z3JheSIgeD0iJytzdHIoeCsxOCkrJyIgeT0iJytzdHIoeStoKzEyKSsnIj48dHNwYW4geG1sOnNwYWNlPSJwcmVzZXJ2ZSI+JytpZDNhWzNdLnNwbGl0KCc7JylbMF0ucmVwbGFjZSgnPCcsJyZsdDsnKS5yZXBsYWNlKCc+JywnJmd0OycpKyc8L3RzcGFuPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWYgIkV2ZW50IiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZSA9ICJlbmQiIGluIGl0LmF0dHJpYlsiaWQiXSBhbmQgIjMiIG9yICIxIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICJlbmQiIGluIGl0LmF0dHJpYlsiaWQiXSBhbmQgInJlZCIgb3IgImRhcmtncmVlbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8ZWxsaXBzZSBjeD0iJytzdHIoeCt3LzIpKyciIGN5PSInK3N0cih5K2gvMikrJyIgcng9Iicrc3RyKHcvMikrJyIgcnk9Iicrc3RyKGgvMikrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9IicrY29sb3IrJyIgZmlsbC1vcGFjaXR5PSIwLjYiIGZpbGw9IndoaXRlIj48dGl0bGU+JytpZDIrJzwvdGl0bGU+PC9lbGxpcHNlPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiaW50ZXJtZWRpYXRlIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPGVsbGlwc2UgY3g9Iicrc3RyKHgrdy8yKSsnIiBjeT0iJytzdHIoeStoLzIpKyciIHJ4PSInK3N0cih3LzItMykrJyIgcnk9Iicrc3RyKGgvMi0zKSsnIiBzdHJva2Utd2lkdGg9Iicrc3Ryb2tlKyciIHN0cm9rZT0iZGFya2dyZWVuIiBmaWxsPSJ3aGl0ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiQ2F0Y2giIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIm9uZGl0aW9uIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHJlY3QgeD0iJWciIHk9IiVnIiB3aWR0aD0iJWciIGhlaWdodD0iJWciIHN0cm9rZT0iYmxhY2siIGZpbGw9Im5vbmUiIC8+JyUoeCt3LzItNyx5K2gvMi05LHcvMi00LGgvMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cGF0aCBkPSInCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJ00lZyAlZyBMJWcgJWcgJyUoeCt3LzItNSx5K2gvMi02KzMqaSx4K3cvMis1LHkraC8yLTYrMyppKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxlbGxpcHNlIGN4PSInK3N0cih4K3cvMikrJyIgY3k9Iicrc3RyKHkraC8yKSsnIiByeD0iJytzdHIody8yLTYpKyciIHJ5PSInK3N0cihoLzItNikrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9ImJsYWNrIiBmaWxsPSJ3aGl0ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxwYXRoIGQ9Ik0lZyAlZyBMJWcgJWcgJWcgJWcgJyUoeCt3LzItNSx5K2gvMi0zLHgrdy8yLHkraC8yLHgrdy8yKzYseStoLzItNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMTIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIG1hdGggaW1wb3J0IHNpbixjb3MscGkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICJNJWcgJWcgTCVnICVnICIlKHgrdy8yKyh3LzItNikqY29zKGkqMipwaS8xMikseStoLzIrKGgvMi02KSpzaW4oaSoyKnBpLzEyKSx4K3cvMisody8yLTkpKmNvcyhpKjIqcGkvMTIpLHkraC8yKyhoLzItOSkqc2luKGkqMipwaS8xMikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiLz4nICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJlcm1pbmF0ZSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxlbGxpcHNlIGN4PSInK3N0cih4K3cvMikrJyIgY3k9Iicrc3RyKHkraC8yKSsnIiByeD0iJytzdHIody8yLTYpKyciIHJ5PSInK3N0cihoLzItNikrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9InJlZCIgZmlsbD0icmVkIiBmaWxsLW9wYWNpdHk9IjAuNiIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICBlbGlmICJHYXRld2F5IiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gIm9yYW5nZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cGF0aCBkPSJNJWcgJWcgTCVnICVnIEwlZyAlZyBMJWcgJWcgWiIgc3Ryb2tlPSIlcyIgZmlsbD0id2hpdGUiPjx0aXRsZT4lczwvdGl0bGU+PC9wYXRoPlxuJyUoeCx5K2gvMix4K3cvMix5LHgrdyx5K2gvMix4K3cvMix5K2gsY29sb3IsaWQyKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgImV4Y2x1c2l2ZSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHBhdGggZD0iTSVnICVnIEwlZyAlZyBNJWcgJWcgTCVnICVnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjMiIC8+XG4nJSh4K3cvMi02LHkraC8yLTYseCt3LzIrNix5K2gvMis2LHgrdy8yKzYseStoLzItNix4K3cvMi02LHkraC8yKzYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgInBhcmFsbGVsIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSc8cGF0aCBkPSJNJWcgJWcgTCVnICVnIE0lZyAlZyBMJWcgJWciIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIgLz5cbiclKHgrdy8yLTgseStoLzIseCt3LzIrOCx5K2gvMix4K3cvMix5K2gvMi04LHgrdy8yLHkraC8yKzgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgImluY2x1c2l2ZSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0nPGNpcmNsZSBjeD0iJWciIGN5PSIlZyIgcj0iNyIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIzIiAvPlxuJyUoeCt3LzIseStoLzIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHJlY3Qgcng9IjciIHJ5PSI3IiB4PSInK3N0cih4KSsnIiB5PSInK3N0cih5KSsnIiB3aWR0aD0iJytzdHIodykrJyIgaGVpZ2h0PSInK3N0cihoKSsnIiBzdHJva2U9ImRhcmtibHVlIiBmaWxsPSJ3aGl0ZSI+PHRpdGxlPicraWQyKyc8L3RpdGxlPjwvcmVjdD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgInNjcmlwdCIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSg0KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSc8cGF0aCBkPSJNJWcgJWcgTCVnICVnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiIC8+JyUoeCsxMCswKmkseSsxMCs0KmkseCsyMiswKmkseSsxMCs0KmkpCiAgICAgICAgICAgIGlmIGxlbihwcCk+MDogIyBzMSE9Jyc6ICMgYWRkIHdob2xlIGZsb3cKICAgICAgICAgICAgICAgICAgczE9c3ZnX3JvdW5kZWRQYXRoKHBwLDEyKQogICAgICAgICAgICAgICAgICBzICs9ICc8cGF0aCBtYXJrZXItZW5kPSJ1cmwoI3RyaWFuZ2xlKSIgZD0iJytzMSsnIiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpicm93bjtzdHJva2Utd2lkdGg6MSIvPlxuJwogICAgICBzICs9ICI8c2NyaXB0PmZ1bmN0aW9uIG9uX2NsaWNrKCkge1suLi5kb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0MScpXS5mb3JFYWNoKGU9PmUuc3R5bGUuZGlzcGxheT0oZS5zdHlsZS5kaXNwbGF5PT0nbm9uZSc/Jyc6J25vbmUnKSk7fTwvc2NyaXB0PiIKICAgICAgcyA9ICc8c3ZnIG9uY2xpY2s9Im9uX2NsaWNrKCkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IiVkIiBoZWlnaHQ9IiVkIj5cbiclKFcrNDArNjAsSCszMCkrcwogICAgICByZXR1cm4gcyArICh0b19hbmltKCkgaWYgaXNhbmltIGVsc2UgJycpICsgJzwvc3ZnPlxuJwpkZWYgdG9fYW5pbSgpOgogICAgICAjcmV0dXJuIHMKICAgICAgZ2xvYmFsIEVOCiAgICAgIHMgPSAgJzxkZWZzPjxmaWx0ZXIgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgaWQ9ImZpIj5cbicKICAgICAgcyArPSAnPGZlRmxvb2QgZmxvb2QtY29sb3I9IndoaXRlIi8+XG4nCiAgICAgIHMgKz0gJzxmZUNvbXBvc2l0ZSBpbj0iU291cmNlR3JhcGhpYyIgb3BlcmF0b3I9ImF0b3AiLz48L2ZpbHRlcj48L2RlZnM+XG4nCiAgICAgIGZvciBlIGluIEVOLmVlOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGUsRW5kKToKICAgICAgICAgICAgICAgICAgZm9yIGMgaW4gZS5xdWV1ZS5vYmplY3RzOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oRU4uZWUpKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeCwgeSwgYSA9IEVOLmVlW2ldLngsIEVOLmVlW2ldLnksIGMuYXR0ciAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSc8dGV4dCBjbGFzcz0idDEiIGZpbHRlcj0idXJsKCNmaSkiIHN0eWxlPSJmb250LXNpemU6c21hbGw7ZmlsbDpyZWQiIHg9Iicrc3RyKHgtMjApKyciIHk9Iicrc3RyKHkrMTMpKyciIHZpc2liaWxpdHk9ImhpZGRlbiI+JytzdHIoYy5uYW1lKSsnXG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQ9Il9fdCIrc3RyKGkrMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdCsiYSIgaW4gYToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDAgPSBhW3QrImEiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9ICc8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJ2aXNpYmlsaXR5IiBmcm9tPSJoaWRkZW4iIHRvPSJ2aXNpYmxlIiBiZWdpbj0iJytzdHIodDApKydzIiBkdXI9IjAuMDFzIiBmaWxsPSJmcmVlemUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdCsiYiIgaW4gYToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBhW3QrImIiXSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAnPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieCIgdG89Iicrc3RyKHgrMzgpKyciIGJlZ2luPSInK3N0cih0MSkrJ3MiIGR1cj0iMC41cyIgZmlsbD0iZnJlZXplIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQrImUiIGluIGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gYVt0KyJlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAnPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0idmlzaWJpbGl0eSIgZnJvbT0idmlzaWJsZSIgdG89ImhpZGRlbiIgYmVnaW49Iicrc3RyKHQyKSsncyIgZHVyPSIwLjAxcyIgZmlsbD0iZnJlZXplIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0nPC90ZXh0PlxuJwogICAgICByZXR1cm4gcwpFTj1bXQojIC0tLS0gc2ltdWxhdGlvbiAtLS0tLQpkZWYgbWFpbl9mdW4oZXhuLG4sYW5pbSxjb21tZW50cyxzY3JpcHRzKTogIyBzdHJpbmcgcmVwcmVzZW50YXRpb24sIG51bWJlciBvZiBzaW11bGF0aW9uCiAgICAgIGRhdGE9W10gICMgbGlzdCBvZiBldmVudHMsIGFycmF5IG9mIHJlc3VsdHMKICAgICAgcyA9ICcnCiAgICAgIGZvciBpIGluIHJhbmdlKG4pOgogICAgICAgICAgICBnbG9iYWwgRU4KICAgICAgICAgICAgRU4gPSBFdmVudE5ldHdvcmsoZXhuKQogICAgICAgICAgICBzaW0gPSBTaW11bGF0b3IoKQogICAgICAgICAgICBmb3IgZSBpbiBFTjoKICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLEdlbmVyYXRvcik6ICAjIGFkZCBnZW5lcmF0aW5nIGV2ZW50cwogICAgICAgICAgICAgICAgICAgICAgICBzaW0uYWRkKGUpICAKICAgICAgICAgICAgc2ltLnJ1bigpCiAgICAgICAgICAgIGRhdGEuYXBwZW5kKFtzaW0udGltZSxCcG1uRXZlbnQuU10pICAgIyBzYXZlIGVuZCB0aW1lIG9mIHNpbXVsYXRpb24KICAgICAgICAgICAgCiAgICAgICAgICAgICNpZiBleG49PWV4NToKICAgICAgICAgICAgIyAgICAgIGRhdGEuYXBwZW5kKEJwbW5FdmVudC5TWyJTLmJBIl0pICMgc2F2ZSBnbG9iYWwgdmFyaWFibGUgUy5iQQogICAgICAgICAgICAjZWxzZToKICAgICAgICAgICAgIyAgICAgIGRhdGEuYXBwZW5kKHNpbS50aW1lKSAgICMgc2F2ZSBlbmQgdGltZSBvZiBzaW11bGF0aW9uCiAgICAgICAgICAgIGlmIGk9PTA6CiAgICAgICAgICAgICAgICAgIHMxID0gdG9fYnBtbihFTi5lZSxFTi5wcCkKICAgICAgICAgICAgICAgICAgczIgPSBicG1uX3Rvc3ZnKHMxLGFuaW0sY29tbWVudHMsc2NyaXB0cykKICAgICAgICAgICAgICAgICAgczMgPSB0b19zdmcoKQogICAgICBzICs9ICIjblx0dFx0IisiXHQiLmpvaW4oZGF0YVswXVsxXS5rZXlzKCkpKyJcbiIKICAgICAgcyArPSAiXG4iLmpvaW4oWyIlZFx0JS4yZlx0JXMiJShpKzEsZGF0YVtpXVswXSwiXHQiLmpvaW4oW3N0cih2KSBmb3IgdiBpbiBbKmRhdGFbaV1bMV0udmFsdWVzKCldXSkpIGZvciBpIGluIHJhbmdlKGxlbihkYXRhKSldKQogICAgICAjZm9yIGUgaW4gbmU6CiAgICAgICMgICAgICBpZiBsZW4oZS5xdWV1ZSk+MDoKICAgICAgIyAgICAgICAgICAgIHMgKz0gc3RyKGUuaWQpICsgKCIoJWQpOiIlbGVuKGUucXVldWUpKSArIHN0cihlLnF1ZXVlKSsnXG4nCiAgICAgICNzICs9IHN0cihzdW0oZGF0YSkvbGVuKGRhdGEpKSsnXG4nCiAgICAgICNzICs9IHN0cihCcG1uRXZlbnQuUykrJ1xuJwogICAgICAjZm9yIGUgaW4gbmU6CiAgICAgICMgICAgICBzICs9IHN0cihlLmlkKStzdHIoZS5BKSsnICcKICAgICAgIyAgICAgIGlmIGlzaW5zdGFuY2UoZSxUYXNrKToKICAgICAgIyAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlLnNlcnZlcnMpKToKICAgICAgIyAgICAgICAgICAgICAgICAgIHMgKz0gc3RyKGUuc2VydmVyc1tpXS5pZCkrJy8nK3N0cihpKzEpK3N0cihlLnNlcnZlcnNbaV0uQSkrJyAnCiAgICAgIHM0PScnCiAgICAgIGlmIGxlbihkYXRhKT49MTAwOgogICAgICAgICAgICAjaWYgZXhuPT1leDQ6CiAgICAgICAgICAgICMgICAgICBzNCA9IGhpc3QoZGF0YSw3KQogICAgICAgICAgICAjZWxzZToKICAgICAgICAgICAgIyAgICAgIHM0ID0gaGlzdChkYXRhKQogICAgICAgICAgICBwYXNzICMgczQgPSBoaXN0KGRhdGEpCiAgICAgIHJldHVybiAocyxzMSxzMixzMyxzNCkgIyBzMisnPGJyPlxuJysoczMgaWYgbj09MSBlbHNlICcnKSsnPGJyPlxuJysnPHByZT4nK3MrJzwvcHJlPicKCmV4MTE9IiIiIyBUaGUgdGVzdHMgCiMgMSkgT3JHYXRlKCkKIyAyKSBHL0cvMiAodGFzayB3aXRoIHR3byBzZXJ2ZXJzKQojIDMpIEJvdW5kYXJ5IGNvbmRpdGlvbmFsIGV2ZW50IAojIFMudm4gdmFyaWFibGVzIGNvbGxlY3QgdmlzaXRlZCBjdXN0b21lcnMgCjEgU3RhcnQoVSxbMV0sLTEwLCJTLnYxPVtdO1MudjI9W107Uy52Mz1bXTtTLnY0PVtdIikgICAgICMgMTAgY3VzdG9tZXJzCjIgT3JHYXRlKCkKMyBPckdhdGUoIj1bQS5uJTIsMV0iKSAgICAgICAgICAgICAgIyMgMS5ldmVyeSBzZWNvbmQsMi5ldmVyeQo0IFRhc2soVSxbNF0sIlMudjE9Uy52MStbY25hbWVdIikgICAjIEcvRy8xCjUgVGFzayhVLFs0XSwiUy52Mj1TLnYyK1tjbmFtZV0iLDIpICMgRy9HLzIKNiBUYXNrKCkKNyBPckdhdGUoKQo4IE9yR2F0ZSgpCjkgVGFzaygpCjEwIFRpbWVyKDEpICAgICAgICAgICAgICAgICAgICAgICAgICAjIDEgZGVsYXkKMTEgRW5kKCJTLnYzPVMudjMrW2NuYW1lXSIpCjEyLjkgQ29uZGl0aW9uKCI9Y25hbWUlND09MCIpICMjIGV2ZXJ5IGN1c3RvbWVyIHdpdGggaWQgZXF1YWwgdG8gbXVsdGlwbGUgb2YgNCAKMTMvOCBUZXJtaW5hdGUoIlMudjQ9Uy52NCtbY25hbWVdIikKMS0+Mi0+My0+NC0+Ny0+OC0+OS0+MTAtPjExCiAgICAgIDMtPjUtPjc7ICAgICAgIDEyLT4xMwogICAyLT4gICA2ICAgLT44CiIiIjsKCiIiIgppZiBfX25hbWVfXz09Il9fbWFpbl9fIjoKICAgICAgaW1wb3J0IHN5cwogICAgICAjaW1wb3J0IGV4CiAgICAgICNleDMwID0gJzEgU3RhcnQoKVxuMiBUYXNrKClcbjMgRW5kKClcbjEtPjItPjNcbicKICAgICAgcyA9IGxlbihzeXMuYXJndik+MSBhbmQgZnJvbV9maWxlKHN5cy5hcmd2WzFdKSBvciBldmFsKCdleCVkJyUoMTEpKQogICAgICBuID0gbGVuKHN5cy5hcmd2KT4yIGFuZCBpbnQoc3lzLmFyZ3ZbMl0pIG9yIDEKICAgICAgYW5pbSA9IDEKICAgICAgY29tbWVudHMgPSAxCiAgICAgIHNjcmlwdHMgPSAxCiAgICAgIG91dHB1dCA9IG1haW5fZnVuKHMsbixhbmltLGNvbW1lbnRzLHNjcmlwdHMpCiAgICAgIHByaW50KEVOKQogICAgICAjcHJpbnQob3V0cHV0WzJdKSAgICAgIAogICAgICAjcHJpbnQob3V0cHV0WzNdKQogICAgICBwcmludCgnPHByZT4nLG91dHB1dFswXSwnPC9wcmU+JykKIiIiCnMgPSBpbnB1dFswXQpuID0gaW50KGlucHV0WzFdKQphbmltID0gaW50KGlucHV0WzJdKQpjb21tZW50cyA9IGludChpbnB1dFszXSkKc2NyaXB0cyA9IGludChpbnB1dFs0XSkKb3V0cHV0ID0gbWFpbl9mdW4ocywgbiwgYW5pbSwgY29tbWVudHMsIHNjcmlwdHMpCnMgPSAnJwojcyArPSAnPGRpdiBpZD0iZGl2MSIgaGlkZGVuPicrb3V0cHV0WzFdKyc8L2Rpdj48YnI+XG4nCnMgKz0gJzxkaXYgaWQ9ImRpdjIiIHRhYmluZGV4PSItMSIgc3R5bGU9Im92ZXJmbG93LXg6YXV0byI+JytvdXRwdXRbMl0rJzwvZGl2Pjxicj5cbicKI3MgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIGJwbW4gdG8geG1sIGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTEoKTsiPjwvaW5wdXQ+XG4nCnMgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIGJwbW4gdG8gc3ZnIGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTIoKTsiPjwvaW5wdXQ+XG4nCnMgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIGJwbW4gdG8geG1sIGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTUoKTsiPjwvaW5wdXQ+PGJyPjxicj5cbicKaWYgbj09MToKICAgICAgcyArPSAnPGRpdiBpZD0iZGl2MyIgc3R5bGU9Im92ZXJmbG93LXg6YXV0byI+JytvdXRwdXRbM10gKyc8L2Rpdj48YnI+XG4nCiAgICAgIHMgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIHRpbWVsaW5lIHRvIHN2ZyBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGUzKCk7Ij48L2lucHV0Pjxicj48YnI+XG4nCnMgKz0nPHRleHRhcmVhIGlkPSJ0YTQiIHJvd3M9IjEwIiBzdHlsZT0iZmllbGQtc2l6aW5nOiBjb250ZW50O21pbi1oZWlnaHQ6MTVyZW07d2lkdGg6MTAwJTtvdmVyZmxvdy14OmF1dG87Zm9udC1mYW1pbHk6bW9ub3NwYWNlIWltcG9ydGFudDsiPicrb3V0cHV0WzBdKyc8L3RleHRhcmVhPjxicj5cbicgIysnPGltZyBzcmM9Iicrb3V0cHV0WzNdKyciPicKcyArPSc8aW5wdXQgdHlwZT1idXR0b24gdmFsdWU9IlNhdmUgcmVzdWx0cyB0byB0eHQgZmlsZSIgb25jbGljaz0id3JpdGVGaWxlNCgpOyI+PC9pbnB1dD48YnI+PGJyPlxuJwpzICs9Jzx0ZXh0YXJlYSBoaWRkZW4gaWQ9InRhNSIgcm93cz0iMTAiIGNvbHM9IjgwIj4nK291dHB1dFsxXSsnPC90ZXh0YXJlYT48YnI+XG4nICMrJzxpbWcgc3JjPSInK291dHB1dFszXSsnIj4nCnMKCgoK";