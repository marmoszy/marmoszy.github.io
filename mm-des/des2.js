var pycode="IyBERVMgLSBkaXNjcmV0ZSBldmVudCAobWljcm8pIHNpbXVsYXRvcgojIC0gYmFzaWMgZXZlbnRzOiBHZW5lcmF0b3IsU2VydmljZSxTaW5rLENvbmRpdGlvbmFsRXZlbnQKIyAtIGJwbW4gZXZlbnRzOiBTdGFydCxUYXNrLEVuZCxUaW1lcixYb3JHYXRlLEFuZEdhdGUsQ29uZGl0aW9uLFRlcm1pbmF0ZQojIE1NIDMxLjEuMjAyNCwgMTMuOS4yMDI1IChhZG9wdGVkIGZvciBweW9kaWRlIGluIGpzKQoKIyAtLS0tIHNpbXVsYXRpb24gb24gYW4gYWJzdHJhY3QgZXZlbnQgLS0tLQpjbGFzcyBFdmVudCgpOgogICAgICBjbnQgPSAwICAgICAgICAgICAgICAgICAgICAgICAgICMgdXNlZCBmb3IgZXZlbnQgaWRlbnRpZmllcgogICAgICBkZWYgX19pbml0X18oc2VsZiwgdGltZSwgbmFtZT1Ob25lKToKICAgICAgICAgICAgc2VsZi50aW1lID0gdGltZTsKICAgICAgICAgICAgRXZlbnQuY250ICs9IDEKICAgICAgICAgICAgc2VsZi5pZCA9IEV2ZW50LmNudAogICAgICAgICAgICBzZWxmLm5hbWUgPSAoKG5hbWU9PU5vbmUpIGFuZCAiRXZlbnQiIG9yIG5hbWUpICsgIl8iK3N0cihzZWxmLmlkKQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOiBwYXNzICAgICAgIyBhYnN0cmFjdCAKICAgICAgZGVmIF9fc3RyX18oc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLm5hbWUrICIgIisgc3RyKHNlbGYuaWQpICsiICIrc3RyKHNlbGYudGltZSkKY2xhc3MgU2ltdWxhdG9yKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAgICAgc2VsZi50aW1lID0gMAogICAgICAgICAgICBzZWxmLmV2ZW50cyA9IFtdCiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucyA9IFtdCiAgICAgIGRlZiBub3coc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnRpbWUKICAgICAgZGVmIGFkZChzZWxmLGUpOgogICAgICAgICAgICBzZWxmLmV2ZW50cy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBhZGRfY29uZGl0aW9uKHNlbGYsZSk6CiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgICAgIHdoaWxlIHNlbGYuZXZlbnRzOgogICAgICAgICAgICAgICAgICBlID0gbWluKHNlbGYuZXZlbnRzLCBrZXk9bGFtYmRhIGU6IGUudGltZSkKICAgICAgICAgICAgICAgICAgc2VsZi5ldmVudHMucmVtb3ZlKGUpCiAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IGUudGltZSAgICAgICAgICMgdXBkYXRlIHNpbXVsYXRvciB0aW1lCiAgICAgICAgICAgICAgICAgIGUuZXhlYyhzZWxmKQogICAgICAgICAgICAgICAgICBmb3IgYyBpbiBzZWxmLmNvbmRpdGlvbnM6ICAjIHRlc3QgY29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICBpZiBjLmV4ZWMoc2VsZik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5yZW1vdmUoYykKIyAtLS0tIHV0aWxzIC0tLS0KaW1wb3J0IG1hdGgscmFuZG9tCmRlZiBfcHJpbnQocyk6ICAgICAgICAgICAgICAgICMgb3duIHByaW50CiAgICAgICNwcmludChzKSAgICAgICAgICAgICAgICMgY29tbWVudCBpZiBubyB2ZXJib3VzIHByaW50aW5nCiAgICAgIHBhc3MKZGVmIEUobWVhbj1bMS4wXSk6ICAgICAgICAgICAgIyBleHBvbmVudGlhbCByYW5kb20gZ2VuZXJhdG9yCiAgICAgICMgLW1lYW5bMF0qbWF0aC5sb2cocmFuZG9tLnJhbmRvbSgpKQogICAgICByZXR1cm4gcmFuZG9tLmV4cG92YXJpYXRlKDEvbWVhblswXSkgCmRlZiBVKG1pbm1heD1bMS4wXSk6ICAgICAgICAgICMgdW5pZm9ybSByYW5kb20gZ2VuZXJhdG9yCiAgICAgIHJldHVybiByYW5kb20udW5pZm9ybShtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXSkKZGVmIE4obWVhbnN0ZD1bMy4wXSk6ICAgICAgICAjIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgcmV0dXJuIHJhbmRvbS5ub3JtYWx2YXJpYXRlKG1lYW5zdGRbMF0sbGVuKG1lYW5zdGQpPjEgYW5kIG1lYW5zdGRbMV0gb3IgMS4wKQpkZWYgQihwPTAuNSk6ICAgICAgICAgICAgICAgICMgYmlub21pYWwgKDAsMSkKICAgICAgcmV0dXJuIHJhbmRvbS5yYW5kb20oKTxwCmRlZiBDKHA9WzEsMSwxXSk6ICAgICAgICAgICAgIyBjaG9pY2UgKDAsMSwyLC4uLikKICAgICAgcmV0dXJuIHJhbmRvbS5jaG9pY2VzKGxpc3QocmFuZ2UobGVuKHApKSksd2VpZ2h0cz1wKVswXQpkZWYgVChtaW5tYXg9WzEuMF0pOiAgICAgICAgICAjIHNlbWkgdHJ1bmNhdGVkIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgbWksbWEgPSBtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXQogICAgICBtZWFuLHN0ZCA9IChtYSttaSkvMiwobWEtbWkpLzIKICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgeCA9IE4oW21lYW4sc3RkXSkKICAgICAgICAgICAgaWYgbWkgPD0geCA8PSBtYTogYnJlYWsKICAgICAgcmV0dXJuIHgKCiMgLS0tLSBwcmltaXRpdmUgY2xhc3NlcyAtLS0tCmNsYXNzIEN1c3RvbWVyKCk6ICAgICMgYW5vbnltb3VzIGN1c3RvbWVyIHdpdGggYSBhdXRvbWF0aWMgbmFtZQogICAgICBjbnQgPSAwICAgICAgICAjIGNvdW50ZXIgY2xhc3MgdmFyaWFibGUgZm9yIGN1c3RvbWVyIG5hbWUKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBDdXN0b21lci5jbnQgKz0gMQogICAgICAgICAgICBzZWxmLm5hbWUgPSBzdHIoQ3VzdG9tZXIuY250KQogICAgICAgICAgICBzZWxmLmF0dHIgPSB7ImNuYW1lIjpzZWxmLm5hbWV9ICMgQ3VzdG9tZXIgYXR0cmlidXRlcwogICAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIHN0cihzZWxmLm5hbWUpCmNsYXNzIFF1ZXVlKCk6ICAgICAgICMgZmlmbyBvZiBjdXN0b21lcnMKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBzZWxmLm9iamVjdHMgPSBbXQogICAgICBkZWYgcHVzaChzZWxmLG9iaik6CiAgICAgICAgICAgIHNlbGYub2JqZWN0cy5hcHBlbmQob2JqKQogICAgICBkZWYgcG9wKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5vYmplY3RzLnBvcCgwKQogICAgICBkZWYgX19sZW5fXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIGxlbihzZWxmLm9iamVjdHMpCiAgICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc3RyKFtzdHIobykgZm9yIG8gaW4gc2VsZi5vYmplY3RzXSkKY2xhc3MgUXVldWVkRXZlbnQoRXZlbnQpOgogICAgICBpbnN0YW5jZXM9W10KICAgICAgZGVmIF9faW5pdF9fKHNlbGYsbmFtZT1Ob25lKToKICAgICAgICAgICAgRXZlbnQuX19pbml0X18oc2VsZiwwLjAsbmFtZSkgICMgcHJlaW5pdCB0aW1lCiAgICAgICAgICAgIHNlbGYucXVldWUgPSBRdWV1ZSgpICAgICAgIyBvd24gcXVldWUKICAgICAgICAgICAgc2VsZi5vdXRwdXQgPSBbXSAgICAgICAgICAjIG5vIGNvbm5lY3RlZCBvYmplY3RzCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICAgIyBub25lIGJlaW5nIHNlcnZlZAogICAgICAgICAgICBRdWV1ZWRFdmVudC5pbnN0YW5jZXMuYXBwZW5kKHNlbGYpCiAgICAgIGRlZiBzZXROYW1lKHNlbGYsbmFtZSk6CiAgICAgICAgICAgIHNlbGYubmFtZT1uYW1lKyJfIitzZWxmLm5hbWUuc3BsaXQoIl8iKVsxXSAjLnJlcGxhY2UoIkV2ZW50IixuYW1lKS5yZXBsYWNlKCJBY3Rpdml0eSIsbmFtZSkKICAgICAgZGVmIG91dChzZWxmLHNpbSk6ICAgICAgICAgICAgICAjIHBhc3MgdG8gY29ubmVjdGVkIG9iamVjdHMKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4wIGFuZCBpc2luc3RhbmNlKHNlbGYsWG9yR2F0ZSk6ICAKICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID0gMSAgIyBzZW5kIHRvIHNlY29uZCBvdXRwdXQKIyAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICJ2YWx1ZSIgaW4gc2VsZi5jdXN0b21lci5hdHRyIG9yIGxlbihzZWxmLm91dHB1dCk8MjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4PTAgIyBzZW5kIHJhdGhlciB0byBmaXJzdCBvdXRwdXQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4yOiAgIyBtb3JlIHRoYW4gMiBvdXRwdXRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeD1pbnQoc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm91dHB1dFtpZHhdLmluc2VydChzZWxmLmN1c3RvbWVyLCBzaW0pCiAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihzZWxmLm91dHB1dCkpOiAgIyBzcGxpdCB0byBhbGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRwdXRbaV0uaW5zZXJ0KHNlbGYuY3VzdG9tZXIsIHNpbSkKICAgICAgZGVmIHByZXYoc2VsZik6CiAgICAgICAgICAgIGVwPVtdCiAgICAgICAgICAgIGZvciBlMCBpbiBRdWV1ZWRFdmVudC5pbnN0YW5jZXM6CiAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlMC5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZTAub3V0cHV0W2ldPT1zZWxmOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcC5hcHBlbmQoZTApCiAgICAgICAgICAgIHJldHVybiBlcAoKIyAtLS0tIGJhc2ljIG1vZGVsIGNsYXNzZXMgKFF1ZXVlRXZlbnQgZGVyaXZlZCkgLS0tLQpjbGFzcyBCcG1uRXZlbnQoUXVldWVkRXZlbnQpOgogICAgICBTID0ge30KICAgICAgZGVmIF9faW5pdF9fKHNlbGYsbmFtZT1Ob25lLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIFF1ZXVlZEV2ZW50Ll9faW5pdF9fKHNlbGYsbmFtZSkKICAgICAgICAgICAgc2VsZi5mdW4sc2VsZi5wYXJhbSxzZWxmLmNvZGUgPSBOb25lLE5vbmUsY29kZQogICAgICAgICAgICBzZWxmLkEsc2VsZi5wcCxzZWxmLnBwMixzZWxmLnRpdGxlID0geyJBLm4iOjB9LFstMSwwXSxbLTEsLTFdLCcnCiAgICAgIGRlZiBfZnVuKHNlbGYpOgogICAgICAgICAgICBwID0gc2VsZi5wYXJhbQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHAsbGlzdCk6CiAgICAgICAgICAgICAgICAgIHAgPSBbZmxvYXQoZXZhbChzZWxmLmF0dHJfcmVwbGFjZShzdHIocykpKSkgZm9yIHMgaW4gcF0KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgcCA9IGZsb2F0KGV2YWwoc2VsZi5hdHRyX3JlcGxhY2Uoc3RyKHApKSkpCiAgICAgICAgICAgICNwcmludCgiX2Z1bjoiLHNlbGYuZnVuLHAsbGVuKHNlbGYucXVldWUpKQogICAgICAgICAgICByZXR1cm4gc2VsZi5mdW4ocCkgaWYgc2VsZi5mdW4hPU5vbmUgZWxzZSBwCiAgICAgIGRlZiBhdHRyX3JlcGxhY2Uoc2VsZixjYyk6CiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIhPU5vbmU6CiAgICAgICAgICAgICAgICAgIGZvciBrLHYgaW4gc2VsZi5jdXN0b21lci5hdHRyLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNjID0gY2MucmVwbGFjZShrLHN0cih2KSkKICAgICAgICAgICAgZm9yIGssdiBpbiBCcG1uRXZlbnQuUy5pdGVtcygpOgogICAgICAgICAgICAgICAgICBjYyA9IGNjLnJlcGxhY2UoayxzdHIodikpCiAgICAgICAgICAgIGZvciBrLHYgaW4gc2VsZi5BLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgIGNjID0gY2MucmVwbGFjZShrLHN0cih2KSkKICAgICAgICAgICAgcmV0dXJuIGNjCiAgICAgIGRlZiBfZXZhbChzZWxmLGNvZGUsbj0tMSk6CiAgICAgICAgICAgIGNvZGVzPXNlbGYuY29kZS5zcGxpdCgiOyIpCiAgICAgICAgICAgIGlmIG4hPS0xOgogICAgICAgICAgICAgICAgICBjb2Rlcz1sZW4oY29kZXMpPm4gYW5kIFtjb2Rlc1tuXV0gb3IgW10KICAgICAgICAgICAgZm9yIGNvZGUgaW4gY29kZXM6CiAgICAgICAgICAgICAgICAgIGNjID0gY29kZS5zcGxpdCgiPSIpCiAgICAgICAgICAgICAgICAgIGNjWzBdID0gY2NbMF0uc3RyaXAoKQogICAgICAgICAgICAgICAgICBpZiBsZW4oY2MpPT0xOgogICAgICAgICAgICAgICAgICAgICAgICBjYz1bImR1bW15Il0rY2MKICAgICAgICAgICAgICAgICAgaWYgbGVuKGNjKT4xOgogICAgICAgICAgICAgICAgICAgICAgICBjY1swXSA9IGxlbihjY1swXSk+MCBhbmQgY2NbMF0gb3IgInZhbHVlIgogICAgICAgICAgICAgICAgICAgICAgICBjY1sxXSA9IHNlbGYuYXR0cl9yZXBsYWNlKCI9Ii5qb2luKGNjWzE6XSkpICMgcmVqb2luCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXY9ZXZhbChjY1sxXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2NbMF0uc3RhcnRzd2l0aCgiUy4iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnBtbkV2ZW50LlNbY2NbMF1dPWV2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgY2NbMF0uc3RhcnRzd2l0aCgiQS4iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5FW2NjWzBdXT1ldgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbY2NbMF1dPWV2CiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyW2NjWzBdXT1GYWxzZQpjbGFzcyBDb25kaXRpb25hbEV2ZW50KEJwbW5FdmVudCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb2RlPU5vbmUpOgogICAgICAgICAgICBCcG1uRXZlbnQuX19pbml0X18oc2VsZiwgTm9uZSwgY29kZSkKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOgogICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiZSJdID0gLTEKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciA9PSBOb25lIDogIyBpZiBmcmVlIGFkZCB0byBzaW11bGF0b3IgY29uZGl0aW9ucwogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyID0gY3VzdAogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbInZhbHVlIl09RmFsc2UKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdID0gc2ltLm5vdygpCiAgICAgICAgICAgICAgICAgIHNpbS5hZGRfY29uZGl0aW9uKHNlbGYpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgIHNlbGYucXVldWUucHVzaChjdXN0KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOgogICAgICAgICAgICBiID0gRmFsc2UKICAgICAgICAgICAgaWYgc2VsZi5jb2RlIT1Ob25lOgogICAgICAgICAgICAgICAgICBzZWxmLl9ldmFsKHNlbGYuY29kZSwwKQogICAgICAgICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyLmF0dHJbInZhbHVlIl09PVRydWU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNjPXNlbGYuY29kZS5zcGxpdCgnOycpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihjYyk+MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbCgiOyIuam9pbihjY1sxOl0pKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXQoc2ltKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyID0gTm9uZSAgICAjIG1hcmsgdGhhdCBub3cgdGhlIHNlcnZpY2UgaXMgZnJlZSAhISEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYucXVldWUpPjAgOiAgIyBidXQgaWYgYW55Ym9keSBpbiBxdWV1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmluc2VydChzZWxmLnF1ZXVlLnBvcCgpLCBzaW0pICAjIGdldCBhbmQgaW5zZXJ0IGludG8gc2ltdWxhdG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBUcnVlICAjIHJlYWR5IHRvIGJlIHJlbW92ZWQgZnJvbSBzaW11bGF0b3IgY29uZGl0aW9ucwogICAgICAgICAgICByZXR1cm4gYgpjbGFzcyBHZW5lcmF0b3IoQnBtbkV2ZW50KToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIGZ1biwgcGFyYW0sIHRtYXg9MC4wLCBjb2RlPU5vbmUpOgogICAgICAgICAgICBCcG1uRXZlbnQuX19pbml0X18oc2VsZiwgTm9uZSwgY29kZSkKICAgICAgICAgICAgc2VsZi5mdW4sIHNlbGYucGFyYW0sIHNlbGYudG1heCwgc2VsZi5uID0gZnVuLCBwYXJhbSwgdG1heCwgMAogICAgICAgICAgICBpZiBzZWxmLmNvZGUhPU5vbmUgOgogICAgICAgICAgICAgICAgICBzZWxmLl9ldmFsKHNlbGYuY29kZSkgICAjIGV2YWx1YXRlIHNjcmlwdCBjb2RlIChbdmFyXT08dmFsdWU+KQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOgogICAgICAgICAgICBzZWxmLmN1c3RvbWVyID0gQ3VzdG9tZXIoKQogICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IHNpbS5ub3coKQogICAgICAgICAgICBzZWxmLkFbIkEubiJdICs9IDEKICAgICAgICAgICAgX3ByaW50KCJSZWdpc3RlcmluZzogIiArIHN0cihzZWxmLmN1c3RvbWVyKSArICIgKCIrc3RyKHNlbGYudGltZSkrIikiKQogICAgICAgICAgICBzZWxmLm91dChzaW0pICAgICAgICAgICAgICMgcGFzcyBjdXN0b21lciB0byBjb25uZWN0ZWQgb2JqZWN0CiAgICAgICAgICAgIHNlbGYudGltZSArPSBzZWxmLl9mdW4oKQogICAgICAgICAgICBpZiBzZWxmLnRtYXg+MCBhbmQgc2VsZi50aW1lIDw9IHNlbGYudG1heCBvciBzZWxmLm48LXNlbGYudG1heC0xOgogICAgICAgICAgICAgICAgICBzZWxmLm4gKz0gMQogICAgICAgICAgICAgICAgICBzaW0uYWRkKHNlbGYpICAgICAgICMgbmV4dCBvbmUgaW4gcmFuZG9tIHRpbWUKY2xhc3MgU2VydmljZShCcG1uRXZlbnQpOgogICAgICBkZWYgX19pbml0X18oc2VsZiwgZnVuLCBwYXJhbSwgY29kZT1Ob25lKTogCiAgICAgICAgICAgIEJwbW5FdmVudC5fX2luaXRfXyhzZWxmLCJBY3Rpdml0eSIsY29kZSkgIAogICAgICAgICAgICBzZWxmLmZ1biwgc2VsZi5wYXJhbSA9IGZ1biwgcGFyYW0gCiAgICAgICAgICAgIHNlbGYuTiA9IDEgIyBOIG51bWJlciBvZiB0b2tlbnMgdG8gd2FpdCAodXNlZCBmb3IgQW5kR2F0ZSkKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNlbGYsWG9yR2F0ZSk6CiAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLm91dHB1dCk+MSBhbmQgc2VsZi5jb2RlPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNvZGU9Ij1CKDAuNSkiCiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIgPT0gTm9uZTogIyBpZiBmcmVlIGFkZCB0byBzaW11bGF0b3Igd2l0aCBlbmQgdGltZQogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLHQgPSBjdXN0LHNlbGYuX2Z1bigpCiAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UodCxsaXN0KTogICMgW2N5Y2xlLGJlZ2luPTBdIGN5Y2xpYyB0aW1lciAoTU0gMS4xMS4yMDI0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4odCk8MjogdC5hcHBlbmQoMCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lID0gdFsxXSttYXRoLmNlaWwoKHNpbS5ub3coKS10WzFdKS90WzBdKSp0WzBdCiAgICAgICAgICAgICAgICAgICAgICAgICNfcHJpbnQoIiMgIitzdHIoc2VsZi5jdXN0b21lcikrIjogIitzdHIoc2ltLm5vdygpKSsiICIrc3RyKHNlbGYudGltZSkpCiAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IHNpbS5ub3coKSArIHQKICAgICAgICAgICAgICAgICAgX3ByaW50KCIjIitzdHIoc2VsZi5pZCkrIiBzdGFydHMgc2VydmluZyAiKwogICAgICAgICAgICAgICAgICAgICAgICAgc3RyKGN1c3QpKyIgKCIrc3RyKHNpbS5ub3coKSkrIiwiK3N0cihzZWxmLnRpbWUpKyIpIikKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdPXNpbS5ub3coKQogICAgICAgICAgICAgICAgICBpZiAiX19uIitzdHIoc2VsZi5pZCkgbm90IGluIHNlbGYuY3VzdG9tZXIuYXR0cjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX24iK3N0cihzZWxmLmlkKV0gPSAwICMgZmlyc3QgdGltZQogICAgICAgICAgICAgICAgICBpZiAiX190IitzdHIoc2VsZi5pZCkrImEiIG5vdCBpbiBzZWxmLmN1c3RvbWVyLmF0dHI6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImEiXT1zaW0ubm93KCkgIyBpZiBub3QgZnJvbSBxdWV1ZQogICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNlbGYsVGltZXIpIGFuZCBub3QgaXNpbnN0YW5jZSh0LGxpc3QpOiAgIyBtb2RpZnkgcmVxdWlyZWQgZmluYWwgZXhlY3V0aW9uIHRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgdGE9Y3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdICAKICAgICAgICAgICAgICAgICAgICAgICAgdGI9Y3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdCiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSAtPSAodGItdGEpICMgZGVjcmVhc2UgYmVnaW4gdGltZQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWUgLT0gKHRiLXRhKSAgIyAuLi4gYnkgdGhlIGRpZmZlcmVuY2UgZWxhcHNlZCBhbHJlYWR5CiAgICAgICAgICAgICAgICAgICAgICAgICNfcHJpbnQoIiMgIitzdHIoc2VsZi5jdXN0b21lcikrIjogIitzdHIoc2VsZi50aW1lKSkKICAgICAgICAgICAgICAgICAgc2ltLmFkZChzZWxmKQogICAgICAgICAgICBlbHNlOiAgICAgICAgICAgICAgICAgICAgICMgZWxzZSBpbnNlcnQgaW50byBxdWV1ZQogICAgICAgICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl09c2ltLm5vdygpICAjIHdpdGggYSBxdWV1ZSBhZGRpbmcgdGltc3RhbXAKICAgICAgICAgICAgICAgICAgc2VsZi5xdWV1ZS5wdXNoKGN1c3QpCiAgICAgIGRlZiBleGVjKHNlbGYsIHNpbSk6CiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIhPU5vbmU6CiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXT1zaW0ubm93KCkKICAgICAgICAgICAgICAgICAgc2VsZi5BWyJBLm4iXSArPSAxCiAgICAgICAgICAgIF9wcmludCgiIyIrc3RyKHNlbGYuaWQpKyIgZmluaXNoZWQgc2VydmluZyAiICsgc3RyKHNlbGYuY3VzdG9tZXIpICsgIiBhdCAiICsgc3RyKHNlbGYudGltZSkpCiAgICAgICAgICAgIGlmIHNlbGYuY29kZSE9Tm9uZSA6ICAgICAgCiAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoc2VsZi5jb2RlKSAgICMgZXZhbHVhdGUgc2NyaXB0IGNvZGUgKFt2YXJdPTx2YWx1ZT4pCiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIhPU5vbmU6CiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX19uIitzdHIoc2VsZi5pZCldICs9IDEKICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuY3VzdG9tZXIuYXR0clsiX19uIitzdHIoc2VsZi5pZCldJXNlbGYuTikgPT0gMDogI3NlbGYuTjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXQoc2ltKSAgICAgIyBwYXNzIGN1c3RvbWVyIHRvIGNvbm5lY3RlZCBvYmplY3QKICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IE5vbmUgICAgIyBtYXJrIHRoYXQgbm93IHRoZSBzZXJ2aWNlIGlzIGZyZWUgISEhCiAgICAgICAgICAgIGlmIGxlbihzZWxmLnF1ZXVlKT4wIDogICMgYnV0IGlmIGFueWJvZHkgaW4gcXVldWUKICAgICAgICAgICAgICAgICAgU2VydmljZS5pbnNlcnQoc2VsZixzZWxmLnF1ZXVlLnBvcCgpLCBzaW0pICAjIGdldCBhbmQgaW5zZXJ0IGludG8gc2ltdWxhdG9yCmNsYXNzIFNpbmsoQnBtbkV2ZW50KToKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOiAgICAKICAgICAgICAgICAgX3ByaW50KCJTaW5raW5nICIrc3RyKGN1c3QpKyIgOiAiK3N0cihzaW0ubm93KCkpKQogICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl0gPSBzaW0ubm93KCkgICMgbWFyayB0aW1lIGluIGN1c3RvbWVyIGF0dHJpYnV0ZXMKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdID0gc2ltLm5vdygpICAjIG1hcmsgdGltZSBpbiBjdXN0b21lciBhdHRyaWJ1dGVzCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IHNpbS5ub3coKSAgIyBtYXJrIHRpbWUgaW4gY3VzdG9tZXIgYXR0cmlidXRlcwogICAgICAgICAgICBzZWxmLkFbIkEubiJdICs9IDEKICAgICAgICAgICAgc2VsZi5xdWV1ZS5wdXNoKGN1c3QpICAgICAjIGluc2VydCBvbmx5IHRvIGl0cyBxdWV1ZSAKCiMgLS0tLSBicG1uIGRlcml2ZWQgY2xhc3NlcyAoZnJvbSBHZW5lcmF0b3IsIFNlcnZpY2UsIENvbmRpdGlvbmFsRXZlbnQgb3IgU2luaykgLS0tLQpjbGFzcyBYb3JHYXRlKFNlcnZpY2UpOiAgICAjIHJhbmRvbSBvdXRwdXQgaWYgdHdvIG91dHB1dHMgCiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6ICAjIGRlZmF1bHRzIHRvIGJpbmFyeSByYW5kb20gc2VsZWN0aW9uCiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixOb25lLDAsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJleGNsdXNpdmVHYXRld2F5IikKY2xhc3MgQW5kR2F0ZShTZXJ2aWNlKTogICAgCiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixOb25lLDAsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJwYXJhbGxlbEdhdGV3YXkiKQogICAgICBkZWYgaW5zZXJ0KHNlbGYsIGN1c3QsIHNpbSk6CiAgICAgICAgICAgIGlkcz1bZS5pZCBmb3IgZSBpbiBzZWxmLnByZXYoKV0gIyBpZHMgb2YgaW5wdXRzCiAgICAgICAgICAgIHNlbGYuTj1sZW4oc2V0KGlkcykpICMgc2V0IG51bWJlciBvZiBpbnB1dHMgKHdpdGggdW5pcXVlIGlkcykgdG8gd2FpdAogICAgICAgICAgICBTZXJ2aWNlLmluc2VydChzZWxmLGN1c3Qsc2ltKQpjbGFzcyBTdGFydChHZW5lcmF0b3IpOgogICAgICBkZWYgX19pbml0X18oc2VsZixmdW49RSxwYXJhbT1bMV0sdG5tYXg9NTAuMCxjb2RlPU5vbmUpOgogICAgICAgICAgICBHZW5lcmF0b3IuX19pbml0X18oc2VsZixmdW4scGFyYW0sdG5tYXgsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJzdGFydEV2ZW50IikKY2xhc3MgVGFzayhTZXJ2aWNlKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsZnVuPVUscGFyYW09WzEsMl0sY29kZT1Ob25lLE09MSk6CiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixmdW4scGFyYW0sY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJ0YXNrIikKICAgICAgICAgICAgc2VsZi5zZXJ2ZXJzLCBzZWxmLm5zZXJ2ZXIsIHNlbGYuTSA9IFtdLCAwLCBNCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKHNlbGYuTS0xKToKICAgICAgICAgICAgICAgICAgRXZlbnQuY250IC09MQogICAgICAgICAgICAgICAgICBzZWxmLnNlcnZlcnMuYXBwZW5kKFNlcnZpY2UoZnVuLHBhcmFtLGNvZGUpKQogICAgICBkZWYgaW5zZXJ0KHNlbGYsIGN1c3QsIHNpbSk6CiAgICAgICAgICAgIGlmKHNlbGYubnNlcnZlcj09MCk6ICAjIG15c2VsZgogICAgICAgICAgICAgICAgICBTZXJ2aWNlLmluc2VydChzZWxmLGN1c3Qsc2ltKQogICAgICAgICAgICBlbHNlOiAgICAgICAgICAgICAgIyBvdGhlcnNlbGZzCiAgICAgICAgICAgICAgICAgIHNlbGYuc2VydmVyc1tzZWxmLm5zZXJ2ZXItMV0uaW5zZXJ0KGN1c3Qsc2ltKQogICAgICAgICAgICBzZWxmLm5zZXJ2ZXIgPSAoc2VsZi5uc2VydmVyKzEpJXNlbGYuTQpjbGFzcyBUaW1lcihTZXJ2aWNlKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsZnVuPTEscGFyYW09Tm9uZSxjb2RlPU5vbmUpOgogICAgICAgICAgICBpZiBub3QgY2FsbGFibGUoZnVuKTogICMgd2hlbiBwYXNzaW5nIGZpeGVkIGRlbGF5IHZhbHVlCiAgICAgICAgICAgICAgICAgIGZ1bixwYXJhbSxjb2RlID0gTm9uZSxmdW4scGFyYW0KICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLGZ1bixwYXJhbSxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImludGVybWVkaWF0ZUNhdGNoRXZlbnQiKQpjbGFzcyBFbmQoU2luayk6CiAgICAgICNkZWYgX19pbml0X18oc2VsZik6CiAgICAgICMgICAgICBTaW5rLl9faW5pdF9fKHNlbGYpCiAgICAgICMgICAgICBzZWxmLnNldE5hbWUoImVuZEV2ZW50IikKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2luay5fX2luaXRfXyhzZWxmLCJlbmRFdmVudCIsY29kZSkKY2xhc3MgVGhyb3coU2VydmljZSk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJpbnRlcm1lZGlhdGVUaHJvd0V2ZW50IikKY2xhc3MgVGVybWluYXRlKEVuZCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIEVuZC5fX2luaXRfXyhzZWxmLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgidGVybWluYXRlRW5kRXZlbnQiKQpjbGFzcyBTY3JpcHQoU2VydmljZSk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixOb25lLDAsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJzY3JpcHRUYXNrIikKY2xhc3MgQ29uZGl0aW9uKENvbmRpdGlvbmFsRXZlbnQpOgogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBDb25kaXRpb25hbEV2ZW50Ll9faW5pdF9fKHNlbGYsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJpbnRlcm1lZGlhdGVDYXRjaEV2ZW50IikKCiMgLS0tLSB1dGlsMiAtLS0tLS0tLSAgICAgIApkZWYgY29ubmVjdChhLCBiKToKICAgICAgYS5vdXRwdXQuYXBwZW5kKGIpCiAgICAgIGlmIGlzaW5zdGFuY2UoYSxUYXNrKToKICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGEuc2VydmVycykpOiAgIyBmaXJzdCBzZXJ2ZXIgaXMgYWxyZWFkeSBjb25uZWN0ZWQKICAgICAgICAgICAgICAgICAgYS5zZXJ2ZXJzW2ldLm91dHB1dC5hcHBlbmQoYikKZGVmIGRpY3RfdG9zdHJpbmcoYSk6CiAgICAgIHJldHVybiAiXG4iLmpvaW4oW2srIjpcdCIrc3RyKHYpIGZvciBrLHYgaW4gYS5pdGVtcygpXSkKIiIiCmRlZiBoaXN0KGE9WzAsMV0sIGI9MjAsIGM9J29yYW5nZScpOgogICAgICBpbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CiAgICAgIHBsdC5oaXN0KGEsYixjb2xvcj1jKQogICAgICBwbHQuc2F2ZWZpZygiZGVzX3Bsb3Quc3ZnIiwgZm9ybWF0PSJzdmciKQogICAgICBwbHQuc2hvdygpCmRlZiBmcm9tX2ZpbGUoZm5hbWUpOgogICAgICB3aXRoIG9wZW4oZm5hbWUsInIiKSBhcyBmcDoKICAgICAgICAgICAgcmV0dXJuIGZwLnJlYWQoKQoiIiIKIyAtLS0tIGNvbnZlcnNpb25zIC0tLS0tLS0tICAgICAgCmRlZiBhdHRyX3Rvc3RyaW5nKGEpOgogICAgICBzPSJuYW1lOiAiK2FbIm5hbWUiXSsiXG4iCiAgICAgIGZvciBpIGluIHJhbmdlKDEsMTAwKToKICAgICAgICAgICAgdD0iX190IitzdHIoaSkKICAgICAgICAgICAgaWYgdCsiYiIgaW4gYToKICAgICAgICAgICAgICAgICAgcys9dCsiICIrIiUuM2YiJWFbdCsiYiJdKyIgIisiJS4zZiIlYVt0KyJlIl0rIlxuIgogICAgICByZXR1cm4gcwpkZWYgYXR0cl90b3N2Z3N0cmluZyhvLHdtYXgsdz0xNixoPTI0KToKICAgICAgZ2xvYmFsIG5lCiAgICAgIGEscyA9IG8uYXR0ciwiIgogICAgICBjPVsnaG90cGluaycsJ2xpbWVncmVlbicsJ2Nvcm5mbG93ZXJibHVlJywnY29yYWwnLCdtZWRpdW1zZWFncmVlbicsJ21lZGl1bXB1cnBsZSddCiAgICAgIGZvciBpIGluIHJhbmdlKDEwMCk6CiAgICAgICAgICAgIHQ9Il9fdCIrc3RyKGkpCiAgICAgICAgICAgIGlmIHQrImIiIGluIGE6CiAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSI4IiB5PSInK3N0cigzMitoKmkpKyciPicrc3RyKGkpKyc8dGl0bGU+JytzdHIobmUuZWVbaS0xXS5uYW1lKSsnICcrc3RyKG5lLmVlW2ktMV0udGl0bGUpKyc8L3RpdGxlPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IGNsYXNzPSJ0MSIgc3R5bGU9ImRpc3BsYXk6bm9uZTtmaWxsOmdyYXkiIHg9IjMyIiB5PSInK3N0cigzMitoKmkpKyciPicrc3RyKG5lLmVlW2ktMV0udGl0bGUpKyc8dGl0bGU+JytzdHIobmUuZWVbaS0xXS5uYW1lKSsnPC90aXRsZT48L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgIHQwLHQxLHQyID0gYVt0KyJhIl0sYVt0KyJiIl0sYVt0KyJlIl0KICAgICAgICAgICAgICAgICAgcys9JzxyZWN0IHk9Iicrc3RyKDIwK2gqaSkrJyIgeD0iJytzdHIoMjArdyp0MSkKICAgICAgICAgICAgICAgICAgcys9JyIgd2lkdGg9Iicrc3RyKHQyLXQxPT0wIGFuZCAxIG9yIHcqKHQyLXQxKSkrJyIgaGVpZ2h0PSInK3N0cihoLTIpKyciIHN0cm9rZT0iYmxhY2siIGZpbGwtb3BhY2l0eT0iMC43IiBmaWxsPSInCiAgICAgICAgICAgICAgICAgIHMrPShjW2ludChhWyJjbmFtZSJdLnNwbGl0KCcgJylbMF0pJWxlbihjKV0pKyciPjx0aXRsZT4nK2FbImNuYW1lIl0rJyBbJysoIiUuMmYsICIldDApKygiJS4yZiwgIiV0MSkrKCIlLjJmIiV0MikrJ10nKyc8L3RpdGxlPjwvcmVjdD5cbicKICAgICAgICAgICAgICAgICAgaWYgdDItdDE+MC41OgogICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoMjArdyp0MSsyKSsnIiB5PSInK3N0cigyMCtoKmkrMTgpKyciPicrYVsiY25hbWUiXSsnPC90ZXh0PicKICAgICAgICAgICAgICAgICAgaWYgdyp0MT53bWF4WzBdOgogICAgICAgICAgICAgICAgICAgICAgICB3bWF4WzBdID0gdyp0MQogICAgICByZXR1cm4gcwpkZWYgdG9fc3ZnKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHcsaCxXLEggPSAxNiwyNCxbMTYwXSw0MCAgIyBXWzBdIGZvciBwYXNzaW5nIGJ5IHJlZmVyZW5jZSEhIQogICAgICBzID0gJzxzdmcgb25jbGljaz0ib25fY2xpY2soKSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iJWQiIGhlaWdodD0iJWQiPlxuJwogICAgICBmb3IgZSBpbiBlZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLEVuZCk6CiAgICAgICAgICAgICAgICAgIGZvciBjIGluIGUucXVldWUub2JqZWN0czoKICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBhdHRyX3Rvc3Znc3RyaW5nKGMsVyx3LGgpCiAgICAgICAgICAgIEggKz0gMjQKICAgICAgSCs9MjQKICAgICAgcys9ICc8cmVjdCB4PSIyMCIgeT0iMTAiIHdpZHRoPSIlZCIgaGVpZ2h0PSIyIi8+XG4nJShXWzBdK3cpCiAgICAgIHMrPSAnPHJlY3QgeD0iMjAiIHk9IiVkIiB3aWR0aD0iJWQiIGhlaWdodD0iMiIvPlxuJyUoSCsxMCxXWzBdK3cpCiAgICAgIGZvciBpIGluIHJhbmdlKGludChXWzBdL3crMikpOgogICAgICAgICAgICBzICs9ICc8cmVjdCB4PSInK3N0cigyMCt3KmkpKyciIHk9IjEwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxMCIvPlxuJwogICAgICAgICAgICBzICs9ICc8cmVjdCB4PSInK3N0cigyMCt3KmkpKyciIHk9IiVkIiB3aWR0aD0iMSIgaGVpZ2h0PSIxMCIvPlxuJyUoSCkKICAgICAgICAgICAgaWYgKGklMTApPT0wOgogICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoMjArdyppLTgpKyciIHk9IjMyIj4nK3N0cihpKSsnPC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoMjArdyppLTgpKyciIHk9IiVkIj4nJShIKStzdHIoaSkrJzwvdGV4dD5cbicKICAgICAgcyArPSAiPHNjcmlwdD5mdW5jdGlvbiBvbl9jbGljaygpIHtbLi4uZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndDEnKV0uZm9yRWFjaChlPT5lLnN0eWxlLmRpc3BsYXk9KGUuc3R5bGUuZGlzcGxheT09J25vbmUnPycnOidub25lJykpO308L3NjcmlwdD4iCiAgICAgIHJldHVybiBzJShXWzBdKzgwLEgrMjApICsgJzwvc3ZnPlxuJwpkZWYgdG9fZG90MChlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMpOgogICAgICBzID0nZGlncmFwaCBCUE1OIHsgcmFua2Rpcj0iTFIiIHJhbmtzZXA9MSBub2Rlc2VwPTFcbicKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6CiAgICAgICAgICAgIHMxID0gJyAge3Jhbms9c2FtZTsgJwogICAgICAgICAgICBmb3IgaiBpbiByYW5nZShsZW4oZWVbaV0ub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgIHMgKz0gIiAgIitzdHIoZWVbaV0uaWQpICsgIiAtPiAiICsgc3RyKGVlW2ldLm91dHB1dFtqXS5pZCkgKyJcbiIKICAgICAgICAgICAgICAgICAgczEgKz0gc3RyKGVlW2ldLm91dHB1dFtqXS5pZCkgKyI7ICIKICAgICAgICAgICAgaWYgbGVuKGVlW2ldLm91dHB1dCk+MToKICAgICAgICAgICAgICAgICAgaWYgYWJzKGVlW2ldLm91dHB1dFswXS5pZC1lZVtpXS5vdXRwdXRbMV0uaWQpPDI6IHMgKz0gczEgKyd9XG4nCiAgICAgIHJldHVybiBzKyd9JwpkZWYgdG9fZG90KGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHMgPSdkaWdyYXBoIEJQTU4yIHsgcmFua2Rpcj0iTFIiIG5vZGVzZXA9MC42XG4nCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBsYWJlbCx4bGFiZWwsc2hhcGUsc3R5bGUsY29sb3IscGVuID0gc3RyKGVlW2ldLmlkKSwiIiwicmVjdCIsIiIsIiIsIjEiCiAgICAgICAgICAgIHNpemU9IiIKICAgICAgICAgICAgaWYgInZlbnQiIGluIGVlW2ldLm5hbWU6IHNoYXBlPSJjaXJjbGUiCiAgICAgICAgICAgIGVsaWYgImF0ZXdheSIgaW4gZWVbaV0ubmFtZTogc2hhcGU9ImRpYW1vbmQiOyBzaXplPSJoZWlnaHQ9MC43IgogICAgICAgICAgICBpZiAiaW50ZXJtZWRpYXRlIiBpbiBlZVtpXS5uYW1lOiBzaGFwZT0iZG91YmxlY2lyY2xlIgogICAgICAgICAgICBpZiBzaGFwZT09InJlY3QiOiBzdHlsZT0icm91bmRlZCxmaWxsZWQiOyBjb2xvcj0ibGlnaHRibHVlIjsgc2l6ZT0id2lkdGg9MS4xIGhlaWdodD0wLjgiCiAgICAgICAgICAgIGVsaWYgImVuZCIgaW4gZWVbaV0ubmFtZTogc3R5bGU9ImZpbGxlZCI7IHBlbj0iMyIKICAgICAgICAgICAgaWYgImV4Y2x1c2l2ZSIgaW4gZWVbaV0ubmFtZTogeGxhYmVsPWxhYmVsOyBsYWJlbD0iWCIKICAgICAgICAgICAgZWxpZiAicGFyYWxsZWwiIGluIGVlW2ldLm5hbWU6IHhsYWJlbD1sYWJlbDsgbGFiZWw9IisiCiAgICAgICAgICAgIHMgKz0gJyAgJytlZVtpXS5uYW1lICsnIFtsYWJlbD0iJytsYWJlbCsnIiB4bGFiZWw9IicreGxhYmVsCiAgICAgICAgICAgIHMgKz0gJyIgc3R5bGU9Iicrc3R5bGUrJyIgc2hhcGU9Iicrc2hhcGUrJyIgZmlsbGNvbG9yPSInCiAgICAgICAgICAgIHMgKz0gY29sb3IrJyIgcGVud2lkdGg9IicrcGVuKyciICcrc2l6ZSsnXScgKydcbicKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6CiAgICAgICAgICAgIHMxID0gJyAge3Jhbms9c2FtZTsgJwogICAgICAgICAgICBmb3IgaiBpbiByYW5nZShsZW4oZWVbaV0ub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgIHMgKz0gIiAgIitlZVtpXS5uYW1lICsgIiAtPiAiICsgZWVbaV0ub3V0cHV0W2pdLm5hbWUgKyJcbiIKICAgICAgICAgICAgICAgICAgczEgKz0gZWVbaV0ub3V0cHV0W2pdLm5hbWUgKyI7ICIKICAgICAgICAgICAgaWYgbGVuKGVlW2ldLm91dHB1dCk+MToKICAgICAgICAgICAgICAgICAgaWYgYWJzKGVlW2ldLm91dHB1dFswXS5pZC1lZVtpXS5vdXRwdXRbMV0uaWQpPDI6IHMgKz0gczEgKyd9XG4nCiAgICAgIHJldHVybiBzKyd9JwpkZWYgdG9fcG9zaXRpb24oZWU9UXVldWVkRXZlbnQuaW5zdGFuY2VzKToKICAgICAgcHA9W10KICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6ICAgIyBzZXQgeCBwb3NpdGlvbiB0byB0cmVlIGxldmVsCiAgICAgICAgICAgIHgsZXAgPSAwLGVlW2ldLnByZXYoKQogICAgICAgICAgICBmb3IgaWR4IGluIHJhbmdlKGxlbihlcCktMSwtMSwtMSk6CiAgICAgICAgICAgICAgICAgIGlmIGVwW2lkeF0ucHBbMF0hPS0xOgogICAgICAgICAgICAgICAgICAgICAgICB4PWVwW2lkeF0ucHBbMF0rMQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlZVtpXS5wcD1beCwwXQogICAgICAgICAgICBwcC5hcHBlbmQoZWVbaV0ucHApCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pCiAgICAgIGZvciBpIGluIHJhbmdlKDEsbGVuKHBwKSk6ICMgaW5jcmVhc2UgeSBwb3NpdGlvbiBmb3IgYWxsIGF0IHRoZSBzYW1lIGxldmVsCiAgICAgICAgICAgIGlmIHBwW2ldWzBdPT1wcFtpLTFdWzBdOgogICAgICAgICAgICAgICAgICBwcFtpXVsxXSA9IHBwW2ktMV1bMV0rMQogICAgICAgICAgICAgICAgICBlZVtpXS5wcD1wcFtpXQogICAgICAjcHJpbnQoW18ucHAgZm9yIF8gaW4gZWVdKQogICAgICAjIiIiCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSktMSwtMSwtMSk6ICAgIyBzZXQgeSBwb3NpdGlvbiB0byB0aGUgbGV2ZWwgb2YgcHJldmlvdXMgCiAgICAgICAgICAgIGUgPSBlZVtpXS5wcmV2KCkKICAgICAgICAgICAgaWYgbGVuKGUpPjAgYW5kIGVbMF0ub3V0cHV0WzBdPT1lZVtpXToKICAgICAgICAgICAgICAgICAgcHBbaV1bMV0gPSBlWzBdLnBwWzFdCiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwPXBwW2ldCiAgICAgICAgICAgIGlmIGxlbihlKT4wIGFuZCBsZW4oZVswXS5vdXRwdXQpPjEgYW5kIGVbMF0ub3V0cHV0WzFdPT1lZVtpXSBhbmQgbGVuKGVlW2ldLm91dHB1dCk9PTA6CiAgICAgICAgICAgICAgICAgIHBwW2ldWzBdID0gZWVbaV0ucHBbMF0tMSAgIyB3aGVuIGl0IGlzIHRoZSBzZWNvbmQgYW5kIGhhcyBubyBvdXB1dAogICAgICAgICAgICAgICAgICBlZVtpXS5wcD1wcFtpXQogICAgICAjcHJpbnQoW18ucHAgZm9yIF8gaW4gZWVdKQogICAgICAjIiIiCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSktMSwtMSwtMSk6ICMgbW92ZSBwcmV2aW91cyB0byB0aGUgbGV2ZWwgb2YgaXRzIGZpcnN0IG5leHQKICAgICAgICAgICAgZXA9ZWVbaV0ucHJldigpCiAgICAgICAgICAgIGlmIGxlbihlcCk+MCBhbmQgZXBbMF0ub3V0cHV0WzBdPT1lZVtpXSBhbmQgZXBbMF0ucHBbMF09PWVlW2ldLnBwWzBdLTE6CiAgICAgICAgICAgICAgICAgIGlmIGVwWzBdLnBwWzFdIT1lZVtpXS5wcFsxXToKICAgICAgICAgICAgICAgICAgICAgICAgZXBbMF0ucHBbMV09ZWVbaV0ucHBbMV0KICAgICAgI3ByaW50KFtfLnBwIGZvciBfIGluIGVlXSkgICAgICAKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6ICAjIGZvcmNlIHBvc2l0aW9uIGZyb20gcHAyCiAgICAgICAgICAgIGlmIGVlW2ldLnBwMlswXSE9LTE6CiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwWzBdPWVlW2ldLnBwMlswXQogICAgICAgICAgICBpZiBlZVtpXS5wcDJbMV0hPS0xOgogICAgICAgICAgICAgICAgICBlZVtpXS5wcFsxXT1lZVtpXS5wcDJbMV0KICAgICAgZm9yIGUgaW4gZWU6ICAgIyBjb3JyZWN0IHBvc2l0aW9uIG9mIGJvdW5kYXJ5IGV2ZW50cyAKICAgICAgICAgICAgI2lmKGUucHBbMF09PTAgYW5kIGUucHBbMV09PTApOgogICAgICAgICAgICBpZihlLmlkIT1lLmlkMik6CiAgICAgICAgICAgICAgICAgIGlkMj1pbnQoc3RyKGUuaWQyKS5zcGxpdCgiLiIpWzFdKQogICAgICAgICAgICAgICAgICBlLnBwWzBdLGUucHBbMV0gPSBlZVtpZDItMV0ucHBbMF0sZWVbaWQyLTFdLnBwWzFdCiAgICAgIHJldHVybiBbZS5wcCBmb3IgZSBpbiBlZV0KZGVmIHRvX2JwbW4oZWU9UXVldWVkRXZlbnQuaW5zdGFuY2VzLHBwPU5vbmUpOgogICAgICBzID0nPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz5cbicKICAgICAgcys9JzxicG1uOmRlZmluaXRpb25zIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiJwogICAgICBzKz0nIHhtbG5zOmJwbW49Imh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0JQTU4vMjAxMDA1MjQvTU9ERUwiJwogICAgICBzKz0nIHhtbG5zOmJwbW5kaT0iaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9ESSInCiAgICAgIHMrPScgeG1sbnM6ZGM9Imh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0RELzIwMTAwNTI0L0RDIicKICAgICAgcys9JyB4bWxuczpkaT0iaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREkiJwogICAgICBzKz0nIHRhcmdldE5hbWVzcGFjZT0iaHR0cDovL2JwbW4uaW8vc2NoZW1hL2JwbW4iJwogICAgICBzKz0nIGlkPSJEZWZpbml0aW9uc18xIiBleHBvcnRlcj0iZGVzIiBleHBvcnRlclZlcnNpb249IjEuMCI+XG4nCiAgICAgIHMxPScgPGJwbW46cHJvY2VzcyBpZD0iUHJvY2Vzc18xIj5cbicKICAgICAgczI9JyA8YnBtbmRpOkJQTU5EaWFncmFtIGlkPSJCUE1ORGlhZ3JhbV8xIj5cbicKICAgICAgczIrPScgIDxicG1uZGk6QlBNTlBsYW5lIGlkPSJCUE1OUGxhbmVfMSIgYnBtbkVsZW1lbnQ9IlByb2Nlc3NfMSI+XG4nCiAgICAgIHMxYT0nJwogICAgICBqMSA9IDAgICMgZmxvdyBjb3VudGVyCiAgICAgIFcsSCxXMCxIMCA9IDEwMCwxMDAsNDAsMzAKICAgICAgaWYgbm90IHBwOgogICAgICAgICAgICBwcCA9IFtlLnBwIGZvciBlIGluIGVlXQogICAgICAgICAgICBpZiBwcFswXVswXT09LTE6CiAgICAgICAgICAgICAgICAgIHBwID0gdG9fcG9zaXRpb24oZWUpCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBuYW1lID0gZWVbaV0ubmFtZQogICAgICAgICAgICBpZiAidGVybWluYXRlIiBpbiBuYW1lOgogICAgICAgICAgICAgICAgICBuYW1lPW5hbWVbbGVuKCJ0ZXJtaW5hdGUiKTpdCiAgICAgICAgICAgIGVuYW1lID0gZWVbaV0uX19jbGFzc19fLl9fbmFtZV9fKydfJytzdHIoZWVbaV0uZnVuIGFuZCBlZVtpXS5mdW4uX19uYW1lX18gb3IgTm9uZSkrJ18nCiAgICAgICAgICAgIGltcG9ydCBiYXNlNjQKICAgICAgICAgICAgZW5hbWUgKz0gYmFzZTY0LmIxNmVuY29kZShieXRlYXJyYXkoc3RyKGVlW2ldLnBhcmFtKSsnXycrc3RyKGVlW2ldLmNvZGUpLCdhc2NpaScpKS5kZWNvZGUoJ2FzY2lpJykgIyByZXF1aXJlcyBlbmNvZGluZyEKICAgICAgICAgICAgdHlwZT1uYW1lLnNwbGl0KCJfIilbMF0KICAgICAgICAgICAgZ3Q9eyJ3aSI6ODAsImgiOjYwLCJveCI6MCwib3kiOjAsImUiOig4MCwzMCksInciOigwLDMwKSwibiI6KDQwLDApLCJzIjooNDAsNjApfQogICAgICAgICAgICBnZz17IndpIjozNiwiaCI6MzYsIm94IjoyMiwib3kiOjEyLCJlIjooNTgsMzApLCJ3IjooMjIsMzApLCJuIjooNDAsMTIpLCJzIjooNDAsNDgpfQogICAgICAgICAgICBnMSA9IGd0IGlmICJhc2siIGluIHR5cGUgZWxzZSBnZwogICAgICAgICAgICB3LGggPSBnMVsid2kiXSxnMVsiaCJdICAjIGljb24gc2l6ZQogICAgICAgICAgICB4Yix5YiA9IFcwK1cqcHBbaV1bMF0sIEgwK0gqcHBbaV1bMV0KICAgICAgICAgICAgeG8seW8gPSB4YitnMVsib3giXSwgeWIrZzFbIm95Il0gIyBpY29uIG9mZnNldAogICAgICAgICAgICBpZiAidGFzayIgaW4gdHlwZToKICAgICAgICAgICAgICAgICAgaWYgbGVuKGVlW2ldLm91dHB1dCk+MTogdHlwZSA9ICJzZW5kVGFzayIKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNldChbZS5pZCBmb3IgZSBpbiBlZVtpXS5wcmV2KCldKSk+MTogdHlwZSA9ICJyZWNlaXZlVGFzayIKICAgICAgICAgICAgaWYgZWVbaV0uaWQgIT0gZWVbaV0uaWQyOiAgIyBmb3IgYm91bmRhcnkgZXZlbnRzCiAgICAgICAgICAgICAgICAgIGlkMiA9IGludChzdHIoZWVbaV0uaWQyKS5zcGxpdCgnLicpWzFdKQogICAgICAgICAgICAgICAgICB4byx5byA9IGVlW2lkMi0xXS54KzIyLjUsZWVbaWQyLTFdLnkrNDIuNQogICAgICAgICAgICAgICAgICB0eXBlID0gImJvdW5kYXJ5RXZlbnQiCiAgICAgICAgICAgIGVlW2ldLngsZWVbaV0ueSA9IHhvLHlvCiAgICAgICAgICAgIHMxKz0nICA8YnBtbjonK3R5cGUrJyBpZD0iJytuYW1lKyciIG5hbWU9IicrbmFtZS5zcGxpdCgiXyIpWzFdKydcbicrZWVbaV0udGl0bGUrJyI+XG4nCiAgICAgICAgICAgIHMyKz0nICAgPGJwbW5kaTpCUE1OU2hhcGUgaWQ9IicrbmFtZSsnXycrZW5hbWUrJyIgYnBtbkVsZW1lbnQ9IicrbmFtZSsnIj5cbicKICAgICAgICAgICAgczIrPScgICAgPGRjOkJvdW5kcyB4PSInK3N0cih4bykrJyIgeT0iJytzdHIoeW8pKyciIHdpZHRoPSInK3N0cih3KSsnIiBoZWlnaHQ9Iicrc3RyKGgpKyciIC8+XG4nCiAgICAgICAgICAgIHMyKz0nICAgPC9icG1uZGk6QlBNTlNoYXBlPlxuJwogICAgICAgICAgICBmb3IgajIgaW4gcmFuZ2UobGVuKGVlW2ldLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICBqMSArPSAxCiAgICAgICAgICAgICAgICAgIGZsb3csZWZsb3c9J0Zsb3dfJytzdHIoajEpLCJkaSIKICAgICAgICAgICAgICAgICAgaWkgPSBlZVtpXS5vdXRwdXRbajJdLmlkLTEKICAgICAgICAgICAgICAgICAgI3ByaW50KGVlW2ldLGoyLGVlW2ldLm91dHB1dFtqMl0saWkscHApCiAgICAgICAgICAgICAgICAgIHhlLHllID0gVzArVypwcFtpaV1bMF0sIEgwK0gqcHBbaWldWzFdCiAgICAgICAgICAgICAgICAgIG5hbWUyPWVlW2ldLm91dHB1dFtqMl0ubmFtZQogICAgICAgICAgICAgICAgICBpZiAidGVybWluYXRlIiBpbiBuYW1lMjoKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTI9bmFtZTJbbGVuKCJ0ZXJtaW5hdGUiKTpdCiAgICAgICAgICAgICAgICAgIHR5cGUyPW5hbWUyLnNwbGl0KCJfIilbMF0KICAgICAgICAgICAgICAgICAgZzIgPSBndCBpZiAiYXNrIiBpbiB0eXBlMiBlbHNlIGdnCiAgICAgICAgICAgICAgICAgIGlmIHhlPnhiOiAjIHR3byBlZGdlcwogICAgICAgICAgICAgICAgICAgICAgICBkeDEsZHkxID0gZzFbInMiXSBpZiB5Yjx5ZSBlbHNlIGcxWyJlIl0KICAgICAgICAgICAgICAgICAgICAgICAgZHgyLGR5MiA9IGcyWyJzIl0gaWYgeWI+eWUgZWxzZSBnMlsidyJdCiAgICAgICAgICAgICAgICAgIGVsc2UgOiAgICAjIHRocmVlIGVkZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgIGR4MSxkeTEgPSBnMVsicyJdIGlmIHliPHllIGVsc2UgZzFbIm4iXQogICAgICAgICAgICAgICAgICAgICAgICBkeDIsZHkyID0gZzJbInMiXSBpZiB5Yj55ZSBlbHNlIGcyWyJuIl0KICAgICAgICAgICAgICAgICAgeDEseTEgPSB4YitkeDEseWIrZHkxCiAgICAgICAgICAgICAgICAgIHgyLHkyID0geGUrZHgyLHllK2R5MgogICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOm91dGdvaW5nPicrZmxvdysnPC9icG1uOm91dGdvaW5nPlxuJwogICAgICAgICAgICAgICAgICBpZiAiaW50ZXJtZWRpYXRlQ2F0Y2giIGluIG5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICJvbmRpdGlvbiIgaW4gZW5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMxKz0nICAgPGJwbW46Y29uZGl0aW9uYWxFdmVudERlZmluaXRpb24vPlxuJwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOnRpbWVyRXZlbnREZWZpbml0aW9uLz5cbicKICAgICAgICAgICAgICAgICAgczFhKz0nICAgIDxicG1uOnNlcXVlbmNlRmxvdyBpZD0iJytmbG93KyciIHNvdXJjZVJlZj0iJytuYW1lKyciIHRhcmdldFJlZj0iJytuYW1lMisnIiAvPlxuJwogICAgICAgICAgICAgICAgICBzMis9JyAgIDxicG1uZGk6QlBNTkVkZ2UgaWQ9IicrZmxvdysnXycrZWZsb3crJyIgYnBtbkVsZW1lbnQ9IicrZmxvdysnIj5cbicKICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgxKSsnIiB5PSInK3N0cih5MSkrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgeHgseXkgPSAwLDAKICAgICAgICAgICAgICAgICAgaWYgeTEhPXkyOiAjIHJlcXVpcmVzIGFkZGl0aW9uYWwgcG9pbnRzIChvbmUgb3IgdHdvIGltcGxlbWVudGVkKQogICAgICAgICAgICAgICAgICAgICAgICB4eCwgeXkgPSB5Mj55MSBhbmQgeDEgb3IgeDIsIHkyPnkxIGFuZCB5MiBvciB5MQogICAgICAgICAgICAgICAgICAgICAgICBpZiB4MT54MjogIyBiYWNrIGNvbm5lY3Rpb24gcmVxdWlyZXMgdHdvIGFkZGl0aW9uYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgeTE+eTI6ICMgZnJvbSBsb3dlciBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5eSAtPSAzNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDEpKyciIHk9Iicrc3RyKHl5KSsnIiAvPlxuJyAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiB5MTx5MjogIyBmcm9tIHVwcGVyIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl5IC09IDI1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4eCkrJyIgeT0iJytzdHIoeXkpKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHh4ID0geDIKICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHh4KSsnIiB5PSInK3N0cih5eSkrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgZWxpZiB5MT09eTIgYW5kIHgxPngyOiAjIGxvb3BiYWNrIC0gcmVxdWlyZXMgdHdvIGFkZGl0aW9uYWwgcG9pbnRzCiAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MSkrJyIgeT0iJytzdHIoeTEtMzApKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MikrJyIgeT0iJytzdHIoeTItMzApKyciIC8+XG4nICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICBpZiB4eCE9eDIgb3IgeXkhPXkyOgogICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDIpKyciIHk9Iicrc3RyKHkyKSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICBzMis9JyAgIDwvYnBtbmRpOkJQTU5FZGdlPlxuJwogICAgICAgICAgICBpZiAidGVybWluYXRlIiBpbiBlZVtpXS5uYW1lOgogICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOnRlcm1pbmF0ZUV2ZW50RGVmaW5pdGlvbi8+XG4nCiAgICAgICAgICAgIHMxKz0nICA8L2JwbW46Jyt0eXBlKyc+XG4nCiAgICAgICAgICAgIHBhc3MKICAgICAgczIrPScgIDwvYnBtbmRpOkJQTU5QbGFuZT5cbicKICAgICAgczIrPScgPC9icG1uZGk6QlBNTkRpYWdyYW0+XG4nCiAgICAgIHMxKz1zMWErJyA8L2JwbW46cHJvY2Vzcz5cbicKICAgICAgcmV0dXJuIHMrczErczIrJzwvYnBtbjpkZWZpbml0aW9ucz5cbicKCmNsYXNzIEV2ZW50TmV0d29yaygpOgogICAgICBkZWYgX19pbml0X18oc2VsZixzKToKICAgICAgICAgICAgRXZlbnQuY250LCBDdXN0b21lci5jbnQgPSAwLCAwCiAgICAgICAgICAgIFF1ZXVlZEV2ZW50Lmluc3RhbmNlcy5jbGVhcigpCiAgICAgICAgICAgIEJwbW5FdmVudC5TID0ge30KICAgICAgICAgICAgc2VsZi5lZSA9IHNlbGYuZnJvbV9zdHJpbmcocykKICAgICAgICAgICAgc2VsZi5wcCA9IHRvX3Bvc2l0aW9uKHNlbGYuZWUpCiAgICAgIGRlZiBfX2dldGl0ZW1fXyhzZWxmLGkpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5lZVtpXQogICAgICBkZWYgZnJvbV9zdHJpbmcoc2VsZixzKToKICAgICAgICAgICAgZWUsIEV2ZW50LmNudCwgeWxldmVsID0gW10sIDAsIC0xCiAgICAgICAgICAgIGZvciBzMCBpbiBzLnNwbGl0KCdcbicpOgogICAgICAgICAgICAgICAgICBzMSA9IHMwLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgaWYgbGVuKHMxKTwyIG9yIHMxWzBdPT0nIyc6IGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgIGlmICItPiIgaW4gczE6ICMgY29ubmVjdGlvbiBkZWZpbml0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHlsZXZlbCArPSAxICAgIyB1c2VkIGZvciBtYXJraW5nIHJlcXVpcmVkIHkgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHMxYSBpbiBzMS5zcGxpdCgiOyIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSBzMWEuc3RyaXAoKS5zcGxpdCgiLT4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihjb2RlKT4xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZVsxXT1jb2RlWzFdLnNwbGl0KCIjIilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGksaiA9IGludChjb2RlWzBdKS0xLCBpbnQoY29kZVsxXSktMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaT4tMSBhbmQgaj4tMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3QoZWVbaV0sZWVbal0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpPi0xIGFuZCBlZVtpXS5wcDJbMV09PS0xOiAjIGlmIG5vdCBzZXQgeWV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVtpXS5wcDJbMV09eWxldmVsICMgZm9yY2UgeSBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaj4tMSBhbmQgZWVbal0ucHAyWzFdPT0tMTogIyBpZiBub3Qgc2V0IHlldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbal0ucHAyWzFdPXlsZXZlbCAjIGZvcmNlIHkgcG9zaXRpb24gICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgZWxzZTogICAgICAgICAgIyBldmVudCBkZWZpbml0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU9czEuc3BsaXQoIiAiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oY29kZSk+MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlMT0iICIuam9pbihjb2RlWzE6XSkuc3BsaXQoJyMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlLmFwcGVuZChldmFsKGNvZGUxWzBdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVstMV0uaWQyPWZsb2F0KGNvZGVbMF0uc3BsaXQoJy8nKVswXSkgIyBpZCBhcyB3cml0dGVuIGluIHNvdXJjZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVstMV0udGl0bGU9Y29kZTFbMV0uc3RyaXAoKSBpZiBsZW4oY29kZTEpPjEgZWxzZSAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjPWNvZGVbMF0uc3BsaXQoIi8iKSAgIyBjaGVjayBpZGVudGlmaWVyIGZpZWxkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbLTFdLnBwMlswXSA9IGZsb2F0KGNjWzFdKS0xIGlmIGxlbihjYyk+MSBlbHNlIC0xIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS5wcDJbMV0gPSBmbG9hdChjY1syXSktMSBpZiBsZW4oY2MpPjIgZWxzZSAtMQogICAgICAgICAgICBpZiBsZW4oc2V0KFtlLnBwMlsxXSBmb3IgZSBpbiBlZV0pKT09MTogIyB2ZXJpZnkgaWYgbXVsdGktbGluZSBkZXNjcmlwdGlvbgogICAgICAgICAgICAgICAgICBmb3IgZSBpbiBlZTogICAgICAjIGlmIHllcwogICAgICAgICAgICAgICAgICAgICAgICBlLnBwMlsxXT0tMSAjIGNsZWFyIGFsbCB5LWxldmVscyB0byB1bmtub3duCiAgICAgICAgICAgIHJldHVybiBlZQogICAgICBkZWYgdG9fc3RyaW5nKHNlbGYpOgogICAgICAgICAgICBzPScnCiAgICAgICAgICAgIGZvciBlIGluIHNlbGYuZWU6CiAgICAgICAgICAgICAgICAgIHMgKz0gc3RyKGUuaWQpICsgIiAiICsgZS5fX2NsYXNzX18uX19uYW1lX18rIigiCiAgICAgICAgICAgICAgICAgIGlmIGUuX19jbGFzc19fLl9fbmFtZV9fIT0nRW5kJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgIkdhdGUiIG5vdCBpbiBlLl9fY2xhc3NfXy5fX25hbWVfXzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBlLmZ1biBhbmQgZS5mdW4uX19uYW1lX18gb3IgJ05vbmUnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0iLCIrc3RyKGUucGFyYW0pKyIsIgogICAgICAgICAgICAgICAgICAgICAgICBpZiBlLl9fY2xhc3NfXy5fX25hbWVfXyE9J1N0YXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9IGUuY29kZSE9Tm9uZSBhbmQgIlwiIitzdHIoZS5jb2RlKSsiXCIiIG9yICJOb25lIgogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz1zdHIoZS50bm1heCkKICAgICAgICAgICAgICAgICAgcyArPSIpXG4iCiAgICAgICAgICAgIGZvciBlIGluIGVlOgogICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZS5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBzdHIoZS5pZCkgKyAiLT4iICsgc3RyKGUub3V0cHV0W2ldLmlkKSArJzsnCiAgICAgICAgICAgIHJldHVybiBzICsgJ1xuJwpkZWYgc3ZnX3JvdW5kZWRQYXRoKHBwLCByKToKICAgICAgaW1wb3J0IG1hdGgKICAgICAgcywgbCA9ICIiLCBsZW4ocHApLTEKICAgICAgZm9yIGkgaW4gcmFuZ2UobCk6CiAgICAgICAgICAgIGEsYiA9IHBwW2ldLCBwcFtpKzFdCiAgICAgICAgICAgIHQgPSBtaW4ociAvIG1hdGguaHlwb3QoYlswXS1hWzBdLCBiWzFdLWFbMV0rMC4wMSksIDAuNSkKICAgICAgICAgICAgaWYgaT09MDoKICAgICAgICAgICAgICAgICAgcyArPSAnTSVnICVnICclKGFbMF0sYVsxXSkKICAgICAgICAgICAgaWYgaT4wOgogICAgICAgICAgICAgICAgICBzICs9ICdRJWcgJWcgJWcgJWcgJyUoYVswXSxhWzFdLGFbMF0qKDEtdCkrYlswXSp0LGFbMV0qKDEtdCkrYlsxXSp0KQogICAgICAgICAgICBpZiBpPT1sLTE6CiAgICAgICAgICAgICAgICAgIHMgKz0gJ0wlZyAlZyAnJShiWzBdLGJbMV0pCiAgICAgICAgICAgIGVsaWYgaTxsLTE6CiAgICAgICAgICAgICAgICAgIHMgKz0gJ0wlZyAlZyAnJShhWzBdKnQrYlswXSooMS10KSxhWzFdKnQrYlsxXSooMS10KSkKICAgICAgcmV0dXJuIHMKI05TX01BUCA9IHsKIyAgICBOb25lOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9NT0RFTCcsCiMgICAgJ2JwbW5kaSc6ICdodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L0RJJywKIyAgICAnb21nZGMnOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREMnLAojICAgICdvbWdkaSc6ICdodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9ESScsCiMgICAgJ3hzaSc6ICdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZScKI30KZGVmIGJwbW5fdG9zdmcwKGJwbW5maWxlLFc9MTAwLEg9ODApOgogICAgICBzID0gJzxkZWZzPjxtYXJrZXIgaWQ9InRyaWFuZ2xlIiB2aWV3Qm94PSIwIDAgMTAgMTAiIHJlZlg9IjEwIiByZWZZPSI1IiBtYXJrZXJVbml0cz0ic3Ryb2tlV2lkdGgiIG1hcmtlcldpZHRoPSIxMCIgbWFya2VySGVpZ2h0PSIxMCIgb3JpZW50PSJhdXRvIj4gPHBhdGggZD0iTSAwIDAgTCAxMCA1IEwgMCAxMCB6IiBmaWxsPSJibGFjayIgLz48L21hcmtlcj48L2RlZnM+XG4nCiAgICAgIGltcG9ydCB4bWwuZXRyZWUuRWxlbWVudFRyZWUgYXMgRVQKICAgICAgZm9yIGUgaW4gRVQucGFyc2UoYnBtbmZpbGUpLmdldHJvb3QoKToKICAgICAgICAgICAgaWYgIkJQTU5EaWFncmFtIiBpbiBlLnRhZzoKICAgICAgICAgICAgICAgICAgZm9yIGQgaW4gZToKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM9W3AgZm9yIHAgaW4gZCBpZiAiQlBNTlBsYW5lIiBpbiBkLnRhZ10KICAgICAgcmV0dXJuIGl0ZW1zCiNkZWYgYnBtbl90b3N2ZyhicG1uZmlsZSxXPTEwMCxIPTgwKToKZGVmIGJwbW5fdG9zdmcoYnBtbnN0cmluZyxpc2FuaW0sVz0xMDAsSD04MCk6CiAgICAgIHMgPSAnPGRlZnM+PG1hcmtlciBpZD0idHJpYW5nbGUiIHZpZXdCb3g9IjAgMCAxMCAxMCIgcmVmWD0iMTAiIHJlZlk9IjUiIG1hcmtlclVuaXRzPSJzdHJva2VXaWR0aCIgbWFya2VyV2lkdGg9IjEwIiBtYXJrZXJIZWlnaHQ9IjEwIiBvcmllbnQ9ImF1dG8iPiA8cGF0aCBkPSJNIDAgMCBMIDEwIDUgTCAwIDEwIHoiIGZpbGw9ImJsYWNrIiAvPjwvbWFya2VyPjwvZGVmcz5cbicKICAgICAgaW1wb3J0IHhtbC5ldHJlZS5FbGVtZW50VHJlZSBhcyBFVAogICAgICAjZm9yIGUgaW4gRVQucGFyc2UoYnBtbmZpbGUpLmdldHJvb3QoKTogICMgY29sbGVjdCBuYW1lZCBwcm9jZXNzZXMKICAgICAgZm9yIGUgaW4gRVQuZnJvbXN0cmluZyhicG1uc3RyaW5nKTogICMgY29sbGVjdCBuYW1lZCBwcm9jZXNzZXMKICAgICAgICAgICAgaWYgInByb2Nlc3MiIGluIGUudGFnOgogICAgICAgICAgICAgICAgICBlbGVtcz1bZCBmb3IgZCBpbiBlIGlmICJuYW1lIiBpbiBkLmF0dHJpYl0KICAgICAgI2ZvciBlIGluIEVULnBhcnNlKGJwbW5maWxlKS5nZXRyb290KCk6ICAjIGNvbGxlY3QgZGlhZ3JhbSBlbGVtZW50cwogICAgICBmb3IgZSBpbiBFVC5mcm9tc3RyaW5nKGJwbW5zdHJpbmcpOiAgIyBjb2xsZWN0IG5hbWVkIHByb2Nlc3NlcwogICAgICAgICAgICBpZiAiQlBNTkRpYWdyYW0iIGluIGUudGFnOgogICAgICAgICAgICAgICAgICBmb3IgZCBpbiBlOgogICAgICAgICAgICAgICAgICAgICAgICBpdGVtcz1bcCBmb3IgcCBpbiBkIGlmICJCUE1OUGxhbmUiIGluIGQudGFnXQogICAgICBmb3IgaXQgaW4gaXRlbXM6CiAgICAgICAgICAgIHBwLG5hbWUgPSBbXSwiIgogICAgICAgICAgICBmb3IgZSBpbiBlbGVtczoKICAgICAgICAgICAgICAgICAgaWYgaXQuYXR0cmliWyJicG1uRWxlbWVudCJdPT1lLmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT0iICIuam9pbihlLmF0dHJpYlsibmFtZSJdLnNwbGl0KCIgIilbMTpdKSAjIGFzc3VtZSAiaWRcbnRleHQiCiAgICAgICAgICAgIGZvciBqIGluIHJhbmdlKGxlbihpdCkpOgogICAgICAgICAgICAgICAgICB4LHkgPSBmbG9hdChpdFtqXS5hdHRyaWJbIngiXSksZmxvYXQoaXRbal0uYXR0cmliWyJ5Il0pCiAgICAgICAgICAgICAgICAgIHcsaCA9IChmbG9hdChpdFtqXS5hdHRyaWJbIndpZHRoIl0pLGZsb2F0KGl0W2pdLmF0dHJpYlsiaGVpZ2h0Il0pKSBpZiAiQm91bmRzIiBpbiBpdFtqXS50YWcgZWxzZSAoMCwwKQogICAgICAgICAgICAgICAgICBXLEggPSBtYXgoVyx4K3cpLG1heChILHkraCkKICAgICAgICAgICAgICAgICAgI3ByaW50KGl0LmF0dHJpYlsiaWQiXSwiOiIseCx5LHcsaCkKICAgICAgICAgICAgICAgICAgaWYgdz09MDogIyBicG1uIGZsb3cKICAgICAgICAgICAgICAgICAgICAgICAgcHAuYXBwZW5kKFt4LHldKQogICAgICAgICAgICAgICAgICBlbHNlOiAgICAjIGJwbW4gZXZlbnQKICAgICAgICAgICAgICAgICAgICAgICAgaWRzPWl0LmF0dHJpYlsiaWQiXS5zcGxpdCgiXyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlkPWlkc1sxXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oaWRzKT40OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgYmFzZTY0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkc1s0XT1iYXNlNjQuYjE2ZGVjb2RlKGlkc1s0XSwnYXNjaWknKS5kZWNvZGUoJ2FzY2lpJykKICAgICAgICAgICAgICAgICAgICAgICAgaWQyPSJfIi5qb2luKGlkc1syOl0pLnJlcGxhY2UoJzwnLCcmbHQ7JykucmVwbGFjZSgnPicsJyZndDsnKQogICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoeC02KSsnIiB5PSInK3N0cih5K2grMTIpKyciPicraWQrJzwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IGZvbnQtc2l6ZT0ic21hbGxlciIgc3R5bGU9ImZpbGw6Z3JheSIgeD0iJytzdHIoeC0xMikrJyIgeT0iJytzdHIoeS02KSsnIj48dHNwYW4geG1sOnNwYWNlPSJwcmVzZXJ2ZSI+JytuYW1lKyc8L3RzcGFuPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWQzPWlkMi5zcGxpdCgiXyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihpZDMpPjMgYW5kIGlkM1szXSAhPSAiTm9uZSIgOiBzKz0nPHRleHQgY2xhc3M9InQxIiBmb250LXNpemU9InNtYWxsZXIiIHN0eWxlPSJmaWxsOmdyYXkiIHg9Iicrc3RyKHgrMTgpKyciIHk9Iicrc3RyKHkraCsxMikrJyI+PHRzcGFuIHhtbDpzcGFjZT0icHJlc2VydmUiPicraWQzWzNdKyc8L3RzcGFuPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWYgIkV2ZW50IiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZSA9ICJlbmQiIGluIGl0LmF0dHJpYlsiaWQiXSBhbmQgIjMiIG9yICIxIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICJlbmQiIGluIGl0LmF0dHJpYlsiaWQiXSBhbmQgInJlZCIgb3IgImRhcmtncmVlbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8ZWxsaXBzZSBjeD0iJytzdHIoeCt3LzIpKyciIGN5PSInK3N0cih5K2gvMikrJyIgcng9Iicrc3RyKHcvMikrJyIgcnk9Iicrc3RyKGgvMikrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9IicrY29sb3IrJyIgZmlsbC1vcGFjaXR5PSIwLjYiIGZpbGw9IndoaXRlIj48dGl0bGU+JytpZDIrJzwvdGl0bGU+PC9lbGxpcHNlPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiaW50ZXJtZWRpYXRlIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPGVsbGlwc2UgY3g9Iicrc3RyKHgrdy8yKSsnIiBjeT0iJytzdHIoeStoLzIpKyciIHJ4PSInK3N0cih3LzItMykrJyIgcnk9Iicrc3RyKGgvMi0zKSsnIiBzdHJva2Utd2lkdGg9Iicrc3Ryb2tlKyciIHN0cm9rZT0iZGFya2dyZWVuIiBmaWxsPSJ3aGl0ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiQ2F0Y2giIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIm9uZGl0aW9uIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHJlY3QgeD0iJWciIHk9IiVnIiB3aWR0aD0iJWciIGhlaWdodD0iJWciIHN0cm9rZT0iYmxhY2siIGZpbGw9Im5vbmUiIC8+JyUoeCt3LzItNyx5K2gvMi05LHcvMi00LGgvMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cGF0aCBkPSInCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJ00lZyAlZyBMJWcgJWcgJyUoeCt3LzItNSx5K2gvMi02KzMqaSx4K3cvMis1LHkraC8yLTYrMyppKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxlbGxpcHNlIGN4PSInK3N0cih4K3cvMikrJyIgY3k9Iicrc3RyKHkraC8yKSsnIiByeD0iJytzdHIody8yLTYpKyciIHJ5PSInK3N0cihoLzItNikrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9ImJsYWNrIiBmaWxsPSJ3aGl0ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxwYXRoIGQ9Ik0lZyAlZyBMJWcgJWcgJWcgJWcgJyUoeCt3LzItNSx5K2gvMi0zLHgrdy8yLHkraC8yLHgrdy8yKzYseStoLzItNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMTIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIG1hdGggaW1wb3J0IHNpbixjb3MscGkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICJNJWcgJWcgTCVnICVnICIlKHgrdy8yKyh3LzItNikqY29zKGkqMipwaS8xMikseStoLzIrKGgvMi02KSpzaW4oaSoyKnBpLzEyKSx4K3cvMisody8yLTkpKmNvcyhpKjIqcGkvMTIpLHkraC8yKyhoLzItOSkqc2luKGkqMipwaS8xMikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiLz4nICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJlcm1pbmF0ZSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxlbGxpcHNlIGN4PSInK3N0cih4K3cvMikrJyIgY3k9Iicrc3RyKHkraC8yKSsnIiByeD0iJytzdHIody8yLTYpKyciIHJ5PSInK3N0cihoLzItNikrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9InJlZCIgZmlsbD0icmVkIiBmaWxsLW9wYWNpdHk9IjAuNiIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICBlbGlmICJHYXRld2F5IiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gIm9yYW5nZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cGF0aCBkPSJNJWcgJWcgTCVnICVnIEwlZyAlZyBMJWcgJWcgWiIgc3Ryb2tlPSIlcyIgZmlsbD0id2hpdGUiPjx0aXRsZT4lczwvdGl0bGU+PC9wYXRoPlxuJyUoeCx5K2gvMix4K3cvMix5LHgrdyx5K2gvMix4K3cvMix5K2gsY29sb3IsaWQyKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgImV4Y2x1c2l2ZSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHBhdGggZD0iTSVnICVnIEwlZyAlZyBNJWcgJWcgTCVnICVnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjMiIC8+XG4nJSh4K3cvMi02LHkraC8yLTYseCt3LzIrNix5K2gvMis2LHgrdy8yKzYseStoLzItNix4K3cvMi02LHkraC8yKzYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgInBhcmFsbGVsIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSc8cGF0aCBkPSJNJWcgJWcgTCVnICVnIE0lZyAlZyBMJWcgJWciIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIgLz5cbiclKHgrdy8yLTgseStoLzIseCt3LzIrOCx5K2gvMix4K3cvMix5K2gvMi04LHgrdy8yLHkraC8yKzgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHJlY3Qgcng9IjciIHJ5PSI3IiB4PSInK3N0cih4KSsnIiB5PSInK3N0cih5KSsnIiB3aWR0aD0iJytzdHIodykrJyIgaGVpZ2h0PSInK3N0cihoKSsnIiBzdHJva2U9ImRhcmtibHVlIiBmaWxsPSJ3aGl0ZSI+PHRpdGxlPicraWQyKyc8L3RpdGxlPjwvcmVjdD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgInNjcmlwdCIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSg0KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSc8cGF0aCBkPSJNJWcgJWcgTCVnICVnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiIC8+JyUoeCsxMCswKmkseSsxMCs0KmkseCsyMiswKmkseSsxMCs0KmkpCiAgICAgICAgICAgIGlmIGxlbihwcCk+MDogIyBzMSE9Jyc6ICMgYWRkIHdob2xlIGZsb3cKICAgICAgICAgICAgICAgICAgczE9c3ZnX3JvdW5kZWRQYXRoKHBwLDEyKQogICAgICAgICAgICAgICAgICBzICs9ICc8cGF0aCBtYXJrZXItZW5kPSJ1cmwoI3RyaWFuZ2xlKSIgZD0iJytzMSsnIiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpicm93bjtzdHJva2Utd2lkdGg6MSIvPlxuJwogICAgICBzICs9ICI8c2NyaXB0PmZ1bmN0aW9uIG9uX2NsaWNrKCkge1suLi5kb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0MScpXS5mb3JFYWNoKGU9PmUuc3R5bGUuZGlzcGxheT0oZS5zdHlsZS5kaXNwbGF5PT0nbm9uZSc/Jyc6J25vbmUnKSk7fTwvc2NyaXB0PiIKICAgICAgcyA9ICc8c3ZnIG9uY2xpY2s9Im9uX2NsaWNrKCkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IiVkIiBoZWlnaHQ9IiVkIj5cbiclKFcrNDAsSCszMCkrcwogICAgICByZXR1cm4gcyArICh0b19hbmltKCkgaWYgaXNhbmltIGVsc2UgJycpICsgJzwvc3ZnPlxuJwpkZWYgdG9fYW5pbSgpOgogICAgICAjcmV0dXJuIHMKICAgICAgZ2xvYmFsIG5lCiAgICAgIHMgPSAgJzxkZWZzPjxmaWx0ZXIgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgaWQ9ImZpIj5cbicKICAgICAgcyArPSAnPGZlRmxvb2QgZmxvb2QtY29sb3I9IndoaXRlIi8+XG4nCiAgICAgIHMgKz0gJzxmZUNvbXBvc2l0ZSBpbj0iU291cmNlR3JhcGhpYyIgb3BlcmF0b3I9ImF0b3AiLz48L2ZpbHRlcj48L2RlZnM+XG4nCiAgICAgIGZvciBlIGluIG5lLmVlOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGUsRW5kKToKICAgICAgICAgICAgICAgICAgZm9yIGMgaW4gZS5xdWV1ZS5vYmplY3RzOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4obmUuZWUpKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeCwgeSwgYSA9IG5lLmVlW2ldLngsIG5lLmVlW2ldLnksIGMuYXR0ciAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSc8dGV4dCBjbGFzcz0idDEiIGZpbHRlcj0idXJsKCNmaSkiIHN0eWxlPSJmb250LXNpemU6c21hbGw7ZmlsbDpyZWQiIHg9Iicrc3RyKHgtMTYpKyciIHk9Iicrc3RyKHkrMTMpKyciIHZpc2liaWxpdHk9ImhpZGRlbiI+JytzdHIoYy5uYW1lKSsnXG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQ9Il9fdCIrc3RyKGkrMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdCsiYSIgaW4gYToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDAgPSBhW3QrImEiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9ICc8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJ2aXNpYmlsaXR5IiBmcm9tPSJoaWRkZW4iIHRvPSJ2aXNpYmxlIiBiZWdpbj0iJytzdHIodDApKydzIiBkdXI9IjAuMDFzIiBmaWxsPSJmcmVlemUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdCsiYiIgaW4gYToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBhW3QrImIiXSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAnPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieCIgdG89Iicrc3RyKHgrMzgpKyciIGJlZ2luPSInK3N0cih0MSkrJ3MiIGR1cj0iMC41cyIgZmlsbD0iZnJlZXplIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQrImUiIGluIGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gYVt0KyJlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAnPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0idmlzaWJpbGl0eSIgZnJvbT0idmlzaWJsZSIgdG89ImhpZGRlbiIgYmVnaW49Iicrc3RyKHQyKSsncyIgZHVyPSIwLjAxcyIgZmlsbD0iZnJlZXplIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0nPC90ZXh0PlxuJwogICAgICByZXR1cm4gcwoKbmU9W10KIyAtLS0tIHNpbXVsYXRpb24gLS0tLS0KZGVmIG1haW5fZnVuKGV4bixuKTogIyBzdHJpbmcgcmVwcmVzZW50YXRpb24sIG51bWJlciBvZiBzaW11bGF0aW9uCiAgICAgIGRhdGE9W10gICMgbGlzdCBvZiBldmVudHMsIGFycmF5IG9mIHJlc3VsdHMKICAgICAgcyA9ICcnCiAgICAgIGZvciBpIGluIHJhbmdlKG4pOgogICAgICAgICAgICBwcmludCgibWFpbl9mdW46IixpLCIoJWQpIiVuKQogICAgICAgICAgICBnbG9iYWwgbmUKICAgICAgICAgICAgbmUgPSBFdmVudE5ldHdvcmsoZXhuKQogICAgICAgICAgICBzaW0gPSBTaW11bGF0b3IoKQogICAgICAgICAgICBmb3IgZSBpbiBuZToKICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLEdlbmVyYXRvcik6ICAjIGFkZCBnZW5lcmF0aW5nIGV2ZW50cwogICAgICAgICAgICAgICAgICAgICAgICBzaW0uYWRkKGUpICAKICAgICAgICAgICAgc2ltLnJ1bigpCiAgICAgICAgICAgIGRhdGEuYXBwZW5kKHNpbS50aW1lKSAgICMgc2F2ZSBlbmQgdGltZSBvZiBzaW11bGF0aW9uCiAgICAgICAgICAgIAogICAgICAgICAgICAjaWYgZXhuPT1leDU6CiAgICAgICAgICAgICMgICAgICBkYXRhLmFwcGVuZChCcG1uRXZlbnQuU1siUy5iQSJdKSAjIHNhdmUgZ2xvYmFsIHZhcmlhYmxlIFMuYkEKICAgICAgICAgICAgI2Vsc2U6CiAgICAgICAgICAgICMgICAgICBkYXRhLmFwcGVuZChzaW0udGltZSkgICAjIHNhdmUgZW5kIHRpbWUgb2Ygc2ltdWxhdGlvbgogICAgICAgICAgICBpZiBpPT0wOgogICAgICAgICAgICAgICAgICBicG1uc3RyaW5nID0gdG9fYnBtbihuZS5lZSxuZS5wcCkKICAgICAgICAgICAgICAgICAgczMgPSBicG1uX3Rvc3ZnKGJwbW5zdHJpbmcsKG49PTEpKQogICAgICAgICAgICAgICAgICBzNCA9IHRvX3N2ZygpCiAgICAgIHMgKz0gIlxuIi5qb2luKFsiJWQgJS4yZiIlKGkrMSxkYXRhW2ldKSBmb3IgaSBpbiByYW5nZShsZW4oZGF0YSkpXSkKICAgICAgI2ZvciBlIGluIG5lOgogICAgICAjICAgICAgaWYgbGVuKGUucXVldWUpPjA6CiAgICAgICMgICAgICAgICAgICBzICs9IHN0cihlLmlkKSArICgiKCVkKToiJWxlbihlLnF1ZXVlKSkgKyBzdHIoZS5xdWV1ZSkrJ1xuJwogICAgICAjcyArPSBzdHIoc3VtKGRhdGEpL2xlbihkYXRhKSkrJ1xuJwogICAgICAjcyArPSBzdHIoQnBtbkV2ZW50LlMpKydcbicKICAgICAgI2ZvciBlIGluIG5lOgogICAgICAjICAgICAgcyArPSBzdHIoZS5pZCkrc3RyKGUuQSkrJyAnCiAgICAgICMgICAgICBpZiBpc2luc3RhbmNlKGUsVGFzayk6CiAgICAgICMgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZS5zZXJ2ZXJzKSk6CiAgICAgICMgICAgICAgICAgICAgICAgICBzICs9IHN0cihlLnNlcnZlcnNbaV0uaWQpKycvJytzdHIoaSsxKStzdHIoZS5zZXJ2ZXJzW2ldLkEpKycgJyAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAjaWYgbGVuKGRhdGEpPjEwMDoKICAgICAgIyAgICAgIGlmIGV4bj09ZXg0OgogICAgICAjICAgICAgICAgICAgaGlzdChkYXRhLDcpCiAgICAgICMgICAgICBlbHNlOgogICAgICAjICAgICAgICAgICAgaGlzdChkYXRhKQogICAgICByZXR1cm4gczMrJzxicj5cbicrKHM0IGlmIG49PTEgZWxzZSAnJykrJzxicj5cbicrJzxwcmU+JytzKyc8L3ByZT4nCgoiIiIKIyAtLS0tLSBtYWluIHdpdGggYXJncyAtLS0tLS0KaWYgX19uYW1lX189PSJfX21haW5fXyI6CiAgICAgIGltcG9ydCBzeXMKICAgICAgaW1wb3J0IGV4CiAgICAgIHMgPSBsZW4oc3lzLmFyZ3YpPjEgYW5kIGZyb21fZmlsZShzeXMuYXJndlsxXSkgb3IgZXZhbCgnZXgnK3N0cigzMCkpCiAgICAgIG4gPSBsZW4oc3lzLmFyZ3YpPjIgYW5kIGludChzeXMuYXJndlsyXSkgb3IgMQogICAgICBzID0gbWFpbl9mdW4ocyxuKQogICAgICBwcmludChzKQoiIiIKcyA9IGlucHV0WzBdCm4gPSBpbnQoaW5wdXRbMV0pCnMgPSBtYWluX2Z1bihzLCBuKQpzCgo=";