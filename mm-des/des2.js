var pycode="IyBtbS1kZXMgLSBkaXNjcmV0ZSBldmVudCBzaW11bGF0b3IKIyAtIGJhc2UgZXZlbnRzOiBHZW5lcmF0b3IsU2VydmljZSxTaW5rLENvbmRpdGlvbmFsRXZlbnQKIyAtIGJwbW4gZXZlbnRzOiBTdGFydCxUYXNrLEVuZCxUaW1lcixYb3JHYXRlLEFuZEdhdGUsQ29uZGl0aW9uLFRlcm1pbmF0ZQojIE1NIDMxLjEuMjAyNCwgMTMuOS4yMDI1IChhZG9wdGVkIGZvciBweW9kaWRlIGluIGpzKQoKIyAtLS0tIHNpbXVsYXRpb24gb24gYW4gYWJzdHJhY3QgZXZlbnQgLS0tLQpjbGFzcyBFdmVudCgpOgogICAgICBjbnQgPSAwICAgICAgICAgICAgICAgICAgICAgICAgICMgdXNlZCBmb3IgZXZlbnQgaWRlbnRpZmllcgogICAgICBkZWYgX19pbml0X18oc2VsZiwgdGltZSwgbmFtZT1Ob25lKToKICAgICAgICAgICAgc2VsZi50aW1lID0gdGltZTsKICAgICAgICAgICAgRXZlbnQuY250ICs9IDEKICAgICAgICAgICAgc2VsZi5pZCA9IEV2ZW50LmNudAogICAgICAgICAgICBzZWxmLm5hbWUgPSAoKG5hbWU9PU5vbmUpIGFuZCAiRXZlbnQiIG9yIG5hbWUpICsgIl8iK3N0cihzZWxmLmlkKQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOiBwYXNzICAgICAgIyBhYnN0cmFjdCAKICAgICAgZGVmIF9fc3RyX18oc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLm5hbWUrICIgIisgc3RyKHNlbGYuaWQpICsiICIrc3RyKHNlbGYudGltZSkKY2xhc3MgU2ltdWxhdG9yKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAgICAgc2VsZi50aW1lID0gMAogICAgICAgICAgICBzZWxmLmV2ZW50cyA9IFtdCiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucyA9IFtdCiAgICAgIGRlZiBub3coc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnRpbWUKICAgICAgZGVmIGFkZChzZWxmLGUpOgogICAgICAgICAgICBzZWxmLmV2ZW50cy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBhZGRfY29uZGl0aW9uKHNlbGYsZSk6CiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgICAgIHdoaWxlIHNlbGYuZXZlbnRzOgogICAgICAgICAgICAgICAgICBlID0gbWluKHNlbGYuZXZlbnRzLCBrZXk9bGFtYmRhIGU6IGUudGltZSkKICAgICAgICAgICAgICAgICAgc2VsZi5ldmVudHMucmVtb3ZlKGUpCiAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IGUudGltZSAgICAgICAgICMgdXBkYXRlIHNpbXVsYXRvciB0aW1lCiAgICAgICAgICAgICAgICAgIGUuZXhlYyhzZWxmKQogICAgICAgICAgICAgICAgICBmb3IgYyBpbiBzZWxmLmNvbmRpdGlvbnM6ICAjIHRlc3QgY29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICBpZiBjLmV4ZWMoc2VsZik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5yZW1vdmUoYykKIyAtLS0tIHV0aWxzIC0tLS0KaW1wb3J0IG1hdGgscmFuZG9tCmRlZiBfcHJpbnQocyk6ICAgICAgICAgICAgICAgICMgb3duIHByaW50CiAgICAgICNwcmludChzKSAgICAgICAgICAgICAgICMgY29tbWVudCBpZiBubyB2ZXJib3VzIHByaW50aW5nCiAgICAgIHBhc3MKZGVmIEUobWVhbj1bMS4wXSk6ICAgICAgICAgICAgIyBleHBvbmVudGlhbCByYW5kb20gZ2VuZXJhdG9yCiAgICAgICMgLW1lYW5bMF0qbWF0aC5sb2cocmFuZG9tLnJhbmRvbSgpKQogICAgICByZXR1cm4gcmFuZG9tLmV4cG92YXJpYXRlKDEvbWVhblswXSkgCmRlZiBVKG1pbm1heD1bMS4wXSk6ICAgICAgICAgICMgdW5pZm9ybSByYW5kb20gZ2VuZXJhdG9yCiAgICAgIHJldHVybiByYW5kb20udW5pZm9ybShtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXSkKZGVmIE4obWVhbnN0ZD1bMy4wXSk6ICAgICAgICAjIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgcmV0dXJuIHJhbmRvbS5ub3JtYWx2YXJpYXRlKG1lYW5zdGRbMF0sbGVuKG1lYW5zdGQpPjEgYW5kIG1lYW5zdGRbMV0gb3IgMS4wKQpkZWYgQihwPTAuNSk6ICAgICAgICAgICAgICAgICMgYmlub21pYWwgKDAsMSkKICAgICAgcmV0dXJuIHJhbmRvbS5yYW5kb20oKTxwCmRlZiBDKHA9WzEsMSwxXSk6ICAgICAgICAgICAgIyBjaG9pY2UgKDAsMSwyLC4uLikKICAgICAgcmV0dXJuIHJhbmRvbS5jaG9pY2VzKGxpc3QocmFuZ2UobGVuKHApKSksd2VpZ2h0cz1wKVswXQpkZWYgVChtaW5tYXg9WzEuMF0pOiAgICAgICAgICAjIHNlbWkgdHJ1bmNhdGVkIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgbWksbWEgPSBtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXQogICAgICBtZWFuLHN0ZCA9IChtYSttaSkvMiwobWEtbWkpLzIKICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgeCA9IE4oW21lYW4sc3RkXSkKICAgICAgICAgICAgaWYgbWkgPD0geCA8PSBtYTogYnJlYWsKICAgICAgcmV0dXJuIHgKCiMgLS0tLSBwcmltaXRpdmUgY2xhc3NlcyAtLS0tCmNsYXNzIEN1c3RvbWVyKCk6ICAgICMgYW5vbnltb3VzIGN1c3RvbWVyIHdpdGggYSBhdXRvbWF0aWMgbmFtZQogICAgICBjbnQgPSAwICAgICAgICAjIGNvdW50ZXIgY2xhc3MgdmFyaWFibGUgZm9yIGN1c3RvbWVyIG5hbWUKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBDdXN0b21lci5jbnQgKz0gMQogICAgICAgICAgICBzZWxmLm5hbWUgPSBzdHIoQ3VzdG9tZXIuY250KQogICAgICAgICAgICBzZWxmLmF0dHIgPSB7ImNuYW1lIjpzZWxmLm5hbWV9ICMgQ3VzdG9tZXIgYXR0cmlidXRlcwogICAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIHN0cihzZWxmLm5hbWUpCmNsYXNzIFF1ZXVlKCk6ICAgICAgICMgZmlmbyBvZiBjdXN0b21lcnMKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBzZWxmLm9iamVjdHMgPSBbXQogICAgICBkZWYgcHVzaChzZWxmLG9iaik6CiAgICAgICAgICAgIHNlbGYub2JqZWN0cy5hcHBlbmQob2JqKQogICAgICBkZWYgcG9wKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5vYmplY3RzLnBvcCgwKQogICAgICBkZWYgX19sZW5fXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIGxlbihzZWxmLm9iamVjdHMpCiAgICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc3RyKFtzdHIobykgZm9yIG8gaW4gc2VsZi5vYmplY3RzXSkKY2xhc3MgUXVldWVkRXZlbnQoRXZlbnQpOgogICAgICBpbnN0YW5jZXM9W10KICAgICAgZGVmIF9faW5pdF9fKHNlbGYsbmFtZT1Ob25lKToKICAgICAgICAgICAgRXZlbnQuX19pbml0X18oc2VsZiwwLjAsbmFtZSkgICMgcHJlaW5pdCB0aW1lCiAgICAgICAgICAgIHNlbGYucXVldWUgPSBRdWV1ZSgpICAgICAgIyBvd24gcXVldWUKICAgICAgICAgICAgc2VsZi5vdXRwdXQgPSBbXSAgICAgICAgICAjIG5vIGNvbm5lY3RlZCBvYmplY3RzCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICAgIyBub25lIGJlaW5nIHNlcnZlZAogICAgICAgICAgICBRdWV1ZWRFdmVudC5pbnN0YW5jZXMuYXBwZW5kKHNlbGYpCiAgICAgIGRlZiBzZXROYW1lKHNlbGYsbmFtZSk6CiAgICAgICAgICAgIHNlbGYubmFtZT1uYW1lKyJfIitzZWxmLm5hbWUuc3BsaXQoIl8iKVsxXSAjLnJlcGxhY2UoIkV2ZW50IixuYW1lKS5yZXBsYWNlKCJBY3Rpdml0eSIsbmFtZSkKICAgICAgZGVmIG91dChzZWxmLHNpbSk6ICAgICAgICAgICAgICAjIHBhc3MgdG8gY29ubmVjdGVkIG9iamVjdHMKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4wIGFuZCBpc2luc3RhbmNlKHNlbGYsWG9yR2F0ZSk6ICAKICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID0gMSAgIyBzZW5kIHRvIHNlY29uZCBvdXRwdXQKICAgICAgICAgICAgICAgICAgICAgICAgI2lmIHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgidmFsdWUiIGluIHNlbGYuY3VzdG9tZXIuYXR0ciBhbmQgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdKSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeD0wICMgc2VuZCByYXRoZXIgdG8gZmlyc3Qgb3V0cHV0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLm91dHB1dCk+MjogICMgbW9yZSB0aGFuIDIgb3V0cHV0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHg9aW50KHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRwdXRbaWR4XS5pbnNlcnQoc2VsZi5jdXN0b21lciwgc2ltKQogICAgICAgICAgICAgICAgICBlbGlmIGxlbihzZWxmLm91dHB1dCk+MSBhbmQgaXNpbnN0YW5jZShzZWxmLE9yR2F0ZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIE4sIHNlbGYuY3VzdG9tZXIuTiA9IDAsIFtdCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihzZWxmLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpbnQoc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdW2ldKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTiArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0cHV0W2ldLmluc2VydChzZWxmLmN1c3RvbWVyLCBzaW0pCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuTj1OIy5hcHBlbmQoTikKICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHNlbGYub3V0cHV0KSk6ICAjIHNwbGl0IHRvIGFsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm91dHB1dFtpXS5pbnNlcnQoc2VsZi5jdXN0b21lcixzaW0pCiAgICAgIGRlZiBwcmV2KHNlbGYpOgogICAgICAgICAgICBlcD1bXQogICAgICAgICAgICBmb3IgZTAgaW4gZmlsdGVyKE5vbmUsUXVldWVkRXZlbnQuaW5zdGFuY2VzKToKICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGUwLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBlMC5vdXRwdXRbaV09PXNlbGY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVwLmFwcGVuZChlMCkKICAgICAgICAgICAgI3ByaW50KCJwcmV2OiIsc3RyKGVwKSkKICAgICAgICAgICAgcmV0dXJuIGVwCgojIC0tLS0gYmFzaWMgbW9kZWwgY2xhc3NlcyAoUXVldWVFdmVudCBkZXJpdmVkKSAtLS0tCmNsYXNzIEJwbW5FdmVudChRdWV1ZWRFdmVudCk6CiAgICAgIFMgPSB7fQogICAgICBkZWYgX19pbml0X18oc2VsZixuYW1lPU5vbmUsY29kZT1Ob25lKToKICAgICAgICAgICAgUXVldWVkRXZlbnQuX19pbml0X18oc2VsZixuYW1lKQogICAgICAgICAgICBzZWxmLmZ1bixzZWxmLnBhcmFtLHNlbGYuY29kZSA9IE5vbmUsTm9uZSxjb2RlCiAgICAgICAgICAgIHNlbGYuQSxzZWxmLnBwLHNlbGYucHAyLHNlbGYudGl0bGUgPSB7IkEubiI6MH0sWy0xLDBdLFstMSwtMV0sJycKICAgICAgZGVmIF9mdW4oc2VsZik6CiAgICAgICAgICAgIHAgPSBzZWxmLnBhcmFtCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocCxsaXN0KToKICAgICAgICAgICAgICAgICAgcCA9IFtmbG9hdChldmFsKHNlbGYuYXR0cl9yZXBsYWNlKHN0cihzKSkpKSBmb3IgcyBpbiBwXQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICBwID0gZmxvYXQoZXZhbChzZWxmLmF0dHJfcmVwbGFjZShzdHIocCkpKSkKICAgICAgICAgICAgI3ByaW50KCJfZnVuOiIsc2VsZi5mdW4scCxsZW4oc2VsZi5xdWV1ZSkpCiAgICAgICAgICAgIHJldHVybiBzZWxmLmZ1bihwKSBpZiBzZWxmLmZ1biE9Tm9uZSBlbHNlIHAKICAgICAgZGVmIGF0dHJfcmVwbGFjZShzZWxmLGNjKToKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgZm9yIGssdiBpbiBzZWxmLmN1c3RvbWVyLmF0dHIuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgY2MgPSBjYy5yZXBsYWNlKGssc3RyKHYpKQogICAgICAgICAgICBmb3Igayx2IGluIEJwbW5FdmVudC5TLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgIGNjID0gY2MucmVwbGFjZShrLHN0cih2KSkKICAgICAgICAgICAgZm9yIGssdiBpbiBzZWxmLkEuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgY2MgPSBjYy5yZXBsYWNlKGssc3RyKHYpKQogICAgICAgICAgICByZXR1cm4gY2MKICAgICAgZGVmIF9ldmFsKHNlbGYsY29kZSxuPS0xKToKICAgICAgICAgICAgY29kZXM9Y29kZS5zcGxpdCgiOyIpCiAgICAgICAgICAgIGlmIG4hPS0xOgogICAgICAgICAgICAgICAgICBjb2Rlcz1sZW4oY29kZXMpPm4gYW5kIFtjb2Rlc1tuXV0gb3IgW10KICAgICAgICAgICAgZm9yIGNvZGUgaW4gY29kZXM6CiAgICAgICAgICAgICAgICAgIGNjID0gY29kZS5zcGxpdCgiPSIpCiAgICAgICAgICAgICAgICAgIGNjWzBdID0gY2NbMF0uc3RyaXAoKQogICAgICAgICAgICAgICAgICBpZiBsZW4oY2MpPT0xOgogICAgICAgICAgICAgICAgICAgICAgICBjYz1bImR1bW15Il0rY2MKICAgICAgICAgICAgICAgICAgaWYgbGVuKGNjKT4xOgogICAgICAgICAgICAgICAgICAgICAgICBjY1swXSA9IGxlbihjY1swXSk+MCBhbmQgY2NbMF0gb3IgInZhbHVlIgogICAgICAgICAgICAgICAgICAgICAgICBjY1sxXSA9IHNlbGYuYXR0cl9yZXBsYWNlKCI9Ii5qb2luKGNjWzE6XSkpICMgcmVqb2luCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXY9ZXZhbChjY1sxXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2NbMF0uc3RhcnRzd2l0aCgiUy4iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnBtbkV2ZW50LlNbY2NbMF1dPWV2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgY2NbMF0uc3RhcnRzd2l0aCgiQS4iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5FW2NjWzBdXT1ldgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbY2NbMF1dPWV2CiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyW2NjWzBdXT1GYWxzZQpjbGFzcyBDb25kaXRpb25hbEV2ZW50KEJwbW5FdmVudCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb2RlPU5vbmUpOgogICAgICAgICAgICBCcG1uRXZlbnQuX19pbml0X18oc2VsZiwgTm9uZSwgY29kZSkKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOgogICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiZSJdID0gLTEKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciA9PSBOb25lIDogIyBpZiBmcmVlIGFkZCB0byBzaW11bGF0b3IgY29uZGl0aW9ucwogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyID0gY3VzdAogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbInZhbHVlIl09RmFsc2UKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdID0gc2ltLm5vdygpCiAgICAgICAgICAgICAgICAgIHNpbS5hZGRfY29uZGl0aW9uKHNlbGYpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgIHNlbGYucXVldWUucHVzaChjdXN0KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOgogICAgICAgICAgICBiID0gRmFsc2UKICAgICAgICAgICAgaWYgc2VsZi5jb2RlIT1Ob25lOgogICAgICAgICAgICAgICAgICBzZWxmLl9ldmFsKHNlbGYuY29kZSwwKQogICAgICAgICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyLmF0dHJbInZhbHVlIl09PVRydWU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNjPXNlbGYuY29kZS5zcGxpdCgnOycpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihjYyk+MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbCgiOyIuam9pbihjY1sxOl0pKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXQoc2ltKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyID0gTm9uZSAgICAjIG1hcmsgdGhhdCBub3cgdGhlIHNlcnZpY2UgaXMgZnJlZSAhISEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYucXVldWUpPjAgOiAgIyBidXQgaWYgYW55Ym9keSBpbiBxdWV1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmluc2VydChzZWxmLnF1ZXVlLnBvcCgpLCBzaW0pICAjIGdldCBhbmQgaW5zZXJ0IGludG8gc2ltdWxhdG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBUcnVlICAjIHJlYWR5IHRvIGJlIHJlbW92ZWQgZnJvbSBzaW11bGF0b3IgY29uZGl0aW9ucwogICAgICAgICAgICByZXR1cm4gYgpjbGFzcyBHZW5lcmF0b3IoQnBtbkV2ZW50KToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIGZ1biwgcGFyYW0sIHRtYXg9MC4wLCBjb2RlPU5vbmUpOgogICAgICAgICAgICBCcG1uRXZlbnQuX19pbml0X18oc2VsZiwgTm9uZSwgY29kZSkKICAgICAgICAgICAgc2VsZi5mdW4sIHNlbGYucGFyYW0sIHNlbGYudG1heCwgc2VsZi5uID0gZnVuLCBwYXJhbSwgdG1heCwgMAogICAgICAgICAgICBpZiBzZWxmLmNvZGUhPU5vbmUgOgogICAgICAgICAgICAgICAgICBzZWxmLl9ldmFsKHNlbGYuY29kZSkgICAjIGV2YWx1YXRlIHNjcmlwdCBjb2RlIChbdmFyXT08dmFsdWU+KQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOgogICAgICAgICAgICBzZWxmLmN1c3RvbWVyID0gQ3VzdG9tZXIoKQogICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IHNpbS5ub3coKQogICAgICAgICAgICBzZWxmLkFbIkEubiJdICs9IDEKICAgICAgICAgICAgX3ByaW50KCJSZWdpc3RlcmluZzogIiArIHN0cihzZWxmLmN1c3RvbWVyKSArICIgKCIrc3RyKHNlbGYudGltZSkrIikiKQogICAgICAgICAgICBzZWxmLm91dChzaW0pICAgICAgICAgICAgICMgcGFzcyBjdXN0b21lciB0byBjb25uZWN0ZWQgb2JqZWN0CiAgICAgICAgICAgIHNlbGYudGltZSArPSBzZWxmLl9mdW4oKQogICAgICAgICAgICBpZiBzZWxmLnRtYXg+MCBhbmQgc2VsZi50aW1lIDw9IHNlbGYudG1heCBvciBzZWxmLm48LXNlbGYudG1heC0xOgogICAgICAgICAgICAgICAgICBzZWxmLm4gKz0gMQogICAgICAgICAgICAgICAgICBzaW0uYWRkKHNlbGYpICAgICAgICMgbmV4dCBvbmUgaW4gcmFuZG9tIHRpbWUKY2xhc3MgU2VydmljZShCcG1uRXZlbnQpOgogICAgICBkZWYgX19pbml0X18oc2VsZiwgZnVuLCBwYXJhbSwgY29kZT1Ob25lKTogCiAgICAgICAgICAgIEJwbW5FdmVudC5fX2luaXRfXyhzZWxmLCJBY3Rpdml0eSIsY29kZSkgIAogICAgICAgICAgICBzZWxmLmZ1biwgc2VsZi5wYXJhbSA9IGZ1biwgcGFyYW0gCiAgICAgICAgICAgIHNlbGYuTiA9IDEgIyBOIG51bWJlciBvZiB0b2tlbnMgdG8gd2FpdCAodXNlZCBmb3IgQW5kR2F0ZSxPckdhdGUpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzZWxmLFhvckdhdGUpOgogICAgICAgICAgICAgICAgICBpZiBsZW4oc2VsZi5vdXRwdXQpPjEgYW5kIHNlbGYuY29kZT09Tm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jb2RlPSI9QigwLjUpIgogICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2Uoc2VsZixPckdhdGUpOgogICAgICAgICAgICAgICAgICBpZiBsZW4oc2VsZi5vdXRwdXQpPjEgYW5kIHNlbGYuY29kZT09Tm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jb2RlPSI9WzEsIisiLCIuam9pbihbJzAnXSoobGVuKHNlbGYub3V0cHV0KS0xKSkrIl0iCiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIgPT0gTm9uZTogIyBpZiBmcmVlIGFkZCB0byBzaW11bGF0b3Igd2l0aCBlbmQgdGltZQogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLHQgPSBjdXN0LHNlbGYuX2Z1bigpCiAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UodCxsaXN0KTogICMgW2N5Y2xlLGJlZ2luPTBdIGN5Y2xpYyB0aW1lciAoTU0gMS4xMS4yMDI0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4odCk8MjogdC5hcHBlbmQoMCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lID0gdFsxXSttYXRoLmNlaWwoKHNpbS5ub3coKS10WzFdKS90WzBdKSp0WzBdCiAgICAgICAgICAgICAgICAgICAgICAgICNfcHJpbnQoIiMgIitzdHIoc2VsZi5jdXN0b21lcikrIjogIitzdHIoc2ltLm5vdygpKSsiICIrc3RyKHNlbGYudGltZSkpCiAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IHNpbS5ub3coKSArIHQKICAgICAgICAgICAgICAgICAgX3ByaW50KCIjIitzdHIoc2VsZi5pZCkrIiBzdGFydHMgc2VydmluZyAiKwogICAgICAgICAgICAgICAgICAgICAgICAgc3RyKGN1c3QpKyIgKCIrc3RyKHNpbS5ub3coKSkrIiwiK3N0cihzZWxmLnRpbWUpKyIpIikKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdPXNpbS5ub3coKQogICAgICAgICAgICAgICAgICBpZiAiX19uIitzdHIoc2VsZi5pZCkgbm90IGluIHNlbGYuY3VzdG9tZXIuYXR0cjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX24iK3N0cihzZWxmLmlkKV0gPSAwICMgZmlyc3QgdGltZQogICAgICAgICAgICAgICAgICBpZiAiX190IitzdHIoc2VsZi5pZCkrImEiIG5vdCBpbiBzZWxmLmN1c3RvbWVyLmF0dHI6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImEiXT1zaW0ubm93KCkgIyBpZiBub3QgZnJvbSBxdWV1ZQogICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNlbGYsVGltZXIpIGFuZCBub3QgaXNpbnN0YW5jZSh0LGxpc3QpOiAgIyBtb2RpZnkgcmVxdWlyZWQgZmluYWwgZXhlY3V0aW9uIHRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgdGE9Y3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdICAKICAgICAgICAgICAgICAgICAgICAgICAgdGI9Y3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdCiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSAtPSAodGItdGEpICMgZGVjcmVhc2UgYmVnaW4gdGltZQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWUgLT0gKHRiLXRhKSAgIyAuLi4gYnkgdGhlIGRpZmZlcmVuY2UgZWxhcHNlZCBhbHJlYWR5CiAgICAgICAgICAgICAgICAgICAgICAgICNfcHJpbnQoIiMgIitzdHIoc2VsZi5jdXN0b21lcikrIjogIitzdHIoc2VsZi50aW1lKSkKICAgICAgICAgICAgICAgICAgc2ltLmFkZChzZWxmKQogICAgICAgICAgICBlbHNlOiAgICAgICAgICAgICAgICAgICAgICMgZWxzZSBpbnNlcnQgaW50byBxdWV1ZQogICAgICAgICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl09c2ltLm5vdygpICAjIHdpdGggYSBxdWV1ZSBhZGRpbmcgdGltc3RhbXAKICAgICAgICAgICAgICAgICAgc2VsZi5xdWV1ZS5wdXNoKGN1c3QpCiAgICAgIGRlZiBleGVjKHNlbGYsIHNpbSk6CiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIhPU5vbmU6CiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXT1zaW0ubm93KCkKICAgICAgICAgICAgICAgICAgc2VsZi5BWyJBLm4iXSArPSAxCiAgICAgICAgICAgIF9wcmludCgiIyIrc3RyKHNlbGYuaWQpKyIgZmluaXNoZWQgc2VydmluZyAiICsgc3RyKHNlbGYuY3VzdG9tZXIpICsgIiBhdCAiICsgc3RyKHNlbGYudGltZSkpCiAgICAgICAgICAgIGlmIHNlbGYuY29kZSE9Tm9uZSA6ICAgICAgCiAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoc2VsZi5jb2RlKSAgICMgZXZhbHVhdGUgc2NyaXB0IGNvZGUgKFt2YXJdPTx2YWx1ZT4pCiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIhPU5vbmU6CiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX19uIitzdHIoc2VsZi5pZCldICs9IDEKICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzZWxmLE9yR2F0ZSkgYW5kIGxlbihzZWxmLm91dHB1dCk9PTE6CiAgICAgICAgICAgICAgICAgICAgICAgICNpZiBub3QgaGFzYXR0cihzZWxmLCdOJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuTiA9IHNlbGYuY3VzdG9tZXIuTiAjLnBvcCgpCiAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmN1c3RvbWVyLmF0dHJbIl9fbiIrc3RyKHNlbGYuaWQpXSVzZWxmLk4pID09IDA6ICNzZWxmLk46CiAgICAgICAgICAgICAgICAgICAgICAgIGRvX291dD1UcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZixUYXNrKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGUgaW4gRU46ICMgZmluZCBib3VuZGFyeSBlbGVtZW50cyBhc2lnbmVkIHRvIGN1cnJlbnQgVGFzawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBlLmlkMiUxPjAgYW5kIHN0cihlLmlkMikuc3BsaXQoJy4nKVsxXT09c3RyKHNlbGYuaWQpIGFuZCBlLmNvZGUhPU5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoZS5jb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyLmF0dHJbInZhbHVlIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuY3VzdG9tZXI9c2VsZi5jdXN0b21lcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLm91dChzaW0pICMgb3V0IHRoZXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvX291dD1GYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkb19vdXQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0KHNpbSkgICAgICMgcGFzcyBjdXN0b21lciB0byBjb25uZWN0ZWQgb2JqZWN0CiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICMgbWFyayB0aGF0IG5vdyB0aGUgc2VydmljZSBpcyBmcmVlICEhIQogICAgICAgICAgICBpZiBsZW4oc2VsZi5xdWV1ZSk+MCA6ICAjIGJ1dCBpZiBhbnlib2R5IGluIHF1ZXVlCiAgICAgICAgICAgICAgICAgIFNlcnZpY2UuaW5zZXJ0KHNlbGYsc2VsZi5xdWV1ZS5wb3AoKSwgc2ltKSAgIyBnZXQgYW5kIGluc2VydCBpbnRvIHNpbXVsYXRvcgpjbGFzcyBTaW5rKEJwbW5FdmVudCk6CiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKTogICAgCiAgICAgICAgICAgIF9wcmludCgiU2lua2luZyAiK3N0cihjdXN0KSsiIDogIitzdHIoc2ltLm5vdygpKSkKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpICAjIG1hcmsgdGltZSBpbiBjdXN0b21lciBhdHRyaWJ1dGVzCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKSAgIyBtYXJrIHRpbWUgaW4gY3VzdG9tZXIgYXR0cmlidXRlcwogICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl0gPSBzaW0ubm93KCkgICMgbWFyayB0aW1lIGluIGN1c3RvbWVyIGF0dHJpYnV0ZXMKICAgICAgICAgICAgc2VsZi5BWyJBLm4iXSArPSAxCiAgICAgICAgICAgIHNlbGYucXVldWUucHVzaChjdXN0KSAgICAgIyBpbnNlcnQgb25seSB0byBpdHMgcXVldWUKICAgICAgICAgICAgc2VsZi5jdXN0b21lcj1jdXN0CiAgICAgICAgICAgIGlmIHNlbGYuY29kZSE9Tm9uZSA6CiAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoc2VsZi5jb2RlKSAgICMgZXZhbHVhdGUgc2NyaXB0IGNvZGUKIyAtLS0tIGJwbW4gZGVyaXZlZCBjbGFzc2VzIChmcm9tIEdlbmVyYXRvciwgU2VydmljZSwgQ29uZGl0aW9uYWxFdmVudCBvciBTaW5rKSAtLS0tCmNsYXNzIFhvckdhdGUoU2VydmljZSk6ICAgICMgcmFuZG9tIG91dHB1dCBpZiB0d28gb3V0cHV0cyAKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKTogICMgZGVmYXVsdHMgdG8gYmluYXJ5IHJhbmRvbSBzZWxlY3Rpb24KICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImV4Y2x1c2l2ZUdhdGV3YXkiKQpjbGFzcyBPckdhdGUoU2VydmljZSk6ICAgICMgb3V0cHV0IGNvbmRpdGlvbiBtdXN0IGJlIGRlZmluZWQgYnkgYXJyYXkgb2YgdmFsdWVzISAKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImluY2x1c2l2ZUdhdGV3YXkiKQpjbGFzcyBBbmRHYXRlKFNlcnZpY2UpOiAgICAKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInBhcmFsbGVsR2F0ZXdheSIpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgaWRzPVtlLmlkIGZvciBlIGluIHNlbGYucHJldigpXSAjIGlkcyBvZiBpbnB1dHMKICAgICAgICAgICAgc2VsZi5OPWxlbihzZXQoaWRzKSkgIyBzZXQgbnVtYmVyIG9mIGlucHV0cyAod2l0aCB1bmlxdWUgaWRzKSB0byB3YWl0CiAgICAgICAgICAgIFNlcnZpY2UuaW5zZXJ0KHNlbGYsY3VzdCxzaW0pCmNsYXNzIFN0YXJ0KEdlbmVyYXRvcik6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGZ1bj1FLHBhcmFtPVsxXSx0bWF4PTUwLjAsY29kZT1Ob25lKToKICAgICAgICAgICAgR2VuZXJhdG9yLl9faW5pdF9fKHNlbGYsZnVuLHBhcmFtLHRtYXgsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJzdGFydEV2ZW50IikKY2xhc3MgVGFzayhTZXJ2aWNlKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsZnVuPVUscGFyYW09WzEsMl0sY29kZT1Ob25lLE09MSk6CiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixmdW4scGFyYW0sY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJ0YXNrIikKICAgICAgICAgICAgc2VsZi5zZXJ2ZXJzLCBzZWxmLm5zZXJ2ZXIsIHNlbGYuTSA9IFtdLCAwLCBNCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKHNlbGYuTS0xKToKICAgICAgICAgICAgICAgICAgRXZlbnQuY250IC09MQogICAgICAgICAgICAgICAgICBzZWxmLnNlcnZlcnMuYXBwZW5kKFNlcnZpY2UoZnVuLHBhcmFtLGNvZGUpKQogICAgICBkZWYgaW5zZXJ0KHNlbGYsIGN1c3QsIHNpbSk6CiAgICAgICAgICAgIGlmKHNlbGYubnNlcnZlcj09MCk6ICAjIG15c2VsZgogICAgICAgICAgICAgICAgICBTZXJ2aWNlLmluc2VydChzZWxmLGN1c3Qsc2ltKQogICAgICAgICAgICBlbHNlOiAgICAgICAgICAgICAgIyBvdGhlcnNlbGZzCiAgICAgICAgICAgICAgICAgIHNlbGYuc2VydmVyc1tzZWxmLm5zZXJ2ZXItMV0uaW5zZXJ0KGN1c3Qsc2ltKQogICAgICAgICAgICBzZWxmLm5zZXJ2ZXIgPSAoc2VsZi5uc2VydmVyKzEpJXNlbGYuTQpjbGFzcyBUaW1lcihTZXJ2aWNlKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsZnVuPTEscGFyYW09Tm9uZSxjb2RlPU5vbmUpOgogICAgICAgICAgICBpZiBub3QgY2FsbGFibGUoZnVuKTogICMgd2hlbiBwYXNzaW5nIGZpeGVkIGRlbGF5IHZhbHVlCiAgICAgICAgICAgICAgICAgIGZ1bixwYXJhbSxjb2RlID0gTm9uZSxmdW4scGFyYW0KICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLGZ1bixwYXJhbSxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImludGVybWVkaWF0ZUNhdGNoRXZlbnQiKQpjbGFzcyBFbmQoU2luayk6CiAgICAgICNkZWYgX19pbml0X18oc2VsZik6CiAgICAgICMgICAgICBTaW5rLl9faW5pdF9fKHNlbGYpCiAgICAgICMgICAgICBzZWxmLnNldE5hbWUoImVuZEV2ZW50IikKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2luay5fX2luaXRfXyhzZWxmLCJlbmRFdmVudCIsY29kZSkKY2xhc3MgVGhyb3coU2VydmljZSk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixOb25lLDAsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJpbnRlcm1lZGlhdGVUaHJvd0V2ZW50IikKY2xhc3MgVGVybWluYXRlKEVuZCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIEVuZC5fX2luaXRfXyhzZWxmLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgidGVybWluYXRlRW5kRXZlbnQiKQpjbGFzcyBTY3JpcHQoU2VydmljZSk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixOb25lLDAsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJzY3JpcHRUYXNrIikKY2xhc3MgQ29uZGl0aW9uKENvbmRpdGlvbmFsRXZlbnQpOgogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBDb25kaXRpb25hbEV2ZW50Ll9faW5pdF9fKHNlbGYsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJpbnRlcm1lZGlhdGVDYXRjaEV2ZW50IikKCiMgLS0tLSB1dGlsMiAtLS0tLS0tLSAgICAgIApkZWYgY29ubmVjdChhLCBiKToKICAgICAgYS5vdXRwdXQuYXBwZW5kKGIpCiAgICAgIGlmIGlzaW5zdGFuY2UoYSxUYXNrKToKICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGEuc2VydmVycykpOiAgIyBmaXJzdCBzZXJ2ZXIgaXMgYWxyZWFkeSBjb25uZWN0ZWQKICAgICAgICAgICAgICAgICAgYS5zZXJ2ZXJzW2ldLm91dHB1dC5hcHBlbmQoYikKZGVmIGRpY3RfdG9zdHJpbmcoYSk6CiAgICAgIHJldHVybiAiXG4iLmpvaW4oW2srIjpcdCIrc3RyKHYpIGZvciBrLHYgaW4gYS5pdGVtcygpXSkKIiIiCmRlZiBoaXN0KGE9WzAsMV0sIGI9MjAsIGM9J29yYW5nZScpOgogICAgICBpbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CiAgICAgIHBsdC5oaXN0KGEsYixjb2xvcj1jKQogICAgICAjcGx0LnNhdmVmaWcoImRlc19wbG90LnN2ZyIsIGZvcm1hdD0ic3ZnIikKICAgICAgI3BsdC5zaG93KCkKICAgICAgaW1wb3J0IGlvLCBiYXNlNjQKICAgICAgYnVmID0gaW8uQnl0ZXNJTygpCiAgICAgIHBsdC5zYXZlZmlnKGJ1ZiwgZm9ybWF0PSdzdmcnKQogICAgICBidWYuc2VlaygwKQogICAgICByZXR1cm4gJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJyArIGJhc2U2NC5iNjRlbmNvZGUoYnVmLnJlYWQoKSkuZGVjb2RlKCdVVEYtOCcpCiIiIgpkZWYgZnJvbV9maWxlKGZuYW1lKToKICAgICAgd2l0aCBvcGVuKGZuYW1lLCJyIikgYXMgZnA6CiAgICAgICAgICAgIHJldHVybiBmcC5yZWFkKCkKCiMgLS0tLSBjb252ZXJzaW9ucyAtLS0tLS0tLSAgICAgIApkZWYgYXR0cl90b3N0cmluZyhhKToKICAgICAgcz0ibmFtZTogIithWyJuYW1lIl0rIlxuIgogICAgICBmb3IgaSBpbiByYW5nZSgxLDEwMCk6CiAgICAgICAgICAgIHQ9Il9fdCIrc3RyKGkpCiAgICAgICAgICAgIGlmIHQrImIiIGluIGE6CiAgICAgICAgICAgICAgICAgIHMrPXQrIiAiKyIlLjNmIiVhW3QrImIiXSsiICIrIiUuM2YiJWFbdCsiZSJdKyJcbiIKICAgICAgcmV0dXJuIHMKZGVmIGF0dHJfdG9zdmdzdHJpbmcobyx3bWF4LHc9MTYsaD0yNCk6CiAgICAgIGdsb2JhbCBFTgogICAgICBhLHMgPSBvLmF0dHIsIiIKICAgICAgYz1bJ2hvdHBpbmsnLCdsaW1lZ3JlZW4nLCdjb3JuZmxvd2VyYmx1ZScsJ2NvcmFsJywnbWVkaXVtc2VhZ3JlZW4nLCdtZWRpdW1wdXJwbGUnXQogICAgICBmb3IgaSBpbiByYW5nZSgxMDApOgogICAgICAgICAgICB0PSJfX3QiK3N0cihpKQogICAgICAgICAgICBpZiB0KyJiIiBpbiBhOgogICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iOCIgeT0iJytzdHIoMzIraCppKSsnIj4nK3N0cihpKSsnPHRpdGxlPicrc3RyKEVOLmVlW2ktMV0ubmFtZSkrJyAnK3N0cihFTi5lZVtpLTFdLnRpdGxlKSsnPC90aXRsZT48L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCBjbGFzcz0idDEiIHN0eWxlPSJkaXNwbGF5Om5vbmU7ZmlsbDpncmF5IiB4PSIzMiIgeT0iJytzdHIoMzIraCppKSsnIj4nK3N0cihFTi5lZVtpLTFdLnRpdGxlKSsnPHRpdGxlPicrc3RyKEVOLmVlW2ktMV0ubmFtZSkrJzwvdGl0bGU+PC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICB0MCx0MSx0MiA9IGFbdCsiYSJdLGFbdCsiYiJdLGFbdCsiZSJdCiAgICAgICAgICAgICAgICAgIHMrPSc8cmVjdCB5PSInK3N0cigyMCtoKmkpKyciIHg9Iicrc3RyKDIwK3cqdDEpCiAgICAgICAgICAgICAgICAgIHMrPSciIHdpZHRoPSInK3N0cih0Mi10MT09MCBhbmQgMSBvciB3Kih0Mi10MSkpKyciIGhlaWdodD0iJytzdHIoaC0yKSsnIiBzdHJva2U9ImJsYWNrIiBmaWxsLW9wYWNpdHk9IjAuNyIgZmlsbD0iJwogICAgICAgICAgICAgICAgICBzKz0oY1tpbnQoYVsiY25hbWUiXS5zcGxpdCgnICcpWzBdKSVsZW4oYyldKSsnIj48dGl0bGU+JythWyJjbmFtZSJdKycgWycrKCIlLjJmLCAiJXQwKSsoIiUuMmYsICIldDEpKygiJS4yZiIldDIpKyddJysnPC90aXRsZT48L3JlY3Q+XG4nCiAgICAgICAgICAgICAgICAgIGlmIHQyLXQxPjAuNToKICAgICAgICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IHg9Iicrc3RyKDIwK3cqdDErMikrJyIgeT0iJytzdHIoMjAraCppKzE4KSsnIj4nK2FbImNuYW1lIl0rJzwvdGV4dD4nCiAgICAgICAgICAgICAgICAgIGlmIHcqdDE+d21heFswXToKICAgICAgICAgICAgICAgICAgICAgICAgd21heFswXSA9IHcqdDEKICAgICAgcmV0dXJuIHMKZGVmIHRvX3N2ZyhlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMpOgogICAgICB3LGgsVyxIID0gMTYsMjQsWzE2MF0sNDAgICMgV1swXSBmb3IgcGFzc2luZyBieSByZWZlcmVuY2UhISEKICAgICAgcyA9ICc8c3ZnIG9uY2xpY2s9Im9uX2NsaWNrKCkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IiVkIiBoZWlnaHQ9IiVkIj5cbicKICAgICAgZm9yIGUgaW4gZWU6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZSxFbmQpOgogICAgICAgICAgICAgICAgICBmb3IgYyBpbiBlLnF1ZXVlLm9iamVjdHM6CiAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gYXR0cl90b3N2Z3N0cmluZyhjLFcsdyxoKQogICAgICAgICAgICBIICs9IDI0CiAgICAgIEgrPTI0CiAgICAgIHMrPSAnPHJlY3QgeD0iMjAiIHk9IjEwIiB3aWR0aD0iJWQiIGhlaWdodD0iMiIvPlxuJyUoV1swXSt3KQogICAgICBzKz0gJzxyZWN0IHg9IjIwIiB5PSIlZCIgd2lkdGg9IiVkIiBoZWlnaHQ9IjIiLz5cbiclKEgrMTAsV1swXSt3KQogICAgICBmb3IgaSBpbiByYW5nZShpbnQoV1swXS93KzIpKToKICAgICAgICAgICAgcyArPSAnPHJlY3QgeD0iJytzdHIoMjArdyppKSsnIiB5PSIxMCIgd2lkdGg9IjEiIGhlaWdodD0iMTAiLz5cbicKICAgICAgICAgICAgcyArPSAnPHJlY3QgeD0iJytzdHIoMjArdyppKSsnIiB5PSIlZCIgd2lkdGg9IjEiIGhlaWdodD0iMTAiLz5cbiclKEgpCiAgICAgICAgICAgIGlmIChpJTEwKT09MDoKICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IHg9Iicrc3RyKDIwK3cqaS04KSsnIiB5PSIzMiI+JytzdHIoaSkrJzwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IHg9Iicrc3RyKDIwK3cqaS04KSsnIiB5PSIlZCI+JyUoSCkrc3RyKGkpKyc8L3RleHQ+XG4nCiAgICAgIHMgKz0gIjxzY3JpcHQ+ZnVuY3Rpb24gb25fY2xpY2soKSB7Wy4uLmRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3QxJyldLmZvckVhY2goZT0+ZS5zdHlsZS5kaXNwbGF5PShlLnN0eWxlLmRpc3BsYXk9PSdub25lJz8nJzonbm9uZScpKTt9PC9zY3JpcHQ+IgogICAgICByZXR1cm4gcyUoV1swXSs4MCxIKzIwKSArICc8L3N2Zz5cbicKZGVmIHRvX2RvdDAoZWU9UXVldWVkRXZlbnQuaW5zdGFuY2VzKToKICAgICAgcyA9J2RpZ3JhcGggQlBNTiB7IHJhbmtkaXI9IkxSIiByYW5rc2VwPTEgbm9kZXNlcD0xXG4nCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBzMSA9ICcgIHtyYW5rPXNhbWU7ICcKICAgICAgICAgICAgZm9yIGogaW4gcmFuZ2UobGVuKGVlW2ldLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICBzICs9ICIgICIrc3RyKGVlW2ldLmlkKSArICIgLT4gIiArIHN0cihlZVtpXS5vdXRwdXRbal0uaWQpICsiXG4iCiAgICAgICAgICAgICAgICAgIHMxICs9IHN0cihlZVtpXS5vdXRwdXRbal0uaWQpICsiOyAiCiAgICAgICAgICAgIGlmIGxlbihlZVtpXS5vdXRwdXQpPjE6CiAgICAgICAgICAgICAgICAgIGlmIGFicyhlZVtpXS5vdXRwdXRbMF0uaWQtZWVbaV0ub3V0cHV0WzFdLmlkKTwyOiBzICs9IHMxICsnfVxuJwogICAgICByZXR1cm4gcysnfScKZGVmIHRvX2RvdChlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMpOgogICAgICBzID0nZGlncmFwaCBCUE1OMiB7IHJhbmtkaXI9IkxSIiBub2Rlc2VwPTAuNlxuJwogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpKToKICAgICAgICAgICAgaWYgZWVbaV09PU5vbmU6IGNvbnRpbnVlCiAgICAgICAgICAgIGxhYmVsLHhsYWJlbCxzaGFwZSxzdHlsZSxjb2xvcixwZW4gPSBzdHIoZWVbaV0uaWQpLCIiLCJyZWN0IiwiIiwiIiwiMSIKICAgICAgICAgICAgc2l6ZT0iIgogICAgICAgICAgICBpZiAidmVudCIgaW4gZWVbaV0ubmFtZTogc2hhcGU9ImNpcmNsZSIKICAgICAgICAgICAgZWxpZiAiYXRld2F5IiBpbiBlZVtpXS5uYW1lOiBzaGFwZT0iZGlhbW9uZCI7IHNpemU9ImhlaWdodD0wLjciCiAgICAgICAgICAgIGlmICJpbnRlcm1lZGlhdGUiIGluIGVlW2ldLm5hbWU6IHNoYXBlPSJkb3VibGVjaXJjbGUiCiAgICAgICAgICAgIGlmIHNoYXBlPT0icmVjdCI6IHN0eWxlPSJyb3VuZGVkLGZpbGxlZCI7IGNvbG9yPSJsaWdodGJsdWUiOyBzaXplPSJ3aWR0aD0xLjEgaGVpZ2h0PTAuOCIKICAgICAgICAgICAgZWxpZiAiZW5kIiBpbiBlZVtpXS5uYW1lOiBzdHlsZT0iZmlsbGVkIjsgcGVuPSIzIgogICAgICAgICAgICBpZiAiZXhjbHVzaXZlIiBpbiBlZVtpXS5uYW1lOiB4bGFiZWw9bGFiZWw7IGxhYmVsPSJYIgogICAgICAgICAgICBlbGlmICJwYXJhbGxlbCIgaW4gZWVbaV0ubmFtZTogeGxhYmVsPWxhYmVsOyBsYWJlbD0iKyIKICAgICAgICAgICAgZWxpZiAiaW5jbHVzaXZlIiBpbiBlZVtpXS5uYW1lOiB4bGFiZWw9bGFiZWw7IGxhYmVsPSJPIgogICAgICAgICAgICBzICs9ICcgICcrZWVbaV0ubmFtZSArJyBbbGFiZWw9IicrbGFiZWwrJyIgeGxhYmVsPSInK3hsYWJlbAogICAgICAgICAgICBzICs9ICciIHN0eWxlPSInK3N0eWxlKyciIHNoYXBlPSInK3NoYXBlKyciIGZpbGxjb2xvcj0iJwogICAgICAgICAgICBzICs9IGNvbG9yKyciIHBlbndpZHRoPSInK3BlbisnIiAnK3NpemUrJ10nICsnXG4nCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgczEgPSAnICB7cmFuaz1zYW1lOyAnCiAgICAgICAgICAgIGZvciBqIGluIHJhbmdlKGxlbihlZVtpXS5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgcyArPSAiICAiK2VlW2ldLm5hbWUgKyAiIC0+ICIgKyBlZVtpXS5vdXRwdXRbal0ubmFtZSArIlxuIgogICAgICAgICAgICAgICAgICBzMSArPSBlZVtpXS5vdXRwdXRbal0ubmFtZSArIjsgIgogICAgICAgICAgICBpZiBsZW4oZWVbaV0ub3V0cHV0KT4xOgogICAgICAgICAgICAgICAgICBpZiBhYnMoZWVbaV0ub3V0cHV0WzBdLmlkLWVlW2ldLm91dHB1dFsxXS5pZCk8MjogcyArPSBzMSArJ31cbicKICAgICAgcmV0dXJuIHMrJ30nCmRlZiB0b19wb3NpdGlvbihlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMpOgogICAgICBwcD1bXQogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpKTogICAjIHNldCB4IHBvc2l0aW9uIHRvIHRyZWUgbGV2ZWwKICAgICAgICAgICAgaWYgZWVbaV09PU5vbmU6CiAgICAgICAgICAgICAgICAgIHBwLmFwcGVuZChOb25lKQogICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB4LGVwID0gMCxlZVtpXS5wcmV2KCkKICAgICAgICAgICAgZm9yIGlkeCBpbiByYW5nZShsZW4oZXApLTEsLTEsLTEpOgogICAgICAgICAgICAgICAgICBpZiBlcFtpZHhdLnBwWzBdIT0tMToKICAgICAgICAgICAgICAgICAgICAgICAgeD1lcFtpZHhdLnBwWzBdKzEKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWVbaV0ucHA9W3gsMF0KICAgICAgICAgICAgcHAuYXBwZW5kKGVlW2ldLnBwKQogICAgICAjcHJpbnQoW18ucHAgZm9yIF8gaW4gZWVdKQogICAgICBmb3IgaSBpbiByYW5nZSgxLGxlbihwcCkpOiAjIGluY3JlYXNlIHkgcG9zaXRpb24gZm9yIGFsbCBhdCB0aGUgc2FtZSBsZXZlbAogICAgICAgICAgICBpZiBwcFtpXSE9Tm9uZSBhbmQgcHBbaS0xXSE9Tm9uZSBhbmQgcHBbaV1bMF09PXBwW2ktMV1bMF06CiAgICAgICAgICAgICAgICAgIHBwW2ldWzFdID0gcHBbaS0xXVsxXSsxCiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwPXBwW2ldCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pCiAgICAgICMiIiIKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKS0xLC0xLC0xKTogICAjIHNldCB5IHBvc2l0aW9uIHRvIHRoZSBsZXZlbCBvZiBwcmV2aW91cyAKICAgICAgICAgICAgaWYgZWVbaV09PU5vbmU6IGNvbnRpbnVlCiAgICAgICAgICAgIGUgPSBlZVtpXS5wcmV2KCkKICAgICAgICAgICAgaWYgbGVuKGUpPjAgYW5kIGVbMF0ub3V0cHV0WzBdPT1lZVtpXToKICAgICAgICAgICAgICAgICAgcHBbaV1bMV0gPSBlWzBdLnBwWzFdCiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwPXBwW2ldCiAgICAgICAgICAgIGlmIGxlbihlKT4wIGFuZCBsZW4oZVswXS5vdXRwdXQpPjEgYW5kIGVbMF0ub3V0cHV0WzFdPT1lZVtpXSBhbmQgbGVuKGVlW2ldLm91dHB1dCk9PTA6CiAgICAgICAgICAgICAgICAgIHBwW2ldWzBdID0gZWVbaV0ucHBbMF0tMSAgIyB3aGVuIGl0IGlzIHRoZSBzZWNvbmQgYW5kIGhhcyBubyBvdXB1dAogICAgICAgICAgICAgICAgICBlZVtpXS5wcD1wcFtpXQogICAgICAjcHJpbnQoW18ucHAgZm9yIF8gaW4gZWVdKQogICAgICAjIiIiCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSktMSwtMSwtMSk6ICMgbW92ZSBwcmV2aW91cyB0byB0aGUgbGV2ZWwgb2YgaXRzIGZpcnN0IG5leHQKICAgICAgICAgICAgaWYgZWVbaV09PU5vbmU6IGNvbnRpbnVlCiAgICAgICAgICAgIGVwPWVlW2ldLnByZXYoKQogICAgICAgICAgICBpZiBsZW4oZXApPjAgYW5kIGVwWzBdLm91dHB1dFswXT09ZWVbaV0gYW5kIGVwWzBdLnBwWzBdPT1lZVtpXS5wcFswXS0xOgogICAgICAgICAgICAgICAgICBpZiBlcFswXS5wcFsxXSE9ZWVbaV0ucHBbMV06CiAgICAgICAgICAgICAgICAgICAgICAgIGVwWzBdLnBwWzFdPWVlW2ldLnBwWzFdCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pICAgICAgCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOiAgIyBmb3JjZSBwb3NpdGlvbiBmcm9tIHBwMgogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgaWYgZWVbaV0ucHAyWzBdIT0tMToKICAgICAgICAgICAgICAgICAgZWVbaV0ucHBbMF09ZWVbaV0ucHAyWzBdCiAgICAgICAgICAgIGlmIGVlW2ldLnBwMlsxXSE9LTE6CiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwWzFdPWVlW2ldLnBwMlsxXQogICAgICBmb3IgZSBpbiBlZTogICAjIGNvcnJlY3QgcG9zaXRpb24gb2YgYm91bmRhcnkgZXZlbnRzCiAgICAgICAgICAgIGlmIGU9PU5vbmU6IGNvbnRpbnVlCiAgICAgICAgICAgICNpZihlLnBwWzBdPT0wIGFuZCBlLnBwWzFdPT0wKToKICAgICAgICAgICAgaWYoZS5pZCE9ZS5pZDIpOgogICAgICAgICAgICAgICAgICBpZDI9aW50KHN0cihlLmlkMikuc3BsaXQoIi4iKVsxXSkKICAgICAgICAgICAgICAgICAgZS5wcFswXSxlLnBwWzFdID0gZWVbaWQyLTFdLnBwWzBdLGVlW2lkMi0xXS5wcFsxXQogICAgICByZXR1cm4gW2UucHAgZm9yIGUgaW4gZmlsdGVyKE5vbmUsZWUpXQpkZWYgdG9fYnBtbihlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMscHA9Tm9uZSk6CiAgICAgIHMgPSc8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJVVEYtOCI/PlxuJwogICAgICBzKz0nPGJwbW46ZGVmaW5pdGlvbnMgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSInCiAgICAgIHMrPScgeG1sbnM6YnBtbj0iaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9NT0RFTCInCiAgICAgIHMrPScgeG1sbnM6YnBtbmRpPSJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L0RJIicKICAgICAgcys9JyB4bWxuczpkYz0iaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREMiJwogICAgICBzKz0nIHhtbG5zOmRpPSJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9ESSInCiAgICAgIHMrPScgdGFyZ2V0TmFtZXNwYWNlPSJodHRwOi8vYnBtbi5pby9zY2hlbWEvYnBtbiInCiAgICAgIHMrPScgaWQ9IkRlZmluaXRpb25zXzEiIGV4cG9ydGVyPSJkZXMiIGV4cG9ydGVyVmVyc2lvbj0iMS4wIj5cbicKICAgICAgczE9JyA8YnBtbjpwcm9jZXNzIGlkPSJQcm9jZXNzXzEiPlxuJwogICAgICBzMj0nIDxicG1uZGk6QlBNTkRpYWdyYW0gaWQ9IkJQTU5EaWFncmFtXzEiPlxuJwogICAgICBzMis9JyAgPGJwbW5kaTpCUE1OUGxhbmUgaWQ9IkJQTU5QbGFuZV8xIiBicG1uRWxlbWVudD0iUHJvY2Vzc18xIj5cbicKICAgICAgczFhPScnCiAgICAgIGoxID0gMCAgIyBmbG93IGNvdW50ZXIKICAgICAgVyxILFcwLEgwID0gMTAwLDEwMCw0MCwzMAogICAgICBpZiBub3QgcHA6CiAgICAgICAgICAgIHBwID0gW2UucHAgZm9yIGUgaW4gZmlsdGVyKE5vbmUsZWUpXQogICAgICAgICAgICBpZiBwcFswXVswXT09LTE6CiAgICAgICAgICAgICAgICAgIHBwID0gdG9fcG9zaXRpb24oZmlsdGVyKE5vbmUsZWUpKQogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpKToKICAgICAgICAgICAgaWYgZWVbaV09PU5vbmU6IGNvbnRpbnVlCiAgICAgICAgICAgIG5hbWUgPSBlZVtpXS5uYW1lCiAgICAgICAgICAgIGlmICJ0ZXJtaW5hdGUiIGluIG5hbWU6CiAgICAgICAgICAgICAgICAgIG5hbWU9bmFtZVtsZW4oInRlcm1pbmF0ZSIpOl0KICAgICAgICAgICAgZW5hbWUgPSBlZVtpXS5fX2NsYXNzX18uX19uYW1lX18rJ18nK3N0cihlZVtpXS5mdW4gYW5kIGVlW2ldLmZ1bi5fX25hbWVfXyBvciBOb25lKSsnXycKICAgICAgICAgICAgaW1wb3J0IGJhc2U2NAogICAgICAgICAgICBlbmFtZSArPSBiYXNlNjQuYjE2ZW5jb2RlKGJ5dGVhcnJheShzdHIoZWVbaV0ucGFyYW0pKydfJytzdHIoZWVbaV0uY29kZSksJ2FzY2lpJykpLmRlY29kZSgnYXNjaWknKSAjIHJlcXVpcmVzIGVuY29kaW5nIQogICAgICAgICAgICB0eXBlPW5hbWUuc3BsaXQoIl8iKVswXQogICAgICAgICAgICBndD17IndpIjo4MCwiaCI6NjAsIm94IjowLCJveSI6MCwiZSI6KDgwLDMwKSwidyI6KDAsMzApLCJuIjooNDAsMCksInMiOig0MCw2MCl9CiAgICAgICAgICAgIGdnPXsid2kiOjM2LCJoIjozNiwib3giOjIyLCJveSI6MTIsImUiOig1OCwzMCksInciOigyMiwzMCksIm4iOig0MCwxMiksInMiOig0MCw0OCl9CiAgICAgICAgICAgIGcxID0gZ3QgaWYgImFzayIgaW4gdHlwZSBlbHNlIGdnCiAgICAgICAgICAgIHcsaCA9IGcxWyJ3aSJdLGcxWyJoIl0gICMgaWNvbiBzaXplCiAgICAgICAgICAgIHhiLHliID0gVzArVypwcFtpXVswXSwgSDArSCpwcFtpXVsxXQogICAgICAgICAgICB4byx5byA9IHhiK2cxWyJveCJdLCB5YitnMVsib3kiXSAjIGljb24gb2Zmc2V0CiAgICAgICAgICAgIGlmICJ0YXNrIiBpbiB0eXBlOgogICAgICAgICAgICAgICAgICBpZiBsZW4oZWVbaV0ub3V0cHV0KT4xOiB0eXBlID0gInNlbmRUYXNrIgogICAgICAgICAgICAgICAgICBpZiBsZW4oc2V0KFtlLmlkIGZvciBlIGluIGVlW2ldLnByZXYoKV0pKT4xOiB0eXBlID0gInJlY2VpdmVUYXNrIgogICAgICAgICAgICBkeW8gPSAwCiAgICAgICAgICAgIGlmIGVlW2ldLmlkICE9IGVlW2ldLmlkMjogICMgZm9yIGJvdW5kYXJ5IGV2ZW50cwogICAgICAgICAgICAgICAgICBpZDIgPSBpbnQoc3RyKGVlW2ldLmlkMikuc3BsaXQoJy4nKVsxXSkKICAgICAgICAgICAgICAgICAgeG8seW8gPSBlZVtpZDItMV0ueCsyMi41LGVlW2lkMi0xXS55KzQyLjUKICAgICAgICAgICAgICAgICAgZHlvID0gMzAKICAgICAgICAgICAgICAgICAgdHlwZSA9ICJib3VuZGFyeUV2ZW50IgogICAgICAgICAgICBlZVtpXS54LGVlW2ldLnkgPSB4byx5bwogICAgICAgICAgICBzMSs9JyAgPGJwbW46Jyt0eXBlKycgaWQ9IicrbmFtZSsnIiBuYW1lPSInK25hbWUuc3BsaXQoIl8iKVsxXSsnXG4nK2VlW2ldLnRpdGxlKyciPlxuJwogICAgICAgICAgICBzMis9JyAgIDxicG1uZGk6QlBNTlNoYXBlIGlkPSInK25hbWUrJ18nK2VuYW1lKyciIGJwbW5FbGVtZW50PSInK25hbWUrJyI+XG4nCiAgICAgICAgICAgIHMyKz0nICAgIDxkYzpCb3VuZHMgeD0iJytzdHIoeG8pKyciIHk9Iicrc3RyKHlvKSsnIiB3aWR0aD0iJytzdHIodykrJyIgaGVpZ2h0PSInK3N0cihoKSsnIiAvPlxuJwogICAgICAgICAgICBzMis9JyAgIDwvYnBtbmRpOkJQTU5TaGFwZT5cbicKICAgICAgICAgICAgZm9yIGoyIGluIHJhbmdlKGxlbihlZVtpXS5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgajEgKz0gMQogICAgICAgICAgICAgICAgICBmbG93LGVmbG93PSdGbG93Xycrc3RyKGoxKSwiZGkiCiAgICAgICAgICAgICAgICAgIGlpID0gZWVbaV0ub3V0cHV0W2oyXS5pZC0xCiAgICAgICAgICAgICAgICAgICNwcmludChlZVtpXSxqMixlZVtpXS5vdXRwdXRbajJdLGlpLHBwKQogICAgICAgICAgICAgICAgICB4ZSx5ZSA9IFcwK1cqcHBbaWldWzBdLCBIMCtIKnBwW2lpXVsxXQogICAgICAgICAgICAgICAgICBuYW1lMj1lZVtpXS5vdXRwdXRbajJdLm5hbWUKICAgICAgICAgICAgICAgICAgaWYgInRlcm1pbmF0ZSIgaW4gbmFtZTI6CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUyPW5hbWUyW2xlbigidGVybWluYXRlIik6XQogICAgICAgICAgICAgICAgICB0eXBlMj1uYW1lMi5zcGxpdCgiXyIpWzBdCiAgICAgICAgICAgICAgICAgIGcyID0gZ3QgaWYgImFzayIgaW4gdHlwZTIgZWxzZSBnZwogICAgICAgICAgICAgICAgICBpZiB4ZT54YjogIyB0d28gZWRnZXMKICAgICAgICAgICAgICAgICAgICAgICAgZHgxLGR5MSA9IGcxWyJzIl0gaWYgeWI8eWUgZWxzZSBnMVsiZSJdCiAgICAgICAgICAgICAgICAgICAgICAgIGR4MixkeTIgPSBnMlsicyJdIGlmIHliPnllIGVsc2UgZzJbInciXQogICAgICAgICAgICAgICAgICBlbHNlIDogICAgIyB0aHJlZSBlZGdlcwogICAgICAgICAgICAgICAgICAgICAgICBkeDEsZHkxID0gZzFbInMiXSBpZiB5Yjx5ZSBlbHNlIGcxWyJuIl0KICAgICAgICAgICAgICAgICAgICAgICAgZHgyLGR5MiA9IGcyWyJzIl0gaWYgeWI+eWUgZWxzZSBnMlsibiJdCiAgICAgICAgICAgICAgICAgIHgxLHkxID0geGIrZHgxLHliK2R5MQogICAgICAgICAgICAgICAgICB4Mix5MiA9IHhlK2R4Mix5ZStkeTIKICAgICAgICAgICAgICAgICAgczErPScgICA8YnBtbjpvdXRnb2luZz4nK2Zsb3crJzwvYnBtbjpvdXRnb2luZz5cbicKICAgICAgICAgICAgICAgICAgaWYgImludGVybWVkaWF0ZUNhdGNoIiBpbiBuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAib25kaXRpb24iIGluIGVuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOmNvbmRpdGlvbmFsRXZlbnREZWZpbml0aW9uLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgczErPScgICA8YnBtbjp0aW1lckV2ZW50RGVmaW5pdGlvbi8+XG4nCiAgICAgICAgICAgICAgICAgIHkxICs9IGR5bwogICAgICAgICAgICAgICAgICBzMWErPScgICAgPGJwbW46c2VxdWVuY2VGbG93IGlkPSInK2Zsb3crJyIgc291cmNlUmVmPSInK25hbWUrJyIgdGFyZ2V0UmVmPSInK25hbWUyKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgIHMyKz0nICAgPGJwbW5kaTpCUE1ORWRnZSBpZD0iJytmbG93KydfJytlZmxvdysnIiBicG1uRWxlbWVudD0iJytmbG93KyciPlxuJwogICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDEpKyciIHk9Iicrc3RyKHkxKSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICB4eCx5eSA9IDAsMAogICAgICAgICAgICAgICAgICBpZiB5MSE9eTI6ICMgcmVxdWlyZXMgYWRkaXRpb25hbCBwb2ludHMgKG9uZSBvciB0d28gaW1wbGVtZW50ZWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHh4LCB5eSA9IHkyPnkxIGFuZCB4MSBvciB4MiwgeTI+eTEgYW5kIHkyIG9yIHkxCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHgxPngyOiAjIGJhY2sgY29ubmVjdGlvbiByZXF1aXJlcyB0d28gYWRkaXRpb25hbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB5MT55MjogIyBmcm9tIGxvd2VyIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl5IC09IDM1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MSkrJyIgeT0iJytzdHIoeXkpKyciIC8+XG4nICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIHkxPHkyOiAjIGZyb20gdXBwZXIgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeXkgLT0gMjUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHh4KSsnIiB5PSInK3N0cih5eSkrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHggPSB4MgogICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeHgpKyciIHk9Iicrc3RyKHl5KSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICBlbGlmIHkxPT15MiBhbmQgeDE+eDI6ICMgbG9vcGJhY2sgLSByZXF1aXJlcyB0d28gYWRkaXRpb25hbCBwb2ludHMKICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgxKSsnIiB5PSInK3N0cih5MS0zMCkrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgyKSsnIiB5PSInK3N0cih5Mi0zMCkrJyIgLz5cbicgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgIGlmIHh4IT14MiBvciB5eSE9eTI6CiAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MikrJyIgeT0iJytzdHIoeTIpKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgIHMyKz0nICAgPC9icG1uZGk6QlBNTkVkZ2U+XG4nCiAgICAgICAgICAgIGlmICJ0ZXJtaW5hdGUiIGluIGVlW2ldLm5hbWU6CiAgICAgICAgICAgICAgICAgIHMxKz0nICAgPGJwbW46dGVybWluYXRlRXZlbnREZWZpbml0aW9uLz5cbicKICAgICAgICAgICAgczErPScgIDwvYnBtbjonK3R5cGUrJz5cbicKICAgICAgICAgICAgcGFzcwogICAgICBzMis9JyAgPC9icG1uZGk6QlBNTlBsYW5lPlxuJwogICAgICBzMis9JyA8L2JwbW5kaTpCUE1ORGlhZ3JhbT5cbicKICAgICAgczErPXMxYSsnIDwvYnBtbjpwcm9jZXNzPlxuJwogICAgICByZXR1cm4gcytzMStzMisnPC9icG1uOmRlZmluaXRpb25zPlxuJwoKZW5fdGl0bGUgPSAiIgppbXBvcnQgcmUKY2xhc3MgRXZlbnROZXR3b3JrKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLHMpOgogICAgICAgICAgICBFdmVudC5jbnQsIEN1c3RvbWVyLmNudCA9IDAsIDAKICAgICAgICAgICAgUXVldWVkRXZlbnQuaW5zdGFuY2VzLmNsZWFyKCkKICAgICAgICAgICAgQnBtbkV2ZW50LlMgPSB7fQogICAgICAgICAgICBzZWxmLmVlID0gc2VsZi5mcm9tX3N0cmluZyhzKQogICAgICAgICAgICBzZWxmLnBwID0gdG9fcG9zaXRpb24oc2VsZi5lZSkKICAgICAgZGVmIF9fZ2V0aXRlbV9fKHNlbGYsaSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmVlW2ldCiAgICAgIGRlZiBmcm9tX3N0cmluZyhzZWxmLHMpOgogICAgICAgICAgICBnbG9iYWwgZW5fdGl0bGUKICAgICAgICAgICAgZWUsIEV2ZW50LmNudCwgeWxldmVsLCBlbl90aXRsZSwgaWQyID0gW10sIDAsIC0xLCAnJywgMAogICAgICAgICAgICBzcyA9IHMuc3BsaXQoJ1xuJykKICAgICAgICAgICAgZm9yIHMwIGluIHNzOgogICAgICAgICAgICAgICAgICBzMSA9IHMwLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgaWYgbGVuKHMxKTwyIG9yIHMxWzBdPT0nIyc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHMxPT1zc1swXTogIyB0aXRsZSBpbiBmaXJzdCBsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuX3RpdGxlID0gc3NbMF1bMTpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgIGlmICItPiIgaW4gczE6ICMgY29ubmVjdGlvbiBkZWZpbml0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHlsZXZlbCArPSAxICAgIyB1c2VkIGZvciBtYXJraW5nIHJlcXVpcmVkIHkgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHMxYSBpbiBzMS5zcGxpdCgiOyIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNjb2RlID0gczFhLnN0cmlwKCkuc3BsaXQoJy0+JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlID0gcmUuc3BsaXQocictWz5dKig/PSg/Oig/OlteXChcKV0qKyg/PCFcXClbXChcKV0pezJ9KSorW15cKFwpXSorXFopJyxzMWEuc3RyaXAoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSBsZW4oY29kZSk+MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVbMV09Y29kZVsxXS5zcGxpdCgiIyIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjb2RlWzBdWzBdPT0nKCc6IGNvZGVbMF09Y29kZVswXVsxOi0xXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29kZVsxXVswXT09JygnOiBjb2RlWzFdPWNvZGVbMV1bMTotMV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYyA9IHJlLnNwbGl0KCdbLHxdJyxjb2RlWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHN0ID0gcmUuc3BsaXQoJ1ssfF0nLGNvZGVbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcyBpbiBzcmM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaT1yZS5zcGxpdCgnLVs+XSonLHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgZCBpbiBkc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaT1yZS5zcGxpdCgnLVs+XSonLGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oc2kpPT0xOiBkaT1bc2lbMF1dK2RpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oZGkpPT0xOiBkaT1bc2lbLTFdXStkaQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGsgaW4gcmFuZ2UobGVuKGRpKS0xKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRpW2srMV09PScnOiB6PWRpW2tdOyBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGlba109PScnOiBkaVtrXT16CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLGogPSBpbnQoZGlba10pLTEsIGludChkaVtrKzFdKS0xCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpPi0xIGFuZCBqPi0xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdChlZVtpXSxlZVtqXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGk+LTEgYW5kIGVlW2ldLnBwMlsxXT09LTE6ICMgaWYgbm90IHNldCB5ZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlW2ldLnBwMlsxXT15bGV2ZWwgIyBmb3JjZSB5IHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBqPi0xIGFuZCBlZVtqXS5wcDJbMV09PS0xOiAjIGlmIG5vdCBzZXQgeWV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVtqXS5wcDJbMV09eWxldmVsICMgZm9yY2UgeSBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5wb3AoMCkKICAgICAgICAgICAgICAgICAgZWxzZTogICAgICAgICAgIyBldmVudCBkZWZpbml0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHMxYT1yZS5zcGxpdChyJycnKCg/OlteOyInXXwiW14iXSoifCdbXiddKicpKyknJycsczEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBzMWIgaW4gczFhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlPXMxYi5zdHJpcCgpLnNwbGl0KCIgIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGNvZGUpPjEgYW5kIGxlbihjb2RlWzBdKT4wOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDIgKz0gMSAjIGlkIGNvdW50ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI2lmIG5vdCBjb2RlWzBdWzoxXS5pc2RpZ2l0KCk6IGNvZGUgPSBbc3RyKGlkMildICsgY29kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlMT0iICIuam9pbihjb2RlWzE6XSkuc3BsaXQoJyMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZS5hcHBlbmQoZXZhbChjb2RlMVswXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS5pZDI9ZmxvYXQoY29kZVswXS5zcGxpdCgnLycpWzBdKSAjIGlkIGFzIHdyaXR0ZW4gaW4gc291cmNlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQoZWVbLTFdLmlkMixlZVstMV0uaWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS50aXRsZT1jb2RlMVsxXS5zdHJpcCgpIGlmIGxlbihjb2RlMSk+MSBlbHNlICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjPWNvZGVbMF0uc3BsaXQoIi8iKSAgIyBjaGVjayBpZGVudGlmaWVyIGZpZWxkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS5wcDJbMF0gPSBmbG9hdChjY1sxXSktMSBpZiBsZW4oY2MpPjEgYW5kIGxlbihjY1sxXSk+MCBlbHNlIC0xIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVstMV0ucHAyWzFdID0gZmxvYXQoY2NbMl0pLTEgaWYgbGVuKGNjKT4yIGFuZCBsZW4oY2NbMl0pPjAgZWxzZSAtMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjZWxpZiBsZW4oY29kZSk9PTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICAgICBlZS5hcHBlbmQoTm9uZSkgICMgZW1wdHkgZWxlbWVudCAKICAgICAgICAgICAgaWYgbGVuKHNldChbZS5wcDJbMV0gZm9yIGUgaW4gZmlsdGVyKE5vbmUsZWUpXSkpPT0xOiAjIHZlcmlmeSBpZiBtdWx0aS1saW5lIGRlc2NyaXB0aW9uCiAgICAgICAgICAgICAgICAgIGZvciBlIGluIGZpbHRlcihOb25lLGVlKTogICAgICAjIGlmIHllcwogICAgICAgICAgICAgICAgICAgICAgICBlLnBwMlsxXT0tMSAjIGNsZWFyIGFsbCB5LWxldmVscyB0byB1bmtub3duCiAgICAgICAgICAgIHJldHVybiBlZQogICAgICBkZWYgX19yZXByX18oc2VsZik6IHJldHVybiBzZWxmLnRvX3N0cmluZygpCiAgICAgIGRlZiB0b19zdHJpbmcoc2VsZik6CiAgICAgICAgICAgIHM9JycKICAgICAgICAgICAgZm9yIGUgaW4gc2VsZi5lZToKICAgICAgICAgICAgICAgICAgcyArPSAiJWciJShlLmlkMikgKyAiICIgKyBlLl9fY2xhc3NfXy5fX25hbWVfXysiKCIKICAgICAgICAgICAgICAgICAgI2lmIGUuX19jbGFzc19fLl9fbmFtZV9fIT0nRW5kJzoKICAgICAgICAgICAgICAgICAgaWYgIkdhdGUiIG5vdCBpbiBlLl9fY2xhc3NfXy5fX25hbWVfXzoKICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBlLmZ1biBhbmQgZS5mdW4uX19uYW1lX18gb3IgJ05vbmUnCiAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0iLCIrc3RyKGUucGFyYW0pKyIsIgogICAgICAgICAgICAgICAgICBpZiBlLl9fY2xhc3NfXy5fX25hbWVfXyE9J1N0YXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgcys9IGUuY29kZSE9Tm9uZSBhbmQgIlwiIitzdHIoZS5jb2RlKSsiXCIiIG9yICJOb25lIgogICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzKz1zdHIoZS50bWF4KQogICAgICAgICAgICAgICAgICBzICs9IilcbiIKICAgICAgICAgICAgZm9yIGUgaW4gc2VsZi5lZToKICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGUub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gc3RyKGUuaWQpICsgIi0+IiArIHN0cihlLm91dHB1dFtpXS5pZCkgKyc7JwogICAgICAgICAgICByZXR1cm4gcyArICdcbicKZGVmIHN2Z19yb3VuZGVkUGF0aChwcCwgcik6CiAgICAgIGltcG9ydCBtYXRoCiAgICAgIHMsIGwgPSAiIiwgbGVuKHBwKS0xCiAgICAgIGZvciBpIGluIHJhbmdlKGwpOgogICAgICAgICAgICBhLGIgPSBwcFtpXSwgcHBbaSsxXQogICAgICAgICAgICB0ID0gbWluKHIgLyBtYXRoLmh5cG90KGJbMF0tYVswXSwgYlsxXS1hWzFdKzAuMDEpLCAwLjUpCiAgICAgICAgICAgIGlmIGk9PTA6CiAgICAgICAgICAgICAgICAgIHMgKz0gJ00lZyAlZyAnJShhWzBdLGFbMV0pCiAgICAgICAgICAgIGlmIGk+MDoKICAgICAgICAgICAgICAgICAgcyArPSAnUSVnICVnICVnICVnICclKGFbMF0sYVsxXSxhWzBdKigxLXQpK2JbMF0qdCxhWzFdKigxLXQpK2JbMV0qdCkKICAgICAgICAgICAgaWYgaT09bC0xOgogICAgICAgICAgICAgICAgICBzICs9ICdMJWcgJWcgJyUoYlswXSxiWzFdKQogICAgICAgICAgICBlbGlmIGk8bC0xOgogICAgICAgICAgICAgICAgICBzICs9ICdMJWcgJWcgJyUoYVswXSp0K2JbMF0qKDEtdCksYVsxXSp0K2JbMV0qKDEtdCkpCiAgICAgIHJldHVybiBzCiNOU19NQVAgPSB7CiMgICAgTm9uZTogJ2h0dHA6Ly93d3cub21nLm9yZy9zcGVjL0JQTU4vMjAxMDA1MjQvTU9ERUwnLAojICAgICdicG1uZGknOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9ESScsCiMgICAgJ29tZ2RjJzogJ2h0dHA6Ly93d3cub21nLm9yZy9zcGVjL0RELzIwMTAwNTI0L0RDJywKIyAgICAnb21nZGknOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREknLAojICAgICd4c2knOiAnaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UnCiN9CmRlZiBicG1uX3Rvc3ZnMChicG1uZmlsZSxXPTEwMCxIPTgwKToKICAgICAgcyA9ICc8ZGVmcz48bWFya2VyIGlkPSJ0cmlhbmdsZSIgdmlld0JveD0iMCAwIDEwIDEwIiByZWZYPSIxMCIgcmVmWT0iNSIgbWFya2VyVW5pdHM9InN0cm9rZVdpZHRoIiBtYXJrZXJXaWR0aD0iMTAiIG1hcmtlckhlaWdodD0iMTAiIG9yaWVudD0iYXV0byI+IDxwYXRoIGQ9Ik0gMCAwIEwgMTAgNSBMIDAgMTAgeiIgZmlsbD0iYmxhY2siIC8+PC9tYXJrZXI+PC9kZWZzPlxuJwogICAgICBpbXBvcnQgeG1sLmV0cmVlLkVsZW1lbnRUcmVlIGFzIEVUCiAgICAgIGZvciBlIGluIEVULnBhcnNlKGJwbW5maWxlKS5nZXRyb290KCk6CiAgICAgICAgICAgIGlmICJCUE1ORGlhZ3JhbSIgaW4gZS50YWc6CiAgICAgICAgICAgICAgICAgIGZvciBkIGluIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zPVtwIGZvciBwIGluIGQgaWYgIkJQTU5QbGFuZSIgaW4gZC50YWddCiAgICAgIHJldHVybiBpdGVtcwojZGVmIGJwbW5fdG9zdmcoYnBtbmZpbGUsVz0xMDAsSD04MCk6CmRlZiBicG1uX3Rvc3ZnKGJwbW5zdHJpbmcsaXNhbmltLGlzY29tbWVudHMsaXNzY3JpcHRzLFc9MTAwLEg9ODApOgogICAgICBzID0gJzxkZWZzPjxtYXJrZXIgaWQ9InRyaWFuZ2xlIiB2aWV3Qm94PSIwIDAgMTAgMTAiIHJlZlg9IjEwIiByZWZZPSI1IiBtYXJrZXJVbml0cz0ic3Ryb2tlV2lkdGgiIG1hcmtlcldpZHRoPSIxMCIgbWFya2VySGVpZ2h0PSIxMCIgb3JpZW50PSJhdXRvIj4gPHBhdGggZD0iTSAwIDAgTCAxMCA1IEwgMCAxMCB6IiBmaWxsPSJibGFjayIgLz48L21hcmtlcj48L2RlZnM+XG4nCiAgICAgIHMgKz0gJzx0ZXh0IHg9IjEwIiB5PSIxMiI+Jytlbl90aXRsZSsnPC90ZXh0PlxuJzsKICAgICAgaW1wb3J0IHhtbC5ldHJlZS5FbGVtZW50VHJlZSBhcyBFVAogICAgICAjZm9yIGUgaW4gRVQucGFyc2UoYnBtbmZpbGUpLmdldHJvb3QoKTogICMgY29sbGVjdCBuYW1lZCBwcm9jZXNzZXMKICAgICAgZm9yIGUgaW4gRVQuZnJvbXN0cmluZyhicG1uc3RyaW5nKTogICMgY29sbGVjdCBuYW1lZCBwcm9jZXNzZXMKICAgICAgICAgICAgaWYgInByb2Nlc3MiIGluIGUudGFnOgogICAgICAgICAgICAgICAgICBlbGVtcz1bZCBmb3IgZCBpbiBlIGlmICJuYW1lIiBpbiBkLmF0dHJpYl0KICAgICAgI2ZvciBlIGluIEVULnBhcnNlKGJwbW5maWxlKS5nZXRyb290KCk6ICAjIGNvbGxlY3QgZGlhZ3JhbSBlbGVtZW50cwogICAgICBmb3IgZSBpbiBFVC5mcm9tc3RyaW5nKGJwbW5zdHJpbmcpOiAgIyBjb2xsZWN0IG5hbWVkIHByb2Nlc3NlcwogICAgICAgICAgICBpZiAiQlBNTkRpYWdyYW0iIGluIGUudGFnOgogICAgICAgICAgICAgICAgICBmb3IgZCBpbiBlOgogICAgICAgICAgICAgICAgICAgICAgICBpdGVtcz1bcCBmb3IgcCBpbiBkIGlmICJCUE1OUGxhbmUiIGluIGQudGFnXQogICAgICBmb3IgaXQgaW4gaXRlbXM6CiAgICAgICAgICAgIHBwLG5hbWUgPSBbXSwiIgogICAgICAgICAgICBmb3IgZSBpbiBlbGVtczoKICAgICAgICAgICAgICAgICAgaWYgaXQuYXR0cmliWyJicG1uRWxlbWVudCJdPT1lLmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT0iICIuam9pbihlLmF0dHJpYlsibmFtZSJdLnNwbGl0KCIgIilbMTpdKSAjIGFzc3VtZSAiaWRcbnRleHQiCiAgICAgICAgICAgIGZvciBqIGluIHJhbmdlKGxlbihpdCkpOgogICAgICAgICAgICAgICAgICB4LHkgPSBmbG9hdChpdFtqXS5hdHRyaWJbIngiXSksZmxvYXQoaXRbal0uYXR0cmliWyJ5Il0pCiAgICAgICAgICAgICAgICAgIHcsaCA9IChmbG9hdChpdFtqXS5hdHRyaWJbIndpZHRoIl0pLGZsb2F0KGl0W2pdLmF0dHJpYlsiaGVpZ2h0Il0pKSBpZiAiQm91bmRzIiBpbiBpdFtqXS50YWcgZWxzZSAoMCwwKQogICAgICAgICAgICAgICAgICBXLEggPSBtYXgoVyx4K3cpLG1heChILHkraCkKICAgICAgICAgICAgICAgICAgI3ByaW50KGl0LmF0dHJpYlsiaWQiXSwiOiIseCx5LHcsaCkKICAgICAgICAgICAgICAgICAgaWYgdz09MDogIyBicG1uIGZsb3cKICAgICAgICAgICAgICAgICAgICAgICAgcHAuYXBwZW5kKFt4LHldKQogICAgICAgICAgICAgICAgICBlbHNlOiAgICAjIGJwbW4gZXZlbnQKICAgICAgICAgICAgICAgICAgICAgICAgaWRzPWl0LmF0dHJpYlsiaWQiXS5zcGxpdCgiXyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlkPWlkc1sxXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oaWRzKT40OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgYmFzZTY0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkc1s0XT1iYXNlNjQuYjE2ZGVjb2RlKGlkc1s0XSwnYXNjaWknKS5kZWNvZGUoJ2FzY2lpJykKICAgICAgICAgICAgICAgICAgICAgICAgaWQyPSJfIi5qb2luKGlkc1syOl0pLnJlcGxhY2UoJzwnLCcmbHQ7JykucmVwbGFjZSgnPicsJyZndDsnKQogICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoeC02KSsnIiB5PSInK3N0cih5K2grMTIpKyciPicraWQrJzwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNjb21tZW50czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IGZvbnQtc2l6ZT0ic21hbGxlciIgc3R5bGU9ImZpbGw6Z3JheSIgeD0iJytzdHIoeC0xMikrJyIgeT0iJytzdHIoeS02KSsnIj48dHNwYW4geG1sOnNwYWNlPSJwcmVzZXJ2ZSI+JytuYW1lKyc8L3RzcGFuPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWQzPWlkMi5zcGxpdCgiXyIpCiAgICAgICAgICAgICAgICAgICAgICAgICNpZiBsZW4oaWQzKT4zIGFuZCBpZDNbM10gIT0gIk5vbmUiIDogcys9Jzx0ZXh0IGNsYXNzPSJ0MSIgZm9udC1zaXplPSJzbWFsbGVyIiBzdHlsZT0iZmlsbDpncmF5IiB4PSInK3N0cih4KzE4KSsnIiB5PSInK3N0cih5K2grMTIrKCJFdmVudCIgaW4gaXQuYXR0cmliWyJpZCJdIGFuZCAxMiBvciAwKSkrJyI+PHRzcGFuIHhtbDpzcGFjZT0icHJlc2VydmUiPicraWQzWzNdKyc8L3RzcGFuPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNzY3JpcHRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDNhPSJfIi5qb2luKGlkc1syOl0pLnNwbGl0KCJfIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGlkM2EpPjMgYW5kIGlkM2FbM10gIT0gIk5vbmUiOiBzKz0nPHRleHQgY2xhc3M9InQxIiBmb250LXNpemU9InNtYWxsZXIiIHN0eWxlPSJmaWxsOmdyYXkiIHg9Iicrc3RyKHgrMTgpKyciIHk9Iicrc3RyKHkraCsxMikrJyI+PHRzcGFuIHhtbDpzcGFjZT0icHJlc2VydmUiPicraWQzYVszXS5zcGxpdCgnOycpWzBdLnJlcGxhY2UoJzwnLCcmbHQ7JykucmVwbGFjZSgnPicsJyZndDsnKSsnPC90c3Bhbj48L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICJFdmVudCIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2UgPSAiZW5kIiBpbiBpdC5hdHRyaWJbImlkIl0gYW5kICIzIiBvciAiMSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSAiZW5kIiBpbiBpdC5hdHRyaWJbImlkIl0gYW5kICJyZWQiIG9yICJkYXJrZ3JlZW4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPGVsbGlwc2UgY3g9Iicrc3RyKHgrdy8yKSsnIiBjeT0iJytzdHIoeStoLzIpKyciIHJ4PSInK3N0cih3LzIpKyciIHJ5PSInK3N0cihoLzIpKyciIHN0cm9rZS13aWR0aD0iJytzdHJva2UrJyIgc3Ryb2tlPSInK2NvbG9yKyciIGZpbGwtb3BhY2l0eT0iMC42IiBmaWxsPSJ3aGl0ZSI+PHRpdGxlPicraWQyKyc8L3RpdGxlPjwvZWxsaXBzZT5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgImludGVybWVkaWF0ZSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxlbGxpcHNlIGN4PSInK3N0cih4K3cvMikrJyIgY3k9Iicrc3RyKHkraC8yKSsnIiByeD0iJytzdHIody8yLTMpKyciIHJ5PSInK3N0cihoLzItMykrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9ImRhcmtncmVlbiIgZmlsbD0id2hpdGUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIkNhdGNoIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJvbmRpdGlvbiIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxyZWN0IHg9IiVnIiB5PSIlZyIgd2lkdGg9IiVnIiBoZWlnaHQ9IiVnIiBzdHJva2U9ImJsYWNrIiBmaWxsPSJub25lIiAvPiclKHgrdy8yLTcseStoLzItOSx3LzItNCxoLzIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHBhdGggZD0iJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSg1KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICdNJWcgJWcgTCVnICVnICclKHgrdy8yLTUseStoLzItNiszKmkseCt3LzIrNSx5K2gvMi02KzMqaSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8ZWxsaXBzZSBjeD0iJytzdHIoeCt3LzIpKyciIGN5PSInK3N0cih5K2gvMikrJyIgcng9Iicrc3RyKHcvMi02KSsnIiByeT0iJytzdHIoaC8yLTYpKyciIHN0cm9rZS13aWR0aD0iJytzdHJva2UrJyIgc3Ryb2tlPSJibGFjayIgZmlsbD0id2hpdGUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cGF0aCBkPSJNJWcgJWcgTCVnICVnICVnICVnICclKHgrdy8yLTUseStoLzItMyx4K3cvMix5K2gvMix4K3cvMis2LHkraC8yLTYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEyKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBtYXRoIGltcG9ydCBzaW4sY29zLHBpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAiTSVnICVnIEwlZyAlZyAiJSh4K3cvMisody8yLTYpKmNvcyhpKjIqcGkvMTIpLHkraC8yKyhoLzItNikqc2luKGkqMipwaS8xMikseCt3LzIrKHcvMi05KSpjb3MoaSoyKnBpLzEyKSx5K2gvMisoaC8yLTkpKnNpbihpKjIqcGkvMTIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIi8+JyAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiZXJtaW5hdGUiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8ZWxsaXBzZSBjeD0iJytzdHIoeCt3LzIpKyciIGN5PSInK3N0cih5K2gvMikrJyIgcng9Iicrc3RyKHcvMi02KSsnIiByeT0iJytzdHIoaC8yLTYpKyciIHN0cm9rZS13aWR0aD0iJytzdHJva2UrJyIgc3Ryb2tlPSJyZWQiIGZpbGw9InJlZCIgZmlsbC1vcGFjaXR5PSIwLjYiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAiR2F0ZXdheSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICJvcmFuZ2UiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHBhdGggZD0iTSVnICVnIEwlZyAlZyBMJWcgJWcgTCVnICVnIFoiIHN0cm9rZT0iJXMiIGZpbGw9IndoaXRlIj48dGl0bGU+JXM8L3RpdGxlPjwvcGF0aD5cbiclKHgseStoLzIseCt3LzIseSx4K3cseStoLzIseCt3LzIseStoLGNvbG9yLGlkMikgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJleGNsdXNpdmUiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9JzxwYXRoIGQ9Ik0lZyAlZyBMJWcgJWcgTSVnICVnIEwlZyAlZyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIzIiAvPlxuJyUoeCt3LzItNix5K2gvMi02LHgrdy8yKzYseStoLzIrNix4K3cvMis2LHkraC8yLTYseCt3LzItNix5K2gvMis2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICJwYXJhbGxlbCIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHBhdGggZD0iTSVnICVnIEwlZyAlZyBNJWcgJWcgTCVnICVnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjMiIC8+XG4nJSh4K3cvMi04LHkraC8yLHgrdy8yKzgseStoLzIseCt3LzIseStoLzItOCx4K3cvMix5K2gvMis4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICJpbmNsdXNpdmUiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9JzxjaXJjbGUgY3g9IiVnIiBjeT0iJWciIHI9IjciIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIgLz5cbiclKHgrdy8yLHkraC8yKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxyZWN0IHJ4PSI3IiByeT0iNyIgeD0iJytzdHIoeCkrJyIgeT0iJytzdHIoeSkrJyIgd2lkdGg9Iicrc3RyKHcpKyciIGhlaWdodD0iJytzdHIoaCkrJyIgc3Ryb2tlPSJkYXJrYmx1ZSIgZmlsbD0id2hpdGUiPjx0aXRsZT4nK2lkMisnPC90aXRsZT48L3JlY3Q+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJzY3JpcHQiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoNCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0nPHBhdGggZD0iTSVnICVnIEwlZyAlZyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxIiAvPiclKHgrMTArMCppLHkrMTArNCppLHgrMjIrMCppLHkrMTArNCppKQogICAgICAgICAgICBpZiBsZW4ocHApPjA6ICMgczEhPScnOiAjIGFkZCB3aG9sZSBmbG93CiAgICAgICAgICAgICAgICAgIHMxPXN2Z19yb3VuZGVkUGF0aChwcCwxMikKICAgICAgICAgICAgICAgICAgcyArPSAnPHBhdGggbWFya2VyLWVuZD0idXJsKCN0cmlhbmdsZSkiIGQ9IicrczErJyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YnJvd247c3Ryb2tlLXdpZHRoOjEiLz5cbicKICAgICAgcyArPSAiPHNjcmlwdD5mdW5jdGlvbiBvbl9jbGljaygpIHtbLi4uZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndDEnKV0uZm9yRWFjaChlPT5lLnN0eWxlLmRpc3BsYXk9KGUuc3R5bGUuZGlzcGxheT09J25vbmUnPycnOidub25lJykpO308L3NjcmlwdD4iCiAgICAgIHMgPSAnPHN2ZyBvbmNsaWNrPSJvbl9jbGljaygpIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIlZCIgaGVpZ2h0PSIlZCI+XG4nJShXKzQwKzYwLEgrMzApK3MKICAgICAgcmV0dXJuIHMgKyAodG9fYW5pbSgpIGlmIGlzYW5pbSBlbHNlICcnKSArICc8L3N2Zz5cbicKZGVmIHRvX2FuaW0oKToKICAgICAgI3JldHVybiBzCiAgICAgIGdsb2JhbCBFTgogICAgICBzID0gICc8ZGVmcz48ZmlsdGVyIHg9IjAiIHk9IjAiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGlkPSJmaSI+XG4nCiAgICAgIHMgKz0gJzxmZUZsb29kIGZsb29kLWNvbG9yPSJ3aGl0ZSIvPlxuJwogICAgICBzICs9ICc8ZmVDb21wb3NpdGUgaW49IlNvdXJjZUdyYXBoaWMiIG9wZXJhdG9yPSJhdG9wIi8+PC9maWx0ZXI+PC9kZWZzPlxuJwogICAgICBmb3IgZSBpbiBFTi5lZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLEVuZCk6CiAgICAgICAgICAgICAgICAgIGZvciBjIGluIGUucXVldWUub2JqZWN0czoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKEVOLmVlKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgsIHksIGEgPSBFTi5lZVtpXS54LCBFTi5lZVtpXS55LCBjLmF0dHIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0nPHRleHQgY2xhc3M9InQxIiBmaWx0ZXI9InVybCgjZmkpIiBzdHlsZT0iZm9udC1zaXplOnNtYWxsO2ZpbGw6cmVkIiB4PSInK3N0cih4LTIwKSsnIiB5PSInK3N0cih5KzEzKSsnIiB2aXNpYmlsaXR5PSJoaWRkZW4iPicrc3RyKGMubmFtZSkrJ1xuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0PSJfX3QiK3N0cihpKzEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQrImEiIGluIGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQwID0gYVt0KyJhIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAnPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0idmlzaWJpbGl0eSIgZnJvbT0iaGlkZGVuIiB0bz0idmlzaWJsZSIgYmVnaW49Iicrc3RyKHQwKSsncyIgZHVyPSIwLjAxcyIgZmlsbD0iZnJlZXplIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQrImIiIGluIGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gYVt0KyJiIl0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gJzxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9IngiIHRvPSInK3N0cih4KzM4KSsnIiBiZWdpbj0iJytzdHIodDEpKydzIiBkdXI9IjAuNXMiIGZpbGw9ImZyZWV6ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0KyJlIiBpbiBhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IGFbdCsiZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gJzxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InZpc2liaWxpdHkiIGZyb209InZpc2libGUiIHRvPSJoaWRkZW4iIGJlZ2luPSInK3N0cih0MikrJ3MiIGR1cj0iMC4wMXMiIGZpbGw9ImZyZWV6ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9JzwvdGV4dD5cbicKICAgICAgcmV0dXJuIHMKRU49W10KIyAtLS0tIHNpbXVsYXRpb24gLS0tLS0KZGVmIG1haW5fZnVuKGV4bixuLGFuaW0sY29tbWVudHMsc2NyaXB0cyk6ICMgc3RyaW5nIHJlcHJlc2VudGF0aW9uLCBudW1iZXIgb2Ygc2ltdWxhdGlvbgogICAgICBkYXRhPVtdICAjIGxpc3Qgb2YgZXZlbnRzLCBhcnJheSBvZiByZXN1bHRzCiAgICAgIHMgPSAnJwogICAgICBmb3IgaSBpbiByYW5nZShuKToKICAgICAgICAgICAgZ2xvYmFsIEVOCiAgICAgICAgICAgIEVOID0gRXZlbnROZXR3b3JrKGV4bikKICAgICAgICAgICAgc2ltID0gU2ltdWxhdG9yKCkKICAgICAgICAgICAgZm9yIGUgaW4gRU46CiAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZSxHZW5lcmF0b3IpOiAgIyBhZGQgZ2VuZXJhdGluZyBldmVudHMKICAgICAgICAgICAgICAgICAgICAgICAgc2ltLmFkZChlKSAgCiAgICAgICAgICAgIHNpbS5ydW4oKQogICAgICAgICAgICBkYXRhLmFwcGVuZChbc2ltLnRpbWUsQnBtbkV2ZW50LlNdKSAgICMgc2F2ZSBlbmQgdGltZSBvZiBzaW11bGF0aW9uCiAgICAgICAgICAgIAogICAgICAgICAgICAjaWYgZXhuPT1leDU6CiAgICAgICAgICAgICMgICAgICBkYXRhLmFwcGVuZChCcG1uRXZlbnQuU1siUy5iQSJdKSAjIHNhdmUgZ2xvYmFsIHZhcmlhYmxlIFMuYkEKICAgICAgICAgICAgI2Vsc2U6CiAgICAgICAgICAgICMgICAgICBkYXRhLmFwcGVuZChzaW0udGltZSkgICAjIHNhdmUgZW5kIHRpbWUgb2Ygc2ltdWxhdGlvbgogICAgICAgICAgICBpZiBpPT0wOgogICAgICAgICAgICAgICAgICBzMSA9IHRvX2JwbW4oRU4uZWUsRU4ucHApCiAgICAgICAgICAgICAgICAgIHMyID0gYnBtbl90b3N2ZyhzMSxhbmltLGNvbW1lbnRzLHNjcmlwdHMpCiAgICAgICAgICAgICAgICAgIHMzID0gdG9fc3ZnKCkKICAgICAgcyArPSAiI25cdHRcdCIrIlx0Ii5qb2luKGRhdGFbMF1bMV0ua2V5cygpKSsiXG4iCiAgICAgIHMgKz0gIlxuIi5qb2luKFsiJWRcdCUuMmZcdCVzIiUoaSsxLGRhdGFbaV1bMF0sIlx0Ii5qb2luKFtzdHIodikgZm9yIHYgaW4gWypkYXRhW2ldWzFdLnZhbHVlcygpXV0pKSBmb3IgaSBpbiByYW5nZShsZW4oZGF0YSkpXSkKICAgICAgI2ZvciBlIGluIG5lOgogICAgICAjICAgICAgaWYgbGVuKGUucXVldWUpPjA6CiAgICAgICMgICAgICAgICAgICBzICs9IHN0cihlLmlkKSArICgiKCVkKToiJWxlbihlLnF1ZXVlKSkgKyBzdHIoZS5xdWV1ZSkrJ1xuJwogICAgICAjcyArPSBzdHIoc3VtKGRhdGEpL2xlbihkYXRhKSkrJ1xuJwogICAgICAjcyArPSBzdHIoQnBtbkV2ZW50LlMpKydcbicKICAgICAgI2ZvciBlIGluIG5lOgogICAgICAjICAgICAgcyArPSBzdHIoZS5pZCkrc3RyKGUuQSkrJyAnCiAgICAgICMgICAgICBpZiBpc2luc3RhbmNlKGUsVGFzayk6CiAgICAgICMgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZS5zZXJ2ZXJzKSk6CiAgICAgICMgICAgICAgICAgICAgICAgICBzICs9IHN0cihlLnNlcnZlcnNbaV0uaWQpKycvJytzdHIoaSsxKStzdHIoZS5zZXJ2ZXJzW2ldLkEpKycgJwogICAgICBzND0nJwogICAgICBpZiBsZW4oZGF0YSk+PTEwMDoKICAgICAgICAgICAgI2lmIGV4bj09ZXg0OgogICAgICAgICAgICAjICAgICAgczQgPSBoaXN0KGRhdGEsNykKICAgICAgICAgICAgI2Vsc2U6CiAgICAgICAgICAgICMgICAgICBzNCA9IGhpc3QoZGF0YSkKICAgICAgICAgICAgcGFzcyAjIHM0ID0gaGlzdChkYXRhKQogICAgICByZXR1cm4gKHMsczEsczIsczMsczQpICMgczIrJzxicj5cbicrKHMzIGlmIG49PTEgZWxzZSAnJykrJzxicj5cbicrJzxwcmU+JytzKyc8L3ByZT4nCgoiIiIKaWYgX19uYW1lX189PSJfX21haW5fXyI6CiAgICAgIGltcG9ydCBzeXMKICAgICAgI2ltcG9ydCBleAogICAgICAjZXgzMCA9ICcxIFN0YXJ0KClcbjIgVGFzaygpXG4zIEVuZCgpXG4xLT4yLT4zXG4nCiAgICAgIHMgPSBsZW4oc3lzLmFyZ3YpPjEgYW5kIGZyb21fZmlsZShzeXMuYXJndlsxXSkgb3IgZXZhbCgnZXglZCclKDMwKSkKICAgICAgbiA9IGxlbihzeXMuYXJndik+MiBhbmQgaW50KHN5cy5hcmd2WzJdKSBvciAxCiAgICAgIGFuaW0gPSAxCiAgICAgIGNvbW1lbnRzID0gMQogICAgICBzY3JpcHRzID0gMQogICAgICBvdXRwdXQgPSBtYWluX2Z1bihzLG4sYW5pbSxjb21tZW50cyxzY3JpcHRzKQogICAgICBwcmludChFTikKICAgICAgI3ByaW50KG91dHB1dFsyXSkgICAgICAKICAgICAgI3ByaW50KG91dHB1dFszXSkKICAgICAgcHJpbnQoJzxwcmU+JyxvdXRwdXRbMF0sJzwvcHJlPicpCiIiIgpzID0gaW5wdXRbMF0KbiA9IGludChpbnB1dFsxXSkKYW5pbSA9IGludChpbnB1dFsyXSkKY29tbWVudHMgPSBpbnQoaW5wdXRbM10pCnNjcmlwdHMgPSBpbnQoaW5wdXRbNF0pCm91dHB1dCA9IG1haW5fZnVuKHMsIG4sIGFuaW0sIGNvbW1lbnRzLCBzY3JpcHRzKQpzID0gJycKI3MgKz0gJzxkaXYgaWQ9ImRpdjEiIGhpZGRlbj4nK291dHB1dFsxXSsnPC9kaXY+PGJyPlxuJwpzICs9ICc8ZGl2IGlkPSJkaXYyIiB0YWJpbmRleD0iLTEiPicrb3V0cHV0WzJdKyc8L2Rpdj48YnI+XG4nCiNzICs9JzxpbnB1dCB0eXBlPWJ1dHRvbiB2YWx1ZT0iU2F2ZSBicG1uIHRvIHhtbCBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGUxKCk7Ij48L2lucHV0PlxuJwpzICs9JzxpbnB1dCB0eXBlPWJ1dHRvbiB2YWx1ZT0iU2F2ZSBicG1uIHRvIHN2ZyBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGUyKCk7Ij48L2lucHV0PlxuJwpzICs9JzxpbnB1dCB0eXBlPWJ1dHRvbiB2YWx1ZT0iU2F2ZSBicG1uIHRvIHhtbCBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGU1KCk7Ij48L2lucHV0Pjxicj48YnI+XG4nCmlmIG49PTE6CiAgICAgIHMgKz0gJzxkaXYgaWQ9ImRpdjMiPicrb3V0cHV0WzNdICsnPC9kaXY+PGJyPlxuJwogICAgICBzICs9JzxpbnB1dCB0eXBlPWJ1dHRvbiB2YWx1ZT0iU2F2ZSB0aW1lbGluZSB0byBzdmcgZmlsZSIgb25jbGljaz0id3JpdGVGaWxlMygpOyI+PC9pbnB1dD48YnI+PGJyPlxuJwpzICs9Jzx0ZXh0YXJlYSBpZD0idGE0IiByb3dzPSIxMCIgY29scz0iODAiPicrb3V0cHV0WzBdKyc8L3RleHRhcmVhPjxicj5cbicgIysnPGltZyBzcmM9Iicrb3V0cHV0WzNdKyciPicKcyArPSc8aW5wdXQgdHlwZT1idXR0b24gdmFsdWU9IlNhdmUgcmVzdWx0cyB0byB0eHQgZmlsZSIgb25jbGljaz0id3JpdGVGaWxlNCgpOyI+PC9pbnB1dD48YnI+PGJyPlxuJwpzICs9Jzx0ZXh0YXJlYSBoaWRkZW4gaWQ9InRhNSIgcm93cz0iMTAiIGNvbHM9IjgwIj4nK291dHB1dFsxXSsnPC90ZXh0YXJlYT48YnI+XG4nICMrJzxpbWcgc3JjPSInK291dHB1dFszXSsnIj4nCnMKCgoK";