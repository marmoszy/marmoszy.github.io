var pycode="IyBtbS1kZXMgLSBkaXNjcmV0ZSBldmVudCBzaW11bGF0b3IKIyAtIGJhc2UgZXZlbnRzOiBHZW5lcmF0b3IsU2VydmljZSxTaW5rLENvbmRpdGlvbmFsRXZlbnQKIyAtIGJwbW4gZXZlbnRzOiBTdGFydCxUYXNrLEVuZCxUaW1lcixYb3JHYXRlLEFuZEdhdGUsQ29uZGl0aW9uLFRlcm1pbmF0ZQojIE1NIDMxLjEuMjAyNCwgMTMuOS4yMDI1IChhZG9wdGVkIGZvciBweW9kaWRlIGluIGpzKQoKIyAtLS0tIHNpbXVsYXRpb24gb24gYW4gYWJzdHJhY3QgZXZlbnQgLS0tLQpjbGFzcyBFdmVudCgpOgogICAgICBjbnQgPSAwICAgICAgICAgICAgICAgICAgICAgICAgICMgdXNlZCBmb3IgZXZlbnQgaWRlbnRpZmllcgogICAgICBkZWYgX19pbml0X18oc2VsZiwgdGltZSwgbmFtZT1Ob25lKToKICAgICAgICAgICAgc2VsZi50aW1lID0gdGltZTsKICAgICAgICAgICAgRXZlbnQuY250ICs9IDEKICAgICAgICAgICAgc2VsZi5pZCA9IEV2ZW50LmNudAogICAgICAgICAgICBzZWxmLm5hbWUgPSAoKG5hbWU9PU5vbmUpIGFuZCAiRXZlbnQiIG9yIG5hbWUpICsgIl8iK3N0cihzZWxmLmlkKQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOiBwYXNzICAgICAgIyBhYnN0cmFjdCAKICAgICAgZGVmIF9fc3RyX18oc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLm5hbWUrICIgIisgc3RyKHNlbGYuaWQpICsiICIrc3RyKHNlbGYudGltZSkKY2xhc3MgU2ltdWxhdG9yKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAgICAgc2VsZi50aW1lID0gMAogICAgICAgICAgICBzZWxmLmV2ZW50cyA9IFtdCiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucyA9IFtdCiAgICAgIGRlZiBub3coc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnRpbWUKICAgICAgZGVmIGFkZChzZWxmLGUpOgogICAgICAgICAgICBzZWxmLmV2ZW50cy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBhZGRfY29uZGl0aW9uKHNlbGYsZSk6CiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgICAgIHdoaWxlIHNlbGYuZXZlbnRzOgogICAgICAgICAgICAgICAgICBlID0gbWluKHNlbGYuZXZlbnRzLCBrZXk9bGFtYmRhIGU6IGUudGltZSkKICAgICAgICAgICAgICAgICAgc2VsZi5ldmVudHMucmVtb3ZlKGUpCiAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IGUudGltZSAgICAgICAgICMgdXBkYXRlIHNpbXVsYXRvciB0aW1lCiAgICAgICAgICAgICAgICAgIGUuZXhlYyhzZWxmKQogICAgICAgICAgICAgICAgICBmb3IgYyBpbiBzZWxmLmNvbmRpdGlvbnM6ICAjIHRlc3QgY29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICBpZiBjLmV4ZWMoc2VsZik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5yZW1vdmUoYykKIyAtLS0tIHV0aWxzIC0tLS0KaW1wb3J0IG1hdGgscmFuZG9tCmRlZiBfcHJpbnQocyk6ICAgICAgICAgICAgICAgICMgb3duIHByaW50CiAgICAgICNwcmludChzKSAgICAgICAgICAgICAgICMgY29tbWVudCBpZiBubyB2ZXJib3VzIHByaW50aW5nCiAgICAgIHBhc3MKZGVmIEUobWVhbj1bMS4wXSk6ICAgICAgICAgICAgIyBleHBvbmVudGlhbCByYW5kb20gZ2VuZXJhdG9yCiAgICAgICMgLW1lYW5bMF0qbWF0aC5sb2cocmFuZG9tLnJhbmRvbSgpKQogICAgICByZXR1cm4gcmFuZG9tLmV4cG92YXJpYXRlKDEvbWVhblswXSkgCmRlZiBVKG1pbm1heD1bMS4wXSk6ICAgICAgICAgICMgdW5pZm9ybSByYW5kb20gZ2VuZXJhdG9yCiAgICAgIHJldHVybiByYW5kb20udW5pZm9ybShtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXSkKZGVmIE4obWVhbnN0ZD1bMy4wXSk6ICAgICAgICAjIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgcmV0dXJuIHJhbmRvbS5ub3JtYWx2YXJpYXRlKG1lYW5zdGRbMF0sbGVuKG1lYW5zdGQpPjEgYW5kIG1lYW5zdGRbMV0gb3IgMS4wKQpkZWYgQihwPTAuNSk6ICAgICAgICAgICAgICAgICMgYmlub21pYWwgKDAsMSkKICAgICAgcmV0dXJuIHJhbmRvbS5yYW5kb20oKTxwCmRlZiBDKHA9WzEsMSwxXSk6ICAgICAgICAgICAgIyBjaG9pY2UgKDAsMSwyLC4uLikKICAgICAgcmV0dXJuIHJhbmRvbS5jaG9pY2VzKGxpc3QocmFuZ2UobGVuKHApKSksd2VpZ2h0cz1wKVswXQpkZWYgVChtaW5tYXg9WzEuMF0pOiAgICAgICAgICAjIHNlbWkgdHJ1bmNhdGVkIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgbWksbWEgPSBtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXQogICAgICBtZWFuLHN0ZCA9IChtYSttaSkvMiwobWEtbWkpLzIKICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgeCA9IE4oW21lYW4sc3RkXSkKICAgICAgICAgICAgaWYgbWkgPD0geCA8PSBtYTogYnJlYWsKICAgICAgcmV0dXJuIHgKCiMgLS0tLSBwcmltaXRpdmUgY2xhc3NlcyAtLS0tCmNsYXNzIEN1c3RvbWVyKCk6ICAgICMgYW5vbnltb3VzIGN1c3RvbWVyIHdpdGggYSBhdXRvbWF0aWMgbmFtZQogICAgICBjbnQgPSAwICAgICAgICAjIGNvdW50ZXIgY2xhc3MgdmFyaWFibGUgZm9yIGN1c3RvbWVyIG5hbWUKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBDdXN0b21lci5jbnQgKz0gMQogICAgICAgICAgICBzZWxmLm5hbWUgPSBzdHIoQ3VzdG9tZXIuY250KQogICAgICAgICAgICBzZWxmLmF0dHIgPSB7ImNuYW1lIjpzZWxmLm5hbWV9ICMgQ3VzdG9tZXIgYXR0cmlidXRlcwogICAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIHN0cihzZWxmLm5hbWUpCmNsYXNzIFF1ZXVlKCk6ICAgICAgICMgZmlmbyBvZiBjdXN0b21lcnMKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBzZWxmLm9iamVjdHMgPSBbXQogICAgICBkZWYgcHVzaChzZWxmLG9iaik6CiAgICAgICAgICAgIHNlbGYub2JqZWN0cy5hcHBlbmQob2JqKQogICAgICBkZWYgcG9wKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5vYmplY3RzLnBvcCgwKQogICAgICBkZWYgX19sZW5fXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIGxlbihzZWxmLm9iamVjdHMpCiAgICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc3RyKFtzdHIobykgZm9yIG8gaW4gc2VsZi5vYmplY3RzXSkKY2xhc3MgUXVldWVkRXZlbnQoRXZlbnQpOgogICAgICBpbnN0YW5jZXM9W10KICAgICAgZGVmIF9faW5pdF9fKHNlbGYsbmFtZT1Ob25lKToKICAgICAgICAgICAgRXZlbnQuX19pbml0X18oc2VsZiwwLjAsbmFtZSkgICMgcHJlaW5pdCB0aW1lCiAgICAgICAgICAgIHNlbGYucXVldWUgPSBRdWV1ZSgpICAgICAgIyBvd24gcXVldWUKICAgICAgICAgICAgc2VsZi5vdXRwdXQgPSBbXSAgICAgICAgICAjIG5vIGNvbm5lY3RlZCBvYmplY3RzCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICAgIyBub25lIGJlaW5nIHNlcnZlZAogICAgICAgICAgICBRdWV1ZWRFdmVudC5pbnN0YW5jZXMuYXBwZW5kKHNlbGYpCiAgICAgIGRlZiBzZXROYW1lKHNlbGYsbmFtZSk6CiAgICAgICAgICAgIHNlbGYubmFtZT1uYW1lKyJfIitzZWxmLm5hbWUuc3BsaXQoIl8iKVsxXSAjLnJlcGxhY2UoIkV2ZW50IixuYW1lKS5yZXBsYWNlKCJBY3Rpdml0eSIsbmFtZSkKICAgICAgZGVmIG91dChzZWxmLHNpbSk6ICAgICAgICAgICAgICAjIHBhc3MgdG8gY29ubmVjdGVkIG9iamVjdHMKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4wIGFuZCBpc2luc3RhbmNlKHNlbGYsWG9yR2F0ZSk6ICAKICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID0gMSAgIyBzZW5kIHRvIHNlY29uZCBvdXRwdXQKICAgICAgICAgICAgICAgICAgICAgICAgI2lmIHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgidmFsdWUiIGluIHNlbGYuY3VzdG9tZXIuYXR0ciBhbmQgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdKSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeD0wICMgc2VuZCByYXRoZXIgdG8gZmlyc3Qgb3V0cHV0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLm91dHB1dCk+MjogICMgbW9yZSB0aGFuIDIgb3V0cHV0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHg9aW50KHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRwdXRbaWR4XS5pbnNlcnQoc2VsZi5jdXN0b21lciwgc2ltKQogICAgICAgICAgICAgICAgICBlbGlmIGxlbihzZWxmLm91dHB1dCk+MSBhbmQgaXNpbnN0YW5jZShzZWxmLE9yR2F0ZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIE4gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihzZWxmLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpbnQoc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdW2ldKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTiArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0cHV0W2ldLmluc2VydChzZWxmLmN1c3RvbWVyLCBzaW0pCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuTiA9IE4KICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHNlbGYub3V0cHV0KSk6ICAjIHNwbGl0IHRvIGFsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm91dHB1dFtpXS5pbnNlcnQoc2VsZi5jdXN0b21lcixzaW0pCiAgICAgIGRlZiBwcmV2KHNlbGYpOgogICAgICAgICAgICBlcD1bXQogICAgICAgICAgICBmb3IgZTAgaW4gZmlsdGVyKE5vbmUsUXVldWVkRXZlbnQuaW5zdGFuY2VzKToKICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGUwLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBlMC5vdXRwdXRbaV09PXNlbGY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVwLmFwcGVuZChlMCkKICAgICAgICAgICAgI3ByaW50KCJwcmV2OiIsc3RyKGVwKSkKICAgICAgICAgICAgcmV0dXJuIGVwCgojIC0tLS0gYmFzaWMgbW9kZWwgY2xhc3NlcyAoUXVldWVFdmVudCBkZXJpdmVkKSAtLS0tCmNsYXNzIEJwbW5FdmVudChRdWV1ZWRFdmVudCk6CiAgICAgIFMgPSB7fQogICAgICBkZWYgX19pbml0X18oc2VsZixuYW1lPU5vbmUsY29kZT1Ob25lKToKICAgICAgICAgICAgUXVldWVkRXZlbnQuX19pbml0X18oc2VsZixuYW1lKQogICAgICAgICAgICBzZWxmLmZ1bixzZWxmLnBhcmFtLHNlbGYuY29kZSA9IE5vbmUsTm9uZSxjb2RlCiAgICAgICAgICAgIHNlbGYuQSxzZWxmLnBwLHNlbGYucHAyLHNlbGYudGl0bGUgPSB7IkEubiI6MH0sWy0xLDBdLFstMSwtMV0sJycKICAgICAgZGVmIF9mdW4oc2VsZik6CiAgICAgICAgICAgIHAgPSBzZWxmLnBhcmFtCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocCxsaXN0KToKICAgICAgICAgICAgICAgICAgcCA9IFtmbG9hdChldmFsKHNlbGYuYXR0cl9yZXBsYWNlKHN0cihzKSkpKSBmb3IgcyBpbiBwXQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICBwID0gZmxvYXQoZXZhbChzZWxmLmF0dHJfcmVwbGFjZShzdHIocCkpKSkKICAgICAgICAgICAgI3ByaW50KCJfZnVuOiIsc2VsZi5mdW4scCxsZW4oc2VsZi5xdWV1ZSkpCiAgICAgICAgICAgIHJldHVybiBzZWxmLmZ1bihwKSBpZiBzZWxmLmZ1biE9Tm9uZSBlbHNlIHAKICAgICAgZGVmIGF0dHJfcmVwbGFjZShzZWxmLGNjKToKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgZm9yIGssdiBpbiBzZWxmLmN1c3RvbWVyLmF0dHIuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgY2MgPSBjYy5yZXBsYWNlKGssc3RyKHYpKQogICAgICAgICAgICBmb3Igayx2IGluIEJwbW5FdmVudC5TLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgIGNjID0gY2MucmVwbGFjZShrLHN0cih2KSkKICAgICAgICAgICAgZm9yIGssdiBpbiBzZWxmLkEuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgY2MgPSBjYy5yZXBsYWNlKGssc3RyKHYpKQogICAgICAgICAgICByZXR1cm4gY2MKICAgICAgZGVmIF9ldmFsKHNlbGYsY29kZSxuPS0xKToKICAgICAgICAgICAgY29kZXM9c2VsZi5jb2RlLnNwbGl0KCI7IikKICAgICAgICAgICAgaWYgbiE9LTE6CiAgICAgICAgICAgICAgICAgIGNvZGVzPWxlbihjb2Rlcyk+biBhbmQgW2NvZGVzW25dXSBvciBbXQogICAgICAgICAgICBmb3IgY29kZSBpbiBjb2RlczoKICAgICAgICAgICAgICAgICAgY2MgPSBjb2RlLnNwbGl0KCI9IikKICAgICAgICAgICAgICAgICAgY2NbMF0gPSBjY1swXS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgIGlmIGxlbihjYyk9PTE6CiAgICAgICAgICAgICAgICAgICAgICAgIGNjPVsiZHVtbXkiXStjYwogICAgICAgICAgICAgICAgICBpZiBsZW4oY2MpPjE6CiAgICAgICAgICAgICAgICAgICAgICAgIGNjWzBdID0gbGVuKGNjWzBdKT4wIGFuZCBjY1swXSBvciAidmFsdWUiCiAgICAgICAgICAgICAgICAgICAgICAgIGNjWzFdID0gc2VsZi5hdHRyX3JlcGxhY2UoIj0iLmpvaW4oY2NbMTpdKSkgIyByZWpvaW4KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldj1ldmFsKGNjWzFdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjY1swXS5zdGFydHN3aXRoKCJTLiIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCcG1uRXZlbnQuU1tjY1swXV09ZXYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBjY1swXS5zdGFydHN3aXRoKCJBLiIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLkVbY2NbMF1dPWV2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0cltjY1swXV09ZXYKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbY2NbMF1dPUZhbHNlCmNsYXNzIENvbmRpdGlvbmFsRXZlbnQoQnBtbkV2ZW50KToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIEJwbW5FdmVudC5fX2luaXRfXyhzZWxmLCBOb25lLCBjb2RlKQogICAgICBkZWYgaW5zZXJ0KHNlbGYsIGN1c3QsIHNpbSk6CiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImEiXSA9IHNpbS5ub3coKQogICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl0gPSAtMQogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyID09IE5vbmUgOiAjIGlmIGZyZWUgYWRkIHRvIHNpbXVsYXRvciBjb25kaXRpb25zCiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBjdXN0CiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXT1GYWxzZQogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJiIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgICAgICAgc2ltLmFkZF9jb25kaXRpb24oc2VsZikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgc2VsZi5xdWV1ZS5wdXNoKGN1c3QpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgIGRlZiBleGVjKHNlbGYsIHNpbSk6CiAgICAgICAgICAgIGIgPSBGYWxzZQogICAgICAgICAgICBpZiBzZWxmLmNvZGUhPU5vbmU6CiAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoc2VsZi5jb2RlLDApCiAgICAgICAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXT09VHJ1ZToKICAgICAgICAgICAgICAgICAgICAgICAgY2M9c2VsZi5jb2RlLnNwbGl0KCc7JykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGNjKT4xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9ldmFsKCI7Ii5qb2luKGNjWzE6XSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IHNpbS5ub3coKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm91dChzaW0pCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICMgbWFyayB0aGF0IG5vdyB0aGUgc2VydmljZSBpcyBmcmVlICEhIQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oc2VsZi5xdWV1ZSk+MCA6ICAjIGJ1dCBpZiBhbnlib2R5IGluIHF1ZXVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaW5zZXJ0KHNlbGYucXVldWUucG9wKCksIHNpbSkgICMgZ2V0IGFuZCBpbnNlcnQgaW50byBzaW11bGF0b3IKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IFRydWUgICMgcmVhZHkgdG8gYmUgcmVtb3ZlZCBmcm9tIHNpbXVsYXRvciBjb25kaXRpb25zCiAgICAgICAgICAgIHJldHVybiBiCmNsYXNzIEdlbmVyYXRvcihCcG1uRXZlbnQpOgogICAgICBkZWYgX19pbml0X18oc2VsZiwgZnVuLCBwYXJhbSwgdG1heD0wLjAsIGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIEJwbW5FdmVudC5fX2luaXRfXyhzZWxmLCBOb25lLCBjb2RlKQogICAgICAgICAgICBzZWxmLmZ1biwgc2VsZi5wYXJhbSwgc2VsZi50bWF4LCBzZWxmLm4gPSBmdW4sIHBhcmFtLCB0bWF4LCAwCiAgICAgICAgICAgIGlmIHNlbGYuY29kZSE9Tm9uZSA6CiAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoc2VsZi5jb2RlKSAgICMgZXZhbHVhdGUgc2NyaXB0IGNvZGUgKFt2YXJdPTx2YWx1ZT4pCiAgICAgIGRlZiBleGVjKHNlbGYsIHNpbSk6CiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBDdXN0b21lcigpCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImEiXSA9IHNpbS5ub3coKQogICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJiIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiZSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIHNlbGYuQVsiQS5uIl0gKz0gMQogICAgICAgICAgICBfcHJpbnQoIlJlZ2lzdGVyaW5nOiAiICsgc3RyKHNlbGYuY3VzdG9tZXIpICsgIiAoIitzdHIoc2VsZi50aW1lKSsiKSIpCiAgICAgICAgICAgIHNlbGYub3V0KHNpbSkgICAgICAgICAgICAgIyBwYXNzIGN1c3RvbWVyIHRvIGNvbm5lY3RlZCBvYmplY3QKICAgICAgICAgICAgc2VsZi50aW1lICs9IHNlbGYuX2Z1bigpCiAgICAgICAgICAgIGlmIHNlbGYudG1heD4wIGFuZCBzZWxmLnRpbWUgPD0gc2VsZi50bWF4IG9yIHNlbGYubjwtc2VsZi50bWF4LTE6CiAgICAgICAgICAgICAgICAgIHNlbGYubiArPSAxCiAgICAgICAgICAgICAgICAgIHNpbS5hZGQoc2VsZikgICAgICAgIyBuZXh0IG9uZSBpbiByYW5kb20gdGltZQpjbGFzcyBTZXJ2aWNlKEJwbW5FdmVudCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmdW4sIHBhcmFtLCBjb2RlPU5vbmUpOiAKICAgICAgICAgICAgQnBtbkV2ZW50Ll9faW5pdF9fKHNlbGYsIkFjdGl2aXR5Iixjb2RlKSAgCiAgICAgICAgICAgIHNlbGYuZnVuLCBzZWxmLnBhcmFtID0gZnVuLCBwYXJhbSAKICAgICAgICAgICAgc2VsZi5OID0gMSAjIE4gbnVtYmVyIG9mIHRva2VucyB0byB3YWl0ICh1c2VkIGZvciBBbmRHYXRlLE9yR2F0ZSkKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNlbGYsWG9yR2F0ZSk6CiAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLm91dHB1dCk+MSBhbmQgc2VsZi5jb2RlPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNvZGU9Ij1CKDAuNSkiCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShzZWxmLE9yR2F0ZSk6CiAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLm91dHB1dCk+MSBhbmQgc2VsZi5jb2RlPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNvZGU9Ij1bMSwiKyIsIi5qb2luKFsnMCddKihsZW4oc2VsZi5vdXRwdXQpLTEpKSsiXSIKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciA9PSBOb25lOiAjIGlmIGZyZWUgYWRkIHRvIHNpbXVsYXRvciB3aXRoIGVuZCB0aW1lCiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIsdCA9IGN1c3Qsc2VsZi5fZnVuKCkKICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh0LGxpc3QpOiAgIyBbY3ljbGUsYmVnaW49MF0gY3ljbGljIHRpbWVyIChNTSAxLjExLjIwMjQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbih0KTwyOiB0LmFwcGVuZCgwKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWUgPSB0WzFdK21hdGguY2VpbCgoc2ltLm5vdygpLXRbMV0pL3RbMF0pKnRbMF0KICAgICAgICAgICAgICAgICAgICAgICAgI19wcmludCgiIyAiK3N0cihzZWxmLmN1c3RvbWVyKSsiOiAiK3N0cihzaW0ubm93KCkpKyIgIitzdHIoc2VsZi50aW1lKSkKICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lID0gc2ltLm5vdygpICsgdAogICAgICAgICAgICAgICAgICBfcHJpbnQoIiMiK3N0cihzZWxmLmlkKSsiIHN0YXJ0cyBzZXJ2aW5nICIrCiAgICAgICAgICAgICAgICAgICAgICAgICBzdHIoY3VzdCkrIiAoIitzdHIoc2ltLm5vdygpKSsiLCIrc3RyKHNlbGYudGltZSkrIikiKQogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJiIl09c2ltLm5vdygpCiAgICAgICAgICAgICAgICAgIGlmICJfX24iK3N0cihzZWxmLmlkKSBub3QgaW4gc2VsZi5jdXN0b21lci5hdHRyOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fbiIrc3RyKHNlbGYuaWQpXSA9IDAgIyBmaXJzdCB0aW1lCiAgICAgICAgICAgICAgICAgIGlmICJfX3QiK3N0cihzZWxmLmlkKSsiYSIgbm90IGluIHNlbGYuY3VzdG9tZXIuYXR0cjoKICAgICAgICAgICAgICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdPXNpbS5ub3coKSAjIGlmIG5vdCBmcm9tIHF1ZXVlCiAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZixUaW1lcikgYW5kIG5vdCBpc2luc3RhbmNlKHQsbGlzdCk6ICAjIG1vZGlmeSByZXF1aXJlZCBmaW5hbCBleGVjdXRpb24gdGltZQogICAgICAgICAgICAgICAgICAgICAgICB0YT1jdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl0gIAogICAgICAgICAgICAgICAgICAgICAgICB0Yj1jdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJiIl0KICAgICAgICAgICAgICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdIC09ICh0Yi10YSkgIyBkZWNyZWFzZSBiZWdpbiB0aW1lCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZSAtPSAodGItdGEpICAjIC4uLiBieSB0aGUgZGlmZmVyZW5jZSBlbGFwc2VkIGFscmVhZHkKICAgICAgICAgICAgICAgICAgICAgICAgI19wcmludCgiIyAiK3N0cihzZWxmLmN1c3RvbWVyKSsiOiAiK3N0cihzZWxmLnRpbWUpKQogICAgICAgICAgICAgICAgICBzaW0uYWRkKHNlbGYpCiAgICAgICAgICAgIGVsc2U6ICAgICAgICAgICAgICAgICAgICAgIyBlbHNlIGluc2VydCBpbnRvIHF1ZXVlCiAgICAgICAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImEiXT1zaW0ubm93KCkgICMgd2l0aCBhIHF1ZXVlIGFkZGluZyB0aW1zdGFtcAogICAgICAgICAgICAgICAgICBzZWxmLnF1ZXVlLnB1c2goY3VzdCkKICAgICAgZGVmIGV4ZWMoc2VsZiwgc2ltKToKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiZSJdPXNpbS5ub3coKQogICAgICAgICAgICAgICAgICBzZWxmLkFbIkEubiJdICs9IDEKICAgICAgICAgICAgX3ByaW50KCIjIitzdHIoc2VsZi5pZCkrIiBmaW5pc2hlZCBzZXJ2aW5nICIgKyBzdHIoc2VsZi5jdXN0b21lcikgKyAiIGF0ICIgKyBzdHIoc2VsZi50aW1lKSkKICAgICAgICAgICAgaWYgc2VsZi5jb2RlIT1Ob25lIDogICAgICAKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUpICAgIyBldmFsdWF0ZSBzY3JpcHQgY29kZSAoW3Zhcl09PHZhbHVlPikKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX24iK3N0cihzZWxmLmlkKV0gKz0gMQogICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNlbGYsT3JHYXRlKSBhbmQgbGVuKHNlbGYub3V0cHV0KT09MToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5OID0gc2VsZi5jdXN0b21lci5OCiAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmN1c3RvbWVyLmF0dHJbIl9fbiIrc3RyKHNlbGYuaWQpXSVzZWxmLk4pID09IDA6ICNzZWxmLk46CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0KHNpbSkgICAgICMgcGFzcyBjdXN0b21lciB0byBjb25uZWN0ZWQgb2JqZWN0CiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICMgbWFyayB0aGF0IG5vdyB0aGUgc2VydmljZSBpcyBmcmVlICEhIQogICAgICAgICAgICBpZiBsZW4oc2VsZi5xdWV1ZSk+MCA6ICAjIGJ1dCBpZiBhbnlib2R5IGluIHF1ZXVlCiAgICAgICAgICAgICAgICAgIFNlcnZpY2UuaW5zZXJ0KHNlbGYsc2VsZi5xdWV1ZS5wb3AoKSwgc2ltKSAgIyBnZXQgYW5kIGluc2VydCBpbnRvIHNpbXVsYXRvcgpjbGFzcyBTaW5rKEJwbW5FdmVudCk6CiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKTogICAgCiAgICAgICAgICAgIF9wcmludCgiU2lua2luZyAiK3N0cihjdXN0KSsiIDogIitzdHIoc2ltLm5vdygpKSkKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpICAjIG1hcmsgdGltZSBpbiBjdXN0b21lciBhdHRyaWJ1dGVzCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKSAgIyBtYXJrIHRpbWUgaW4gY3VzdG9tZXIgYXR0cmlidXRlcwogICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl0gPSBzaW0ubm93KCkgICMgbWFyayB0aW1lIGluIGN1c3RvbWVyIGF0dHJpYnV0ZXMKICAgICAgICAgICAgc2VsZi5BWyJBLm4iXSArPSAxCiAgICAgICAgICAgIHNlbGYucXVldWUucHVzaChjdXN0KSAgICAgIyBpbnNlcnQgb25seSB0byBpdHMgcXVldWUKICAgICAgICAgICAgc2VsZi5jdXN0b21lcj1jdXN0CiAgICAgICAgICAgIGlmIHNlbGYuY29kZSE9Tm9uZSA6CiAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoc2VsZi5jb2RlKSAgICMgZXZhbHVhdGUgc2NyaXB0IGNvZGUKIyAtLS0tIGJwbW4gZGVyaXZlZCBjbGFzc2VzIChmcm9tIEdlbmVyYXRvciwgU2VydmljZSwgQ29uZGl0aW9uYWxFdmVudCBvciBTaW5rKSAtLS0tCmNsYXNzIFhvckdhdGUoU2VydmljZSk6ICAgICMgcmFuZG9tIG91dHB1dCBpZiB0d28gb3V0cHV0cyAKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKTogICMgZGVmYXVsdHMgdG8gYmluYXJ5IHJhbmRvbSBzZWxlY3Rpb24KICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImV4Y2x1c2l2ZUdhdGV3YXkiKQpjbGFzcyBPckdhdGUoU2VydmljZSk6ICAgICMgb3V0cHV0IGNvbmRpdGlvbiBtdXN0IGJlIGRlZmluZWQgYnkgYXJyYXkgb2YgdmFsdWVzISAKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImluY2x1c2l2ZUdhdGV3YXkiKQpjbGFzcyBBbmRHYXRlKFNlcnZpY2UpOiAgICAKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInBhcmFsbGVsR2F0ZXdheSIpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgaWRzPVtlLmlkIGZvciBlIGluIHNlbGYucHJldigpXSAjIGlkcyBvZiBpbnB1dHMKICAgICAgICAgICAgc2VsZi5OPWxlbihzZXQoaWRzKSkgIyBzZXQgbnVtYmVyIG9mIGlucHV0cyAod2l0aCB1bmlxdWUgaWRzKSB0byB3YWl0CiAgICAgICAgICAgIFNlcnZpY2UuaW5zZXJ0KHNlbGYsY3VzdCxzaW0pCmNsYXNzIFN0YXJ0KEdlbmVyYXRvcik6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGZ1bj1FLHBhcmFtPVsxXSx0bm1heD01MC4wLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIEdlbmVyYXRvci5fX2luaXRfXyhzZWxmLGZ1bixwYXJhbSx0bm1heCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInN0YXJ0RXZlbnQiKQpjbGFzcyBUYXNrKFNlcnZpY2UpOgogICAgICBkZWYgX19pbml0X18oc2VsZixmdW49VSxwYXJhbT1bMSwyXSxjb2RlPU5vbmUsTT0xKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLGZ1bixwYXJhbSxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInRhc2siKQogICAgICAgICAgICBzZWxmLnNlcnZlcnMsIHNlbGYubnNlcnZlciwgc2VsZi5NID0gW10sIDAsIE0KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2Uoc2VsZi5NLTEpOgogICAgICAgICAgICAgICAgICBFdmVudC5jbnQgLT0xCiAgICAgICAgICAgICAgICAgIHNlbGYuc2VydmVycy5hcHBlbmQoU2VydmljZShmdW4scGFyYW0sY29kZSkpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgaWYoc2VsZi5uc2VydmVyPT0wKTogICMgbXlzZWxmCiAgICAgICAgICAgICAgICAgIFNlcnZpY2UuaW5zZXJ0KHNlbGYsY3VzdCxzaW0pCiAgICAgICAgICAgIGVsc2U6ICAgICAgICAgICAgICAjIG90aGVyc2VsZnMKICAgICAgICAgICAgICAgICAgc2VsZi5zZXJ2ZXJzW3NlbGYubnNlcnZlci0xXS5pbnNlcnQoY3VzdCxzaW0pCiAgICAgICAgICAgIHNlbGYubnNlcnZlciA9IChzZWxmLm5zZXJ2ZXIrMSklc2VsZi5NCmNsYXNzIFRpbWVyKFNlcnZpY2UpOgogICAgICBkZWYgX19pbml0X18oc2VsZixmdW49MSxwYXJhbT1Ob25lLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIGlmIG5vdCBjYWxsYWJsZShmdW4pOiAgIyB3aGVuIHBhc3NpbmcgZml4ZWQgZGVsYXkgdmFsdWUKICAgICAgICAgICAgICAgICAgZnVuLHBhcmFtLGNvZGUgPSBOb25lLGZ1bixwYXJhbQogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsZnVuLHBhcmFtLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiaW50ZXJtZWRpYXRlQ2F0Y2hFdmVudCIpCmNsYXNzIEVuZChTaW5rKToKICAgICAgI2RlZiBfX2luaXRfXyhzZWxmKToKICAgICAgIyAgICAgIFNpbmsuX19pbml0X18oc2VsZikKICAgICAgIyAgICAgIHNlbGYuc2V0TmFtZSgiZW5kRXZlbnQiKQogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTaW5rLl9faW5pdF9fKHNlbGYsImVuZEV2ZW50Iixjb2RlKQpjbGFzcyBUaHJvdyhTZXJ2aWNlKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImludGVybWVkaWF0ZVRocm93RXZlbnQiKQpjbGFzcyBUZXJtaW5hdGUoRW5kKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgRW5kLl9faW5pdF9fKHNlbGYsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJ0ZXJtaW5hdGVFbmRFdmVudCIpCmNsYXNzIFNjcmlwdChTZXJ2aWNlKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInNjcmlwdFRhc2siKQpjbGFzcyBDb25kaXRpb24oQ29uZGl0aW9uYWxFdmVudCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIENvbmRpdGlvbmFsRXZlbnQuX19pbml0X18oc2VsZixjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImludGVybWVkaWF0ZUNhdGNoRXZlbnQiKQoKIyAtLS0tIHV0aWwyIC0tLS0tLS0tICAgICAgCmRlZiBjb25uZWN0KGEsIGIpOgogICAgICBhLm91dHB1dC5hcHBlbmQoYikKICAgICAgaWYgaXNpbnN0YW5jZShhLFRhc2spOgogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oYS5zZXJ2ZXJzKSk6ICAjIGZpcnN0IHNlcnZlciBpcyBhbHJlYWR5IGNvbm5lY3RlZAogICAgICAgICAgICAgICAgICBhLnNlcnZlcnNbaV0ub3V0cHV0LmFwcGVuZChiKQpkZWYgZGljdF90b3N0cmluZyhhKToKICAgICAgcmV0dXJuICJcbiIuam9pbihbaysiOlx0IitzdHIodikgZm9yIGssdiBpbiBhLml0ZW1zKCldKQoiIiIKZGVmIGhpc3QoYT1bMCwxXSwgYj0yMCwgYz0nb3JhbmdlJyk6CiAgICAgIGltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKICAgICAgcGx0Lmhpc3QoYSxiLGNvbG9yPWMpCiAgICAgICNwbHQuc2F2ZWZpZygiZGVzX3Bsb3Quc3ZnIiwgZm9ybWF0PSJzdmciKQogICAgICAjcGx0LnNob3coKQogICAgICBpbXBvcnQgaW8sIGJhc2U2NAogICAgICBidWYgPSBpby5CeXRlc0lPKCkKICAgICAgcGx0LnNhdmVmaWcoYnVmLCBmb3JtYXQ9J3N2ZycpCiAgICAgIGJ1Zi5zZWVrKDApCiAgICAgIHJldHVybiAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgYmFzZTY0LmI2NGVuY29kZShidWYucmVhZCgpKS5kZWNvZGUoJ1VURi04JykKIiIiCmRlZiBmcm9tX2ZpbGUoZm5hbWUpOgogICAgICB3aXRoIG9wZW4oZm5hbWUsInIiKSBhcyBmcDoKICAgICAgICAgICAgcmV0dXJuIGZwLnJlYWQoKQoKIyAtLS0tIGNvbnZlcnNpb25zIC0tLS0tLS0tICAgICAgCmRlZiBhdHRyX3Rvc3RyaW5nKGEpOgogICAgICBzPSJuYW1lOiAiK2FbIm5hbWUiXSsiXG4iCiAgICAgIGZvciBpIGluIHJhbmdlKDEsMTAwKToKICAgICAgICAgICAgdD0iX190IitzdHIoaSkKICAgICAgICAgICAgaWYgdCsiYiIgaW4gYToKICAgICAgICAgICAgICAgICAgcys9dCsiICIrIiUuM2YiJWFbdCsiYiJdKyIgIisiJS4zZiIlYVt0KyJlIl0rIlxuIgogICAgICByZXR1cm4gcwpkZWYgYXR0cl90b3N2Z3N0cmluZyhvLHdtYXgsdz0xNixoPTI0KToKICAgICAgZ2xvYmFsIG5lCiAgICAgIGEscyA9IG8uYXR0ciwiIgogICAgICBjPVsnaG90cGluaycsJ2xpbWVncmVlbicsJ2Nvcm5mbG93ZXJibHVlJywnY29yYWwnLCdtZWRpdW1zZWFncmVlbicsJ21lZGl1bXB1cnBsZSddCiAgICAgIGZvciBpIGluIHJhbmdlKDEwMCk6CiAgICAgICAgICAgIHQ9Il9fdCIrc3RyKGkpCiAgICAgICAgICAgIGlmIHQrImIiIGluIGE6CiAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSI4IiB5PSInK3N0cigzMitoKmkpKyciPicrc3RyKGkpKyc8dGl0bGU+JytzdHIobmUuZWVbaS0xXS5uYW1lKSsnICcrc3RyKG5lLmVlW2ktMV0udGl0bGUpKyc8L3RpdGxlPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IGNsYXNzPSJ0MSIgc3R5bGU9ImRpc3BsYXk6bm9uZTtmaWxsOmdyYXkiIHg9IjMyIiB5PSInK3N0cigzMitoKmkpKyciPicrc3RyKG5lLmVlW2ktMV0udGl0bGUpKyc8dGl0bGU+JytzdHIobmUuZWVbaS0xXS5uYW1lKSsnPC90aXRsZT48L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgIHQwLHQxLHQyID0gYVt0KyJhIl0sYVt0KyJiIl0sYVt0KyJlIl0KICAgICAgICAgICAgICAgICAgcys9JzxyZWN0IHk9Iicrc3RyKDIwK2gqaSkrJyIgeD0iJytzdHIoMjArdyp0MSkKICAgICAgICAgICAgICAgICAgcys9JyIgd2lkdGg9Iicrc3RyKHQyLXQxPT0wIGFuZCAxIG9yIHcqKHQyLXQxKSkrJyIgaGVpZ2h0PSInK3N0cihoLTIpKyciIHN0cm9rZT0iYmxhY2siIGZpbGwtb3BhY2l0eT0iMC43IiBmaWxsPSInCiAgICAgICAgICAgICAgICAgIHMrPShjW2ludChhWyJjbmFtZSJdLnNwbGl0KCcgJylbMF0pJWxlbihjKV0pKyciPjx0aXRsZT4nK2FbImNuYW1lIl0rJyBbJysoIiUuMmYsICIldDApKygiJS4yZiwgIiV0MSkrKCIlLjJmIiV0MikrJ10nKyc8L3RpdGxlPjwvcmVjdD5cbicKICAgICAgICAgICAgICAgICAgaWYgdDItdDE+MC41OgogICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoMjArdyp0MSsyKSsnIiB5PSInK3N0cigyMCtoKmkrMTgpKyciPicrYVsiY25hbWUiXSsnPC90ZXh0PicKICAgICAgICAgICAgICAgICAgaWYgdyp0MT53bWF4WzBdOgogICAgICAgICAgICAgICAgICAgICAgICB3bWF4WzBdID0gdyp0MQogICAgICByZXR1cm4gcwpkZWYgdG9fc3ZnKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHcsaCxXLEggPSAxNiwyNCxbMTYwXSw0MCAgIyBXWzBdIGZvciBwYXNzaW5nIGJ5IHJlZmVyZW5jZSEhIQogICAgICBzID0gJzxzdmcgb25jbGljaz0ib25fY2xpY2soKSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iJWQiIGhlaWdodD0iJWQiPlxuJwogICAgICBmb3IgZSBpbiBlZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLEVuZCk6CiAgICAgICAgICAgICAgICAgIGZvciBjIGluIGUucXVldWUub2JqZWN0czoKICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBhdHRyX3Rvc3Znc3RyaW5nKGMsVyx3LGgpCiAgICAgICAgICAgIEggKz0gMjQKICAgICAgSCs9MjQKICAgICAgcys9ICc8cmVjdCB4PSIyMCIgeT0iMTAiIHdpZHRoPSIlZCIgaGVpZ2h0PSIyIi8+XG4nJShXWzBdK3cpCiAgICAgIHMrPSAnPHJlY3QgeD0iMjAiIHk9IiVkIiB3aWR0aD0iJWQiIGhlaWdodD0iMiIvPlxuJyUoSCsxMCxXWzBdK3cpCiAgICAgIGZvciBpIGluIHJhbmdlKGludChXWzBdL3crMikpOgogICAgICAgICAgICBzICs9ICc8cmVjdCB4PSInK3N0cigyMCt3KmkpKyciIHk9IjEwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxMCIvPlxuJwogICAgICAgICAgICBzICs9ICc8cmVjdCB4PSInK3N0cigyMCt3KmkpKyciIHk9IiVkIiB3aWR0aD0iMSIgaGVpZ2h0PSIxMCIvPlxuJyUoSCkKICAgICAgICAgICAgaWYgKGklMTApPT0wOgogICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoMjArdyppLTgpKyciIHk9IjMyIj4nK3N0cihpKSsnPC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoMjArdyppLTgpKyciIHk9IiVkIj4nJShIKStzdHIoaSkrJzwvdGV4dD5cbicKICAgICAgcyArPSAiPHNjcmlwdD5mdW5jdGlvbiBvbl9jbGljaygpIHtbLi4uZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndDEnKV0uZm9yRWFjaChlPT5lLnN0eWxlLmRpc3BsYXk9KGUuc3R5bGUuZGlzcGxheT09J25vbmUnPycnOidub25lJykpO308L3NjcmlwdD4iCiAgICAgIHJldHVybiBzJShXWzBdKzgwLEgrMjApICsgJzwvc3ZnPlxuJwpkZWYgdG9fZG90MChlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMpOgogICAgICBzID0nZGlncmFwaCBCUE1OIHsgcmFua2Rpcj0iTFIiIHJhbmtzZXA9MSBub2Rlc2VwPTFcbicKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6CiAgICAgICAgICAgIHMxID0gJyAge3Jhbms9c2FtZTsgJwogICAgICAgICAgICBmb3IgaiBpbiByYW5nZShsZW4oZWVbaV0ub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgIHMgKz0gIiAgIitzdHIoZWVbaV0uaWQpICsgIiAtPiAiICsgc3RyKGVlW2ldLm91dHB1dFtqXS5pZCkgKyJcbiIKICAgICAgICAgICAgICAgICAgczEgKz0gc3RyKGVlW2ldLm91dHB1dFtqXS5pZCkgKyI7ICIKICAgICAgICAgICAgaWYgbGVuKGVlW2ldLm91dHB1dCk+MToKICAgICAgICAgICAgICAgICAgaWYgYWJzKGVlW2ldLm91dHB1dFswXS5pZC1lZVtpXS5vdXRwdXRbMV0uaWQpPDI6IHMgKz0gczEgKyd9XG4nCiAgICAgIHJldHVybiBzKyd9JwpkZWYgdG9fZG90KGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHMgPSdkaWdyYXBoIEJQTU4yIHsgcmFua2Rpcj0iTFIiIG5vZGVzZXA9MC42XG4nCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgbGFiZWwseGxhYmVsLHNoYXBlLHN0eWxlLGNvbG9yLHBlbiA9IHN0cihlZVtpXS5pZCksIiIsInJlY3QiLCIiLCIiLCIxIgogICAgICAgICAgICBzaXplPSIiCiAgICAgICAgICAgIGlmICJ2ZW50IiBpbiBlZVtpXS5uYW1lOiBzaGFwZT0iY2lyY2xlIgogICAgICAgICAgICBlbGlmICJhdGV3YXkiIGluIGVlW2ldLm5hbWU6IHNoYXBlPSJkaWFtb25kIjsgc2l6ZT0iaGVpZ2h0PTAuNyIKICAgICAgICAgICAgaWYgImludGVybWVkaWF0ZSIgaW4gZWVbaV0ubmFtZTogc2hhcGU9ImRvdWJsZWNpcmNsZSIKICAgICAgICAgICAgaWYgc2hhcGU9PSJyZWN0Ijogc3R5bGU9InJvdW5kZWQsZmlsbGVkIjsgY29sb3I9ImxpZ2h0Ymx1ZSI7IHNpemU9IndpZHRoPTEuMSBoZWlnaHQ9MC44IgogICAgICAgICAgICBlbGlmICJlbmQiIGluIGVlW2ldLm5hbWU6IHN0eWxlPSJmaWxsZWQiOyBwZW49IjMiCiAgICAgICAgICAgIGlmICJleGNsdXNpdmUiIGluIGVlW2ldLm5hbWU6IHhsYWJlbD1sYWJlbDsgbGFiZWw9IlgiCiAgICAgICAgICAgIGVsaWYgInBhcmFsbGVsIiBpbiBlZVtpXS5uYW1lOiB4bGFiZWw9bGFiZWw7IGxhYmVsPSIrIgogICAgICAgICAgICBlbGlmICJpbmNsdXNpdmUiIGluIGVlW2ldLm5hbWU6IHhsYWJlbD1sYWJlbDsgbGFiZWw9Ik8iCiAgICAgICAgICAgIHMgKz0gJyAgJytlZVtpXS5uYW1lICsnIFtsYWJlbD0iJytsYWJlbCsnIiB4bGFiZWw9IicreGxhYmVsCiAgICAgICAgICAgIHMgKz0gJyIgc3R5bGU9Iicrc3R5bGUrJyIgc2hhcGU9Iicrc2hhcGUrJyIgZmlsbGNvbG9yPSInCiAgICAgICAgICAgIHMgKz0gY29sb3IrJyIgcGVud2lkdGg9IicrcGVuKyciICcrc2l6ZSsnXScgKydcbicKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6CiAgICAgICAgICAgIGlmIGVlW2ldPT1Ob25lOiBjb250aW51ZQogICAgICAgICAgICBzMSA9ICcgIHtyYW5rPXNhbWU7ICcKICAgICAgICAgICAgZm9yIGogaW4gcmFuZ2UobGVuKGVlW2ldLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICBzICs9ICIgICIrZWVbaV0ubmFtZSArICIgLT4gIiArIGVlW2ldLm91dHB1dFtqXS5uYW1lICsiXG4iCiAgICAgICAgICAgICAgICAgIHMxICs9IGVlW2ldLm91dHB1dFtqXS5uYW1lICsiOyAiCiAgICAgICAgICAgIGlmIGxlbihlZVtpXS5vdXRwdXQpPjE6CiAgICAgICAgICAgICAgICAgIGlmIGFicyhlZVtpXS5vdXRwdXRbMF0uaWQtZWVbaV0ub3V0cHV0WzFdLmlkKTwyOiBzICs9IHMxICsnfVxuJwogICAgICByZXR1cm4gcysnfScKZGVmIHRvX3Bvc2l0aW9uKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHBwPVtdCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOiAgICMgc2V0IHggcG9zaXRpb24gdG8gdHJlZSBsZXZlbAogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZToKICAgICAgICAgICAgICAgICAgcHAuYXBwZW5kKE5vbmUpCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHgsZXAgPSAwLGVlW2ldLnByZXYoKQogICAgICAgICAgICBmb3IgaWR4IGluIHJhbmdlKGxlbihlcCktMSwtMSwtMSk6CiAgICAgICAgICAgICAgICAgIGlmIGVwW2lkeF0ucHBbMF0hPS0xOgogICAgICAgICAgICAgICAgICAgICAgICB4PWVwW2lkeF0ucHBbMF0rMQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlZVtpXS5wcD1beCwwXQogICAgICAgICAgICBwcC5hcHBlbmQoZWVbaV0ucHApCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pCiAgICAgIGZvciBpIGluIHJhbmdlKDEsbGVuKHBwKSk6ICMgaW5jcmVhc2UgeSBwb3NpdGlvbiBmb3IgYWxsIGF0IHRoZSBzYW1lIGxldmVsCiAgICAgICAgICAgIGlmIHBwW2ldIT1Ob25lIGFuZCBwcFtpLTFdIT1Ob25lIGFuZCBwcFtpXVswXT09cHBbaS0xXVswXToKICAgICAgICAgICAgICAgICAgcHBbaV1bMV0gPSBwcFtpLTFdWzFdKzEKICAgICAgICAgICAgICAgICAgZWVbaV0ucHA9cHBbaV0KICAgICAgI3ByaW50KFtfLnBwIGZvciBfIGluIGVlXSkKICAgICAgIyIiIgogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpLTEsLTEsLTEpOiAgICMgc2V0IHkgcG9zaXRpb24gdG8gdGhlIGxldmVsIG9mIHByZXZpb3VzIAogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgZSA9IGVlW2ldLnByZXYoKQogICAgICAgICAgICBpZiBsZW4oZSk+MCBhbmQgZVswXS5vdXRwdXRbMF09PWVlW2ldOgogICAgICAgICAgICAgICAgICBwcFtpXVsxXSA9IGVbMF0ucHBbMV0KICAgICAgICAgICAgICAgICAgZWVbaV0ucHA9cHBbaV0KICAgICAgICAgICAgaWYgbGVuKGUpPjAgYW5kIGxlbihlWzBdLm91dHB1dCk+MSBhbmQgZVswXS5vdXRwdXRbMV09PWVlW2ldIGFuZCBsZW4oZWVbaV0ub3V0cHV0KT09MDoKICAgICAgICAgICAgICAgICAgcHBbaV1bMF0gPSBlZVtpXS5wcFswXS0xICAjIHdoZW4gaXQgaXMgdGhlIHNlY29uZCBhbmQgaGFzIG5vIG91cHV0CiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwPXBwW2ldCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pCiAgICAgICMiIiIKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKS0xLC0xLC0xKTogIyBtb3ZlIHByZXZpb3VzIHRvIHRoZSBsZXZlbCBvZiBpdHMgZmlyc3QgbmV4dAogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgZXA9ZWVbaV0ucHJldigpCiAgICAgICAgICAgIGlmIGxlbihlcCk+MCBhbmQgZXBbMF0ub3V0cHV0WzBdPT1lZVtpXSBhbmQgZXBbMF0ucHBbMF09PWVlW2ldLnBwWzBdLTE6CiAgICAgICAgICAgICAgICAgIGlmIGVwWzBdLnBwWzFdIT1lZVtpXS5wcFsxXToKICAgICAgICAgICAgICAgICAgICAgICAgZXBbMF0ucHBbMV09ZWVbaV0ucHBbMV0KICAgICAgI3ByaW50KFtfLnBwIGZvciBfIGluIGVlXSkgICAgICAKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6ICAjIGZvcmNlIHBvc2l0aW9uIGZyb20gcHAyCiAgICAgICAgICAgIGlmIGVlW2ldPT1Ob25lOiBjb250aW51ZQogICAgICAgICAgICBpZiBlZVtpXS5wcDJbMF0hPS0xOgogICAgICAgICAgICAgICAgICBlZVtpXS5wcFswXT1lZVtpXS5wcDJbMF0KICAgICAgICAgICAgaWYgZWVbaV0ucHAyWzFdIT0tMToKICAgICAgICAgICAgICAgICAgZWVbaV0ucHBbMV09ZWVbaV0ucHAyWzFdCiAgICAgIGZvciBlIGluIGVlOiAgICMgY29ycmVjdCBwb3NpdGlvbiBvZiBib3VuZGFyeSBldmVudHMKICAgICAgICAgICAgaWYgZT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgI2lmKGUucHBbMF09PTAgYW5kIGUucHBbMV09PTApOgogICAgICAgICAgICBpZihlLmlkIT1lLmlkMik6CiAgICAgICAgICAgICAgICAgIGlkMj1pbnQoc3RyKGUuaWQyKS5zcGxpdCgiLiIpWzFdKQogICAgICAgICAgICAgICAgICBlLnBwWzBdLGUucHBbMV0gPSBlZVtpZDItMV0ucHBbMF0sZWVbaWQyLTFdLnBwWzFdCiAgICAgIHJldHVybiBbZS5wcCBmb3IgZSBpbiBmaWx0ZXIoTm9uZSxlZSldCmRlZiB0b19icG1uKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyxwcD1Ob25lKToKICAgICAgcyA9Jzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ij8+XG4nCiAgICAgIHMrPSc8YnBtbjpkZWZpbml0aW9ucyB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIicKICAgICAgcys9JyB4bWxuczpicG1uPSJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L01PREVMIicKICAgICAgcys9JyB4bWxuczpicG1uZGk9Imh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0JQTU4vMjAxMDA1MjQvREkiJwogICAgICBzKz0nIHhtbG5zOmRjPSJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9EQyInCiAgICAgIHMrPScgeG1sbnM6ZGk9Imh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0RELzIwMTAwNTI0L0RJIicKICAgICAgcys9JyB0YXJnZXROYW1lc3BhY2U9Imh0dHA6Ly9icG1uLmlvL3NjaGVtYS9icG1uIicKICAgICAgcys9JyBpZD0iRGVmaW5pdGlvbnNfMSIgZXhwb3J0ZXI9ImRlcyIgZXhwb3J0ZXJWZXJzaW9uPSIxLjAiPlxuJwogICAgICBzMT0nIDxicG1uOnByb2Nlc3MgaWQ9IlByb2Nlc3NfMSI+XG4nCiAgICAgIHMyPScgPGJwbW5kaTpCUE1ORGlhZ3JhbSBpZD0iQlBNTkRpYWdyYW1fMSI+XG4nCiAgICAgIHMyKz0nICA8YnBtbmRpOkJQTU5QbGFuZSBpZD0iQlBNTlBsYW5lXzEiIGJwbW5FbGVtZW50PSJQcm9jZXNzXzEiPlxuJwogICAgICBzMWE9JycKICAgICAgajEgPSAwICAjIGZsb3cgY291bnRlcgogICAgICBXLEgsVzAsSDAgPSAxMDAsMTAwLDQwLDMwCiAgICAgIGlmIG5vdCBwcDoKICAgICAgICAgICAgcHAgPSBbZS5wcCBmb3IgZSBpbiBmaWx0ZXIoTm9uZSxlZSldCiAgICAgICAgICAgIGlmIHBwWzBdWzBdPT0tMToKICAgICAgICAgICAgICAgICAgcHAgPSB0b19wb3NpdGlvbihmaWx0ZXIoTm9uZSxlZSkpCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBpZiBlZVtpXT09Tm9uZTogY29udGludWUKICAgICAgICAgICAgbmFtZSA9IGVlW2ldLm5hbWUKICAgICAgICAgICAgaWYgInRlcm1pbmF0ZSIgaW4gbmFtZToKICAgICAgICAgICAgICAgICAgbmFtZT1uYW1lW2xlbigidGVybWluYXRlIik6XQogICAgICAgICAgICBlbmFtZSA9IGVlW2ldLl9fY2xhc3NfXy5fX25hbWVfXysnXycrc3RyKGVlW2ldLmZ1biBhbmQgZWVbaV0uZnVuLl9fbmFtZV9fIG9yIE5vbmUpKydfJwogICAgICAgICAgICBpbXBvcnQgYmFzZTY0CiAgICAgICAgICAgIGVuYW1lICs9IGJhc2U2NC5iMTZlbmNvZGUoYnl0ZWFycmF5KHN0cihlZVtpXS5wYXJhbSkrJ18nK3N0cihlZVtpXS5jb2RlKSwnYXNjaWknKSkuZGVjb2RlKCdhc2NpaScpICMgcmVxdWlyZXMgZW5jb2RpbmchCiAgICAgICAgICAgIHR5cGU9bmFtZS5zcGxpdCgiXyIpWzBdCiAgICAgICAgICAgIGd0PXsid2kiOjgwLCJoIjo2MCwib3giOjAsIm95IjowLCJlIjooODAsMzApLCJ3IjooMCwzMCksIm4iOig0MCwwKSwicyI6KDQwLDYwKX0KICAgICAgICAgICAgZ2c9eyJ3aSI6MzYsImgiOjM2LCJveCI6MjIsIm95IjoxMiwiZSI6KDU4LDMwKSwidyI6KDIyLDMwKSwibiI6KDQwLDEyKSwicyI6KDQwLDQ4KX0KICAgICAgICAgICAgZzEgPSBndCBpZiAiYXNrIiBpbiB0eXBlIGVsc2UgZ2cKICAgICAgICAgICAgdyxoID0gZzFbIndpIl0sZzFbImgiXSAgIyBpY29uIHNpemUKICAgICAgICAgICAgeGIseWIgPSBXMCtXKnBwW2ldWzBdLCBIMCtIKnBwW2ldWzFdCiAgICAgICAgICAgIHhvLHlvID0geGIrZzFbIm94Il0sIHliK2cxWyJveSJdICMgaWNvbiBvZmZzZXQKICAgICAgICAgICAgaWYgInRhc2siIGluIHR5cGU6CiAgICAgICAgICAgICAgICAgIGlmIGxlbihlZVtpXS5vdXRwdXQpPjE6IHR5cGUgPSAic2VuZFRhc2siCiAgICAgICAgICAgICAgICAgIGlmIGxlbihzZXQoW2UuaWQgZm9yIGUgaW4gZWVbaV0ucHJldigpXSkpPjE6IHR5cGUgPSAicmVjZWl2ZVRhc2siCiAgICAgICAgICAgIGlmIGVlW2ldLmlkICE9IGVlW2ldLmlkMjogICMgZm9yIGJvdW5kYXJ5IGV2ZW50cwogICAgICAgICAgICAgICAgICBpZDIgPSBpbnQoc3RyKGVlW2ldLmlkMikuc3BsaXQoJy4nKVsxXSkKICAgICAgICAgICAgICAgICAgeG8seW8gPSBlZVtpZDItMV0ueCsyMi41LGVlW2lkMi0xXS55KzQyLjUKICAgICAgICAgICAgICAgICAgdHlwZSA9ICJib3VuZGFyeUV2ZW50IgogICAgICAgICAgICBlZVtpXS54LGVlW2ldLnkgPSB4byx5bwogICAgICAgICAgICBzMSs9JyAgPGJwbW46Jyt0eXBlKycgaWQ9IicrbmFtZSsnIiBuYW1lPSInK25hbWUuc3BsaXQoIl8iKVsxXSsnXG4nK2VlW2ldLnRpdGxlKyciPlxuJwogICAgICAgICAgICBzMis9JyAgIDxicG1uZGk6QlBNTlNoYXBlIGlkPSInK25hbWUrJ18nK2VuYW1lKyciIGJwbW5FbGVtZW50PSInK25hbWUrJyI+XG4nCiAgICAgICAgICAgIHMyKz0nICAgIDxkYzpCb3VuZHMgeD0iJytzdHIoeG8pKyciIHk9Iicrc3RyKHlvKSsnIiB3aWR0aD0iJytzdHIodykrJyIgaGVpZ2h0PSInK3N0cihoKSsnIiAvPlxuJwogICAgICAgICAgICBzMis9JyAgIDwvYnBtbmRpOkJQTU5TaGFwZT5cbicKICAgICAgICAgICAgZm9yIGoyIGluIHJhbmdlKGxlbihlZVtpXS5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgajEgKz0gMQogICAgICAgICAgICAgICAgICBmbG93LGVmbG93PSdGbG93Xycrc3RyKGoxKSwiZGkiCiAgICAgICAgICAgICAgICAgIGlpID0gZWVbaV0ub3V0cHV0W2oyXS5pZC0xCiAgICAgICAgICAgICAgICAgICNwcmludChlZVtpXSxqMixlZVtpXS5vdXRwdXRbajJdLGlpLHBwKQogICAgICAgICAgICAgICAgICB4ZSx5ZSA9IFcwK1cqcHBbaWldWzBdLCBIMCtIKnBwW2lpXVsxXQogICAgICAgICAgICAgICAgICBuYW1lMj1lZVtpXS5vdXRwdXRbajJdLm5hbWUKICAgICAgICAgICAgICAgICAgaWYgInRlcm1pbmF0ZSIgaW4gbmFtZTI6CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUyPW5hbWUyW2xlbigidGVybWluYXRlIik6XQogICAgICAgICAgICAgICAgICB0eXBlMj1uYW1lMi5zcGxpdCgiXyIpWzBdCiAgICAgICAgICAgICAgICAgIGcyID0gZ3QgaWYgImFzayIgaW4gdHlwZTIgZWxzZSBnZwogICAgICAgICAgICAgICAgICBpZiB4ZT54YjogIyB0d28gZWRnZXMKICAgICAgICAgICAgICAgICAgICAgICAgZHgxLGR5MSA9IGcxWyJzIl0gaWYgeWI8eWUgZWxzZSBnMVsiZSJdCiAgICAgICAgICAgICAgICAgICAgICAgIGR4MixkeTIgPSBnMlsicyJdIGlmIHliPnllIGVsc2UgZzJbInciXQogICAgICAgICAgICAgICAgICBlbHNlIDogICAgIyB0aHJlZSBlZGdlcwogICAgICAgICAgICAgICAgICAgICAgICBkeDEsZHkxID0gZzFbInMiXSBpZiB5Yjx5ZSBlbHNlIGcxWyJuIl0KICAgICAgICAgICAgICAgICAgICAgICAgZHgyLGR5MiA9IGcyWyJzIl0gaWYgeWI+eWUgZWxzZSBnMlsibiJdCiAgICAgICAgICAgICAgICAgIHgxLHkxID0geGIrZHgxLHliK2R5MQogICAgICAgICAgICAgICAgICB4Mix5MiA9IHhlK2R4Mix5ZStkeTIKICAgICAgICAgICAgICAgICAgczErPScgICA8YnBtbjpvdXRnb2luZz4nK2Zsb3crJzwvYnBtbjpvdXRnb2luZz5cbicKICAgICAgICAgICAgICAgICAgaWYgImludGVybWVkaWF0ZUNhdGNoIiBpbiBuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAib25kaXRpb24iIGluIGVuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOmNvbmRpdGlvbmFsRXZlbnREZWZpbml0aW9uLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgczErPScgICA8YnBtbjp0aW1lckV2ZW50RGVmaW5pdGlvbi8+XG4nCiAgICAgICAgICAgICAgICAgIHMxYSs9JyAgICA8YnBtbjpzZXF1ZW5jZUZsb3cgaWQ9IicrZmxvdysnIiBzb3VyY2VSZWY9IicrbmFtZSsnIiB0YXJnZXRSZWY9IicrbmFtZTIrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgczIrPScgICA8YnBtbmRpOkJQTU5FZGdlIGlkPSInK2Zsb3crJ18nK2VmbG93KyciIGJwbW5FbGVtZW50PSInK2Zsb3crJyI+XG4nCiAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MSkrJyIgeT0iJytzdHIoeTEpKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgIHh4LHl5ID0gMCwwCiAgICAgICAgICAgICAgICAgIGlmIHkxIT15MjogIyByZXF1aXJlcyBhZGRpdGlvbmFsIHBvaW50cyAob25lIG9yIHR3byBpbXBsZW1lbnRlZCkKICAgICAgICAgICAgICAgICAgICAgICAgeHgsIHl5ID0geTI+eTEgYW5kIHgxIG9yIHgyLCB5Mj55MSBhbmQgeTIgb3IgeTEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgeDE+eDI6ICMgYmFjayBjb25uZWN0aW9uIHJlcXVpcmVzIHR3byBhZGRpdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHkxPnkyOiAjIGZyb20gbG93ZXIgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeXkgLT0gMzUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgxKSsnIiB5PSInK3N0cih5eSkrJyIgLz5cbicgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgeTE8eTI6ICMgZnJvbSB1cHBlciBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5eSAtPSAyNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeHgpKyciIHk9Iicrc3RyKHl5KSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4eCA9IHgyCiAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4eCkrJyIgeT0iJytzdHIoeXkpKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgIGVsaWYgeTE9PXkyIGFuZCB4MT54MjogIyBsb29wYmFjayAtIHJlcXVpcmVzIHR3byBhZGRpdGlvbmFsIHBvaW50cwogICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDEpKyciIHk9Iicrc3RyKHkxLTMwKSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDIpKyciIHk9Iicrc3RyKHkyLTMwKSsnIiAvPlxuJyAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgaWYgeHghPXgyIG9yIHl5IT15MjoKICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgyKSsnIiB5PSInK3N0cih5MikrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgczIrPScgICA8L2JwbW5kaTpCUE1ORWRnZT5cbicKICAgICAgICAgICAgaWYgInRlcm1pbmF0ZSIgaW4gZWVbaV0ubmFtZToKICAgICAgICAgICAgICAgICAgczErPScgICA8YnBtbjp0ZXJtaW5hdGVFdmVudERlZmluaXRpb24vPlxuJwogICAgICAgICAgICBzMSs9JyAgPC9icG1uOicrdHlwZSsnPlxuJwogICAgICAgICAgICBwYXNzCiAgICAgIHMyKz0nICA8L2JwbW5kaTpCUE1OUGxhbmU+XG4nCiAgICAgIHMyKz0nIDwvYnBtbmRpOkJQTU5EaWFncmFtPlxuJwogICAgICBzMSs9czFhKycgPC9icG1uOnByb2Nlc3M+XG4nCiAgICAgIHJldHVybiBzK3MxK3MyKyc8L2JwbW46ZGVmaW5pdGlvbnM+XG4nCgplbl90aXRsZSA9ICIiCmNsYXNzIEV2ZW50TmV0d29yaygpOgogICAgICBkZWYgX19pbml0X18oc2VsZixzKToKICAgICAgICAgICAgRXZlbnQuY250LCBDdXN0b21lci5jbnQgPSAwLCAwCiAgICAgICAgICAgIFF1ZXVlZEV2ZW50Lmluc3RhbmNlcy5jbGVhcigpCiAgICAgICAgICAgIEJwbW5FdmVudC5TID0ge30KICAgICAgICAgICAgc2VsZi5lZSA9IHNlbGYuZnJvbV9zdHJpbmcocykKICAgICAgICAgICAgc2VsZi5wcCA9IHRvX3Bvc2l0aW9uKHNlbGYuZWUpCiAgICAgIGRlZiBfX2dldGl0ZW1fXyhzZWxmLGkpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5lZVtpXQogICAgICBkZWYgZnJvbV9zdHJpbmcoc2VsZixzKToKICAgICAgICAgICAgZ2xvYmFsIGVuX3RpdGxlCiAgICAgICAgICAgIGVlLCBFdmVudC5jbnQsIHlsZXZlbCwgZW5fdGl0bGUgPSBbXSwgMCwgLTEsICcnCiAgICAgICAgICAgIHNzID0gcy5zcGxpdCgnXG4nKQogICAgICAgICAgICBmb3IgczAgaW4gc3M6CiAgICAgICAgICAgICAgICAgIHMxID0gczAuc3RyaXAoKQogICAgICAgICAgICAgICAgICBpZiBsZW4oczEpPDEgb3IgczFbMF09PScjJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgczE9PXNzWzBdOiAjIHRpdGxlIGluIGZpcnN0IGxpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5fdGl0bGUgPSBzc1swXVsxOl0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgaWYgIi0+IiBpbiBzMTogIyBjb25uZWN0aW9uIGRlZmluaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgeWxldmVsICs9IDEgICAjIHVzZWQgZm9yIG1hcmtpbmcgcmVxdWlyZWQgeSBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgczFhIGluIHMxLnNwbGl0KCI7Iik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IHMxYS5zdHJpcCgpLnNwbGl0KCItPiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgbGVuKGNvZGUpPjE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlWzFdPWNvZGVbMV0uc3BsaXQoIiMiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29kZVswXVswXT09JygnOiBjb2RlWzBdPWNvZGVbMF1bMTotMV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvZGVbMV1bMF09PScoJzogY29kZVsxXT1jb2RlWzFdWzE6LTFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYyA9IHJlLnNwbGl0KCdbLHxdJyxjb2RlWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHN0ID0gcmUuc3BsaXQoJ1ssfF0nLGNvZGVbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcyBpbiBzcmM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgZCBpbiBkc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLGogPSBpbnQocyktMSwgaW50KGQpLTEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGk+LTEgYW5kIGo+LTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0KGVlW2ldLGVlW2pdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaT4tMSBhbmQgZWVbaV0ucHAyWzFdPT0tMTogIyBpZiBub3Qgc2V0IHlldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbaV0ucHAyWzFdPXlsZXZlbCAjIGZvcmNlIHkgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGo+LTEgYW5kIGVlW2pdLnBwMlsxXT09LTE6ICMgaWYgbm90IHNldCB5ZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlW2pdLnBwMlsxXT15bGV2ZWwgIyBmb3JjZSB5IHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLnBvcCgwKQogICAgICAgICAgICAgICAgICBlbHNlOiAgICAgICAgICAjIGV2ZW50IGRlZmluaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgY29kZT1zMS5zcGxpdCgiICIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihjb2RlKT4xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlMT0iICIuam9pbihjb2RlWzE6XSkuc3BsaXQoJyMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZS5hcHBlbmQoZXZhbChjb2RlMVswXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS5pZDI9ZmxvYXQoY29kZVswXS5zcGxpdCgnLycpWzBdKSAjIGlkIGFzIHdyaXR0ZW4gaW4gc291cmNlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVstMV0udGl0bGU9Y29kZTFbMV0uc3RyaXAoKSBpZiBsZW4oY29kZTEpPjEgZWxzZSAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYz1jb2RlWzBdLnNwbGl0KCIvIikgICMgY2hlY2sgaWRlbnRpZmllciBmaWVsZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVstMV0ucHAyWzBdID0gZmxvYXQoY2NbMV0pLTEgaWYgbGVuKGNjKT4xIGVsc2UgLTEgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS5wcDJbMV0gPSBmbG9hdChjY1syXSktMSBpZiBsZW4oY2MpPjIgZWxzZSAtMQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGxlbihjb2RlKT09MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWUuYXBwZW5kKE5vbmUpICAjIGVtcHR5IGVsZW1lbnQgCiAgICAgICAgICAgIGlmIGxlbihzZXQoW2UucHAyWzFdIGZvciBlIGluIGZpbHRlcihOb25lLGVlKV0pKT09MTogIyB2ZXJpZnkgaWYgbXVsdGktbGluZSBkZXNjcmlwdGlvbgogICAgICAgICAgICAgICAgICBmb3IgZSBpbiBmaWx0ZXIoTm9uZSxlZSk6ICAgICAgIyBpZiB5ZXMKICAgICAgICAgICAgICAgICAgICAgICAgZS5wcDJbMV09LTEgIyBjbGVhciBhbGwgeS1sZXZlbHMgdG8gdW5rbm93bgogICAgICAgICAgICByZXR1cm4gZWUKICAgICAgZGVmIHRvX3N0cmluZyhzZWxmKToKICAgICAgICAgICAgcz0nJwogICAgICAgICAgICBmb3IgZSBpbiBzZWxmLmVlOgogICAgICAgICAgICAgICAgICBzICs9IHN0cihlLmlkKSArICIgIiArIGUuX19jbGFzc19fLl9fbmFtZV9fKyIoIgogICAgICAgICAgICAgICAgICBpZiBlLl9fY2xhc3NfXy5fX25hbWVfXyE9J0VuZCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICJHYXRlIiBub3QgaW4gZS5fX2NsYXNzX18uX19uYW1lX186CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gZS5mdW4gYW5kIGUuZnVuLl9fbmFtZV9fIG9yICdOb25lJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9IiwiK3N0cihlLnBhcmFtKSsiLCIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZS5fX2NsYXNzX18uX19uYW1lX18hPSdTdGFydCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSBlLmNvZGUhPU5vbmUgYW5kICJcIiIrc3RyKGUuY29kZSkrIlwiIiBvciAiTm9uZSIKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9c3RyKGUudG5tYXgpCiAgICAgICAgICAgICAgICAgIHMgKz0iKVxuIgogICAgICAgICAgICBmb3IgZSBpbiBlZToKICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGUub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gc3RyKGUuaWQpICsgIi0+IiArIHN0cihlLm91dHB1dFtpXS5pZCkgKyc7JwogICAgICAgICAgICByZXR1cm4gcyArICdcbicKZGVmIHN2Z19yb3VuZGVkUGF0aChwcCwgcik6CiAgICAgIGltcG9ydCBtYXRoCiAgICAgIHMsIGwgPSAiIiwgbGVuKHBwKS0xCiAgICAgIGZvciBpIGluIHJhbmdlKGwpOgogICAgICAgICAgICBhLGIgPSBwcFtpXSwgcHBbaSsxXQogICAgICAgICAgICB0ID0gbWluKHIgLyBtYXRoLmh5cG90KGJbMF0tYVswXSwgYlsxXS1hWzFdKzAuMDEpLCAwLjUpCiAgICAgICAgICAgIGlmIGk9PTA6CiAgICAgICAgICAgICAgICAgIHMgKz0gJ00lZyAlZyAnJShhWzBdLGFbMV0pCiAgICAgICAgICAgIGlmIGk+MDoKICAgICAgICAgICAgICAgICAgcyArPSAnUSVnICVnICVnICVnICclKGFbMF0sYVsxXSxhWzBdKigxLXQpK2JbMF0qdCxhWzFdKigxLXQpK2JbMV0qdCkKICAgICAgICAgICAgaWYgaT09bC0xOgogICAgICAgICAgICAgICAgICBzICs9ICdMJWcgJWcgJyUoYlswXSxiWzFdKQogICAgICAgICAgICBlbGlmIGk8bC0xOgogICAgICAgICAgICAgICAgICBzICs9ICdMJWcgJWcgJyUoYVswXSp0K2JbMF0qKDEtdCksYVsxXSp0K2JbMV0qKDEtdCkpCiAgICAgIHJldHVybiBzCiNOU19NQVAgPSB7CiMgICAgTm9uZTogJ2h0dHA6Ly93d3cub21nLm9yZy9zcGVjL0JQTU4vMjAxMDA1MjQvTU9ERUwnLAojICAgICdicG1uZGknOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9ESScsCiMgICAgJ29tZ2RjJzogJ2h0dHA6Ly93d3cub21nLm9yZy9zcGVjL0RELzIwMTAwNTI0L0RDJywKIyAgICAnb21nZGknOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREknLAojICAgICd4c2knOiAnaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UnCiN9CmRlZiBicG1uX3Rvc3ZnMChicG1uZmlsZSxXPTEwMCxIPTgwKToKICAgICAgcyA9ICc8ZGVmcz48bWFya2VyIGlkPSJ0cmlhbmdsZSIgdmlld0JveD0iMCAwIDEwIDEwIiByZWZYPSIxMCIgcmVmWT0iNSIgbWFya2VyVW5pdHM9InN0cm9rZVdpZHRoIiBtYXJrZXJXaWR0aD0iMTAiIG1hcmtlckhlaWdodD0iMTAiIG9yaWVudD0iYXV0byI+IDxwYXRoIGQ9Ik0gMCAwIEwgMTAgNSBMIDAgMTAgeiIgZmlsbD0iYmxhY2siIC8+PC9tYXJrZXI+PC9kZWZzPlxuJwogICAgICBpbXBvcnQgeG1sLmV0cmVlLkVsZW1lbnRUcmVlIGFzIEVUCiAgICAgIGZvciBlIGluIEVULnBhcnNlKGJwbW5maWxlKS5nZXRyb290KCk6CiAgICAgICAgICAgIGlmICJCUE1ORGlhZ3JhbSIgaW4gZS50YWc6CiAgICAgICAgICAgICAgICAgIGZvciBkIGluIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zPVtwIGZvciBwIGluIGQgaWYgIkJQTU5QbGFuZSIgaW4gZC50YWddCiAgICAgIHJldHVybiBpdGVtcwojZGVmIGJwbW5fdG9zdmcoYnBtbmZpbGUsVz0xMDAsSD04MCk6CmRlZiBicG1uX3Rvc3ZnKGJwbW5zdHJpbmcsaXNhbmltLGlzY29tbWVudHMsaXNzY3JpcHRzLFc9MTAwLEg9ODApOgogICAgICBzID0gJzxkZWZzPjxtYXJrZXIgaWQ9InRyaWFuZ2xlIiB2aWV3Qm94PSIwIDAgMTAgMTAiIHJlZlg9IjEwIiByZWZZPSI1IiBtYXJrZXJVbml0cz0ic3Ryb2tlV2lkdGgiIG1hcmtlcldpZHRoPSIxMCIgbWFya2VySGVpZ2h0PSIxMCIgb3JpZW50PSJhdXRvIj4gPHBhdGggZD0iTSAwIDAgTCAxMCA1IEwgMCAxMCB6IiBmaWxsPSJibGFjayIgLz48L21hcmtlcj48L2RlZnM+XG4nCiAgICAgIHMgKz0gJzx0ZXh0IHg9IjEwIiB5PSIxMiI+Jytlbl90aXRsZSsnPC90ZXh0PlxuJzsKICAgICAgaW1wb3J0IHhtbC5ldHJlZS5FbGVtZW50VHJlZSBhcyBFVAogICAgICAjZm9yIGUgaW4gRVQucGFyc2UoYnBtbmZpbGUpLmdldHJvb3QoKTogICMgY29sbGVjdCBuYW1lZCBwcm9jZXNzZXMKICAgICAgZm9yIGUgaW4gRVQuZnJvbXN0cmluZyhicG1uc3RyaW5nKTogICMgY29sbGVjdCBuYW1lZCBwcm9jZXNzZXMKICAgICAgICAgICAgaWYgInByb2Nlc3MiIGluIGUudGFnOgogICAgICAgICAgICAgICAgICBlbGVtcz1bZCBmb3IgZCBpbiBlIGlmICJuYW1lIiBpbiBkLmF0dHJpYl0KICAgICAgI2ZvciBlIGluIEVULnBhcnNlKGJwbW5maWxlKS5nZXRyb290KCk6ICAjIGNvbGxlY3QgZGlhZ3JhbSBlbGVtZW50cwogICAgICBmb3IgZSBpbiBFVC5mcm9tc3RyaW5nKGJwbW5zdHJpbmcpOiAgIyBjb2xsZWN0IG5hbWVkIHByb2Nlc3NlcwogICAgICAgICAgICBpZiAiQlBNTkRpYWdyYW0iIGluIGUudGFnOgogICAgICAgICAgICAgICAgICBmb3IgZCBpbiBlOgogICAgICAgICAgICAgICAgICAgICAgICBpdGVtcz1bcCBmb3IgcCBpbiBkIGlmICJCUE1OUGxhbmUiIGluIGQudGFnXQogICAgICBmb3IgaXQgaW4gaXRlbXM6CiAgICAgICAgICAgIHBwLG5hbWUgPSBbXSwiIgogICAgICAgICAgICBmb3IgZSBpbiBlbGVtczoKICAgICAgICAgICAgICAgICAgaWYgaXQuYXR0cmliWyJicG1uRWxlbWVudCJdPT1lLmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT0iICIuam9pbihlLmF0dHJpYlsibmFtZSJdLnNwbGl0KCIgIilbMTpdKSAjIGFzc3VtZSAiaWRcbnRleHQiCiAgICAgICAgICAgIGZvciBqIGluIHJhbmdlKGxlbihpdCkpOgogICAgICAgICAgICAgICAgICB4LHkgPSBmbG9hdChpdFtqXS5hdHRyaWJbIngiXSksZmxvYXQoaXRbal0uYXR0cmliWyJ5Il0pCiAgICAgICAgICAgICAgICAgIHcsaCA9IChmbG9hdChpdFtqXS5hdHRyaWJbIndpZHRoIl0pLGZsb2F0KGl0W2pdLmF0dHJpYlsiaGVpZ2h0Il0pKSBpZiAiQm91bmRzIiBpbiBpdFtqXS50YWcgZWxzZSAoMCwwKQogICAgICAgICAgICAgICAgICBXLEggPSBtYXgoVyx4K3cpLG1heChILHkraCkKICAgICAgICAgICAgICAgICAgI3ByaW50KGl0LmF0dHJpYlsiaWQiXSwiOiIseCx5LHcsaCkKICAgICAgICAgICAgICAgICAgaWYgdz09MDogIyBicG1uIGZsb3cKICAgICAgICAgICAgICAgICAgICAgICAgcHAuYXBwZW5kKFt4LHldKQogICAgICAgICAgICAgICAgICBlbHNlOiAgICAjIGJwbW4gZXZlbnQKICAgICAgICAgICAgICAgICAgICAgICAgaWRzPWl0LmF0dHJpYlsiaWQiXS5zcGxpdCgiXyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlkPWlkc1sxXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oaWRzKT40OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgYmFzZTY0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkc1s0XT1iYXNlNjQuYjE2ZGVjb2RlKGlkc1s0XSwnYXNjaWknKS5kZWNvZGUoJ2FzY2lpJykKICAgICAgICAgICAgICAgICAgICAgICAgaWQyPSJfIi5qb2luKGlkc1syOl0pLnJlcGxhY2UoJzwnLCcmbHQ7JykucmVwbGFjZSgnPicsJyZndDsnKQogICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoeC02KSsnIiB5PSInK3N0cih5K2grMTIpKyciPicraWQrJzwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNjb21tZW50czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IGZvbnQtc2l6ZT0ic21hbGxlciIgc3R5bGU9ImZpbGw6Z3JheSIgeD0iJytzdHIoeC0xMikrJyIgeT0iJytzdHIoeS02KSsnIj48dHNwYW4geG1sOnNwYWNlPSJwcmVzZXJ2ZSI+JytuYW1lKyc8L3RzcGFuPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWQzPWlkMi5zcGxpdCgiXyIpCiAgICAgICAgICAgICAgICAgICAgICAgICNpZiBsZW4oaWQzKT4zIGFuZCBpZDNbM10gIT0gIk5vbmUiIDogcys9Jzx0ZXh0IGNsYXNzPSJ0MSIgZm9udC1zaXplPSJzbWFsbGVyIiBzdHlsZT0iZmlsbDpncmF5IiB4PSInK3N0cih4KzE4KSsnIiB5PSInK3N0cih5K2grMTIrKCJFdmVudCIgaW4gaXQuYXR0cmliWyJpZCJdIGFuZCAxMiBvciAwKSkrJyI+PHRzcGFuIHhtbDpzcGFjZT0icHJlc2VydmUiPicraWQzWzNdKyc8L3RzcGFuPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNzY3JpcHRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDNhPSJfIi5qb2luKGlkc1syOl0pLnNwbGl0KCJfIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGlkM2EpPjMgYW5kIGlkM2FbM10gIT0gIk5vbmUiOiBzKz0nPHRleHQgY2xhc3M9InQxIiBmb250LXNpemU9InNtYWxsZXIiIHN0eWxlPSJmaWxsOmdyYXkiIHg9Iicrc3RyKHgrMTgpKyciIHk9Iicrc3RyKHkraCsxMikrJyI+PHRzcGFuIHhtbDpzcGFjZT0icHJlc2VydmUiPicraWQzYVszXS5zcGxpdCgnOycpWzBdLnJlcGxhY2UoJzwnLCcmbHQ7JykucmVwbGFjZSgnPicsJyZndDsnKSsnPC90c3Bhbj48L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICJFdmVudCIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2UgPSAiZW5kIiBpbiBpdC5hdHRyaWJbImlkIl0gYW5kICIzIiBvciAiMSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSAiZW5kIiBpbiBpdC5hdHRyaWJbImlkIl0gYW5kICJyZWQiIG9yICJkYXJrZ3JlZW4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPGVsbGlwc2UgY3g9Iicrc3RyKHgrdy8yKSsnIiBjeT0iJytzdHIoeStoLzIpKyciIHJ4PSInK3N0cih3LzIpKyciIHJ5PSInK3N0cihoLzIpKyciIHN0cm9rZS13aWR0aD0iJytzdHJva2UrJyIgc3Ryb2tlPSInK2NvbG9yKyciIGZpbGwtb3BhY2l0eT0iMC42IiBmaWxsPSJ3aGl0ZSI+PHRpdGxlPicraWQyKyc8L3RpdGxlPjwvZWxsaXBzZT5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgImludGVybWVkaWF0ZSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxlbGxpcHNlIGN4PSInK3N0cih4K3cvMikrJyIgY3k9Iicrc3RyKHkraC8yKSsnIiByeD0iJytzdHIody8yLTMpKyciIHJ5PSInK3N0cihoLzItMykrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9ImRhcmtncmVlbiIgZmlsbD0id2hpdGUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIkNhdGNoIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJvbmRpdGlvbiIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxyZWN0IHg9IiVnIiB5PSIlZyIgd2lkdGg9IiVnIiBoZWlnaHQ9IiVnIiBzdHJva2U9ImJsYWNrIiBmaWxsPSJub25lIiAvPiclKHgrdy8yLTcseStoLzItOSx3LzItNCxoLzIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHBhdGggZD0iJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSg1KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICdNJWcgJWcgTCVnICVnICclKHgrdy8yLTUseStoLzItNiszKmkseCt3LzIrNSx5K2gvMi02KzMqaSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8ZWxsaXBzZSBjeD0iJytzdHIoeCt3LzIpKyciIGN5PSInK3N0cih5K2gvMikrJyIgcng9Iicrc3RyKHcvMi02KSsnIiByeT0iJytzdHIoaC8yLTYpKyciIHN0cm9rZS13aWR0aD0iJytzdHJva2UrJyIgc3Ryb2tlPSJibGFjayIgZmlsbD0id2hpdGUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cGF0aCBkPSJNJWcgJWcgTCVnICVnICVnICVnICclKHgrdy8yLTUseStoLzItMyx4K3cvMix5K2gvMix4K3cvMis2LHkraC8yLTYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEyKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBtYXRoIGltcG9ydCBzaW4sY29zLHBpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAiTSVnICVnIEwlZyAlZyAiJSh4K3cvMisody8yLTYpKmNvcyhpKjIqcGkvMTIpLHkraC8yKyhoLzItNikqc2luKGkqMipwaS8xMikseCt3LzIrKHcvMi05KSpjb3MoaSoyKnBpLzEyKSx5K2gvMisoaC8yLTkpKnNpbihpKjIqcGkvMTIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIi8+JyAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiZXJtaW5hdGUiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8ZWxsaXBzZSBjeD0iJytzdHIoeCt3LzIpKyciIGN5PSInK3N0cih5K2gvMikrJyIgcng9Iicrc3RyKHcvMi02KSsnIiByeT0iJytzdHIoaC8yLTYpKyciIHN0cm9rZS13aWR0aD0iJytzdHJva2UrJyIgc3Ryb2tlPSJyZWQiIGZpbGw9InJlZCIgZmlsbC1vcGFjaXR5PSIwLjYiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAiR2F0ZXdheSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICJvcmFuZ2UiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHBhdGggZD0iTSVnICVnIEwlZyAlZyBMJWcgJWcgTCVnICVnIFoiIHN0cm9rZT0iJXMiIGZpbGw9IndoaXRlIj48dGl0bGU+JXM8L3RpdGxlPjwvcGF0aD5cbiclKHgseStoLzIseCt3LzIseSx4K3cseStoLzIseCt3LzIseStoLGNvbG9yLGlkMikgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJleGNsdXNpdmUiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9JzxwYXRoIGQ9Ik0lZyAlZyBMJWcgJWcgTSVnICVnIEwlZyAlZyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIzIiAvPlxuJyUoeCt3LzItNix5K2gvMi02LHgrdy8yKzYseStoLzIrNix4K3cvMis2LHkraC8yLTYseCt3LzItNix5K2gvMis2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICJwYXJhbGxlbCIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHBhdGggZD0iTSVnICVnIEwlZyAlZyBNJWcgJWcgTCVnICVnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjMiIC8+XG4nJSh4K3cvMi04LHkraC8yLHgrdy8yKzgseStoLzIseCt3LzIseStoLzItOCx4K3cvMix5K2gvMis4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICJpbmNsdXNpdmUiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9JzxjaXJjbGUgY3g9IiVnIiBjeT0iJWciIHI9IjciIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIgLz5cbiclKHgrdy8yLHkraC8yKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxyZWN0IHJ4PSI3IiByeT0iNyIgeD0iJytzdHIoeCkrJyIgeT0iJytzdHIoeSkrJyIgd2lkdGg9Iicrc3RyKHcpKyciIGhlaWdodD0iJytzdHIoaCkrJyIgc3Ryb2tlPSJkYXJrYmx1ZSIgZmlsbD0id2hpdGUiPjx0aXRsZT4nK2lkMisnPC90aXRsZT48L3JlY3Q+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJzY3JpcHQiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoNCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0nPHBhdGggZD0iTSVnICVnIEwlZyAlZyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxIiAvPiclKHgrMTArMCppLHkrMTArNCppLHgrMjIrMCppLHkrMTArNCppKQogICAgICAgICAgICBpZiBsZW4ocHApPjA6ICMgczEhPScnOiAjIGFkZCB3aG9sZSBmbG93CiAgICAgICAgICAgICAgICAgIHMxPXN2Z19yb3VuZGVkUGF0aChwcCwxMikKICAgICAgICAgICAgICAgICAgcyArPSAnPHBhdGggbWFya2VyLWVuZD0idXJsKCN0cmlhbmdsZSkiIGQ9IicrczErJyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YnJvd247c3Ryb2tlLXdpZHRoOjEiLz5cbicKICAgICAgcyArPSAiPHNjcmlwdD5mdW5jdGlvbiBvbl9jbGljaygpIHtbLi4uZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndDEnKV0uZm9yRWFjaChlPT5lLnN0eWxlLmRpc3BsYXk9KGUuc3R5bGUuZGlzcGxheT09J25vbmUnPycnOidub25lJykpO308L3NjcmlwdD4iCiAgICAgIHMgPSAnPHN2ZyBvbmNsaWNrPSJvbl9jbGljaygpIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIlZCIgaGVpZ2h0PSIlZCI+XG4nJShXKzQwKzYwLEgrMzApK3MKICAgICAgcmV0dXJuIHMgKyAodG9fYW5pbSgpIGlmIGlzYW5pbSBlbHNlICcnKSArICc8L3N2Zz5cbicKZGVmIHRvX2FuaW0oKToKICAgICAgI3JldHVybiBzCiAgICAgIGdsb2JhbCBuZQogICAgICBzID0gICc8ZGVmcz48ZmlsdGVyIHg9IjAiIHk9IjAiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGlkPSJmaSI+XG4nCiAgICAgIHMgKz0gJzxmZUZsb29kIGZsb29kLWNvbG9yPSJ3aGl0ZSIvPlxuJwogICAgICBzICs9ICc8ZmVDb21wb3NpdGUgaW49IlNvdXJjZUdyYXBoaWMiIG9wZXJhdG9yPSJhdG9wIi8+PC9maWx0ZXI+PC9kZWZzPlxuJwogICAgICBmb3IgZSBpbiBuZS5lZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLEVuZCk6CiAgICAgICAgICAgICAgICAgIGZvciBjIGluIGUucXVldWUub2JqZWN0czoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKG5lLmVlKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgsIHksIGEgPSBuZS5lZVtpXS54LCBuZS5lZVtpXS55LCBjLmF0dHIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0nPHRleHQgY2xhc3M9InQxIiBmaWx0ZXI9InVybCgjZmkpIiBzdHlsZT0iZm9udC1zaXplOnNtYWxsO2ZpbGw6cmVkIiB4PSInK3N0cih4LTIwKSsnIiB5PSInK3N0cih5KzEzKSsnIiB2aXNpYmlsaXR5PSJoaWRkZW4iPicrc3RyKGMubmFtZSkrJ1xuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0PSJfX3QiK3N0cihpKzEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQrImEiIGluIGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQwID0gYVt0KyJhIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAnPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0idmlzaWJpbGl0eSIgZnJvbT0iaGlkZGVuIiB0bz0idmlzaWJsZSIgYmVnaW49Iicrc3RyKHQwKSsncyIgZHVyPSIwLjAxcyIgZmlsbD0iZnJlZXplIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQrImIiIGluIGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gYVt0KyJiIl0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gJzxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9IngiIHRvPSInK3N0cih4KzM4KSsnIiBiZWdpbj0iJytzdHIodDEpKydzIiBkdXI9IjAuNXMiIGZpbGw9ImZyZWV6ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0KyJlIiBpbiBhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IGFbdCsiZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gJzxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InZpc2liaWxpdHkiIGZyb209InZpc2libGUiIHRvPSJoaWRkZW4iIGJlZ2luPSInK3N0cih0MikrJ3MiIGR1cj0iMC4wMXMiIGZpbGw9ImZyZWV6ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9JzwvdGV4dD5cbicKICAgICAgcmV0dXJuIHMKCm5lPVtdCiMgLS0tLSBzaW11bGF0aW9uIC0tLS0tCmRlZiBtYWluX2Z1bihleG4sbixhbmltLGNvbW1lbnRzLHNjcmlwdHMpOiAjIHN0cmluZyByZXByZXNlbnRhdGlvbiwgbnVtYmVyIG9mIHNpbXVsYXRpb24KICAgICAgZGF0YT1bXSAgIyBsaXN0IG9mIGV2ZW50cywgYXJyYXkgb2YgcmVzdWx0cwogICAgICBzID0gJycKICAgICAgZm9yIGkgaW4gcmFuZ2Uobik6CiAgICAgICAgICAgIGdsb2JhbCBuZQogICAgICAgICAgICBuZSA9IEV2ZW50TmV0d29yayhleG4pCiAgICAgICAgICAgIHNpbSA9IFNpbXVsYXRvcigpCiAgICAgICAgICAgIGZvciBlIGluIG5lOgogICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGUsR2VuZXJhdG9yKTogICMgYWRkIGdlbmVyYXRpbmcgZXZlbnRzCiAgICAgICAgICAgICAgICAgICAgICAgIHNpbS5hZGQoZSkgIAogICAgICAgICAgICBzaW0ucnVuKCkKICAgICAgICAgICAgZGF0YS5hcHBlbmQoW3NpbS50aW1lLEJwbW5FdmVudC5TXSkgICAjIHNhdmUgZW5kIHRpbWUgb2Ygc2ltdWxhdGlvbgogICAgICAgICAgICAKICAgICAgICAgICAgI2lmIGV4bj09ZXg1OgogICAgICAgICAgICAjICAgICAgZGF0YS5hcHBlbmQoQnBtbkV2ZW50LlNbIlMuYkEiXSkgIyBzYXZlIGdsb2JhbCB2YXJpYWJsZSBTLmJBCiAgICAgICAgICAgICNlbHNlOgogICAgICAgICAgICAjICAgICAgZGF0YS5hcHBlbmQoc2ltLnRpbWUpICAgIyBzYXZlIGVuZCB0aW1lIG9mIHNpbXVsYXRpb24KICAgICAgICAgICAgaWYgaT09MDoKICAgICAgICAgICAgICAgICAgczEgPSB0b19icG1uKG5lLmVlLG5lLnBwKQogICAgICAgICAgICAgICAgICBzMiA9IGJwbW5fdG9zdmcoczEsYW5pbSxjb21tZW50cyxzY3JpcHRzKQogICAgICAgICAgICAgICAgICBzMyA9IHRvX3N2ZygpCiAgICAgIHMgKz0gIiNuXHR0XHQiKyJcdCIuam9pbihkYXRhWzBdWzFdLmtleXMoKSkrIlxuIgogICAgICBzICs9ICJcbiIuam9pbihbIiVkXHQlLjJmXHQlcyIlKGkrMSxkYXRhW2ldWzBdLCJcdCIuam9pbihbc3RyKHYpIGZvciB2IGluIFsqZGF0YVtpXVsxXS52YWx1ZXMoKV1dKSkgZm9yIGkgaW4gcmFuZ2UobGVuKGRhdGEpKV0pCiAgICAgICNmb3IgZSBpbiBuZToKICAgICAgIyAgICAgIGlmIGxlbihlLnF1ZXVlKT4wOgogICAgICAjICAgICAgICAgICAgcyArPSBzdHIoZS5pZCkgKyAoIiglZCk6IiVsZW4oZS5xdWV1ZSkpICsgc3RyKGUucXVldWUpKydcbicKICAgICAgI3MgKz0gc3RyKHN1bShkYXRhKS9sZW4oZGF0YSkpKydcbicKICAgICAgI3MgKz0gc3RyKEJwbW5FdmVudC5TKSsnXG4nCiAgICAgICNmb3IgZSBpbiBuZToKICAgICAgIyAgICAgIHMgKz0gc3RyKGUuaWQpK3N0cihlLkEpKycgJwogICAgICAjICAgICAgaWYgaXNpbnN0YW5jZShlLFRhc2spOgogICAgICAjICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGUuc2VydmVycykpOgogICAgICAjICAgICAgICAgICAgICAgICAgcyArPSBzdHIoZS5zZXJ2ZXJzW2ldLmlkKSsnLycrc3RyKGkrMSkrc3RyKGUuc2VydmVyc1tpXS5BKSsnICcKICAgICAgczQ9JycKICAgICAgaWYgbGVuKGRhdGEpPj0xMDA6CiAgICAgICAgICAgICNpZiBleG49PWV4NDoKICAgICAgICAgICAgIyAgICAgIHM0ID0gaGlzdChkYXRhLDcpCiAgICAgICAgICAgICNlbHNlOgogICAgICAgICAgICAjICAgICAgczQgPSBoaXN0KGRhdGEpCiAgICAgICAgICAgIHBhc3MgIyBzNCA9IGhpc3QoZGF0YSkKICAgICAgcmV0dXJuIChzLHMxLHMyLHMzLHM0KSAjIHMyKyc8YnI+XG4nKyhzMyBpZiBuPT0xIGVsc2UgJycpKyc8YnI+XG4nKyc8cHJlPicrcysnPC9wcmU+JwoKIiIiCmlmIF9fbmFtZV9fPT0iX19tYWluX18iOgogICAgICBpbXBvcnQgc3lzCiAgICAgICNpbXBvcnQgZXgKICAgICAgZXgzMCA9ICcxIFN0YXJ0KClcbjIgVGFzaygpXG4zIEVuZCgpXG4xLT4yLT4zXG4nCiAgICAgIHMgPSBsZW4oc3lzLmFyZ3YpPjEgYW5kIGZyb21fZmlsZShzeXMuYXJndlsxXSkgb3IgZXZhbCgnZXglZCclKDMwKSkKICAgICAgbiA9IGxlbihzeXMuYXJndik+MiBhbmQgaW50KHN5cy5hcmd2WzJdKSBvciAxCiAgICAgIGFuaW0gPSAxCiAgICAgIGNvbW1lbnRzID0gMQogICAgICBzY3JpcHRzID0gMQogICAgICBvdXRwdXQgPSBtYWluX2Z1bihzLG4sYW5pbSxjb21tZW50cyxzY3JpcHRzKQogICAgICBwcmludChvdXRwdXRbMl0pICAgICAgCiAgICAgIHByaW50KG91dHB1dFszXSkKICAgICAgcHJpbnQoJzxwcmU+JyxvdXRwdXRbMF0sJzwvcHJlPicpCiIiIgpzID0gaW5wdXRbMF0KbiA9IGludChpbnB1dFsxXSkKYW5pbSA9IGludChpbnB1dFsyXSkKY29tbWVudHMgPSBpbnQoaW5wdXRbM10pCnNjcmlwdHMgPSBpbnQoaW5wdXRbNF0pCm91dHB1dCA9IG1haW5fZnVuKHMsIG4sIGFuaW0sIGNvbW1lbnRzLCBzY3JpcHRzKQpzID0gJycKI3MgKz0gJzxkaXYgaWQ9ImRpdjEiIGhpZGRlbj4nK291dHB1dFsxXSsnPC9kaXY+PGJyPlxuJwpzICs9ICc8ZGl2IGlkPSJkaXYyIiB0YWJpbmRleD0iLTEiPicrb3V0cHV0WzJdKyc8L2Rpdj48YnI+XG4nCiNzICs9JzxpbnB1dCB0eXBlPWJ1dHRvbiB2YWx1ZT0iU2F2ZSBicG1uIHRvIHhtbCBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGUxKCk7Ij48L2lucHV0PlxuJwpzICs9JzxpbnB1dCB0eXBlPWJ1dHRvbiB2YWx1ZT0iU2F2ZSBicG1uIHRvIHN2ZyBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGUyKCk7Ij48L2lucHV0PlxuJwpzICs9JzxpbnB1dCB0eXBlPWJ1dHRvbiB2YWx1ZT0iU2F2ZSBicG1uIHRvIHhtbCBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGU1KCk7Ij48L2lucHV0Pjxicj48YnI+XG4nCmlmIG49PTE6CiAgICAgIHMgKz0gJzxkaXYgaWQ9ImRpdjMiPicrb3V0cHV0WzNdICsnPC9kaXY+PGJyPlxuJwogICAgICBzICs9JzxpbnB1dCB0eXBlPWJ1dHRvbiB2YWx1ZT0iU2F2ZSB0aW1lbGluZSB0byBzdmcgZmlsZSIgb25jbGljaz0id3JpdGVGaWxlMygpOyI+PC9pbnB1dD48YnI+PGJyPlxuJwpzICs9Jzx0ZXh0YXJlYSBpZD0idGE0IiByb3dzPSIxMCIgY29scz0iODAiPicrb3V0cHV0WzBdKyc8L3RleHRhcmVhPjxicj5cbicgIysnPGltZyBzcmM9Iicrb3V0cHV0WzNdKyciPicKcyArPSc8aW5wdXQgdHlwZT1idXR0b24gdmFsdWU9IlNhdmUgcmVzdWx0cyB0byB0eHQgZmlsZSIgb25jbGljaz0id3JpdGVGaWxlNCgpOyI+PC9pbnB1dD48YnI+PGJyPlxuJwpzICs9Jzx0ZXh0YXJlYSBoaWRkZW4gaWQ9InRhNSIgcm93cz0iMTAiIGNvbHM9IjgwIj4nK291dHB1dFsxXSsnPC90ZXh0YXJlYT48YnI+XG4nICMrJzxpbWcgc3JjPSInK291dHB1dFszXSsnIj4nCnMKCgoK";