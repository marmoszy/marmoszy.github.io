var pycode="IyBtbS1kZXMgLSBkaXNjcmV0ZSBldmVudCBzaW11bGF0b3IKIyAtIGJhc2UgZXZlbnRzOiBHZW5lcmF0b3IsU2VydmljZSxTaW5rLENvbmRpdGlvbmFsRXZlbnQKIyAtIGJwbW4gZXZlbnRzOiBTdGFydCxUYXNrLEVuZCxUaW1lcixYb3JHYXRlLEFuZEdhdGUsQ29uZGl0aW9uLFRlcm1pbmF0ZQojIE1NIDMxLjEuMjAyNCwgMTMuOS4yMDI1IChhZG9wdGVkIGZvciBweW9kaWRlIGluIGpzKQoKIyAtLS0tIHNpbXVsYXRpb24gb24gYW4gYWJzdHJhY3QgZXZlbnQgLS0tLQpjbGFzcyBFdmVudCgpOgogICAgICBjbnQgPSAwICAgICAgICAgICAgICAgICAgICAgICAgICMgdXNlZCBmb3IgZXZlbnQgaWRlbnRpZmllcgogICAgICBkZWYgX19pbml0X18oc2VsZiwgdGltZSwgbmFtZT1Ob25lKToKICAgICAgICAgICAgc2VsZi50aW1lID0gdGltZTsKICAgICAgICAgICAgRXZlbnQuY250ICs9IDEKICAgICAgICAgICAgc2VsZi5pZCA9IEV2ZW50LmNudAogICAgICAgICAgICBzZWxmLm5hbWUgPSAoKG5hbWU9PU5vbmUpIGFuZCAiRXZlbnQiIG9yIG5hbWUpICsgIl8iK3N0cihzZWxmLmlkKQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOiBwYXNzICAgICAgIyBhYnN0cmFjdCAKICAgICAgZGVmIF9fc3RyX18oc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLm5hbWUrICIgIisgc3RyKHNlbGYuaWQpICsiICIrc3RyKHNlbGYudGltZSkKY2xhc3MgU2ltdWxhdG9yKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAgICAgc2VsZi50aW1lID0gMAogICAgICAgICAgICBzZWxmLmV2ZW50cyA9IFtdCiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucyA9IFtdCiAgICAgIGRlZiBub3coc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnRpbWUKICAgICAgZGVmIGFkZChzZWxmLGUpOgogICAgICAgICAgICBzZWxmLmV2ZW50cy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBhZGRfY29uZGl0aW9uKHNlbGYsZSk6CiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgICAgIHdoaWxlIHNlbGYuZXZlbnRzOgogICAgICAgICAgICAgICAgICBlID0gbWluKHNlbGYuZXZlbnRzLCBrZXk9bGFtYmRhIGU6IGUudGltZSkKICAgICAgICAgICAgICAgICAgc2VsZi5ldmVudHMucmVtb3ZlKGUpCiAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IGUudGltZSAgICAgICAgICMgdXBkYXRlIHNpbXVsYXRvciB0aW1lCiAgICAgICAgICAgICAgICAgIGUuZXhlYyhzZWxmKQogICAgICAgICAgICAgICAgICBmb3IgYyBpbiBzZWxmLmNvbmRpdGlvbnM6ICAjIHRlc3QgY29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICBpZiBjLmV4ZWMoc2VsZik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5yZW1vdmUoYykKIyAtLS0tIHV0aWxzIC0tLS0KaW1wb3J0IG1hdGgscmFuZG9tCmRlZiBfcHJpbnQocyk6ICAgICAgICAgICAgICAgICMgb3duIHByaW50CiAgICAgICNwcmludChzKSAgICAgICAgICAgICAgICMgY29tbWVudCBpZiBubyB2ZXJib3VzIHByaW50aW5nCiAgICAgIHBhc3MKZGVmIEUobWVhbj1bMS4wXSk6ICAgICAgICAgICAgIyBleHBvbmVudGlhbCByYW5kb20gZ2VuZXJhdG9yCiAgICAgICMgLW1lYW5bMF0qbWF0aC5sb2cocmFuZG9tLnJhbmRvbSgpKQogICAgICByZXR1cm4gcmFuZG9tLmV4cG92YXJpYXRlKDEvbWVhblswXSkgCmRlZiBVKG1pbm1heD1bMS4wXSk6ICAgICAgICAgICMgdW5pZm9ybSByYW5kb20gZ2VuZXJhdG9yCiAgICAgIHJldHVybiByYW5kb20udW5pZm9ybShtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXSkKZGVmIE4obWVhbnN0ZD1bMy4wXSk6ICAgICAgICAjIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgcmV0dXJuIHJhbmRvbS5ub3JtYWx2YXJpYXRlKG1lYW5zdGRbMF0sbGVuKG1lYW5zdGQpPjEgYW5kIG1lYW5zdGRbMV0gb3IgMS4wKQpkZWYgQihwPTAuNSk6ICAgICAgICAgICAgICAgICMgYmlub21pYWwgKDAsMSkKICAgICAgcmV0dXJuIHJhbmRvbS5yYW5kb20oKTxwCmRlZiBDKHA9WzEsMSwxXSk6ICAgICAgICAgICAgIyBjaG9pY2UgKDAsMSwyLC4uLikKICAgICAgcmV0dXJuIHJhbmRvbS5jaG9pY2VzKGxpc3QocmFuZ2UobGVuKHApKSksd2VpZ2h0cz1wKVswXQpkZWYgVChtaW5tYXg9WzEuMF0pOiAgICAgICAgICAjIHNlbWkgdHJ1bmNhdGVkIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgbWksbWEgPSBtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXQogICAgICBtZWFuLHN0ZCA9IChtYSttaSkvMiwobWEtbWkpLzIKICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgeCA9IE4oW21lYW4sc3RkXSkKICAgICAgICAgICAgaWYgbWkgPD0geCA8PSBtYTogYnJlYWsKICAgICAgcmV0dXJuIHgKCiMgLS0tLSBwcmltaXRpdmUgY2xhc3NlcyAtLS0tCmNsYXNzIEN1c3RvbWVyKCk6ICAgICMgYW5vbnltb3VzIGN1c3RvbWVyIHdpdGggYSBhdXRvbWF0aWMgbmFtZQogICAgICBjbnQgPSAwICAgICAgICAjIGNvdW50ZXIgY2xhc3MgdmFyaWFibGUgZm9yIGN1c3RvbWVyIG5hbWUKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBDdXN0b21lci5jbnQgKz0gMQogICAgICAgICAgICBzZWxmLm5hbWUgPSBzdHIoQ3VzdG9tZXIuY250KQogICAgICAgICAgICBzZWxmLmF0dHIgPSB7ImNuYW1lIjpzZWxmLm5hbWV9ICMgQ3VzdG9tZXIgYXR0cmlidXRlcwogICAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIHN0cihzZWxmLm5hbWUpCmNsYXNzIFF1ZXVlKCk6ICAgICAgICMgZmlmbyBvZiBjdXN0b21lcnMKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBzZWxmLm9iamVjdHMgPSBbXQogICAgICBkZWYgcHVzaChzZWxmLG9iaik6CiAgICAgICAgICAgIHNlbGYub2JqZWN0cy5hcHBlbmQob2JqKQogICAgICBkZWYgcG9wKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5vYmplY3RzLnBvcCgwKQogICAgICBkZWYgX19sZW5fXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIGxlbihzZWxmLm9iamVjdHMpCiAgICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc3RyKFtzdHIobykgZm9yIG8gaW4gc2VsZi5vYmplY3RzXSkKY2xhc3MgUXVldWVkRXZlbnQoRXZlbnQpOgogICAgICBpbnN0YW5jZXM9W10KICAgICAgZGVmIF9faW5pdF9fKHNlbGYsbmFtZT1Ob25lKToKICAgICAgICAgICAgRXZlbnQuX19pbml0X18oc2VsZiwwLjAsbmFtZSkgICMgcHJlaW5pdCB0aW1lCiAgICAgICAgICAgIHNlbGYucXVldWUgPSBRdWV1ZSgpICAgICAgIyBvd24gcXVldWUKICAgICAgICAgICAgc2VsZi5vdXRwdXQgPSBbXSAgICAgICAgICAjIG5vIGNvbm5lY3RlZCBvYmplY3RzCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICAgIyBub25lIGJlaW5nIHNlcnZlZAogICAgICAgICAgICBRdWV1ZWRFdmVudC5pbnN0YW5jZXMuYXBwZW5kKHNlbGYpCiAgICAgIGRlZiBzZXROYW1lKHNlbGYsbmFtZSk6CiAgICAgICAgICAgIHNlbGYubmFtZT1uYW1lKyJfIitzZWxmLm5hbWUuc3BsaXQoIl8iKVsxXSAjLnJlcGxhY2UoIkV2ZW50IixuYW1lKS5yZXBsYWNlKCJBY3Rpdml0eSIsbmFtZSkKICAgICAgZGVmIG91dChzZWxmLHNpbSk6ICAgICAgICAgICAgICAjIHBhc3MgdG8gY29ubmVjdGVkIG9iamVjdHMKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4wIGFuZCBpc2luc3RhbmNlKHNlbGYsWG9yR2F0ZSk6ICAKICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID0gMSAgIyBzZW5kIHRvIHNlY29uZCBvdXRwdXQKIyAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgidmFsdWUiIGluIHNlbGYuY3VzdG9tZXIuYXR0ciBhbmQgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdKSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeD0wICMgc2VuZCByYXRoZXIgdG8gZmlyc3Qgb3V0cHV0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLm91dHB1dCk+MjogICMgbW9yZSB0aGFuIDIgb3V0cHV0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHg9aW50KHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRwdXRbaWR4XS5pbnNlcnQoc2VsZi5jdXN0b21lciwgc2ltKQogICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oc2VsZi5vdXRwdXQpKTogICMgc3BsaXQgdG8gYWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0cHV0W2ldLmluc2VydChzZWxmLmN1c3RvbWVyLCBzaW0pCiAgICAgIGRlZiBwcmV2KHNlbGYpOgogICAgICAgICAgICBlcD1bXQogICAgICAgICAgICBmb3IgZTAgaW4gUXVldWVkRXZlbnQuaW5zdGFuY2VzOgogICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZTAub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGUwLm91dHB1dFtpXT09c2VsZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXAuYXBwZW5kKGUwKQogICAgICAgICAgICByZXR1cm4gZXAKCiMgLS0tLSBiYXNpYyBtb2RlbCBjbGFzc2VzIChRdWV1ZUV2ZW50IGRlcml2ZWQpIC0tLS0KY2xhc3MgQnBtbkV2ZW50KFF1ZXVlZEV2ZW50KToKICAgICAgUyA9IHt9CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLG5hbWU9Tm9uZSxjb2RlPU5vbmUpOgogICAgICAgICAgICBRdWV1ZWRFdmVudC5fX2luaXRfXyhzZWxmLG5hbWUpCiAgICAgICAgICAgIHNlbGYuZnVuLHNlbGYucGFyYW0sc2VsZi5jb2RlID0gTm9uZSxOb25lLGNvZGUKICAgICAgICAgICAgc2VsZi5BLHNlbGYucHAsc2VsZi5wcDIsc2VsZi50aXRsZSA9IHsiQS5uIjowfSxbLTEsMF0sWy0xLC0xXSwnJwogICAgICBkZWYgX2Z1bihzZWxmKToKICAgICAgICAgICAgcCA9IHNlbGYucGFyYW0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShwLGxpc3QpOgogICAgICAgICAgICAgICAgICBwID0gW2Zsb2F0KGV2YWwoc2VsZi5hdHRyX3JlcGxhY2Uoc3RyKHMpKSkpIGZvciBzIGluIHBdCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgIHAgPSBmbG9hdChldmFsKHNlbGYuYXR0cl9yZXBsYWNlKHN0cihwKSkpKQogICAgICAgICAgICAjcHJpbnQoIl9mdW46IixzZWxmLmZ1bixwLGxlbihzZWxmLnF1ZXVlKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZnVuKHApIGlmIHNlbGYuZnVuIT1Ob25lIGVsc2UgcAogICAgICBkZWYgYXR0cl9yZXBsYWNlKHNlbGYsY2MpOgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBmb3Igayx2IGluIHNlbGYuY3VzdG9tZXIuYXR0ci5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgICAgICBjYyA9IGNjLnJlcGxhY2UoayxzdHIodikpCiAgICAgICAgICAgIGZvciBrLHYgaW4gQnBtbkV2ZW50LlMuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgY2MgPSBjYy5yZXBsYWNlKGssc3RyKHYpKQogICAgICAgICAgICBmb3Igayx2IGluIHNlbGYuQS5pdGVtcygpOgogICAgICAgICAgICAgICAgICBjYyA9IGNjLnJlcGxhY2UoayxzdHIodikpCiAgICAgICAgICAgIHJldHVybiBjYwogICAgICBkZWYgX2V2YWwoc2VsZixjb2RlLG49LTEpOgogICAgICAgICAgICBjb2Rlcz1zZWxmLmNvZGUuc3BsaXQoIjsiKQogICAgICAgICAgICBpZiBuIT0tMToKICAgICAgICAgICAgICAgICAgY29kZXM9bGVuKGNvZGVzKT5uIGFuZCBbY29kZXNbbl1dIG9yIFtdCiAgICAgICAgICAgIGZvciBjb2RlIGluIGNvZGVzOgogICAgICAgICAgICAgICAgICBjYyA9IGNvZGUuc3BsaXQoIj0iKQogICAgICAgICAgICAgICAgICBjY1swXSA9IGNjWzBdLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgaWYgbGVuKGNjKT09MToKICAgICAgICAgICAgICAgICAgICAgICAgY2M9WyJkdW1teSJdK2NjCiAgICAgICAgICAgICAgICAgIGlmIGxlbihjYyk+MToKICAgICAgICAgICAgICAgICAgICAgICAgY2NbMF0gPSBsZW4oY2NbMF0pPjAgYW5kIGNjWzBdIG9yICJ2YWx1ZSIKICAgICAgICAgICAgICAgICAgICAgICAgY2NbMV0gPSBzZWxmLmF0dHJfcmVwbGFjZSgiPSIuam9pbihjY1sxOl0pKSAjIHJlam9pbgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2PWV2YWwoY2NbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNjWzBdLnN0YXJ0c3dpdGgoIlMuIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJwbW5FdmVudC5TW2NjWzBdXT1ldgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGNjWzBdLnN0YXJ0c3dpdGgoIkEuIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuRVtjY1swXV09ZXYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyW2NjWzBdXT1ldgogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0cltjY1swXV09RmFsc2UKY2xhc3MgQ29uZGl0aW9uYWxFdmVudChCcG1uRXZlbnQpOgogICAgICBkZWYgX19pbml0X18oc2VsZiwgY29kZT1Ob25lKToKICAgICAgICAgICAgQnBtbkV2ZW50Ll9faW5pdF9fKHNlbGYsIE5vbmUsIGNvZGUpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IC0xCiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIgPT0gTm9uZSA6ICMgaWYgZnJlZSBhZGQgdG8gc2ltdWxhdG9yIGNvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IGN1c3QKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdPUZhbHNlCiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKQogICAgICAgICAgICAgICAgICBzaW0uYWRkX2NvbmRpdGlvbihzZWxmKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICBzZWxmLnF1ZXVlLnB1c2goY3VzdCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgZGVmIGV4ZWMoc2VsZiwgc2ltKToKICAgICAgICAgICAgYiA9IEZhbHNlCiAgICAgICAgICAgIGlmIHNlbGYuY29kZSE9Tm9uZToKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUsMCkKICAgICAgICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdPT1UcnVlOgogICAgICAgICAgICAgICAgICAgICAgICBjYz1zZWxmLmNvZGUuc3BsaXQoJzsnKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oY2MpPjE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoIjsiLmpvaW4oY2NbMTpdKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiZSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0KHNpbSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IE5vbmUgICAgIyBtYXJrIHRoYXQgbm93IHRoZSBzZXJ2aWNlIGlzIGZyZWUgISEhCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLnF1ZXVlKT4wIDogICMgYnV0IGlmIGFueWJvZHkgaW4gcXVldWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pbnNlcnQoc2VsZi5xdWV1ZS5wb3AoKSwgc2ltKSAgIyBnZXQgYW5kIGluc2VydCBpbnRvIHNpbXVsYXRvcgogICAgICAgICAgICAgICAgICAgICAgICBiID0gVHJ1ZSAgIyByZWFkeSB0byBiZSByZW1vdmVkIGZyb20gc2ltdWxhdG9yIGNvbmRpdGlvbnMKICAgICAgICAgICAgcmV0dXJuIGIKY2xhc3MgR2VuZXJhdG9yKEJwbW5FdmVudCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmdW4sIHBhcmFtLCB0bWF4PTAuMCwgY29kZT1Ob25lKToKICAgICAgICAgICAgQnBtbkV2ZW50Ll9faW5pdF9fKHNlbGYsIE5vbmUsIGNvZGUpCiAgICAgICAgICAgIHNlbGYuZnVuLCBzZWxmLnBhcmFtLCBzZWxmLnRtYXgsIHNlbGYubiA9IGZ1biwgcGFyYW0sIHRtYXgsIDAKICAgICAgICAgICAgaWYgc2VsZi5jb2RlIT1Ob25lIDoKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUpICAgIyBldmFsdWF0ZSBzY3JpcHQgY29kZSAoW3Zhcl09PHZhbHVlPikKICAgICAgZGVmIGV4ZWMoc2VsZiwgc2ltKToKICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IEN1c3RvbWVyKCkKICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKQogICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgc2VsZi5BWyJBLm4iXSArPSAxCiAgICAgICAgICAgIF9wcmludCgiUmVnaXN0ZXJpbmc6ICIgKyBzdHIoc2VsZi5jdXN0b21lcikgKyAiICgiK3N0cihzZWxmLnRpbWUpKyIpIikKICAgICAgICAgICAgc2VsZi5vdXQoc2ltKSAgICAgICAgICAgICAjIHBhc3MgY3VzdG9tZXIgdG8gY29ubmVjdGVkIG9iamVjdAogICAgICAgICAgICBzZWxmLnRpbWUgKz0gc2VsZi5fZnVuKCkKICAgICAgICAgICAgaWYgc2VsZi50bWF4PjAgYW5kIHNlbGYudGltZSA8PSBzZWxmLnRtYXggb3Igc2VsZi5uPC1zZWxmLnRtYXgtMToKICAgICAgICAgICAgICAgICAgc2VsZi5uICs9IDEKICAgICAgICAgICAgICAgICAgc2ltLmFkZChzZWxmKSAgICAgICAjIG5leHQgb25lIGluIHJhbmRvbSB0aW1lCmNsYXNzIFNlcnZpY2UoQnBtbkV2ZW50KToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIGZ1biwgcGFyYW0sIGNvZGU9Tm9uZSk6IAogICAgICAgICAgICBCcG1uRXZlbnQuX19pbml0X18oc2VsZiwiQWN0aXZpdHkiLGNvZGUpICAKICAgICAgICAgICAgc2VsZi5mdW4sIHNlbGYucGFyYW0gPSBmdW4sIHBhcmFtIAogICAgICAgICAgICBzZWxmLk4gPSAxICMgTiBudW1iZXIgb2YgdG9rZW5zIHRvIHdhaXQgKHVzZWQgZm9yIEFuZEdhdGUpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzZWxmLFhvckdhdGUpOgogICAgICAgICAgICAgICAgICBpZiBsZW4oc2VsZi5vdXRwdXQpPjEgYW5kIHNlbGYuY29kZT09Tm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jb2RlPSI9QigwLjUpIgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyID09IE5vbmU6ICMgaWYgZnJlZSBhZGQgdG8gc2ltdWxhdG9yIHdpdGggZW5kIHRpbWUKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lcix0ID0gY3VzdCxzZWxmLl9mdW4oKQogICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHQsbGlzdCk6ICAjIFtjeWNsZSxiZWdpbj0wXSBjeWNsaWMgdGltZXIgKE1NIDEuMTEuMjAyNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHQpPDI6IHQuYXBwZW5kKDApCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IHRbMV0rbWF0aC5jZWlsKChzaW0ubm93KCktdFsxXSkvdFswXSkqdFswXQogICAgICAgICAgICAgICAgICAgICAgICAjX3ByaW50KCIjICIrc3RyKHNlbGYuY3VzdG9tZXIpKyI6ICIrc3RyKHNpbS5ub3coKSkrIiAiK3N0cihzZWxmLnRpbWUpKQogICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWUgPSBzaW0ubm93KCkgKyB0CiAgICAgICAgICAgICAgICAgIF9wcmludCgiIyIrc3RyKHNlbGYuaWQpKyIgc3RhcnRzIHNlcnZpbmcgIisKICAgICAgICAgICAgICAgICAgICAgICAgIHN0cihjdXN0KSsiICgiK3N0cihzaW0ubm93KCkpKyIsIitzdHIoc2VsZi50aW1lKSsiKSIpCiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXT1zaW0ubm93KCkKICAgICAgICAgICAgICAgICAgaWYgIl9fbiIrc3RyKHNlbGYuaWQpIG5vdCBpbiBzZWxmLmN1c3RvbWVyLmF0dHI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX19uIitzdHIoc2VsZi5pZCldID0gMCAjIGZpcnN0IHRpbWUKICAgICAgICAgICAgICAgICAgaWYgIl9fdCIrc3RyKHNlbGYuaWQpKyJhIiBub3QgaW4gc2VsZi5jdXN0b21lci5hdHRyOgogICAgICAgICAgICAgICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl09c2ltLm5vdygpICMgaWYgbm90IGZyb20gcXVldWUKICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzZWxmLFRpbWVyKSBhbmQgbm90IGlzaW5zdGFuY2UodCxsaXN0KTogICMgbW9kaWZ5IHJlcXVpcmVkIGZpbmFsIGV4ZWN1dGlvbiB0aW1lCiAgICAgICAgICAgICAgICAgICAgICAgIHRhPWN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImEiXSAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRiPWN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXQogICAgICAgICAgICAgICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJiIl0gLT0gKHRiLXRhKSAjIGRlY3JlYXNlIGJlZ2luIHRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lIC09ICh0Yi10YSkgICMgLi4uIGJ5IHRoZSBkaWZmZXJlbmNlIGVsYXBzZWQgYWxyZWFkeQogICAgICAgICAgICAgICAgICAgICAgICAjX3ByaW50KCIjICIrc3RyKHNlbGYuY3VzdG9tZXIpKyI6ICIrc3RyKHNlbGYudGltZSkpCiAgICAgICAgICAgICAgICAgIHNpbS5hZGQoc2VsZikKICAgICAgICAgICAgZWxzZTogICAgICAgICAgICAgICAgICAgICAjIGVsc2UgaW5zZXJ0IGludG8gcXVldWUKICAgICAgICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdPXNpbS5ub3coKSAgIyB3aXRoIGEgcXVldWUgYWRkaW5nIHRpbXN0YW1wCiAgICAgICAgICAgICAgICAgIHNlbGYucXVldWUucHVzaChjdXN0KQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl09c2ltLm5vdygpCiAgICAgICAgICAgICAgICAgIHNlbGYuQVsiQS5uIl0gKz0gMQogICAgICAgICAgICBfcHJpbnQoIiMiK3N0cihzZWxmLmlkKSsiIGZpbmlzaGVkIHNlcnZpbmcgIiArIHN0cihzZWxmLmN1c3RvbWVyKSArICIgYXQgIiArIHN0cihzZWxmLnRpbWUpKQogICAgICAgICAgICBpZiBzZWxmLmNvZGUhPU5vbmUgOiAgICAgIAogICAgICAgICAgICAgICAgICBzZWxmLl9ldmFsKHNlbGYuY29kZSkgICAjIGV2YWx1YXRlIHNjcmlwdCBjb2RlIChbdmFyXT08dmFsdWU+KQogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fbiIrc3RyKHNlbGYuaWQpXSArPSAxCiAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmN1c3RvbWVyLmF0dHJbIl9fbiIrc3RyKHNlbGYuaWQpXSVzZWxmLk4pID09IDA6ICNzZWxmLk46CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0KHNpbSkgICAgICMgcGFzcyBjdXN0b21lciB0byBjb25uZWN0ZWQgb2JqZWN0CiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICMgbWFyayB0aGF0IG5vdyB0aGUgc2VydmljZSBpcyBmcmVlICEhIQogICAgICAgICAgICBpZiBsZW4oc2VsZi5xdWV1ZSk+MCA6ICAjIGJ1dCBpZiBhbnlib2R5IGluIHF1ZXVlCiAgICAgICAgICAgICAgICAgIFNlcnZpY2UuaW5zZXJ0KHNlbGYsc2VsZi5xdWV1ZS5wb3AoKSwgc2ltKSAgIyBnZXQgYW5kIGluc2VydCBpbnRvIHNpbXVsYXRvcgpjbGFzcyBTaW5rKEJwbW5FdmVudCk6CiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKTogICAgCiAgICAgICAgICAgIF9wcmludCgiU2lua2luZyAiK3N0cihjdXN0KSsiIDogIitzdHIoc2ltLm5vdygpKSkKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpICAjIG1hcmsgdGltZSBpbiBjdXN0b21lciBhdHRyaWJ1dGVzCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKSAgIyBtYXJrIHRpbWUgaW4gY3VzdG9tZXIgYXR0cmlidXRlcwogICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl0gPSBzaW0ubm93KCkgICMgbWFyayB0aW1lIGluIGN1c3RvbWVyIGF0dHJpYnV0ZXMKICAgICAgICAgICAgc2VsZi5BWyJBLm4iXSArPSAxCiAgICAgICAgICAgIHNlbGYucXVldWUucHVzaChjdXN0KSAgICAgIyBpbnNlcnQgb25seSB0byBpdHMgcXVldWUKICAgICAgICAgICAgc2VsZi5jdXN0b21lcj1jdXN0CiAgICAgICAgICAgIGlmIHNlbGYuY29kZSE9Tm9uZSA6CiAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoc2VsZi5jb2RlKSAgICMgZXZhbHVhdGUgc2NyaXB0IGNvZGUKIyAtLS0tIGJwbW4gZGVyaXZlZCBjbGFzc2VzIChmcm9tIEdlbmVyYXRvciwgU2VydmljZSwgQ29uZGl0aW9uYWxFdmVudCBvciBTaW5rKSAtLS0tCmNsYXNzIFhvckdhdGUoU2VydmljZSk6ICAgICMgcmFuZG9tIG91dHB1dCBpZiB0d28gb3V0cHV0cyAKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKTogICMgZGVmYXVsdHMgdG8gYmluYXJ5IHJhbmRvbSBzZWxlY3Rpb24KICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImV4Y2x1c2l2ZUdhdGV3YXkiKQpjbGFzcyBBbmRHYXRlKFNlcnZpY2UpOiAgICAKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInBhcmFsbGVsR2F0ZXdheSIpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgaWRzPVtlLmlkIGZvciBlIGluIHNlbGYucHJldigpXSAjIGlkcyBvZiBpbnB1dHMKICAgICAgICAgICAgc2VsZi5OPWxlbihzZXQoaWRzKSkgIyBzZXQgbnVtYmVyIG9mIGlucHV0cyAod2l0aCB1bmlxdWUgaWRzKSB0byB3YWl0CiAgICAgICAgICAgIFNlcnZpY2UuaW5zZXJ0KHNlbGYsY3VzdCxzaW0pCmNsYXNzIFN0YXJ0KEdlbmVyYXRvcik6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGZ1bj1FLHBhcmFtPVsxXSx0bm1heD01MC4wLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIEdlbmVyYXRvci5fX2luaXRfXyhzZWxmLGZ1bixwYXJhbSx0bm1heCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInN0YXJ0RXZlbnQiKQpjbGFzcyBUYXNrKFNlcnZpY2UpOgogICAgICBkZWYgX19pbml0X18oc2VsZixmdW49VSxwYXJhbT1bMSwyXSxjb2RlPU5vbmUsTT0xKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLGZ1bixwYXJhbSxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInRhc2siKQogICAgICAgICAgICBzZWxmLnNlcnZlcnMsIHNlbGYubnNlcnZlciwgc2VsZi5NID0gW10sIDAsIE0KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2Uoc2VsZi5NLTEpOgogICAgICAgICAgICAgICAgICBFdmVudC5jbnQgLT0xCiAgICAgICAgICAgICAgICAgIHNlbGYuc2VydmVycy5hcHBlbmQoU2VydmljZShmdW4scGFyYW0sY29kZSkpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgaWYoc2VsZi5uc2VydmVyPT0wKTogICMgbXlzZWxmCiAgICAgICAgICAgICAgICAgIFNlcnZpY2UuaW5zZXJ0KHNlbGYsY3VzdCxzaW0pCiAgICAgICAgICAgIGVsc2U6ICAgICAgICAgICAgICAjIG90aGVyc2VsZnMKICAgICAgICAgICAgICAgICAgc2VsZi5zZXJ2ZXJzW3NlbGYubnNlcnZlci0xXS5pbnNlcnQoY3VzdCxzaW0pCiAgICAgICAgICAgIHNlbGYubnNlcnZlciA9IChzZWxmLm5zZXJ2ZXIrMSklc2VsZi5NCmNsYXNzIFRpbWVyKFNlcnZpY2UpOgogICAgICBkZWYgX19pbml0X18oc2VsZixmdW49MSxwYXJhbT1Ob25lLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIGlmIG5vdCBjYWxsYWJsZShmdW4pOiAgIyB3aGVuIHBhc3NpbmcgZml4ZWQgZGVsYXkgdmFsdWUKICAgICAgICAgICAgICAgICAgZnVuLHBhcmFtLGNvZGUgPSBOb25lLGZ1bixwYXJhbQogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsZnVuLHBhcmFtLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiaW50ZXJtZWRpYXRlQ2F0Y2hFdmVudCIpCmNsYXNzIEVuZChTaW5rKToKICAgICAgI2RlZiBfX2luaXRfXyhzZWxmKToKICAgICAgIyAgICAgIFNpbmsuX19pbml0X18oc2VsZikKICAgICAgIyAgICAgIHNlbGYuc2V0TmFtZSgiZW5kRXZlbnQiKQogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTaW5rLl9faW5pdF9fKHNlbGYsImVuZEV2ZW50Iixjb2RlKQpjbGFzcyBUaHJvdyhTZXJ2aWNlKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImludGVybWVkaWF0ZVRocm93RXZlbnQiKQpjbGFzcyBUZXJtaW5hdGUoRW5kKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgRW5kLl9faW5pdF9fKHNlbGYsY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJ0ZXJtaW5hdGVFbmRFdmVudCIpCmNsYXNzIFNjcmlwdChTZXJ2aWNlKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgU2VydmljZS5fX2luaXRfXyhzZWxmLE5vbmUsMCxjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInNjcmlwdFRhc2siKQpjbGFzcyBDb25kaXRpb24oQ29uZGl0aW9uYWxFdmVudCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIENvbmRpdGlvbmFsRXZlbnQuX19pbml0X18oc2VsZixjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoImludGVybWVkaWF0ZUNhdGNoRXZlbnQiKQoKIyAtLS0tIHV0aWwyIC0tLS0tLS0tICAgICAgCmRlZiBjb25uZWN0KGEsIGIpOgogICAgICBhLm91dHB1dC5hcHBlbmQoYikKICAgICAgaWYgaXNpbnN0YW5jZShhLFRhc2spOgogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oYS5zZXJ2ZXJzKSk6ICAjIGZpcnN0IHNlcnZlciBpcyBhbHJlYWR5IGNvbm5lY3RlZAogICAgICAgICAgICAgICAgICBhLnNlcnZlcnNbaV0ub3V0cHV0LmFwcGVuZChiKQpkZWYgZGljdF90b3N0cmluZyhhKToKICAgICAgcmV0dXJuICJcbiIuam9pbihbaysiOlx0IitzdHIodikgZm9yIGssdiBpbiBhLml0ZW1zKCldKQoiIiIKZGVmIGhpc3QoYT1bMCwxXSwgYj0yMCwgYz0nb3JhbmdlJyk6CiAgICAgIGltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKICAgICAgcGx0Lmhpc3QoYSxiLGNvbG9yPWMpCiAgICAgICNwbHQuc2F2ZWZpZygiZGVzX3Bsb3Quc3ZnIiwgZm9ybWF0PSJzdmciKQogICAgICAjcGx0LnNob3coKQogICAgICBpbXBvcnQgaW8sIGJhc2U2NAogICAgICBidWYgPSBpby5CeXRlc0lPKCkKICAgICAgcGx0LnNhdmVmaWcoYnVmLCBmb3JtYXQ9J3N2ZycpCiAgICAgIGJ1Zi5zZWVrKDApCiAgICAgIHJldHVybiAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgYmFzZTY0LmI2NGVuY29kZShidWYucmVhZCgpKS5kZWNvZGUoJ1VURi04JykKZGVmIGZyb21fZmlsZShmbmFtZSk6CiAgICAgIHdpdGggb3BlbihmbmFtZSwiciIpIGFzIGZwOgogICAgICAgICAgICByZXR1cm4gZnAucmVhZCgpCiIiIgojIC0tLS0gY29udmVyc2lvbnMgLS0tLS0tLS0gICAgICAKZGVmIGF0dHJfdG9zdHJpbmcoYSk6CiAgICAgIHM9Im5hbWU6ICIrYVsibmFtZSJdKyJcbiIKICAgICAgZm9yIGkgaW4gcmFuZ2UoMSwxMDApOgogICAgICAgICAgICB0PSJfX3QiK3N0cihpKQogICAgICAgICAgICBpZiB0KyJiIiBpbiBhOgogICAgICAgICAgICAgICAgICBzKz10KyIgIisiJS4zZiIlYVt0KyJiIl0rIiAiKyIlLjNmIiVhW3QrImUiXSsiXG4iCiAgICAgIHJldHVybiBzCmRlZiBhdHRyX3Rvc3Znc3RyaW5nKG8sd21heCx3PTE2LGg9MjQpOgogICAgICBnbG9iYWwgbmUKICAgICAgYSxzID0gby5hdHRyLCIiCiAgICAgIGM9Wydob3RwaW5rJywnbGltZWdyZWVuJywnY29ybmZsb3dlcmJsdWUnLCdjb3JhbCcsJ21lZGl1bXNlYWdyZWVuJywnbWVkaXVtcHVycGxlJ10KICAgICAgZm9yIGkgaW4gcmFuZ2UoMTAwKToKICAgICAgICAgICAgdD0iX190IitzdHIoaSkKICAgICAgICAgICAgaWYgdCsiYiIgaW4gYToKICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IHg9IjgiIHk9Iicrc3RyKDMyK2gqaSkrJyI+JytzdHIoaSkrJzx0aXRsZT4nK3N0cihuZS5lZVtpLTFdLm5hbWUpKycgJytzdHIobmUuZWVbaS0xXS50aXRsZSkrJzwvdGl0bGU+PC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICBzKz0nPHRleHQgY2xhc3M9InQxIiBzdHlsZT0iZGlzcGxheTpub25lO2ZpbGw6Z3JheSIgeD0iMzIiIHk9Iicrc3RyKDMyK2gqaSkrJyI+JytzdHIobmUuZWVbaS0xXS50aXRsZSkrJzx0aXRsZT4nK3N0cihuZS5lZVtpLTFdLm5hbWUpKyc8L3RpdGxlPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgdDAsdDEsdDIgPSBhW3QrImEiXSxhW3QrImIiXSxhW3QrImUiXQogICAgICAgICAgICAgICAgICBzKz0nPHJlY3QgeT0iJytzdHIoMjAraCppKSsnIiB4PSInK3N0cigyMCt3KnQxKQogICAgICAgICAgICAgICAgICBzKz0nIiB3aWR0aD0iJytzdHIodDItdDE9PTAgYW5kIDEgb3IgdyoodDItdDEpKSsnIiBoZWlnaHQ9Iicrc3RyKGgtMikrJyIgc3Ryb2tlPSJibGFjayIgZmlsbC1vcGFjaXR5PSIwLjciIGZpbGw9IicKICAgICAgICAgICAgICAgICAgcys9KGNbaW50KGFbImNuYW1lIl0uc3BsaXQoJyAnKVswXSklbGVuKGMpXSkrJyI+PHRpdGxlPicrYVsiY25hbWUiXSsnIFsnKygiJS4yZiwgIiV0MCkrKCIlLjJmLCAiJXQxKSsoIiUuMmYiJXQyKSsnXScrJzwvdGl0bGU+PC9yZWN0PlxuJwogICAgICAgICAgICAgICAgICBpZiB0Mi10MT4wLjU6CiAgICAgICAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSInK3N0cigyMCt3KnQxKzIpKyciIHk9Iicrc3RyKDIwK2gqaSsxOCkrJyI+JythWyJjbmFtZSJdKyc8L3RleHQ+JwogICAgICAgICAgICAgICAgICBpZiB3KnQxPndtYXhbMF06CiAgICAgICAgICAgICAgICAgICAgICAgIHdtYXhbMF0gPSB3KnQxCiAgICAgIHJldHVybiBzCmRlZiB0b19zdmcoZWU9UXVldWVkRXZlbnQuaW5zdGFuY2VzKToKICAgICAgdyxoLFcsSCA9IDE2LDI0LFsxNjBdLDQwICAjIFdbMF0gZm9yIHBhc3NpbmcgYnkgcmVmZXJlbmNlISEhCiAgICAgIHMgPSAnPHN2ZyBvbmNsaWNrPSJvbl9jbGljaygpIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIlZCIgaGVpZ2h0PSIlZCI+XG4nCiAgICAgIGZvciBlIGluIGVlOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGUsRW5kKToKICAgICAgICAgICAgICAgICAgZm9yIGMgaW4gZS5xdWV1ZS5vYmplY3RzOgogICAgICAgICAgICAgICAgICAgICAgICBzICs9IGF0dHJfdG9zdmdzdHJpbmcoYyxXLHcsaCkKICAgICAgICAgICAgSCArPSAyNAogICAgICBIKz0yNAogICAgICBzKz0gJzxyZWN0IHg9IjIwIiB5PSIxMCIgd2lkdGg9IiVkIiBoZWlnaHQ9IjIiLz5cbiclKFdbMF0rdykKICAgICAgcys9ICc8cmVjdCB4PSIyMCIgeT0iJWQiIHdpZHRoPSIlZCIgaGVpZ2h0PSIyIi8+XG4nJShIKzEwLFdbMF0rdykKICAgICAgZm9yIGkgaW4gcmFuZ2UoaW50KFdbMF0vdysyKSk6CiAgICAgICAgICAgIHMgKz0gJzxyZWN0IHg9Iicrc3RyKDIwK3cqaSkrJyIgeT0iMTAiIHdpZHRoPSIxIiBoZWlnaHQ9IjEwIi8+XG4nCiAgICAgICAgICAgIHMgKz0gJzxyZWN0IHg9Iicrc3RyKDIwK3cqaSkrJyIgeT0iJWQiIHdpZHRoPSIxIiBoZWlnaHQ9IjEwIi8+XG4nJShIKQogICAgICAgICAgICBpZiAoaSUxMCk9PTA6CiAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSInK3N0cigyMCt3KmktOCkrJyIgeT0iMzIiPicrc3RyKGkpKyc8L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSInK3N0cigyMCt3KmktOCkrJyIgeT0iJWQiPiclKEgpK3N0cihpKSsnPC90ZXh0PlxuJwogICAgICBzICs9ICI8c2NyaXB0PmZ1bmN0aW9uIG9uX2NsaWNrKCkge1suLi5kb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0MScpXS5mb3JFYWNoKGU9PmUuc3R5bGUuZGlzcGxheT0oZS5zdHlsZS5kaXNwbGF5PT0nbm9uZSc/Jyc6J25vbmUnKSk7fTwvc2NyaXB0PiIKICAgICAgcmV0dXJuIHMlKFdbMF0rODAsSCsyMCkgKyAnPC9zdmc+XG4nCmRlZiB0b19kb3QwKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHMgPSdkaWdyYXBoIEJQTU4geyByYW5rZGlyPSJMUiIgcmFua3NlcD0xIG5vZGVzZXA9MVxuJwogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpKToKICAgICAgICAgICAgczEgPSAnICB7cmFuaz1zYW1lOyAnCiAgICAgICAgICAgIGZvciBqIGluIHJhbmdlKGxlbihlZVtpXS5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgcyArPSAiICAiK3N0cihlZVtpXS5pZCkgKyAiIC0+ICIgKyBzdHIoZWVbaV0ub3V0cHV0W2pdLmlkKSArIlxuIgogICAgICAgICAgICAgICAgICBzMSArPSBzdHIoZWVbaV0ub3V0cHV0W2pdLmlkKSArIjsgIgogICAgICAgICAgICBpZiBsZW4oZWVbaV0ub3V0cHV0KT4xOgogICAgICAgICAgICAgICAgICBpZiBhYnMoZWVbaV0ub3V0cHV0WzBdLmlkLWVlW2ldLm91dHB1dFsxXS5pZCk8MjogcyArPSBzMSArJ31cbicKICAgICAgcmV0dXJuIHMrJ30nCmRlZiB0b19kb3QoZWU9UXVldWVkRXZlbnQuaW5zdGFuY2VzKToKICAgICAgcyA9J2RpZ3JhcGggQlBNTjIgeyByYW5rZGlyPSJMUiIgbm9kZXNlcD0wLjZcbicKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6CiAgICAgICAgICAgIGxhYmVsLHhsYWJlbCxzaGFwZSxzdHlsZSxjb2xvcixwZW4gPSBzdHIoZWVbaV0uaWQpLCIiLCJyZWN0IiwiIiwiIiwiMSIKICAgICAgICAgICAgc2l6ZT0iIgogICAgICAgICAgICBpZiAidmVudCIgaW4gZWVbaV0ubmFtZTogc2hhcGU9ImNpcmNsZSIKICAgICAgICAgICAgZWxpZiAiYXRld2F5IiBpbiBlZVtpXS5uYW1lOiBzaGFwZT0iZGlhbW9uZCI7IHNpemU9ImhlaWdodD0wLjciCiAgICAgICAgICAgIGlmICJpbnRlcm1lZGlhdGUiIGluIGVlW2ldLm5hbWU6IHNoYXBlPSJkb3VibGVjaXJjbGUiCiAgICAgICAgICAgIGlmIHNoYXBlPT0icmVjdCI6IHN0eWxlPSJyb3VuZGVkLGZpbGxlZCI7IGNvbG9yPSJsaWdodGJsdWUiOyBzaXplPSJ3aWR0aD0xLjEgaGVpZ2h0PTAuOCIKICAgICAgICAgICAgZWxpZiAiZW5kIiBpbiBlZVtpXS5uYW1lOiBzdHlsZT0iZmlsbGVkIjsgcGVuPSIzIgogICAgICAgICAgICBpZiAiZXhjbHVzaXZlIiBpbiBlZVtpXS5uYW1lOiB4bGFiZWw9bGFiZWw7IGxhYmVsPSJYIgogICAgICAgICAgICBlbGlmICJwYXJhbGxlbCIgaW4gZWVbaV0ubmFtZTogeGxhYmVsPWxhYmVsOyBsYWJlbD0iKyIKICAgICAgICAgICAgcyArPSAnICAnK2VlW2ldLm5hbWUgKycgW2xhYmVsPSInK2xhYmVsKyciIHhsYWJlbD0iJyt4bGFiZWwKICAgICAgICAgICAgcyArPSAnIiBzdHlsZT0iJytzdHlsZSsnIiBzaGFwZT0iJytzaGFwZSsnIiBmaWxsY29sb3I9IicKICAgICAgICAgICAgcyArPSBjb2xvcisnIiBwZW53aWR0aD0iJytwZW4rJyIgJytzaXplKyddJyArJ1xuJwogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpKToKICAgICAgICAgICAgczEgPSAnICB7cmFuaz1zYW1lOyAnCiAgICAgICAgICAgIGZvciBqIGluIHJhbmdlKGxlbihlZVtpXS5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgcyArPSAiICAiK2VlW2ldLm5hbWUgKyAiIC0+ICIgKyBlZVtpXS5vdXRwdXRbal0ubmFtZSArIlxuIgogICAgICAgICAgICAgICAgICBzMSArPSBlZVtpXS5vdXRwdXRbal0ubmFtZSArIjsgIgogICAgICAgICAgICBpZiBsZW4oZWVbaV0ub3V0cHV0KT4xOgogICAgICAgICAgICAgICAgICBpZiBhYnMoZWVbaV0ub3V0cHV0WzBdLmlkLWVlW2ldLm91dHB1dFsxXS5pZCk8MjogcyArPSBzMSArJ31cbicKICAgICAgcmV0dXJuIHMrJ30nCmRlZiB0b19wb3NpdGlvbihlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMpOgogICAgICBwcD1bXQogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpKTogICAjIHNldCB4IHBvc2l0aW9uIHRvIHRyZWUgbGV2ZWwKICAgICAgICAgICAgeCxlcCA9IDAsZWVbaV0ucHJldigpCiAgICAgICAgICAgIGZvciBpZHggaW4gcmFuZ2UobGVuKGVwKS0xLC0xLC0xKToKICAgICAgICAgICAgICAgICAgaWYgZXBbaWR4XS5wcFswXSE9LTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHg9ZXBbaWR4XS5wcFswXSsxCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVlW2ldLnBwPVt4LDBdCiAgICAgICAgICAgIHBwLmFwcGVuZChlZVtpXS5wcCkKICAgICAgI3ByaW50KFtfLnBwIGZvciBfIGluIGVlXSkKICAgICAgZm9yIGkgaW4gcmFuZ2UoMSxsZW4ocHApKTogIyBpbmNyZWFzZSB5IHBvc2l0aW9uIGZvciBhbGwgYXQgdGhlIHNhbWUgbGV2ZWwKICAgICAgICAgICAgaWYgcHBbaV1bMF09PXBwW2ktMV1bMF06CiAgICAgICAgICAgICAgICAgIHBwW2ldWzFdID0gcHBbaS0xXVsxXSsxCiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwPXBwW2ldCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pCiAgICAgICMiIiIKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKS0xLC0xLC0xKTogICAjIHNldCB5IHBvc2l0aW9uIHRvIHRoZSBsZXZlbCBvZiBwcmV2aW91cyAKICAgICAgICAgICAgZSA9IGVlW2ldLnByZXYoKQogICAgICAgICAgICBpZiBsZW4oZSk+MCBhbmQgZVswXS5vdXRwdXRbMF09PWVlW2ldOgogICAgICAgICAgICAgICAgICBwcFtpXVsxXSA9IGVbMF0ucHBbMV0KICAgICAgICAgICAgICAgICAgZWVbaV0ucHA9cHBbaV0KICAgICAgICAgICAgaWYgbGVuKGUpPjAgYW5kIGxlbihlWzBdLm91dHB1dCk+MSBhbmQgZVswXS5vdXRwdXRbMV09PWVlW2ldIGFuZCBsZW4oZWVbaV0ub3V0cHV0KT09MDoKICAgICAgICAgICAgICAgICAgcHBbaV1bMF0gPSBlZVtpXS5wcFswXS0xICAjIHdoZW4gaXQgaXMgdGhlIHNlY29uZCBhbmQgaGFzIG5vIG91cHV0CiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwPXBwW2ldCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pCiAgICAgICMiIiIKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKS0xLC0xLC0xKTogIyBtb3ZlIHByZXZpb3VzIHRvIHRoZSBsZXZlbCBvZiBpdHMgZmlyc3QgbmV4dAogICAgICAgICAgICBlcD1lZVtpXS5wcmV2KCkKICAgICAgICAgICAgaWYgbGVuKGVwKT4wIGFuZCBlcFswXS5vdXRwdXRbMF09PWVlW2ldIGFuZCBlcFswXS5wcFswXT09ZWVbaV0ucHBbMF0tMToKICAgICAgICAgICAgICAgICAgaWYgZXBbMF0ucHBbMV0hPWVlW2ldLnBwWzFdOgogICAgICAgICAgICAgICAgICAgICAgICBlcFswXS5wcFsxXT1lZVtpXS5wcFsxXQogICAgICAjcHJpbnQoW18ucHAgZm9yIF8gaW4gZWVdKSAgICAgIAogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpKTogICMgZm9yY2UgcG9zaXRpb24gZnJvbSBwcDIKICAgICAgICAgICAgaWYgZWVbaV0ucHAyWzBdIT0tMToKICAgICAgICAgICAgICAgICAgZWVbaV0ucHBbMF09ZWVbaV0ucHAyWzBdCiAgICAgICAgICAgIGlmIGVlW2ldLnBwMlsxXSE9LTE6CiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwWzFdPWVlW2ldLnBwMlsxXQogICAgICBmb3IgZSBpbiBlZTogICAjIGNvcnJlY3QgcG9zaXRpb24gb2YgYm91bmRhcnkgZXZlbnRzIAogICAgICAgICAgICAjaWYoZS5wcFswXT09MCBhbmQgZS5wcFsxXT09MCk6CiAgICAgICAgICAgIGlmKGUuaWQhPWUuaWQyKToKICAgICAgICAgICAgICAgICAgaWQyPWludChzdHIoZS5pZDIpLnNwbGl0KCIuIilbMV0pCiAgICAgICAgICAgICAgICAgIGUucHBbMF0sZS5wcFsxXSA9IGVlW2lkMi0xXS5wcFswXSxlZVtpZDItMV0ucHBbMV0KICAgICAgcmV0dXJuIFtlLnBwIGZvciBlIGluIGVlXQpkZWYgdG9fYnBtbihlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMscHA9Tm9uZSk6CiAgICAgIHMgPSc8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJVVEYtOCI/PlxuJwogICAgICBzKz0nPGJwbW46ZGVmaW5pdGlvbnMgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSInCiAgICAgIHMrPScgeG1sbnM6YnBtbj0iaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9NT0RFTCInCiAgICAgIHMrPScgeG1sbnM6YnBtbmRpPSJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L0RJIicKICAgICAgcys9JyB4bWxuczpkYz0iaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREMiJwogICAgICBzKz0nIHhtbG5zOmRpPSJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9ESSInCiAgICAgIHMrPScgdGFyZ2V0TmFtZXNwYWNlPSJodHRwOi8vYnBtbi5pby9zY2hlbWEvYnBtbiInCiAgICAgIHMrPScgaWQ9IkRlZmluaXRpb25zXzEiIGV4cG9ydGVyPSJkZXMiIGV4cG9ydGVyVmVyc2lvbj0iMS4wIj5cbicKICAgICAgczE9JyA8YnBtbjpwcm9jZXNzIGlkPSJQcm9jZXNzXzEiPlxuJwogICAgICBzMj0nIDxicG1uZGk6QlBNTkRpYWdyYW0gaWQ9IkJQTU5EaWFncmFtXzEiPlxuJwogICAgICBzMis9JyAgPGJwbW5kaTpCUE1OUGxhbmUgaWQ9IkJQTU5QbGFuZV8xIiBicG1uRWxlbWVudD0iUHJvY2Vzc18xIj5cbicKICAgICAgczFhPScnCiAgICAgIGoxID0gMCAgIyBmbG93IGNvdW50ZXIKICAgICAgVyxILFcwLEgwID0gMTAwLDEwMCw0MCwzMAogICAgICBpZiBub3QgcHA6CiAgICAgICAgICAgIHBwID0gW2UucHAgZm9yIGUgaW4gZWVdCiAgICAgICAgICAgIGlmIHBwWzBdWzBdPT0tMToKICAgICAgICAgICAgICAgICAgcHAgPSB0b19wb3NpdGlvbihlZSkKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6CiAgICAgICAgICAgIG5hbWUgPSBlZVtpXS5uYW1lCiAgICAgICAgICAgIGlmICJ0ZXJtaW5hdGUiIGluIG5hbWU6CiAgICAgICAgICAgICAgICAgIG5hbWU9bmFtZVtsZW4oInRlcm1pbmF0ZSIpOl0KICAgICAgICAgICAgZW5hbWUgPSBlZVtpXS5fX2NsYXNzX18uX19uYW1lX18rJ18nK3N0cihlZVtpXS5mdW4gYW5kIGVlW2ldLmZ1bi5fX25hbWVfXyBvciBOb25lKSsnXycKICAgICAgICAgICAgaW1wb3J0IGJhc2U2NAogICAgICAgICAgICBlbmFtZSArPSBiYXNlNjQuYjE2ZW5jb2RlKGJ5dGVhcnJheShzdHIoZWVbaV0ucGFyYW0pKydfJytzdHIoZWVbaV0uY29kZSksJ2FzY2lpJykpLmRlY29kZSgnYXNjaWknKSAjIHJlcXVpcmVzIGVuY29kaW5nIQogICAgICAgICAgICB0eXBlPW5hbWUuc3BsaXQoIl8iKVswXQogICAgICAgICAgICBndD17IndpIjo4MCwiaCI6NjAsIm94IjowLCJveSI6MCwiZSI6KDgwLDMwKSwidyI6KDAsMzApLCJuIjooNDAsMCksInMiOig0MCw2MCl9CiAgICAgICAgICAgIGdnPXsid2kiOjM2LCJoIjozNiwib3giOjIyLCJveSI6MTIsImUiOig1OCwzMCksInciOigyMiwzMCksIm4iOig0MCwxMiksInMiOig0MCw0OCl9CiAgICAgICAgICAgIGcxID0gZ3QgaWYgImFzayIgaW4gdHlwZSBlbHNlIGdnCiAgICAgICAgICAgIHcsaCA9IGcxWyJ3aSJdLGcxWyJoIl0gICMgaWNvbiBzaXplCiAgICAgICAgICAgIHhiLHliID0gVzArVypwcFtpXVswXSwgSDArSCpwcFtpXVsxXQogICAgICAgICAgICB4byx5byA9IHhiK2cxWyJveCJdLCB5YitnMVsib3kiXSAjIGljb24gb2Zmc2V0CiAgICAgICAgICAgIGlmICJ0YXNrIiBpbiB0eXBlOgogICAgICAgICAgICAgICAgICBpZiBsZW4oZWVbaV0ub3V0cHV0KT4xOiB0eXBlID0gInNlbmRUYXNrIgogICAgICAgICAgICAgICAgICBpZiBsZW4oc2V0KFtlLmlkIGZvciBlIGluIGVlW2ldLnByZXYoKV0pKT4xOiB0eXBlID0gInJlY2VpdmVUYXNrIgogICAgICAgICAgICBpZiBlZVtpXS5pZCAhPSBlZVtpXS5pZDI6ICAjIGZvciBib3VuZGFyeSBldmVudHMKICAgICAgICAgICAgICAgICAgaWQyID0gaW50KHN0cihlZVtpXS5pZDIpLnNwbGl0KCcuJylbMV0pCiAgICAgICAgICAgICAgICAgIHhvLHlvID0gZWVbaWQyLTFdLngrMjIuNSxlZVtpZDItMV0ueSs0Mi41CiAgICAgICAgICAgICAgICAgIHR5cGUgPSAiYm91bmRhcnlFdmVudCIKICAgICAgICAgICAgZWVbaV0ueCxlZVtpXS55ID0geG8seW8KICAgICAgICAgICAgczErPScgIDxicG1uOicrdHlwZSsnIGlkPSInK25hbWUrJyIgbmFtZT0iJytuYW1lLnNwbGl0KCJfIilbMV0rJ1xuJytlZVtpXS50aXRsZSsnIj5cbicKICAgICAgICAgICAgczIrPScgICA8YnBtbmRpOkJQTU5TaGFwZSBpZD0iJytuYW1lKydfJytlbmFtZSsnIiBicG1uRWxlbWVudD0iJytuYW1lKyciPlxuJwogICAgICAgICAgICBzMis9JyAgICA8ZGM6Qm91bmRzIHg9Iicrc3RyKHhvKSsnIiB5PSInK3N0cih5bykrJyIgd2lkdGg9Iicrc3RyKHcpKyciIGhlaWdodD0iJytzdHIoaCkrJyIgLz5cbicKICAgICAgICAgICAgczIrPScgICA8L2JwbW5kaTpCUE1OU2hhcGU+XG4nCiAgICAgICAgICAgIGZvciBqMiBpbiByYW5nZShsZW4oZWVbaV0ub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgIGoxICs9IDEKICAgICAgICAgICAgICAgICAgZmxvdyxlZmxvdz0nRmxvd18nK3N0cihqMSksImRpIgogICAgICAgICAgICAgICAgICBpaSA9IGVlW2ldLm91dHB1dFtqMl0uaWQtMQogICAgICAgICAgICAgICAgICAjcHJpbnQoZWVbaV0sajIsZWVbaV0ub3V0cHV0W2oyXSxpaSxwcCkKICAgICAgICAgICAgICAgICAgeGUseWUgPSBXMCtXKnBwW2lpXVswXSwgSDArSCpwcFtpaV1bMV0KICAgICAgICAgICAgICAgICAgbmFtZTI9ZWVbaV0ub3V0cHV0W2oyXS5uYW1lCiAgICAgICAgICAgICAgICAgIGlmICJ0ZXJtaW5hdGUiIGluIG5hbWUyOgogICAgICAgICAgICAgICAgICAgICAgICBuYW1lMj1uYW1lMltsZW4oInRlcm1pbmF0ZSIpOl0KICAgICAgICAgICAgICAgICAgdHlwZTI9bmFtZTIuc3BsaXQoIl8iKVswXQogICAgICAgICAgICAgICAgICBnMiA9IGd0IGlmICJhc2siIGluIHR5cGUyIGVsc2UgZ2cKICAgICAgICAgICAgICAgICAgaWYgeGU+eGI6ICMgdHdvIGVkZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgIGR4MSxkeTEgPSBnMVsicyJdIGlmIHliPHllIGVsc2UgZzFbImUiXQogICAgICAgICAgICAgICAgICAgICAgICBkeDIsZHkyID0gZzJbInMiXSBpZiB5Yj55ZSBlbHNlIGcyWyJ3Il0KICAgICAgICAgICAgICAgICAgZWxzZSA6ICAgICMgdGhyZWUgZWRnZXMKICAgICAgICAgICAgICAgICAgICAgICAgZHgxLGR5MSA9IGcxWyJzIl0gaWYgeWI8eWUgZWxzZSBnMVsibiJdCiAgICAgICAgICAgICAgICAgICAgICAgIGR4MixkeTIgPSBnMlsicyJdIGlmIHliPnllIGVsc2UgZzJbIm4iXQogICAgICAgICAgICAgICAgICB4MSx5MSA9IHhiK2R4MSx5YitkeTEKICAgICAgICAgICAgICAgICAgeDIseTIgPSB4ZStkeDIseWUrZHkyCiAgICAgICAgICAgICAgICAgIHMxKz0nICAgPGJwbW46b3V0Z29pbmc+JytmbG93Kyc8L2JwbW46b3V0Z29pbmc+XG4nCiAgICAgICAgICAgICAgICAgIGlmICJpbnRlcm1lZGlhdGVDYXRjaCIgaW4gbmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgIm9uZGl0aW9uIiBpbiBlbmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgczErPScgICA8YnBtbjpjb25kaXRpb25hbEV2ZW50RGVmaW5pdGlvbi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMxKz0nICAgPGJwbW46dGltZXJFdmVudERlZmluaXRpb24vPlxuJwogICAgICAgICAgICAgICAgICBzMWErPScgICAgPGJwbW46c2VxdWVuY2VGbG93IGlkPSInK2Zsb3crJyIgc291cmNlUmVmPSInK25hbWUrJyIgdGFyZ2V0UmVmPSInK25hbWUyKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgIHMyKz0nICAgPGJwbW5kaTpCUE1ORWRnZSBpZD0iJytmbG93KydfJytlZmxvdysnIiBicG1uRWxlbWVudD0iJytmbG93KyciPlxuJwogICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDEpKyciIHk9Iicrc3RyKHkxKSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICB4eCx5eSA9IDAsMAogICAgICAgICAgICAgICAgICBpZiB5MSE9eTI6ICMgcmVxdWlyZXMgYWRkaXRpb25hbCBwb2ludHMgKG9uZSBvciB0d28gaW1wbGVtZW50ZWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHh4LCB5eSA9IHkyPnkxIGFuZCB4MSBvciB4MiwgeTI+eTEgYW5kIHkyIG9yIHkxCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHgxPngyOiAjIGJhY2sgY29ubmVjdGlvbiByZXF1aXJlcyB0d28gYWRkaXRpb25hbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB5MT55MjogIyBmcm9tIGxvd2VyIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl5IC09IDM1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MSkrJyIgeT0iJytzdHIoeXkpKyciIC8+XG4nICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIHkxPHkyOiAjIGZyb20gdXBwZXIgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeXkgLT0gMjUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHh4KSsnIiB5PSInK3N0cih5eSkrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHggPSB4MgogICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeHgpKyciIHk9Iicrc3RyKHl5KSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICBlbGlmIHkxPT15MiBhbmQgeDE+eDI6ICMgbG9vcGJhY2sgLSByZXF1aXJlcyB0d28gYWRkaXRpb25hbCBwb2ludHMKICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgxKSsnIiB5PSInK3N0cih5MS0zMCkrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgyKSsnIiB5PSInK3N0cih5Mi0zMCkrJyIgLz5cbicgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgIGlmIHh4IT14MiBvciB5eSE9eTI6CiAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MikrJyIgeT0iJytzdHIoeTIpKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgIHMyKz0nICAgPC9icG1uZGk6QlBNTkVkZ2U+XG4nCiAgICAgICAgICAgIGlmICJ0ZXJtaW5hdGUiIGluIGVlW2ldLm5hbWU6CiAgICAgICAgICAgICAgICAgIHMxKz0nICAgPGJwbW46dGVybWluYXRlRXZlbnREZWZpbml0aW9uLz5cbicKICAgICAgICAgICAgczErPScgIDwvYnBtbjonK3R5cGUrJz5cbicKICAgICAgICAgICAgcGFzcwogICAgICBzMis9JyAgPC9icG1uZGk6QlBNTlBsYW5lPlxuJwogICAgICBzMis9JyA8L2JwbW5kaTpCUE1ORGlhZ3JhbT5cbicKICAgICAgczErPXMxYSsnIDwvYnBtbjpwcm9jZXNzPlxuJwogICAgICByZXR1cm4gcytzMStzMisnPC9icG1uOmRlZmluaXRpb25zPlxuJwoKZW5fdGl0bGUgPSAiIgpjbGFzcyBFdmVudE5ldHdvcmsoKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYscyk6CiAgICAgICAgICAgIEV2ZW50LmNudCwgQ3VzdG9tZXIuY250ID0gMCwgMAogICAgICAgICAgICBRdWV1ZWRFdmVudC5pbnN0YW5jZXMuY2xlYXIoKQogICAgICAgICAgICBCcG1uRXZlbnQuUyA9IHt9CiAgICAgICAgICAgIHNlbGYuZWUgPSBzZWxmLmZyb21fc3RyaW5nKHMpCiAgICAgICAgICAgIHNlbGYucHAgPSB0b19wb3NpdGlvbihzZWxmLmVlKQogICAgICBkZWYgX19nZXRpdGVtX18oc2VsZixpKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZWVbaV0KICAgICAgZGVmIGZyb21fc3RyaW5nKHNlbGYscyk6CiAgICAgICAgICAgIGdsb2JhbCBlbl90aXRsZQogICAgICAgICAgICBlZSwgRXZlbnQuY250LCB5bGV2ZWwsIGVuX3RpdGxlID0gW10sIDAsIC0xLCAnJwogICAgICAgICAgICBzcyA9IHMuc3BsaXQoJ1xuJykKICAgICAgICAgICAgZm9yIHMwIGluIHNzOgogICAgICAgICAgICAgICAgICBzMSA9IHMwLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgaWYgbGVuKHMxKTwyIG9yIHMxWzBdPT0nIyc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHMxPT1zc1swXTogIyB0aXRsZSBpbiBmaXJzdCBsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuX3RpdGxlID0gc3NbMF1bMTpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgIGlmICItPiIgaW4gczE6ICMgY29ubmVjdGlvbiBkZWZpbml0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHlsZXZlbCArPSAxICAgIyB1c2VkIGZvciBtYXJraW5nIHJlcXVpcmVkIHkgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHMxYSBpbiBzMS5zcGxpdCgiOyIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSBzMWEuc3RyaXAoKS5zcGxpdCgiLT4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihjb2RlKT4xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZVsxXT1jb2RlWzFdLnNwbGl0KCIjIilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGksaiA9IGludChjb2RlWzBdKS0xLCBpbnQoY29kZVsxXSktMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaT4tMSBhbmQgaj4tMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3QoZWVbaV0sZWVbal0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpPi0xIGFuZCBlZVtpXS5wcDJbMV09PS0xOiAjIGlmIG5vdCBzZXQgeWV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVtpXS5wcDJbMV09eWxldmVsICMgZm9yY2UgeSBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaj4tMSBhbmQgZWVbal0ucHAyWzFdPT0tMTogIyBpZiBub3Qgc2V0IHlldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbal0ucHAyWzFdPXlsZXZlbCAjIGZvcmNlIHkgcG9zaXRpb24gICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgZWxzZTogICAgICAgICAgIyBldmVudCBkZWZpbml0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU9czEuc3BsaXQoIiAiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oY29kZSk+MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlMT0iICIuam9pbihjb2RlWzE6XSkuc3BsaXQoJyMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlLmFwcGVuZChldmFsKGNvZGUxWzBdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVstMV0uaWQyPWZsb2F0KGNvZGVbMF0uc3BsaXQoJy8nKVswXSkgIyBpZCBhcyB3cml0dGVuIGluIHNvdXJjZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVstMV0udGl0bGU9Y29kZTFbMV0uc3RyaXAoKSBpZiBsZW4oY29kZTEpPjEgZWxzZSAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjPWNvZGVbMF0uc3BsaXQoIi8iKSAgIyBjaGVjayBpZGVudGlmaWVyIGZpZWxkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbLTFdLnBwMlswXSA9IGZsb2F0KGNjWzFdKS0xIGlmIGxlbihjYyk+MSBlbHNlIC0xIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS5wcDJbMV0gPSBmbG9hdChjY1syXSktMSBpZiBsZW4oY2MpPjIgZWxzZSAtMQogICAgICAgICAgICBpZiBsZW4oc2V0KFtlLnBwMlsxXSBmb3IgZSBpbiBlZV0pKT09MTogIyB2ZXJpZnkgaWYgbXVsdGktbGluZSBkZXNjcmlwdGlvbgogICAgICAgICAgICAgICAgICBmb3IgZSBpbiBlZTogICAgICAjIGlmIHllcwogICAgICAgICAgICAgICAgICAgICAgICBlLnBwMlsxXT0tMSAjIGNsZWFyIGFsbCB5LWxldmVscyB0byB1bmtub3duCiAgICAgICAgICAgIHJldHVybiBlZQogICAgICBkZWYgdG9fc3RyaW5nKHNlbGYpOgogICAgICAgICAgICBzPScnCiAgICAgICAgICAgIGZvciBlIGluIHNlbGYuZWU6CiAgICAgICAgICAgICAgICAgIHMgKz0gc3RyKGUuaWQpICsgIiAiICsgZS5fX2NsYXNzX18uX19uYW1lX18rIigiCiAgICAgICAgICAgICAgICAgIGlmIGUuX19jbGFzc19fLl9fbmFtZV9fIT0nRW5kJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgIkdhdGUiIG5vdCBpbiBlLl9fY2xhc3NfXy5fX25hbWVfXzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBlLmZ1biBhbmQgZS5mdW4uX19uYW1lX18gb3IgJ05vbmUnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0iLCIrc3RyKGUucGFyYW0pKyIsIgogICAgICAgICAgICAgICAgICAgICAgICBpZiBlLl9fY2xhc3NfXy5fX25hbWVfXyE9J1N0YXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9IGUuY29kZSE9Tm9uZSBhbmQgIlwiIitzdHIoZS5jb2RlKSsiXCIiIG9yICJOb25lIgogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz1zdHIoZS50bm1heCkKICAgICAgICAgICAgICAgICAgcyArPSIpXG4iCiAgICAgICAgICAgIGZvciBlIGluIGVlOgogICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZS5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBzdHIoZS5pZCkgKyAiLT4iICsgc3RyKGUub3V0cHV0W2ldLmlkKSArJzsnCiAgICAgICAgICAgIHJldHVybiBzICsgJ1xuJwpkZWYgc3ZnX3JvdW5kZWRQYXRoKHBwLCByKToKICAgICAgaW1wb3J0IG1hdGgKICAgICAgcywgbCA9ICIiLCBsZW4ocHApLTEKICAgICAgZm9yIGkgaW4gcmFuZ2UobCk6CiAgICAgICAgICAgIGEsYiA9IHBwW2ldLCBwcFtpKzFdCiAgICAgICAgICAgIHQgPSBtaW4ociAvIG1hdGguaHlwb3QoYlswXS1hWzBdLCBiWzFdLWFbMV0rMC4wMSksIDAuNSkKICAgICAgICAgICAgaWYgaT09MDoKICAgICAgICAgICAgICAgICAgcyArPSAnTSVnICVnICclKGFbMF0sYVsxXSkKICAgICAgICAgICAgaWYgaT4wOgogICAgICAgICAgICAgICAgICBzICs9ICdRJWcgJWcgJWcgJWcgJyUoYVswXSxhWzFdLGFbMF0qKDEtdCkrYlswXSp0LGFbMV0qKDEtdCkrYlsxXSp0KQogICAgICAgICAgICBpZiBpPT1sLTE6CiAgICAgICAgICAgICAgICAgIHMgKz0gJ0wlZyAlZyAnJShiWzBdLGJbMV0pCiAgICAgICAgICAgIGVsaWYgaTxsLTE6CiAgICAgICAgICAgICAgICAgIHMgKz0gJ0wlZyAlZyAnJShhWzBdKnQrYlswXSooMS10KSxhWzFdKnQrYlsxXSooMS10KSkKICAgICAgcmV0dXJuIHMKI05TX01BUCA9IHsKIyAgICBOb25lOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9NT0RFTCcsCiMgICAgJ2JwbW5kaSc6ICdodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L0RJJywKIyAgICAnb21nZGMnOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREMnLAojICAgICdvbWdkaSc6ICdodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9ESScsCiMgICAgJ3hzaSc6ICdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZScKI30KZGVmIGJwbW5fdG9zdmcwKGJwbW5maWxlLFc9MTAwLEg9ODApOgogICAgICBzID0gJzxkZWZzPjxtYXJrZXIgaWQ9InRyaWFuZ2xlIiB2aWV3Qm94PSIwIDAgMTAgMTAiIHJlZlg9IjEwIiByZWZZPSI1IiBtYXJrZXJVbml0cz0ic3Ryb2tlV2lkdGgiIG1hcmtlcldpZHRoPSIxMCIgbWFya2VySGVpZ2h0PSIxMCIgb3JpZW50PSJhdXRvIj4gPHBhdGggZD0iTSAwIDAgTCAxMCA1IEwgMCAxMCB6IiBmaWxsPSJibGFjayIgLz48L21hcmtlcj48L2RlZnM+XG4nCiAgICAgIGltcG9ydCB4bWwuZXRyZWUuRWxlbWVudFRyZWUgYXMgRVQKICAgICAgZm9yIGUgaW4gRVQucGFyc2UoYnBtbmZpbGUpLmdldHJvb3QoKToKICAgICAgICAgICAgaWYgIkJQTU5EaWFncmFtIiBpbiBlLnRhZzoKICAgICAgICAgICAgICAgICAgZm9yIGQgaW4gZToKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM9W3AgZm9yIHAgaW4gZCBpZiAiQlBNTlBsYW5lIiBpbiBkLnRhZ10KICAgICAgcmV0dXJuIGl0ZW1zCiNkZWYgYnBtbl90b3N2ZyhicG1uZmlsZSxXPTEwMCxIPTgwKToKZGVmIGJwbW5fdG9zdmcoYnBtbnN0cmluZyxpc2FuaW0saXNjb21tZW50cyxpc3NjcmlwdHMsVz0xMDAsSD04MCk6CiAgICAgIHMgPSAnPGRlZnM+PG1hcmtlciBpZD0idHJpYW5nbGUiIHZpZXdCb3g9IjAgMCAxMCAxMCIgcmVmWD0iMTAiIHJlZlk9IjUiIG1hcmtlclVuaXRzPSJzdHJva2VXaWR0aCIgbWFya2VyV2lkdGg9IjEwIiBtYXJrZXJIZWlnaHQ9IjEwIiBvcmllbnQ9ImF1dG8iPiA8cGF0aCBkPSJNIDAgMCBMIDEwIDUgTCAwIDEwIHoiIGZpbGw9ImJsYWNrIiAvPjwvbWFya2VyPjwvZGVmcz5cbicKICAgICAgcyArPSAnPHRleHQgeD0iMTAiIHk9IjEyIj4nK2VuX3RpdGxlKyc8L3RleHQ+XG4nOwogICAgICBpbXBvcnQgeG1sLmV0cmVlLkVsZW1lbnRUcmVlIGFzIEVUCiAgICAgICNmb3IgZSBpbiBFVC5wYXJzZShicG1uZmlsZSkuZ2V0cm9vdCgpOiAgIyBjb2xsZWN0IG5hbWVkIHByb2Nlc3NlcwogICAgICBmb3IgZSBpbiBFVC5mcm9tc3RyaW5nKGJwbW5zdHJpbmcpOiAgIyBjb2xsZWN0IG5hbWVkIHByb2Nlc3NlcwogICAgICAgICAgICBpZiAicHJvY2VzcyIgaW4gZS50YWc6CiAgICAgICAgICAgICAgICAgIGVsZW1zPVtkIGZvciBkIGluIGUgaWYgIm5hbWUiIGluIGQuYXR0cmliXQogICAgICAjZm9yIGUgaW4gRVQucGFyc2UoYnBtbmZpbGUpLmdldHJvb3QoKTogICMgY29sbGVjdCBkaWFncmFtIGVsZW1lbnRzCiAgICAgIGZvciBlIGluIEVULmZyb21zdHJpbmcoYnBtbnN0cmluZyk6ICAjIGNvbGxlY3QgbmFtZWQgcHJvY2Vzc2VzCiAgICAgICAgICAgIGlmICJCUE1ORGlhZ3JhbSIgaW4gZS50YWc6CiAgICAgICAgICAgICAgICAgIGZvciBkIGluIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zPVtwIGZvciBwIGluIGQgaWYgIkJQTU5QbGFuZSIgaW4gZC50YWddCiAgICAgIGZvciBpdCBpbiBpdGVtczoKICAgICAgICAgICAgcHAsbmFtZSA9IFtdLCIiCiAgICAgICAgICAgIGZvciBlIGluIGVsZW1zOgogICAgICAgICAgICAgICAgICBpZiBpdC5hdHRyaWJbImJwbW5FbGVtZW50Il09PWUuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICBuYW1lPSIgIi5qb2luKGUuYXR0cmliWyJuYW1lIl0uc3BsaXQoIiAiKVsxOl0pICMgYXNzdW1lICJpZFxudGV4dCIKICAgICAgICAgICAgZm9yIGogaW4gcmFuZ2UobGVuKGl0KSk6CiAgICAgICAgICAgICAgICAgIHgseSA9IGZsb2F0KGl0W2pdLmF0dHJpYlsieCJdKSxmbG9hdChpdFtqXS5hdHRyaWJbInkiXSkKICAgICAgICAgICAgICAgICAgdyxoID0gKGZsb2F0KGl0W2pdLmF0dHJpYlsid2lkdGgiXSksZmxvYXQoaXRbal0uYXR0cmliWyJoZWlnaHQiXSkpIGlmICJCb3VuZHMiIGluIGl0W2pdLnRhZyBlbHNlICgwLDApCiAgICAgICAgICAgICAgICAgIFcsSCA9IG1heChXLHgrdyksbWF4KEgseStoKQogICAgICAgICAgICAgICAgICAjcHJpbnQoaXQuYXR0cmliWyJpZCJdLCI6Iix4LHksdyxoKQogICAgICAgICAgICAgICAgICBpZiB3PT0wOiAjIGJwbW4gZmxvdwogICAgICAgICAgICAgICAgICAgICAgICBwcC5hcHBlbmQoW3gseV0pCiAgICAgICAgICAgICAgICAgIGVsc2U6ICAgICMgYnBtbiBldmVudAogICAgICAgICAgICAgICAgICAgICAgICBpZHM9aXQuYXR0cmliWyJpZCJdLnNwbGl0KCJfIikKICAgICAgICAgICAgICAgICAgICAgICAgaWQ9aWRzWzFdCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihpZHMpPjQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBiYXNlNjQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRzWzRdPWJhc2U2NC5iMTZkZWNvZGUoaWRzWzRdLCdhc2NpaScpLmRlY29kZSgnYXNjaWknKQogICAgICAgICAgICAgICAgICAgICAgICBpZDI9Il8iLmpvaW4oaWRzWzI6XSkucmVwbGFjZSgnPCcsJyZsdDsnKS5yZXBsYWNlKCc+JywnJmd0OycpCiAgICAgICAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSInK3N0cih4LTYpKyciIHk9Iicrc3RyKHkraCsxMikrJyI+JytpZCsnPC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2NvbW1lbnRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHRleHQgZm9udC1zaXplPSJzbWFsbGVyIiBzdHlsZT0iZmlsbDpncmF5IiB4PSInK3N0cih4LTEyKSsnIiB5PSInK3N0cih5LTYpKyciPjx0c3BhbiB4bWw6c3BhY2U9InByZXNlcnZlIj4nK25hbWUrJzwvdHNwYW4+PC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICAgICAgICBpZDM9aWQyLnNwbGl0KCJfIikKICAgICAgICAgICAgICAgICAgICAgICAgI2lmIGxlbihpZDMpPjMgYW5kIGlkM1szXSAhPSAiTm9uZSIgOiBzKz0nPHRleHQgY2xhc3M9InQxIiBmb250LXNpemU9InNtYWxsZXIiIHN0eWxlPSJmaWxsOmdyYXkiIHg9Iicrc3RyKHgrMTgpKyciIHk9Iicrc3RyKHkraCsxMisoIkV2ZW50IiBpbiBpdC5hdHRyaWJbImlkIl0gYW5kIDEyIG9yIDApKSsnIj48dHNwYW4geG1sOnNwYWNlPSJwcmVzZXJ2ZSI+JytpZDNbM10rJzwvdHNwYW4+PC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc3NjcmlwdHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkM2E9Il8iLmpvaW4oaWRzWzI6XSkuc3BsaXQoIl8iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oaWQzYSk+MyBhbmQgaWQzYVszXSAhPSAiTm9uZSI6IHMrPSc8dGV4dCBjbGFzcz0idDEiIGZvbnQtc2l6ZT0ic21hbGxlciIgc3R5bGU9ImZpbGw6Z3JheSIgeD0iJytzdHIoeCsxOCkrJyIgeT0iJytzdHIoeStoKzEyKSsnIj48dHNwYW4geG1sOnNwYWNlPSJwcmVzZXJ2ZSI+JytpZDNhWzNdLnNwbGl0KCc7JylbMF0ucmVwbGFjZSgnPCcsJyZsdDsnKS5yZXBsYWNlKCc+JywnJmd0OycpKyc8L3RzcGFuPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWYgIkV2ZW50IiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZSA9ICJlbmQiIGluIGl0LmF0dHJpYlsiaWQiXSBhbmQgIjMiIG9yICIxIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICJlbmQiIGluIGl0LmF0dHJpYlsiaWQiXSBhbmQgInJlZCIgb3IgImRhcmtncmVlbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8ZWxsaXBzZSBjeD0iJytzdHIoeCt3LzIpKyciIGN5PSInK3N0cih5K2gvMikrJyIgcng9Iicrc3RyKHcvMikrJyIgcnk9Iicrc3RyKGgvMikrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9IicrY29sb3IrJyIgZmlsbC1vcGFjaXR5PSIwLjYiIGZpbGw9IndoaXRlIj48dGl0bGU+JytpZDIrJzwvdGl0bGU+PC9lbGxpcHNlPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiaW50ZXJtZWRpYXRlIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPGVsbGlwc2UgY3g9Iicrc3RyKHgrdy8yKSsnIiBjeT0iJytzdHIoeStoLzIpKyciIHJ4PSInK3N0cih3LzItMykrJyIgcnk9Iicrc3RyKGgvMi0zKSsnIiBzdHJva2Utd2lkdGg9Iicrc3Ryb2tlKyciIHN0cm9rZT0iZGFya2dyZWVuIiBmaWxsPSJ3aGl0ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiQ2F0Y2giIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIm9uZGl0aW9uIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHJlY3QgeD0iJWciIHk9IiVnIiB3aWR0aD0iJWciIGhlaWdodD0iJWciIHN0cm9rZT0iYmxhY2siIGZpbGw9Im5vbmUiIC8+JyUoeCt3LzItNyx5K2gvMi05LHcvMi00LGgvMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cGF0aCBkPSInCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJ00lZyAlZyBMJWcgJWcgJyUoeCt3LzItNSx5K2gvMi02KzMqaSx4K3cvMis1LHkraC8yLTYrMyppKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxlbGxpcHNlIGN4PSInK3N0cih4K3cvMikrJyIgY3k9Iicrc3RyKHkraC8yKSsnIiByeD0iJytzdHIody8yLTYpKyciIHJ5PSInK3N0cihoLzItNikrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9ImJsYWNrIiBmaWxsPSJ3aGl0ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxwYXRoIGQ9Ik0lZyAlZyBMJWcgJWcgJWcgJWcgJyUoeCt3LzItNSx5K2gvMi0zLHgrdy8yLHkraC8yLHgrdy8yKzYseStoLzItNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMTIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIG1hdGggaW1wb3J0IHNpbixjb3MscGkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICJNJWcgJWcgTCVnICVnICIlKHgrdy8yKyh3LzItNikqY29zKGkqMipwaS8xMikseStoLzIrKGgvMi02KSpzaW4oaSoyKnBpLzEyKSx4K3cvMisody8yLTkpKmNvcyhpKjIqcGkvMTIpLHkraC8yKyhoLzItOSkqc2luKGkqMipwaS8xMikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiLz4nICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJlcm1pbmF0ZSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxlbGxpcHNlIGN4PSInK3N0cih4K3cvMikrJyIgY3k9Iicrc3RyKHkraC8yKSsnIiByeD0iJytzdHIody8yLTYpKyciIHJ5PSInK3N0cihoLzItNikrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9InJlZCIgZmlsbD0icmVkIiBmaWxsLW9wYWNpdHk9IjAuNiIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICBlbGlmICJHYXRld2F5IiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gIm9yYW5nZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cGF0aCBkPSJNJWcgJWcgTCVnICVnIEwlZyAlZyBMJWcgJWcgWiIgc3Ryb2tlPSIlcyIgZmlsbD0id2hpdGUiPjx0aXRsZT4lczwvdGl0bGU+PC9wYXRoPlxuJyUoeCx5K2gvMix4K3cvMix5LHgrdyx5K2gvMix4K3cvMix5K2gsY29sb3IsaWQyKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgImV4Y2x1c2l2ZSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHBhdGggZD0iTSVnICVnIEwlZyAlZyBNJWcgJWcgTCVnICVnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjMiIC8+XG4nJSh4K3cvMi02LHkraC8yLTYseCt3LzIrNix5K2gvMis2LHgrdy8yKzYseStoLzItNix4K3cvMi02LHkraC8yKzYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgInBhcmFsbGVsIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSc8cGF0aCBkPSJNJWcgJWcgTCVnICVnIE0lZyAlZyBMJWcgJWciIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIgLz5cbiclKHgrdy8yLTgseStoLzIseCt3LzIrOCx5K2gvMix4K3cvMix5K2gvMi04LHgrdy8yLHkraC8yKzgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHJlY3Qgcng9IjciIHJ5PSI3IiB4PSInK3N0cih4KSsnIiB5PSInK3N0cih5KSsnIiB3aWR0aD0iJytzdHIodykrJyIgaGVpZ2h0PSInK3N0cihoKSsnIiBzdHJva2U9ImRhcmtibHVlIiBmaWxsPSJ3aGl0ZSI+PHRpdGxlPicraWQyKyc8L3RpdGxlPjwvcmVjdD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgInNjcmlwdCIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSg0KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSc8cGF0aCBkPSJNJWcgJWcgTCVnICVnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiIC8+JyUoeCsxMCswKmkseSsxMCs0KmkseCsyMiswKmkseSsxMCs0KmkpCiAgICAgICAgICAgIGlmIGxlbihwcCk+MDogIyBzMSE9Jyc6ICMgYWRkIHdob2xlIGZsb3cKICAgICAgICAgICAgICAgICAgczE9c3ZnX3JvdW5kZWRQYXRoKHBwLDEyKQogICAgICAgICAgICAgICAgICBzICs9ICc8cGF0aCBtYXJrZXItZW5kPSJ1cmwoI3RyaWFuZ2xlKSIgZD0iJytzMSsnIiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpicm93bjtzdHJva2Utd2lkdGg6MSIvPlxuJwogICAgICBzICs9ICI8c2NyaXB0PmZ1bmN0aW9uIG9uX2NsaWNrKCkge1suLi5kb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0MScpXS5mb3JFYWNoKGU9PmUuc3R5bGUuZGlzcGxheT0oZS5zdHlsZS5kaXNwbGF5PT0nbm9uZSc/Jyc6J25vbmUnKSk7fTwvc2NyaXB0PiIKICAgICAgcyA9ICc8c3ZnIG9uY2xpY2s9Im9uX2NsaWNrKCkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IiVkIiBoZWlnaHQ9IiVkIj5cbiclKFcrNDArNjAsSCszMCkrcwogICAgICByZXR1cm4gcyArICh0b19hbmltKCkgaWYgaXNhbmltIGVsc2UgJycpICsgJzwvc3ZnPlxuJwpkZWYgdG9fYW5pbSgpOgogICAgICAjcmV0dXJuIHMKICAgICAgZ2xvYmFsIG5lCiAgICAgIHMgPSAgJzxkZWZzPjxmaWx0ZXIgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgaWQ9ImZpIj5cbicKICAgICAgcyArPSAnPGZlRmxvb2QgZmxvb2QtY29sb3I9IndoaXRlIi8+XG4nCiAgICAgIHMgKz0gJzxmZUNvbXBvc2l0ZSBpbj0iU291cmNlR3JhcGhpYyIgb3BlcmF0b3I9ImF0b3AiLz48L2ZpbHRlcj48L2RlZnM+XG4nCiAgICAgIGZvciBlIGluIG5lLmVlOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGUsRW5kKToKICAgICAgICAgICAgICAgICAgZm9yIGMgaW4gZS5xdWV1ZS5vYmplY3RzOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4obmUuZWUpKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeCwgeSwgYSA9IG5lLmVlW2ldLngsIG5lLmVlW2ldLnksIGMuYXR0ciAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSc8dGV4dCBjbGFzcz0idDEiIGZpbHRlcj0idXJsKCNmaSkiIHN0eWxlPSJmb250LXNpemU6c21hbGw7ZmlsbDpyZWQiIHg9Iicrc3RyKHgtMjApKyciIHk9Iicrc3RyKHkrMTMpKyciIHZpc2liaWxpdHk9ImhpZGRlbiI+JytzdHIoYy5uYW1lKSsnXG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQ9Il9fdCIrc3RyKGkrMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdCsiYSIgaW4gYToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDAgPSBhW3QrImEiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9ICc8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJ2aXNpYmlsaXR5IiBmcm9tPSJoaWRkZW4iIHRvPSJ2aXNpYmxlIiBiZWdpbj0iJytzdHIodDApKydzIiBkdXI9IjAuMDFzIiBmaWxsPSJmcmVlemUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdCsiYiIgaW4gYToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBhW3QrImIiXSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAnPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieCIgdG89Iicrc3RyKHgrMzgpKyciIGJlZ2luPSInK3N0cih0MSkrJ3MiIGR1cj0iMC41cyIgZmlsbD0iZnJlZXplIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQrImUiIGluIGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gYVt0KyJlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAnPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0idmlzaWJpbGl0eSIgZnJvbT0idmlzaWJsZSIgdG89ImhpZGRlbiIgYmVnaW49Iicrc3RyKHQyKSsncyIgZHVyPSIwLjAxcyIgZmlsbD0iZnJlZXplIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0nPC90ZXh0PlxuJwogICAgICByZXR1cm4gcwoKbmU9W10KIyAtLS0tIHNpbXVsYXRpb24gLS0tLS0KZGVmIG1haW5fZnVuKGV4bixuLGFuaW0sY29tbWVudHMsc2NyaXB0cyk6ICMgc3RyaW5nIHJlcHJlc2VudGF0aW9uLCBudW1iZXIgb2Ygc2ltdWxhdGlvbgogICAgICBkYXRhPVtdICAjIGxpc3Qgb2YgZXZlbnRzLCBhcnJheSBvZiByZXN1bHRzCiAgICAgIHMgPSAnJwogICAgICBmb3IgaSBpbiByYW5nZShuKToKICAgICAgICAgICAgZ2xvYmFsIG5lCiAgICAgICAgICAgIG5lID0gRXZlbnROZXR3b3JrKGV4bikKICAgICAgICAgICAgc2ltID0gU2ltdWxhdG9yKCkKICAgICAgICAgICAgZm9yIGUgaW4gbmU6CiAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZSxHZW5lcmF0b3IpOiAgIyBhZGQgZ2VuZXJhdGluZyBldmVudHMKICAgICAgICAgICAgICAgICAgICAgICAgc2ltLmFkZChlKSAgCiAgICAgICAgICAgIHNpbS5ydW4oKQogICAgICAgICAgICBkYXRhLmFwcGVuZChbc2ltLnRpbWUsQnBtbkV2ZW50LlNdKSAgICMgc2F2ZSBlbmQgdGltZSBvZiBzaW11bGF0aW9uCiAgICAgICAgICAgIAogICAgICAgICAgICAjaWYgZXhuPT1leDU6CiAgICAgICAgICAgICMgICAgICBkYXRhLmFwcGVuZChCcG1uRXZlbnQuU1siUy5iQSJdKSAjIHNhdmUgZ2xvYmFsIHZhcmlhYmxlIFMuYkEKICAgICAgICAgICAgI2Vsc2U6CiAgICAgICAgICAgICMgICAgICBkYXRhLmFwcGVuZChzaW0udGltZSkgICAjIHNhdmUgZW5kIHRpbWUgb2Ygc2ltdWxhdGlvbgogICAgICAgICAgICBpZiBpPT0wOgogICAgICAgICAgICAgICAgICBzMSA9IHRvX2JwbW4obmUuZWUsbmUucHApCiAgICAgICAgICAgICAgICAgIHMyID0gYnBtbl90b3N2ZyhzMSxhbmltLGNvbW1lbnRzLHNjcmlwdHMpCiAgICAgICAgICAgICAgICAgIHMzID0gdG9fc3ZnKCkKICAgICAgcyArPSAiI25cdHRcdCIrIlx0Ii5qb2luKGRhdGFbMF1bMV0ua2V5cygpKSsiXG4iCiAgICAgIHMgKz0gIlxuIi5qb2luKFsiJWRcdCUuMmZcdCVzIiUoaSsxLGRhdGFbaV1bMF0sIlx0Ii5qb2luKFtzdHIodikgZm9yIHYgaW4gWypkYXRhW2ldWzFdLnZhbHVlcygpXV0pKSBmb3IgaSBpbiByYW5nZShsZW4oZGF0YSkpXSkKICAgICAgI2ZvciBlIGluIG5lOgogICAgICAjICAgICAgaWYgbGVuKGUucXVldWUpPjA6CiAgICAgICMgICAgICAgICAgICBzICs9IHN0cihlLmlkKSArICgiKCVkKToiJWxlbihlLnF1ZXVlKSkgKyBzdHIoZS5xdWV1ZSkrJ1xuJwogICAgICAjcyArPSBzdHIoc3VtKGRhdGEpL2xlbihkYXRhKSkrJ1xuJwogICAgICAjcyArPSBzdHIoQnBtbkV2ZW50LlMpKydcbicKICAgICAgI2ZvciBlIGluIG5lOgogICAgICAjICAgICAgcyArPSBzdHIoZS5pZCkrc3RyKGUuQSkrJyAnCiAgICAgICMgICAgICBpZiBpc2luc3RhbmNlKGUsVGFzayk6CiAgICAgICMgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZS5zZXJ2ZXJzKSk6CiAgICAgICMgICAgICAgICAgICAgICAgICBzICs9IHN0cihlLnNlcnZlcnNbaV0uaWQpKycvJytzdHIoaSsxKStzdHIoZS5zZXJ2ZXJzW2ldLkEpKycgJwogICAgICBzND0nJwogICAgICBpZiBsZW4oZGF0YSk+PTEwMDoKICAgICAgICAgICAgI2lmIGV4bj09ZXg0OgogICAgICAgICAgICAjICAgICAgczQgPSBoaXN0KGRhdGEsNykKICAgICAgICAgICAgI2Vsc2U6CiAgICAgICAgICAgICMgICAgICBzNCA9IGhpc3QoZGF0YSkKICAgICAgICAgICAgcGFzcyAjIHM0ID0gaGlzdChkYXRhKQogICAgICByZXR1cm4gKHMsczEsczIsczMsczQpICMgczIrJzxicj5cbicrKHMzIGlmIG49PTEgZWxzZSAnJykrJzxicj5cbicrJzxwcmU+JytzKyc8L3ByZT4nCgoKIiIiCmlmIF9fbmFtZV9fPT0iX19tYWluX18iOgogICAgICBpbXBvcnQgc3lzCiAgICAgICNpbXBvcnQgZXgKICAgICAgZXgzMCA9ICcxIFN0YXJ0KClcbjIgVGFzaygpXG4zIEVuZCgpXG4xLT4yOzItPjNcbicKICAgICAgcyA9IGxlbihzeXMuYXJndik+MSBhbmQgZnJvbV9maWxlKHN5cy5hcmd2WzFdKSBvciBldmFsKCdleCVkJyUoMzApKQogICAgICBuID0gbGVuKHN5cy5hcmd2KT4yIGFuZCBpbnQoc3lzLmFyZ3ZbMl0pIG9yIDEwMAogICAgICBzID0gbWFpbl9mdW4ocyxuKQogICAgICBwcmludChzWzNdKQoiIiIKcyA9IGlucHV0WzBdCm4gPSBpbnQoaW5wdXRbMV0pCmFuaW0gPSBpbnQoaW5wdXRbMl0pCmNvbW1lbnRzID0gaW50KGlucHV0WzNdKQpzY3JpcHRzID0gaW50KGlucHV0WzRdKQpvdXRwdXQgPSBtYWluX2Z1bihzLCBuLCBhbmltLCBjb21tZW50cywgc2NyaXB0cykKcyA9ICcnCiNzICs9ICc8ZGl2IGlkPSJkaXYxIiBoaWRkZW4+JytvdXRwdXRbMV0rJzwvZGl2Pjxicj5cbicKcyArPSAnPGRpdiBpZD0iZGl2MiIgdGFiaW5kZXg9Ii0xIj4nK291dHB1dFsyXSsnPC9kaXY+PGJyPlxuJwojcyArPSc8aW5wdXQgdHlwZT1idXR0b24gdmFsdWU9IlNhdmUgYnBtbiB0byB4bWwgZmlsZSIgb25jbGljaz0id3JpdGVGaWxlMSgpOyI+PC9pbnB1dD5cbicKcyArPSc8aW5wdXQgdHlwZT1idXR0b24gdmFsdWU9IlNhdmUgYnBtbiB0byBzdmcgZmlsZSIgb25jbGljaz0id3JpdGVGaWxlMigpOyI+PC9pbnB1dD5cbicKcyArPSc8aW5wdXQgdHlwZT1idXR0b24gdmFsdWU9IlNhdmUgYnBtbiB0byB4bWwgZmlsZSIgb25jbGljaz0id3JpdGVGaWxlNSgpOyI+PC9pbnB1dD48YnI+PGJyPlxuJwppZiBuPT0xOgogICAgICBzICs9ICc8ZGl2IGlkPSJkaXYzIj4nK291dHB1dFszXSArJzwvZGl2Pjxicj5cbicKICAgICAgcyArPSc8aW5wdXQgdHlwZT1idXR0b24gdmFsdWU9IlNhdmUgdGltZWxpbmUgdG8gc3ZnIGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTMoKTsiPjwvaW5wdXQ+PGJyPjxicj5cbicKcyArPSc8dGV4dGFyZWEgaWQ9InRhNCIgcm93cz0iMTAiIGNvbHM9IjgwIj4nK291dHB1dFswXSsnPC90ZXh0YXJlYT48YnI+XG4nICMrJzxpbWcgc3JjPSInK291dHB1dFszXSsnIj4nCnMgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIHJlc3VsdHMgdG8gdHh0IGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTQoKTsiPjwvaW5wdXQ+PGJyPjxicj5cbicKcyArPSc8dGV4dGFyZWEgaGlkZGVuIGlkPSJ0YTUiIHJvd3M9IjEwIiBjb2xzPSI4MCI+JytvdXRwdXRbMV0rJzwvdGV4dGFyZWE+PGJyPlxuJyAjKyc8aW1nIHNyYz0iJytvdXRwdXRbM10rJyI+JwpzCgoK";