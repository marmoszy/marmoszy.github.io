var pycode="IyBtbS1kZXMgLSBkaXNjcmV0ZSBldmVudCBzaW11bGF0b3IKIyAtIGJhc2UgZXZlbnRzOiBHZW5lcmF0b3IsU2VydmljZSxTaW5rLENvbmRpdGlvbmFsRXZlbnQKIyAtIGJwbW4gZXZlbnRzOiBTdGFydCxUYXNrLEVuZCxUaW1lcixYb3JHYXRlLEFuZEdhdGUsQ29uZGl0aW9uLFRlcm1pbmF0ZQojIE1NIDMxLjEuMjAyNCwgMTMuOS4yMDI1IChhZG9wdGVkIGZvciBweW9kaWRlIGluIGpzKQoKIyAtLS0tIHNpbXVsYXRpb24gb24gYW4gYWJzdHJhY3QgZXZlbnQgLS0tLQpjbGFzcyBFdmVudCgpOgogICAgICBjbnQgPSAwICAgICAgICAgICAgICAgICAgICAgICAgICMgdXNlZCBmb3IgZXZlbnQgaWRlbnRpZmllcgogICAgICBkZWYgX19pbml0X18oc2VsZiwgdGltZSwgbmFtZT1Ob25lKToKICAgICAgICAgICAgc2VsZi50aW1lID0gdGltZTsKICAgICAgICAgICAgRXZlbnQuY250ICs9IDEKICAgICAgICAgICAgc2VsZi5pZCA9IEV2ZW50LmNudAogICAgICAgICAgICBzZWxmLm5hbWUgPSAoKG5hbWU9PU5vbmUpIGFuZCAiRXZlbnQiIG9yIG5hbWUpICsgIl8iK3N0cihzZWxmLmlkKQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOiBwYXNzICAgICAgIyBhYnN0cmFjdCAKICAgICAgZGVmIF9fc3RyX18oc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLm5hbWUrICIgIisgc3RyKHNlbGYuaWQpICsiICIrc3RyKHNlbGYudGltZSkKY2xhc3MgU2ltdWxhdG9yKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAgICAgc2VsZi50aW1lID0gMAogICAgICAgICAgICBzZWxmLmV2ZW50cyA9IFtdCiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucyA9IFtdCiAgICAgIGRlZiBub3coc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnRpbWUKICAgICAgZGVmIGFkZChzZWxmLGUpOgogICAgICAgICAgICBzZWxmLmV2ZW50cy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBhZGRfY29uZGl0aW9uKHNlbGYsZSk6CiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgICAgIHdoaWxlIHNlbGYuZXZlbnRzOgogICAgICAgICAgICAgICAgICBlID0gbWluKHNlbGYuZXZlbnRzLCBrZXk9bGFtYmRhIGU6IGUudGltZSkKICAgICAgICAgICAgICAgICAgc2VsZi5ldmVudHMucmVtb3ZlKGUpCiAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IGUudGltZSAgICAgICAgICMgdXBkYXRlIHNpbXVsYXRvciB0aW1lCiAgICAgICAgICAgICAgICAgIGUuZXhlYyhzZWxmKQogICAgICAgICAgICAgICAgICBmb3IgYyBpbiBzZWxmLmNvbmRpdGlvbnM6ICAjIHRlc3QgY29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICBpZiBjLmV4ZWMoc2VsZik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5yZW1vdmUoYykKIyAtLS0tIHV0aWxzIC0tLS0KaW1wb3J0IG1hdGgscmFuZG9tCmRlZiBfcHJpbnQocyk6ICAgICAgICAgICAgICAgICMgb3duIHByaW50CiAgICAgICNwcmludChzKSAgICAgICAgICAgICAgICMgY29tbWVudCBpZiBubyB2ZXJib3VzIHByaW50aW5nCiAgICAgIHBhc3MKZGVmIEUobWVhbj1bMS4wXSk6ICAgICAgICAgICAgIyBleHBvbmVudGlhbCByYW5kb20gZ2VuZXJhdG9yCiAgICAgICMgLW1lYW5bMF0qbWF0aC5sb2cocmFuZG9tLnJhbmRvbSgpKQogICAgICByZXR1cm4gcmFuZG9tLmV4cG92YXJpYXRlKDEvbWVhblswXSkgCmRlZiBVKG1pbm1heD1bMS4wXSk6ICAgICAgICAgICMgdW5pZm9ybSByYW5kb20gZ2VuZXJhdG9yCiAgICAgIHJldHVybiByYW5kb20udW5pZm9ybShtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXSkKZGVmIE4obWVhbnN0ZD1bMy4wXSk6ICAgICAgICAjIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgcmV0dXJuIHJhbmRvbS5ub3JtYWx2YXJpYXRlKG1lYW5zdGRbMF0sbGVuKG1lYW5zdGQpPjEgYW5kIG1lYW5zdGRbMV0gb3IgMS4wKQpkZWYgQihwPTAuNSk6ICAgICAgICAgICAgICAgICMgYmlub21pYWwgKDAsMSkKICAgICAgcmV0dXJuIHJhbmRvbS5yYW5kb20oKTxwCmRlZiBDKHA9WzEsMSwxXSk6ICAgICAgICAgICAgIyBjaG9pY2UgKDAsMSwyLC4uLikKICAgICAgcmV0dXJuIHJhbmRvbS5jaG9pY2VzKGxpc3QocmFuZ2UobGVuKHApKSksd2VpZ2h0cz1wKVswXQpkZWYgVChtaW5tYXg9WzEuMF0pOiAgICAgICAgICAjIHNlbWkgdHJ1bmNhdGVkIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgbWksbWEgPSBtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXQogICAgICBtZWFuLHN0ZCA9IChtYSttaSkvMiwobWEtbWkpLzIKICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgeCA9IE4oW21lYW4sc3RkXSkKICAgICAgICAgICAgaWYgbWkgPD0geCA8PSBtYTogYnJlYWsKICAgICAgcmV0dXJuIHgKCiMgLS0tLSBwcmltaXRpdmUgY2xhc3NlcyAtLS0tCmNsYXNzIEN1c3RvbWVyKCk6ICAgICMgYW5vbnltb3VzIGN1c3RvbWVyIHdpdGggYSBhdXRvbWF0aWMgbmFtZQogICAgICBjbnQgPSAwICAgICAgICAjIGNvdW50ZXIgY2xhc3MgdmFyaWFibGUgZm9yIGN1c3RvbWVyIG5hbWUKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBDdXN0b21lci5jbnQgKz0gMQogICAgICAgICAgICBzZWxmLm5hbWUgPSBzdHIoQ3VzdG9tZXIuY250KQogICAgICAgICAgICBzZWxmLmF0dHIgPSB7ImNuYW1lIjpzZWxmLm5hbWV9ICMgQ3VzdG9tZXIgYXR0cmlidXRlcwogICAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIHN0cihzZWxmLm5hbWUpCmNsYXNzIFF1ZXVlKCk6ICAgICAgICMgZmlmbyBvZiBjdXN0b21lcnMKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBzZWxmLm9iamVjdHMgPSBbXQogICAgICBkZWYgcHVzaChzZWxmLG9iaik6CiAgICAgICAgICAgIHNlbGYub2JqZWN0cy5hcHBlbmQob2JqKQogICAgICBkZWYgcG9wKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5vYmplY3RzLnBvcCgwKQogICAgICBkZWYgX19sZW5fXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIGxlbihzZWxmLm9iamVjdHMpCiAgICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc3RyKFtzdHIobykgZm9yIG8gaW4gc2VsZi5vYmplY3RzXSkKY2xhc3MgUXVldWVkRXZlbnQoRXZlbnQpOgogICAgICBpbnN0YW5jZXM9W10KICAgICAgZGVmIF9faW5pdF9fKHNlbGYsbmFtZT1Ob25lKToKICAgICAgICAgICAgRXZlbnQuX19pbml0X18oc2VsZiwwLjAsbmFtZSkgICMgcHJlaW5pdCB0aW1lCiAgICAgICAgICAgIHNlbGYucXVldWUgPSBRdWV1ZSgpICAgICAgIyBvd24gcXVldWUKICAgICAgICAgICAgc2VsZi5vdXRwdXQgPSBbXSAgICAgICAgICAjIG5vIGNvbm5lY3RlZCBvYmplY3RzCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICAgIyBub25lIGJlaW5nIHNlcnZlZAogICAgICAgICAgICBRdWV1ZWRFdmVudC5pbnN0YW5jZXMuYXBwZW5kKHNlbGYpCiAgICAgIGRlZiBzZXROYW1lKHNlbGYsbmFtZSk6CiAgICAgICAgICAgIHNlbGYubmFtZT1uYW1lKyJfIitzZWxmLm5hbWUuc3BsaXQoIl8iKVsxXSAjLnJlcGxhY2UoIkV2ZW50IixuYW1lKS5yZXBsYWNlKCJBY3Rpdml0eSIsbmFtZSkKICAgICAgZGVmIG91dChzZWxmLHNpbSk6ICAgICAgICAgICAgICAjIHBhc3MgdG8gY29ubmVjdGVkIG9iamVjdHMKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4wIGFuZCBpc2luc3RhbmNlKHNlbGYsWG9yR2F0ZSk6ICAKICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID0gMSAgIyBzZW5kIHRvIHNlY29uZCBvdXRwdXQKICAgICAgICAgICAgICAgICAgICAgICAgI2lmIHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgidmFsdWUiIGluIHNlbGYuY3VzdG9tZXIuYXR0ciBhbmQgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdKSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeD0wICMgc2VuZCByYXRoZXIgdG8gZmlyc3Qgb3V0cHV0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLm91dHB1dCk+MjogICMgbW9yZSB0aGFuIDIgb3V0cHV0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHg9aW50KHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRwdXRbaWR4XS5pbnNlcnQoc2VsZi5jdXN0b21lciwgc2ltKQogICAgICAgICAgICAgICAgICBlbGlmIGxlbihzZWxmLm91dHB1dCk+MSBhbmQgaXNpbnN0YW5jZShzZWxmLE9yR2F0ZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICNwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIE4gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihzZWxmLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpbnQoc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdW2ldKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTiArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0cHV0W2ldLmluc2VydChzZWxmLmN1c3RvbWVyLCBzaW0pCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuTiA9IE4KICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHNlbGYub3V0cHV0KSk6ICAjIHNwbGl0IHRvIGFsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm91dHB1dFtpXS5pbnNlcnQoc2VsZi5jdXN0b21lcixzaW0pCiAgICAgIGRlZiBwcmV2KHNlbGYpOgogICAgICAgICAgICBlcD1bXQogICAgICAgICAgICBmb3IgZTAgaW4gUXVldWVkRXZlbnQuaW5zdGFuY2VzOgogICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZTAub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGUwLm91dHB1dFtpXT09c2VsZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXAuYXBwZW5kKGUwKQogICAgICAgICAgICByZXR1cm4gZXAKCiMgLS0tLSBiYXNpYyBtb2RlbCBjbGFzc2VzIChRdWV1ZUV2ZW50IGRlcml2ZWQpIC0tLS0KY2xhc3MgQnBtbkV2ZW50KFF1ZXVlZEV2ZW50KToKICAgICAgUyA9IHt9CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLG5hbWU9Tm9uZSxjb2RlPU5vbmUpOgogICAgICAgICAgICBRdWV1ZWRFdmVudC5fX2luaXRfXyhzZWxmLG5hbWUpCiAgICAgICAgICAgIHNlbGYuZnVuLHNlbGYucGFyYW0sc2VsZi5jb2RlID0gTm9uZSxOb25lLGNvZGUKICAgICAgICAgICAgc2VsZi5BLHNlbGYucHAsc2VsZi5wcDIsc2VsZi50aXRsZSA9IHsiQS5uIjowfSxbLTEsMF0sWy0xLC0xXSwnJwogICAgICBkZWYgX2Z1bihzZWxmKToKICAgICAgICAgICAgcCA9IHNlbGYucGFyYW0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShwLGxpc3QpOgogICAgICAgICAgICAgICAgICBwID0gW2Zsb2F0KGV2YWwoc2VsZi5hdHRyX3JlcGxhY2Uoc3RyKHMpKSkpIGZvciBzIGluIHBdCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgIHAgPSBmbG9hdChldmFsKHNlbGYuYXR0cl9yZXBsYWNlKHN0cihwKSkpKQogICAgICAgICAgICAjcHJpbnQoIl9mdW46IixzZWxmLmZ1bixwLGxlbihzZWxmLnF1ZXVlKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZnVuKHApIGlmIHNlbGYuZnVuIT1Ob25lIGVsc2UgcAogICAgICBkZWYgYXR0cl9yZXBsYWNlKHNlbGYsY2MpOgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBmb3Igayx2IGluIHNlbGYuY3VzdG9tZXIuYXR0ci5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgICAgICBjYyA9IGNjLnJlcGxhY2UoayxzdHIodikpCiAgICAgICAgICAgIGZvciBrLHYgaW4gQnBtbkV2ZW50LlMuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgY2MgPSBjYy5yZXBsYWNlKGssc3RyKHYpKQogICAgICAgICAgICBmb3Igayx2IGluIHNlbGYuQS5pdGVtcygpOgogICAgICAgICAgICAgICAgICBjYyA9IGNjLnJlcGxhY2UoayxzdHIodikpCiAgICAgICAgICAgIHJldHVybiBjYwogICAgICBkZWYgX2V2YWwoc2VsZixjb2RlLG49LTEpOgogICAgICAgICAgICBjb2Rlcz1zZWxmLmNvZGUuc3BsaXQoIjsiKQogICAgICAgICAgICBpZiBuIT0tMToKICAgICAgICAgICAgICAgICAgY29kZXM9bGVuKGNvZGVzKT5uIGFuZCBbY29kZXNbbl1dIG9yIFtdCiAgICAgICAgICAgIGZvciBjb2RlIGluIGNvZGVzOgogICAgICAgICAgICAgICAgICBjYyA9IGNvZGUuc3BsaXQoIj0iKQogICAgICAgICAgICAgICAgICBjY1swXSA9IGNjWzBdLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgaWYgbGVuKGNjKT09MToKICAgICAgICAgICAgICAgICAgICAgICAgY2M9WyJkdW1teSJdK2NjCiAgICAgICAgICAgICAgICAgIGlmIGxlbihjYyk+MToKICAgICAgICAgICAgICAgICAgICAgICAgY2NbMF0gPSBsZW4oY2NbMF0pPjAgYW5kIGNjWzBdIG9yICJ2YWx1ZSIKICAgICAgICAgICAgICAgICAgICAgICAgY2NbMV0gPSBzZWxmLmF0dHJfcmVwbGFjZSgiPSIuam9pbihjY1sxOl0pKSAjIHJlam9pbgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2PWV2YWwoY2NbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNjWzBdLnN0YXJ0c3dpdGgoIlMuIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJwbW5FdmVudC5TW2NjWzBdXT1ldgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGNjWzBdLnN0YXJ0c3dpdGgoIkEuIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuRVtjY1swXV09ZXYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyW2NjWzBdXT1ldgogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0cltjY1swXV09RmFsc2UKY2xhc3MgQ29uZGl0aW9uYWxFdmVudChCcG1uRXZlbnQpOgogICAgICBkZWYgX19pbml0X18oc2VsZiwgY29kZT1Ob25lKToKICAgICAgICAgICAgQnBtbkV2ZW50Ll9faW5pdF9fKHNlbGYsIE5vbmUsIGNvZGUpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IC0xCiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIgPT0gTm9uZSA6ICMgaWYgZnJlZSBhZGQgdG8gc2ltdWxhdG9yIGNvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IGN1c3QKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdPUZhbHNlCiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKQogICAgICAgICAgICAgICAgICBzaW0uYWRkX2NvbmRpdGlvbihzZWxmKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICBzZWxmLnF1ZXVlLnB1c2goY3VzdCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgZGVmIGV4ZWMoc2VsZiwgc2ltKToKICAgICAgICAgICAgYiA9IEZhbHNlCiAgICAgICAgICAgIGlmIHNlbGYuY29kZSE9Tm9uZToKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUsMCkKICAgICAgICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdPT1UcnVlOgogICAgICAgICAgICAgICAgICAgICAgICBjYz1zZWxmLmNvZGUuc3BsaXQoJzsnKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oY2MpPjE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoIjsiLmpvaW4oY2NbMTpdKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiZSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0KHNpbSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IE5vbmUgICAgIyBtYXJrIHRoYXQgbm93IHRoZSBzZXJ2aWNlIGlzIGZyZWUgISEhCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLnF1ZXVlKT4wIDogICMgYnV0IGlmIGFueWJvZHkgaW4gcXVldWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pbnNlcnQoc2VsZi5xdWV1ZS5wb3AoKSwgc2ltKSAgIyBnZXQgYW5kIGluc2VydCBpbnRvIHNpbXVsYXRvcgogICAgICAgICAgICAgICAgICAgICAgICBiID0gVHJ1ZSAgIyByZWFkeSB0byBiZSByZW1vdmVkIGZyb20gc2ltdWxhdG9yIGNvbmRpdGlvbnMKICAgICAgICAgICAgcmV0dXJuIGIKY2xhc3MgR2VuZXJhdG9yKEJwbW5FdmVudCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmdW4sIHBhcmFtLCB0bWF4PTAuMCwgY29kZT1Ob25lKToKICAgICAgICAgICAgQnBtbkV2ZW50Ll9faW5pdF9fKHNlbGYsIE5vbmUsIGNvZGUpCiAgICAgICAgICAgIHNlbGYuZnVuLCBzZWxmLnBhcmFtLCBzZWxmLnRtYXgsIHNlbGYubiA9IGZ1biwgcGFyYW0sIHRtYXgsIDAKICAgICAgICAgICAgaWYgc2VsZi5jb2RlIT1Ob25lIDoKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUpICAgIyBldmFsdWF0ZSBzY3JpcHQgY29kZSAoW3Zhcl09PHZhbHVlPikKICAgICAgZGVmIGV4ZWMoc2VsZiwgc2ltKToKICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IEN1c3RvbWVyKCkKICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKQogICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgc2VsZi5BWyJBLm4iXSArPSAxCiAgICAgICAgICAgIF9wcmludCgiUmVnaXN0ZXJpbmc6ICIgKyBzdHIoc2VsZi5jdXN0b21lcikgKyAiICgiK3N0cihzZWxmLnRpbWUpKyIpIikKICAgICAgICAgICAgc2VsZi5vdXQoc2ltKSAgICAgICAgICAgICAjIHBhc3MgY3VzdG9tZXIgdG8gY29ubmVjdGVkIG9iamVjdAogICAgICAgICAgICBzZWxmLnRpbWUgKz0gc2VsZi5fZnVuKCkKICAgICAgICAgICAgaWYgc2VsZi50bWF4PjAgYW5kIHNlbGYudGltZSA8PSBzZWxmLnRtYXggb3Igc2VsZi5uPC1zZWxmLnRtYXgtMToKICAgICAgICAgICAgICAgICAgc2VsZi5uICs9IDEKICAgICAgICAgICAgICAgICAgc2ltLmFkZChzZWxmKSAgICAgICAjIG5leHQgb25lIGluIHJhbmRvbSB0aW1lCmNsYXNzIFNlcnZpY2UoQnBtbkV2ZW50KToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIGZ1biwgcGFyYW0sIGNvZGU9Tm9uZSk6IAogICAgICAgICAgICBCcG1uRXZlbnQuX19pbml0X18oc2VsZiwiQWN0aXZpdHkiLGNvZGUpICAKICAgICAgICAgICAgc2VsZi5mdW4sIHNlbGYucGFyYW0gPSBmdW4sIHBhcmFtIAogICAgICAgICAgICBzZWxmLk4gPSAxICMgTiBudW1iZXIgb2YgdG9rZW5zIHRvIHdhaXQgKHVzZWQgZm9yIEFuZEdhdGUsT3JHYXRlKQogICAgICBkZWYgaW5zZXJ0KHNlbGYsIGN1c3QsIHNpbSk6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZixYb3JHYXRlKToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4xIGFuZCBzZWxmLmNvZGU9PU5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29kZT0iPUIoMC41KSIKICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKHNlbGYsT3JHYXRlKToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4xIGFuZCBzZWxmLmNvZGU9PU5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29kZT0iPVsxLCIrIiwiLmpvaW4oWycwJ10qKGxlbihzZWxmLm91dHB1dCktMSkpKyJdIgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyID09IE5vbmU6ICMgaWYgZnJlZSBhZGQgdG8gc2ltdWxhdG9yIHdpdGggZW5kIHRpbWUKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lcix0ID0gY3VzdCxzZWxmLl9mdW4oKQogICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHQsbGlzdCk6ICAjIFtjeWNsZSxiZWdpbj0wXSBjeWNsaWMgdGltZXIgKE1NIDEuMTEuMjAyNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHQpPDI6IHQuYXBwZW5kKDApCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IHRbMV0rbWF0aC5jZWlsKChzaW0ubm93KCktdFsxXSkvdFswXSkqdFswXQogICAgICAgICAgICAgICAgICAgICAgICAjX3ByaW50KCIjICIrc3RyKHNlbGYuY3VzdG9tZXIpKyI6ICIrc3RyKHNpbS5ub3coKSkrIiAiK3N0cihzZWxmLnRpbWUpKQogICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWUgPSBzaW0ubm93KCkgKyB0CiAgICAgICAgICAgICAgICAgIF9wcmludCgiIyIrc3RyKHNlbGYuaWQpKyIgc3RhcnRzIHNlcnZpbmcgIisKICAgICAgICAgICAgICAgICAgICAgICAgIHN0cihjdXN0KSsiICgiK3N0cihzaW0ubm93KCkpKyIsIitzdHIoc2VsZi50aW1lKSsiKSIpCiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXT1zaW0ubm93KCkKICAgICAgICAgICAgICAgICAgaWYgIl9fbiIrc3RyKHNlbGYuaWQpIG5vdCBpbiBzZWxmLmN1c3RvbWVyLmF0dHI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX19uIitzdHIoc2VsZi5pZCldID0gMCAjIGZpcnN0IHRpbWUKICAgICAgICAgICAgICAgICAgaWYgIl9fdCIrc3RyKHNlbGYuaWQpKyJhIiBub3QgaW4gc2VsZi5jdXN0b21lci5hdHRyOgogICAgICAgICAgICAgICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl09c2ltLm5vdygpICMgaWYgbm90IGZyb20gcXVldWUKICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzZWxmLFRpbWVyKSBhbmQgbm90IGlzaW5zdGFuY2UodCxsaXN0KTogICMgbW9kaWZ5IHJlcXVpcmVkIGZpbmFsIGV4ZWN1dGlvbiB0aW1lCiAgICAgICAgICAgICAgICAgICAgICAgIHRhPWN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImEiXSAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRiPWN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXQogICAgICAgICAgICAgICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJiIl0gLT0gKHRiLXRhKSAjIGRlY3JlYXNlIGJlZ2luIHRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lIC09ICh0Yi10YSkgICMgLi4uIGJ5IHRoZSBkaWZmZXJlbmNlIGVsYXBzZWQgYWxyZWFkeQogICAgICAgICAgICAgICAgICAgICAgICAjX3ByaW50KCIjICIrc3RyKHNlbGYuY3VzdG9tZXIpKyI6ICIrc3RyKHNlbGYudGltZSkpCiAgICAgICAgICAgICAgICAgIHNpbS5hZGQoc2VsZikKICAgICAgICAgICAgZWxzZTogICAgICAgICAgICAgICAgICAgICAjIGVsc2UgaW5zZXJ0IGludG8gcXVldWUKICAgICAgICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdPXNpbS5ub3coKSAgIyB3aXRoIGEgcXVldWUgYWRkaW5nIHRpbXN0YW1wCiAgICAgICAgICAgICAgICAgIHNlbGYucXVldWUucHVzaChjdXN0KQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl09c2ltLm5vdygpCiAgICAgICAgICAgICAgICAgIHNlbGYuQVsiQS5uIl0gKz0gMQogICAgICAgICAgICBfcHJpbnQoIiMiK3N0cihzZWxmLmlkKSsiIGZpbmlzaGVkIHNlcnZpbmcgIiArIHN0cihzZWxmLmN1c3RvbWVyKSArICIgYXQgIiArIHN0cihzZWxmLnRpbWUpKQogICAgICAgICAgICBpZiBzZWxmLmNvZGUhPU5vbmUgOiAgICAgIAogICAgICAgICAgICAgICAgICBzZWxmLl9ldmFsKHNlbGYuY29kZSkgICAjIGV2YWx1YXRlIHNjcmlwdCBjb2RlIChbdmFyXT08dmFsdWU+KQogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fbiIrc3RyKHNlbGYuaWQpXSArPSAxCiAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZixPckdhdGUpIGFuZCBsZW4oc2VsZi5vdXRwdXQpPT0xOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLk4gPSBzZWxmLmN1c3RvbWVyLk4KICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuY3VzdG9tZXIuYXR0clsiX19uIitzdHIoc2VsZi5pZCldJXNlbGYuTikgPT0gMDogI3NlbGYuTjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXQoc2ltKSAgICAgIyBwYXNzIGN1c3RvbWVyIHRvIGNvbm5lY3RlZCBvYmplY3QKICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IE5vbmUgICAgIyBtYXJrIHRoYXQgbm93IHRoZSBzZXJ2aWNlIGlzIGZyZWUgISEhCiAgICAgICAgICAgIGlmIGxlbihzZWxmLnF1ZXVlKT4wIDogICMgYnV0IGlmIGFueWJvZHkgaW4gcXVldWUKICAgICAgICAgICAgICAgICAgU2VydmljZS5pbnNlcnQoc2VsZixzZWxmLnF1ZXVlLnBvcCgpLCBzaW0pICAjIGdldCBhbmQgaW5zZXJ0IGludG8gc2ltdWxhdG9yCmNsYXNzIFNpbmsoQnBtbkV2ZW50KToKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOiAgICAKICAgICAgICAgICAgX3ByaW50KCJTaW5raW5nICIrc3RyKGN1c3QpKyIgOiAiK3N0cihzaW0ubm93KCkpKQogICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl0gPSBzaW0ubm93KCkgICMgbWFyayB0aW1lIGluIGN1c3RvbWVyIGF0dHJpYnV0ZXMKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdID0gc2ltLm5vdygpICAjIG1hcmsgdGltZSBpbiBjdXN0b21lciBhdHRyaWJ1dGVzCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IHNpbS5ub3coKSAgIyBtYXJrIHRpbWUgaW4gY3VzdG9tZXIgYXR0cmlidXRlcwogICAgICAgICAgICBzZWxmLkFbIkEubiJdICs9IDEKICAgICAgICAgICAgc2VsZi5xdWV1ZS5wdXNoKGN1c3QpICAgICAjIGluc2VydCBvbmx5IHRvIGl0cyBxdWV1ZQogICAgICAgICAgICBzZWxmLmN1c3RvbWVyPWN1c3QKICAgICAgICAgICAgaWYgc2VsZi5jb2RlIT1Ob25lIDoKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUpICAgIyBldmFsdWF0ZSBzY3JpcHQgY29kZQojIC0tLS0gYnBtbiBkZXJpdmVkIGNsYXNzZXMgKGZyb20gR2VuZXJhdG9yLCBTZXJ2aWNlLCBDb25kaXRpb25hbEV2ZW50IG9yIFNpbmspIC0tLS0KY2xhc3MgWG9yR2F0ZShTZXJ2aWNlKTogICAgIyByYW5kb20gb3V0cHV0IGlmIHR3byBvdXRwdXRzIAogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOiAgIyBkZWZhdWx0cyB0byBiaW5hcnkgcmFuZG9tIHNlbGVjdGlvbgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiZXhjbHVzaXZlR2F0ZXdheSIpCmNsYXNzIE9yR2F0ZShTZXJ2aWNlKTogICAgIyBvdXRwdXQgY29uZGl0aW9uIG11c3QgYmUgZGVmaW5lZCBieSBhcnJheSBvZiB2YWx1ZXMhIAogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiaW5jbHVzaXZlR2F0ZXdheSIpCmNsYXNzIEFuZEdhdGUoU2VydmljZSk6ICAgIAogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgicGFyYWxsZWxHYXRld2F5IikKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOgogICAgICAgICAgICBpZHM9W2UuaWQgZm9yIGUgaW4gc2VsZi5wcmV2KCldICMgaWRzIG9mIGlucHV0cwogICAgICAgICAgICBzZWxmLk49bGVuKHNldChpZHMpKSAjIHNldCBudW1iZXIgb2YgaW5wdXRzICh3aXRoIHVuaXF1ZSBpZHMpIHRvIHdhaXQKICAgICAgICAgICAgU2VydmljZS5pbnNlcnQoc2VsZixjdXN0LHNpbSkKY2xhc3MgU3RhcnQoR2VuZXJhdG9yKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsZnVuPUUscGFyYW09WzFdLHRubWF4PTUwLjAsY29kZT1Ob25lKToKICAgICAgICAgICAgR2VuZXJhdG9yLl9faW5pdF9fKHNlbGYsZnVuLHBhcmFtLHRubWF4LGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgic3RhcnRFdmVudCIpCmNsYXNzIFRhc2soU2VydmljZSk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGZ1bj1VLHBhcmFtPVsxLDJdLGNvZGU9Tm9uZSxNPTEpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsZnVuLHBhcmFtLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgidGFzayIpCiAgICAgICAgICAgIHNlbGYuc2VydmVycywgc2VsZi5uc2VydmVyLCBzZWxmLk0gPSBbXSwgMCwgTQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShzZWxmLk0tMSk6CiAgICAgICAgICAgICAgICAgIEV2ZW50LmNudCAtPTEKICAgICAgICAgICAgICAgICAgc2VsZi5zZXJ2ZXJzLmFwcGVuZChTZXJ2aWNlKGZ1bixwYXJhbSxjb2RlKSkKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOgogICAgICAgICAgICBpZihzZWxmLm5zZXJ2ZXI9PTApOiAgIyBteXNlbGYKICAgICAgICAgICAgICAgICAgU2VydmljZS5pbnNlcnQoc2VsZixjdXN0LHNpbSkKICAgICAgICAgICAgZWxzZTogICAgICAgICAgICAgICMgb3RoZXJzZWxmcwogICAgICAgICAgICAgICAgICBzZWxmLnNlcnZlcnNbc2VsZi5uc2VydmVyLTFdLmluc2VydChjdXN0LHNpbSkKICAgICAgICAgICAgc2VsZi5uc2VydmVyID0gKHNlbGYubnNlcnZlcisxKSVzZWxmLk0KY2xhc3MgVGltZXIoU2VydmljZSk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGZ1bj0xLHBhcmFtPU5vbmUsY29kZT1Ob25lKToKICAgICAgICAgICAgaWYgbm90IGNhbGxhYmxlKGZ1bik6ICAjIHdoZW4gcGFzc2luZyBmaXhlZCBkZWxheSB2YWx1ZQogICAgICAgICAgICAgICAgICBmdW4scGFyYW0sY29kZSA9IE5vbmUsZnVuLHBhcmFtCiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixmdW4scGFyYW0sY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJpbnRlcm1lZGlhdGVDYXRjaEV2ZW50IikKY2xhc3MgRW5kKFNpbmspOgogICAgICAjZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAjICAgICAgU2luay5fX2luaXRfXyhzZWxmKQogICAgICAjICAgICAgc2VsZi5zZXROYW1lKCJlbmRFdmVudCIpCiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIFNpbmsuX19pbml0X18oc2VsZiwiZW5kRXZlbnQiLGNvZGUpCmNsYXNzIFRocm93KFNlcnZpY2UpOgogICAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixOb25lLDApCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiaW50ZXJtZWRpYXRlVGhyb3dFdmVudCIpCmNsYXNzIFRlcm1pbmF0ZShFbmQpOgogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBFbmQuX19pbml0X18oc2VsZixjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInRlcm1pbmF0ZUVuZEV2ZW50IikKY2xhc3MgU2NyaXB0KFNlcnZpY2UpOgogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgic2NyaXB0VGFzayIpCmNsYXNzIENvbmRpdGlvbihDb25kaXRpb25hbEV2ZW50KToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgQ29uZGl0aW9uYWxFdmVudC5fX2luaXRfXyhzZWxmLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiaW50ZXJtZWRpYXRlQ2F0Y2hFdmVudCIpCgojIC0tLS0gdXRpbDIgLS0tLS0tLS0gICAgICAKZGVmIGNvbm5lY3QoYSwgYik6CiAgICAgIGEub3V0cHV0LmFwcGVuZChiKQogICAgICBpZiBpc2luc3RhbmNlKGEsVGFzayk6CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihhLnNlcnZlcnMpKTogICMgZmlyc3Qgc2VydmVyIGlzIGFscmVhZHkgY29ubmVjdGVkCiAgICAgICAgICAgICAgICAgIGEuc2VydmVyc1tpXS5vdXRwdXQuYXBwZW5kKGIpCmRlZiBkaWN0X3Rvc3RyaW5nKGEpOgogICAgICByZXR1cm4gIlxuIi5qb2luKFtrKyI6XHQiK3N0cih2KSBmb3Igayx2IGluIGEuaXRlbXMoKV0pCiIiIgpkZWYgaGlzdChhPVswLDFdLCBiPTIwLCBjPSdvcmFuZ2UnKToKICAgICAgaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdAogICAgICBwbHQuaGlzdChhLGIsY29sb3I9YykKICAgICAgI3BsdC5zYXZlZmlnKCJkZXNfcGxvdC5zdmciLCBmb3JtYXQ9InN2ZyIpCiAgICAgICNwbHQuc2hvdygpCiAgICAgIGltcG9ydCBpbywgYmFzZTY0CiAgICAgIGJ1ZiA9IGlvLkJ5dGVzSU8oKQogICAgICBwbHQuc2F2ZWZpZyhidWYsIGZvcm1hdD0nc3ZnJykKICAgICAgYnVmLnNlZWsoMCkKICAgICAgcmV0dXJuICdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCcgKyBiYXNlNjQuYjY0ZW5jb2RlKGJ1Zi5yZWFkKCkpLmRlY29kZSgnVVRGLTgnKQoiIiIKZGVmIGZyb21fZmlsZShmbmFtZSk6CiAgICAgIHdpdGggb3BlbihmbmFtZSwiciIpIGFzIGZwOgogICAgICAgICAgICByZXR1cm4gZnAucmVhZCgpCgojIC0tLS0gY29udmVyc2lvbnMgLS0tLS0tLS0gICAgICAKZGVmIGF0dHJfdG9zdHJpbmcoYSk6CiAgICAgIHM9Im5hbWU6ICIrYVsibmFtZSJdKyJcbiIKICAgICAgZm9yIGkgaW4gcmFuZ2UoMSwxMDApOgogICAgICAgICAgICB0PSJfX3QiK3N0cihpKQogICAgICAgICAgICBpZiB0KyJiIiBpbiBhOgogICAgICAgICAgICAgICAgICBzKz10KyIgIisiJS4zZiIlYVt0KyJiIl0rIiAiKyIlLjNmIiVhW3QrImUiXSsiXG4iCiAgICAgIHJldHVybiBzCmRlZiBhdHRyX3Rvc3Znc3RyaW5nKG8sd21heCx3PTE2LGg9MjQpOgogICAgICBnbG9iYWwgbmUKICAgICAgYSxzID0gby5hdHRyLCIiCiAgICAgIGM9Wydob3RwaW5rJywnbGltZWdyZWVuJywnY29ybmZsb3dlcmJsdWUnLCdjb3JhbCcsJ21lZGl1bXNlYWdyZWVuJywnbWVkaXVtcHVycGxlJ10KICAgICAgZm9yIGkgaW4gcmFuZ2UoMTAwKToKICAgICAgICAgICAgdD0iX190IitzdHIoaSkKICAgICAgICAgICAgaWYgdCsiYiIgaW4gYToKICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IHg9IjgiIHk9Iicrc3RyKDMyK2gqaSkrJyI+JytzdHIoaSkrJzx0aXRsZT4nK3N0cihuZS5lZVtpLTFdLm5hbWUpKycgJytzdHIobmUuZWVbaS0xXS50aXRsZSkrJzwvdGl0bGU+PC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICBzKz0nPHRleHQgY2xhc3M9InQxIiBzdHlsZT0iZGlzcGxheTpub25lO2ZpbGw6Z3JheSIgeD0iMzIiIHk9Iicrc3RyKDMyK2gqaSkrJyI+JytzdHIobmUuZWVbaS0xXS50aXRsZSkrJzx0aXRsZT4nK3N0cihuZS5lZVtpLTFdLm5hbWUpKyc8L3RpdGxlPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgdDAsdDEsdDIgPSBhW3QrImEiXSxhW3QrImIiXSxhW3QrImUiXQogICAgICAgICAgICAgICAgICBzKz0nPHJlY3QgeT0iJytzdHIoMjAraCppKSsnIiB4PSInK3N0cigyMCt3KnQxKQogICAgICAgICAgICAgICAgICBzKz0nIiB3aWR0aD0iJytzdHIodDItdDE9PTAgYW5kIDEgb3IgdyoodDItdDEpKSsnIiBoZWlnaHQ9Iicrc3RyKGgtMikrJyIgc3Ryb2tlPSJibGFjayIgZmlsbC1vcGFjaXR5PSIwLjciIGZpbGw9IicKICAgICAgICAgICAgICAgICAgcys9KGNbaW50KGFbImNuYW1lIl0uc3BsaXQoJyAnKVswXSklbGVuKGMpXSkrJyI+PHRpdGxlPicrYVsiY25hbWUiXSsnIFsnKygiJS4yZiwgIiV0MCkrKCIlLjJmLCAiJXQxKSsoIiUuMmYiJXQyKSsnXScrJzwvdGl0bGU+PC9yZWN0PlxuJwogICAgICAgICAgICAgICAgICBpZiB0Mi10MT4wLjU6CiAgICAgICAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSInK3N0cigyMCt3KnQxKzIpKyciIHk9Iicrc3RyKDIwK2gqaSsxOCkrJyI+JythWyJjbmFtZSJdKyc8L3RleHQ+JwogICAgICAgICAgICAgICAgICBpZiB3KnQxPndtYXhbMF06CiAgICAgICAgICAgICAgICAgICAgICAgIHdtYXhbMF0gPSB3KnQxCiAgICAgIHJldHVybiBzCmRlZiB0b19zdmcoZWU9UXVldWVkRXZlbnQuaW5zdGFuY2VzKToKICAgICAgdyxoLFcsSCA9IDE2LDI0LFsxNjBdLDQwICAjIFdbMF0gZm9yIHBhc3NpbmcgYnkgcmVmZXJlbmNlISEhCiAgICAgIHMgPSAnPHN2ZyBvbmNsaWNrPSJvbl9jbGljaygpIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIlZCIgaGVpZ2h0PSIlZCI+XG4nCiAgICAgIGZvciBlIGluIGVlOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGUsRW5kKToKICAgICAgICAgICAgICAgICAgZm9yIGMgaW4gZS5xdWV1ZS5vYmplY3RzOgogICAgICAgICAgICAgICAgICAgICAgICBzICs9IGF0dHJfdG9zdmdzdHJpbmcoYyxXLHcsaCkKICAgICAgICAgICAgSCArPSAyNAogICAgICBIKz0yNAogICAgICBzKz0gJzxyZWN0IHg9IjIwIiB5PSIxMCIgd2lkdGg9IiVkIiBoZWlnaHQ9IjIiLz5cbiclKFdbMF0rdykKICAgICAgcys9ICc8cmVjdCB4PSIyMCIgeT0iJWQiIHdpZHRoPSIlZCIgaGVpZ2h0PSIyIi8+XG4nJShIKzEwLFdbMF0rdykKICAgICAgZm9yIGkgaW4gcmFuZ2UoaW50KFdbMF0vdysyKSk6CiAgICAgICAgICAgIHMgKz0gJzxyZWN0IHg9Iicrc3RyKDIwK3cqaSkrJyIgeT0iMTAiIHdpZHRoPSIxIiBoZWlnaHQ9IjEwIi8+XG4nCiAgICAgICAgICAgIHMgKz0gJzxyZWN0IHg9Iicrc3RyKDIwK3cqaSkrJyIgeT0iJWQiIHdpZHRoPSIxIiBoZWlnaHQ9IjEwIi8+XG4nJShIKQogICAgICAgICAgICBpZiAoaSUxMCk9PTA6CiAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSInK3N0cigyMCt3KmktOCkrJyIgeT0iMzIiPicrc3RyKGkpKyc8L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCB4PSInK3N0cigyMCt3KmktOCkrJyIgeT0iJWQiPiclKEgpK3N0cihpKSsnPC90ZXh0PlxuJwogICAgICBzICs9ICI8c2NyaXB0PmZ1bmN0aW9uIG9uX2NsaWNrKCkge1suLi5kb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0MScpXS5mb3JFYWNoKGU9PmUuc3R5bGUuZGlzcGxheT0oZS5zdHlsZS5kaXNwbGF5PT0nbm9uZSc/Jyc6J25vbmUnKSk7fTwvc2NyaXB0PiIKICAgICAgcmV0dXJuIHMlKFdbMF0rODAsSCsyMCkgKyAnPC9zdmc+XG4nCmRlZiB0b19kb3QwKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHMgPSdkaWdyYXBoIEJQTU4geyByYW5rZGlyPSJMUiIgcmFua3NlcD0xIG5vZGVzZXA9MVxuJwogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpKToKICAgICAgICAgICAgczEgPSAnICB7cmFuaz1zYW1lOyAnCiAgICAgICAgICAgIGZvciBqIGluIHJhbmdlKGxlbihlZVtpXS5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgcyArPSAiICAiK3N0cihlZVtpXS5pZCkgKyAiIC0+ICIgKyBzdHIoZWVbaV0ub3V0cHV0W2pdLmlkKSArIlxuIgogICAgICAgICAgICAgICAgICBzMSArPSBzdHIoZWVbaV0ub3V0cHV0W2pdLmlkKSArIjsgIgogICAgICAgICAgICBpZiBsZW4oZWVbaV0ub3V0cHV0KT4xOgogICAgICAgICAgICAgICAgICBpZiBhYnMoZWVbaV0ub3V0cHV0WzBdLmlkLWVlW2ldLm91dHB1dFsxXS5pZCk8MjogcyArPSBzMSArJ31cbicKICAgICAgcmV0dXJuIHMrJ30nCmRlZiB0b19kb3QoZWU9UXVldWVkRXZlbnQuaW5zdGFuY2VzKToKICAgICAgcyA9J2RpZ3JhcGggQlBNTjIgeyByYW5rZGlyPSJMUiIgbm9kZXNlcD0wLjZcbicKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6CiAgICAgICAgICAgIGxhYmVsLHhsYWJlbCxzaGFwZSxzdHlsZSxjb2xvcixwZW4gPSBzdHIoZWVbaV0uaWQpLCIiLCJyZWN0IiwiIiwiIiwiMSIKICAgICAgICAgICAgc2l6ZT0iIgogICAgICAgICAgICBpZiAidmVudCIgaW4gZWVbaV0ubmFtZTogc2hhcGU9ImNpcmNsZSIKICAgICAgICAgICAgZWxpZiAiYXRld2F5IiBpbiBlZVtpXS5uYW1lOiBzaGFwZT0iZGlhbW9uZCI7IHNpemU9ImhlaWdodD0wLjciCiAgICAgICAgICAgIGlmICJpbnRlcm1lZGlhdGUiIGluIGVlW2ldLm5hbWU6IHNoYXBlPSJkb3VibGVjaXJjbGUiCiAgICAgICAgICAgIGlmIHNoYXBlPT0icmVjdCI6IHN0eWxlPSJyb3VuZGVkLGZpbGxlZCI7IGNvbG9yPSJsaWdodGJsdWUiOyBzaXplPSJ3aWR0aD0xLjEgaGVpZ2h0PTAuOCIKICAgICAgICAgICAgZWxpZiAiZW5kIiBpbiBlZVtpXS5uYW1lOiBzdHlsZT0iZmlsbGVkIjsgcGVuPSIzIgogICAgICAgICAgICBpZiAiZXhjbHVzaXZlIiBpbiBlZVtpXS5uYW1lOiB4bGFiZWw9bGFiZWw7IGxhYmVsPSJYIgogICAgICAgICAgICBlbGlmICJwYXJhbGxlbCIgaW4gZWVbaV0ubmFtZTogeGxhYmVsPWxhYmVsOyBsYWJlbD0iKyIKICAgICAgICAgICAgZWxpZiAiaW5jbHVzaXZlIiBpbiBlZVtpXS5uYW1lOiB4bGFiZWw9bGFiZWw7IGxhYmVsPSJPIgogICAgICAgICAgICBzICs9ICcgICcrZWVbaV0ubmFtZSArJyBbbGFiZWw9IicrbGFiZWwrJyIgeGxhYmVsPSInK3hsYWJlbAogICAgICAgICAgICBzICs9ICciIHN0eWxlPSInK3N0eWxlKyciIHNoYXBlPSInK3NoYXBlKyciIGZpbGxjb2xvcj0iJwogICAgICAgICAgICBzICs9IGNvbG9yKyciIHBlbndpZHRoPSInK3BlbisnIiAnK3NpemUrJ10nICsnXG4nCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBzMSA9ICcgIHtyYW5rPXNhbWU7ICcKICAgICAgICAgICAgZm9yIGogaW4gcmFuZ2UobGVuKGVlW2ldLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICBzICs9ICIgICIrZWVbaV0ubmFtZSArICIgLT4gIiArIGVlW2ldLm91dHB1dFtqXS5uYW1lICsiXG4iCiAgICAgICAgICAgICAgICAgIHMxICs9IGVlW2ldLm91dHB1dFtqXS5uYW1lICsiOyAiCiAgICAgICAgICAgIGlmIGxlbihlZVtpXS5vdXRwdXQpPjE6CiAgICAgICAgICAgICAgICAgIGlmIGFicyhlZVtpXS5vdXRwdXRbMF0uaWQtZWVbaV0ub3V0cHV0WzFdLmlkKTwyOiBzICs9IHMxICsnfVxuJwogICAgICByZXR1cm4gcysnfScKZGVmIHRvX3Bvc2l0aW9uKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyk6CiAgICAgIHBwPVtdCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOiAgICMgc2V0IHggcG9zaXRpb24gdG8gdHJlZSBsZXZlbAogICAgICAgICAgICB4LGVwID0gMCxlZVtpXS5wcmV2KCkKICAgICAgICAgICAgZm9yIGlkeCBpbiByYW5nZShsZW4oZXApLTEsLTEsLTEpOgogICAgICAgICAgICAgICAgICBpZiBlcFtpZHhdLnBwWzBdIT0tMToKICAgICAgICAgICAgICAgICAgICAgICAgeD1lcFtpZHhdLnBwWzBdKzEKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWVbaV0ucHA9W3gsMF0KICAgICAgICAgICAgcHAuYXBwZW5kKGVlW2ldLnBwKQogICAgICAjcHJpbnQoW18ucHAgZm9yIF8gaW4gZWVdKQogICAgICBmb3IgaSBpbiByYW5nZSgxLGxlbihwcCkpOiAjIGluY3JlYXNlIHkgcG9zaXRpb24gZm9yIGFsbCBhdCB0aGUgc2FtZSBsZXZlbAogICAgICAgICAgICBpZiBwcFtpXVswXT09cHBbaS0xXVswXToKICAgICAgICAgICAgICAgICAgcHBbaV1bMV0gPSBwcFtpLTFdWzFdKzEKICAgICAgICAgICAgICAgICAgZWVbaV0ucHA9cHBbaV0KICAgICAgI3ByaW50KFtfLnBwIGZvciBfIGluIGVlXSkKICAgICAgIyIiIgogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpLTEsLTEsLTEpOiAgICMgc2V0IHkgcG9zaXRpb24gdG8gdGhlIGxldmVsIG9mIHByZXZpb3VzIAogICAgICAgICAgICBlID0gZWVbaV0ucHJldigpCiAgICAgICAgICAgIGlmIGxlbihlKT4wIGFuZCBlWzBdLm91dHB1dFswXT09ZWVbaV06CiAgICAgICAgICAgICAgICAgIHBwW2ldWzFdID0gZVswXS5wcFsxXQogICAgICAgICAgICAgICAgICBlZVtpXS5wcD1wcFtpXQogICAgICAgICAgICBpZiBsZW4oZSk+MCBhbmQgbGVuKGVbMF0ub3V0cHV0KT4xIGFuZCBlWzBdLm91dHB1dFsxXT09ZWVbaV0gYW5kIGxlbihlZVtpXS5vdXRwdXQpPT0wOgogICAgICAgICAgICAgICAgICBwcFtpXVswXSA9IGVlW2ldLnBwWzBdLTEgICMgd2hlbiBpdCBpcyB0aGUgc2Vjb25kIGFuZCBoYXMgbm8gb3VwdXQKICAgICAgICAgICAgICAgICAgZWVbaV0ucHA9cHBbaV0KICAgICAgI3ByaW50KFtfLnBwIGZvciBfIGluIGVlXSkKICAgICAgIyIiIgogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpLTEsLTEsLTEpOiAjIG1vdmUgcHJldmlvdXMgdG8gdGhlIGxldmVsIG9mIGl0cyBmaXJzdCBuZXh0CiAgICAgICAgICAgIGVwPWVlW2ldLnByZXYoKQogICAgICAgICAgICBpZiBsZW4oZXApPjAgYW5kIGVwWzBdLm91dHB1dFswXT09ZWVbaV0gYW5kIGVwWzBdLnBwWzBdPT1lZVtpXS5wcFswXS0xOgogICAgICAgICAgICAgICAgICBpZiBlcFswXS5wcFsxXSE9ZWVbaV0ucHBbMV06CiAgICAgICAgICAgICAgICAgICAgICAgIGVwWzBdLnBwWzFdPWVlW2ldLnBwWzFdCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pICAgICAgCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOiAgIyBmb3JjZSBwb3NpdGlvbiBmcm9tIHBwMgogICAgICAgICAgICBpZiBlZVtpXS5wcDJbMF0hPS0xOgogICAgICAgICAgICAgICAgICBlZVtpXS5wcFswXT1lZVtpXS5wcDJbMF0KICAgICAgICAgICAgaWYgZWVbaV0ucHAyWzFdIT0tMToKICAgICAgICAgICAgICAgICAgZWVbaV0ucHBbMV09ZWVbaV0ucHAyWzFdCiAgICAgIGZvciBlIGluIGVlOiAgICMgY29ycmVjdCBwb3NpdGlvbiBvZiBib3VuZGFyeSBldmVudHMgCiAgICAgICAgICAgICNpZihlLnBwWzBdPT0wIGFuZCBlLnBwWzFdPT0wKToKICAgICAgICAgICAgaWYoZS5pZCE9ZS5pZDIpOgogICAgICAgICAgICAgICAgICBpZDI9aW50KHN0cihlLmlkMikuc3BsaXQoIi4iKVsxXSkKICAgICAgICAgICAgICAgICAgZS5wcFswXSxlLnBwWzFdID0gZWVbaWQyLTFdLnBwWzBdLGVlW2lkMi0xXS5wcFsxXQogICAgICByZXR1cm4gW2UucHAgZm9yIGUgaW4gZWVdCmRlZiB0b19icG1uKGVlPVF1ZXVlZEV2ZW50Lmluc3RhbmNlcyxwcD1Ob25lKToKICAgICAgcyA9Jzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ij8+XG4nCiAgICAgIHMrPSc8YnBtbjpkZWZpbml0aW9ucyB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIicKICAgICAgcys9JyB4bWxuczpicG1uPSJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L01PREVMIicKICAgICAgcys9JyB4bWxuczpicG1uZGk9Imh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0JQTU4vMjAxMDA1MjQvREkiJwogICAgICBzKz0nIHhtbG5zOmRjPSJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9EQyInCiAgICAgIHMrPScgeG1sbnM6ZGk9Imh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0RELzIwMTAwNTI0L0RJIicKICAgICAgcys9JyB0YXJnZXROYW1lc3BhY2U9Imh0dHA6Ly9icG1uLmlvL3NjaGVtYS9icG1uIicKICAgICAgcys9JyBpZD0iRGVmaW5pdGlvbnNfMSIgZXhwb3J0ZXI9ImRlcyIgZXhwb3J0ZXJWZXJzaW9uPSIxLjAiPlxuJwogICAgICBzMT0nIDxicG1uOnByb2Nlc3MgaWQ9IlByb2Nlc3NfMSI+XG4nCiAgICAgIHMyPScgPGJwbW5kaTpCUE1ORGlhZ3JhbSBpZD0iQlBNTkRpYWdyYW1fMSI+XG4nCiAgICAgIHMyKz0nICA8YnBtbmRpOkJQTU5QbGFuZSBpZD0iQlBNTlBsYW5lXzEiIGJwbW5FbGVtZW50PSJQcm9jZXNzXzEiPlxuJwogICAgICBzMWE9JycKICAgICAgajEgPSAwICAjIGZsb3cgY291bnRlcgogICAgICBXLEgsVzAsSDAgPSAxMDAsMTAwLDQwLDMwCiAgICAgIGlmIG5vdCBwcDoKICAgICAgICAgICAgcHAgPSBbZS5wcCBmb3IgZSBpbiBlZV0KICAgICAgICAgICAgaWYgcHBbMF1bMF09PS0xOgogICAgICAgICAgICAgICAgICBwcCA9IHRvX3Bvc2l0aW9uKGVlKQogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpKToKICAgICAgICAgICAgbmFtZSA9IGVlW2ldLm5hbWUKICAgICAgICAgICAgaWYgInRlcm1pbmF0ZSIgaW4gbmFtZToKICAgICAgICAgICAgICAgICAgbmFtZT1uYW1lW2xlbigidGVybWluYXRlIik6XQogICAgICAgICAgICBlbmFtZSA9IGVlW2ldLl9fY2xhc3NfXy5fX25hbWVfXysnXycrc3RyKGVlW2ldLmZ1biBhbmQgZWVbaV0uZnVuLl9fbmFtZV9fIG9yIE5vbmUpKydfJwogICAgICAgICAgICBpbXBvcnQgYmFzZTY0CiAgICAgICAgICAgIGVuYW1lICs9IGJhc2U2NC5iMTZlbmNvZGUoYnl0ZWFycmF5KHN0cihlZVtpXS5wYXJhbSkrJ18nK3N0cihlZVtpXS5jb2RlKSwnYXNjaWknKSkuZGVjb2RlKCdhc2NpaScpICMgcmVxdWlyZXMgZW5jb2RpbmchCiAgICAgICAgICAgIHR5cGU9bmFtZS5zcGxpdCgiXyIpWzBdCiAgICAgICAgICAgIGd0PXsid2kiOjgwLCJoIjo2MCwib3giOjAsIm95IjowLCJlIjooODAsMzApLCJ3IjooMCwzMCksIm4iOig0MCwwKSwicyI6KDQwLDYwKX0KICAgICAgICAgICAgZ2c9eyJ3aSI6MzYsImgiOjM2LCJveCI6MjIsIm95IjoxMiwiZSI6KDU4LDMwKSwidyI6KDIyLDMwKSwibiI6KDQwLDEyKSwicyI6KDQwLDQ4KX0KICAgICAgICAgICAgZzEgPSBndCBpZiAiYXNrIiBpbiB0eXBlIGVsc2UgZ2cKICAgICAgICAgICAgdyxoID0gZzFbIndpIl0sZzFbImgiXSAgIyBpY29uIHNpemUKICAgICAgICAgICAgeGIseWIgPSBXMCtXKnBwW2ldWzBdLCBIMCtIKnBwW2ldWzFdCiAgICAgICAgICAgIHhvLHlvID0geGIrZzFbIm94Il0sIHliK2cxWyJveSJdICMgaWNvbiBvZmZzZXQKICAgICAgICAgICAgaWYgInRhc2siIGluIHR5cGU6CiAgICAgICAgICAgICAgICAgIGlmIGxlbihlZVtpXS5vdXRwdXQpPjE6IHR5cGUgPSAic2VuZFRhc2siCiAgICAgICAgICAgICAgICAgIGlmIGxlbihzZXQoW2UuaWQgZm9yIGUgaW4gZWVbaV0ucHJldigpXSkpPjE6IHR5cGUgPSAicmVjZWl2ZVRhc2siCiAgICAgICAgICAgIGlmIGVlW2ldLmlkICE9IGVlW2ldLmlkMjogICMgZm9yIGJvdW5kYXJ5IGV2ZW50cwogICAgICAgICAgICAgICAgICBpZDIgPSBpbnQoc3RyKGVlW2ldLmlkMikuc3BsaXQoJy4nKVsxXSkKICAgICAgICAgICAgICAgICAgeG8seW8gPSBlZVtpZDItMV0ueCsyMi41LGVlW2lkMi0xXS55KzQyLjUKICAgICAgICAgICAgICAgICAgdHlwZSA9ICJib3VuZGFyeUV2ZW50IgogICAgICAgICAgICBlZVtpXS54LGVlW2ldLnkgPSB4byx5bwogICAgICAgICAgICBzMSs9JyAgPGJwbW46Jyt0eXBlKycgaWQ9IicrbmFtZSsnIiBuYW1lPSInK25hbWUuc3BsaXQoIl8iKVsxXSsnXG4nK2VlW2ldLnRpdGxlKyciPlxuJwogICAgICAgICAgICBzMis9JyAgIDxicG1uZGk6QlBNTlNoYXBlIGlkPSInK25hbWUrJ18nK2VuYW1lKyciIGJwbW5FbGVtZW50PSInK25hbWUrJyI+XG4nCiAgICAgICAgICAgIHMyKz0nICAgIDxkYzpCb3VuZHMgeD0iJytzdHIoeG8pKyciIHk9Iicrc3RyKHlvKSsnIiB3aWR0aD0iJytzdHIodykrJyIgaGVpZ2h0PSInK3N0cihoKSsnIiAvPlxuJwogICAgICAgICAgICBzMis9JyAgIDwvYnBtbmRpOkJQTU5TaGFwZT5cbicKICAgICAgICAgICAgZm9yIGoyIGluIHJhbmdlKGxlbihlZVtpXS5vdXRwdXQpKToKICAgICAgICAgICAgICAgICAgajEgKz0gMQogICAgICAgICAgICAgICAgICBmbG93LGVmbG93PSdGbG93Xycrc3RyKGoxKSwiZGkiCiAgICAgICAgICAgICAgICAgIGlpID0gZWVbaV0ub3V0cHV0W2oyXS5pZC0xCiAgICAgICAgICAgICAgICAgICNwcmludChlZVtpXSxqMixlZVtpXS5vdXRwdXRbajJdLGlpLHBwKQogICAgICAgICAgICAgICAgICB4ZSx5ZSA9IFcwK1cqcHBbaWldWzBdLCBIMCtIKnBwW2lpXVsxXQogICAgICAgICAgICAgICAgICBuYW1lMj1lZVtpXS5vdXRwdXRbajJdLm5hbWUKICAgICAgICAgICAgICAgICAgaWYgInRlcm1pbmF0ZSIgaW4gbmFtZTI6CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUyPW5hbWUyW2xlbigidGVybWluYXRlIik6XQogICAgICAgICAgICAgICAgICB0eXBlMj1uYW1lMi5zcGxpdCgiXyIpWzBdCiAgICAgICAgICAgICAgICAgIGcyID0gZ3QgaWYgImFzayIgaW4gdHlwZTIgZWxzZSBnZwogICAgICAgICAgICAgICAgICBpZiB4ZT54YjogIyB0d28gZWRnZXMKICAgICAgICAgICAgICAgICAgICAgICAgZHgxLGR5MSA9IGcxWyJzIl0gaWYgeWI8eWUgZWxzZSBnMVsiZSJdCiAgICAgICAgICAgICAgICAgICAgICAgIGR4MixkeTIgPSBnMlsicyJdIGlmIHliPnllIGVsc2UgZzJbInciXQogICAgICAgICAgICAgICAgICBlbHNlIDogICAgIyB0aHJlZSBlZGdlcwogICAgICAgICAgICAgICAgICAgICAgICBkeDEsZHkxID0gZzFbInMiXSBpZiB5Yjx5ZSBlbHNlIGcxWyJuIl0KICAgICAgICAgICAgICAgICAgICAgICAgZHgyLGR5MiA9IGcyWyJzIl0gaWYgeWI+eWUgZWxzZSBnMlsibiJdCiAgICAgICAgICAgICAgICAgIHgxLHkxID0geGIrZHgxLHliK2R5MQogICAgICAgICAgICAgICAgICB4Mix5MiA9IHhlK2R4Mix5ZStkeTIKICAgICAgICAgICAgICAgICAgczErPScgICA8YnBtbjpvdXRnb2luZz4nK2Zsb3crJzwvYnBtbjpvdXRnb2luZz5cbicKICAgICAgICAgICAgICAgICAgaWYgImludGVybWVkaWF0ZUNhdGNoIiBpbiBuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAib25kaXRpb24iIGluIGVuYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOmNvbmRpdGlvbmFsRXZlbnREZWZpbml0aW9uLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgczErPScgICA8YnBtbjp0aW1lckV2ZW50RGVmaW5pdGlvbi8+XG4nCiAgICAgICAgICAgICAgICAgIHMxYSs9JyAgICA8YnBtbjpzZXF1ZW5jZUZsb3cgaWQ9IicrZmxvdysnIiBzb3VyY2VSZWY9IicrbmFtZSsnIiB0YXJnZXRSZWY9IicrbmFtZTIrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgczIrPScgICA8YnBtbmRpOkJQTU5FZGdlIGlkPSInK2Zsb3crJ18nK2VmbG93KyciIGJwbW5FbGVtZW50PSInK2Zsb3crJyI+XG4nCiAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MSkrJyIgeT0iJytzdHIoeTEpKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgIHh4LHl5ID0gMCwwCiAgICAgICAgICAgICAgICAgIGlmIHkxIT15MjogIyByZXF1aXJlcyBhZGRpdGlvbmFsIHBvaW50cyAob25lIG9yIHR3byBpbXBsZW1lbnRlZCkKICAgICAgICAgICAgICAgICAgICAgICAgeHgsIHl5ID0geTI+eTEgYW5kIHgxIG9yIHgyLCB5Mj55MSBhbmQgeTIgb3IgeTEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgeDE+eDI6ICMgYmFjayBjb25uZWN0aW9uIHJlcXVpcmVzIHR3byBhZGRpdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHkxPnkyOiAjIGZyb20gbG93ZXIgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeXkgLT0gMzUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgxKSsnIiB5PSInK3N0cih5eSkrJyIgLz5cbicgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgeTE8eTI6ICMgZnJvbSB1cHBlciBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5eSAtPSAyNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeHgpKyciIHk9Iicrc3RyKHl5KSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4eCA9IHgyCiAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4eCkrJyIgeT0iJytzdHIoeXkpKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgIGVsaWYgeTE9PXkyIGFuZCB4MT54MjogIyBsb29wYmFjayAtIHJlcXVpcmVzIHR3byBhZGRpdGlvbmFsIHBvaW50cwogICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDEpKyciIHk9Iicrc3RyKHkxLTMwKSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDIpKyciIHk9Iicrc3RyKHkyLTMwKSsnIiAvPlxuJyAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgaWYgeHghPXgyIG9yIHl5IT15MjoKICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgyKSsnIiB5PSInK3N0cih5MikrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgczIrPScgICA8L2JwbW5kaTpCUE1ORWRnZT5cbicKICAgICAgICAgICAgaWYgInRlcm1pbmF0ZSIgaW4gZWVbaV0ubmFtZToKICAgICAgICAgICAgICAgICAgczErPScgICA8YnBtbjp0ZXJtaW5hdGVFdmVudERlZmluaXRpb24vPlxuJwogICAgICAgICAgICBzMSs9JyAgPC9icG1uOicrdHlwZSsnPlxuJwogICAgICAgICAgICBwYXNzCiAgICAgIHMyKz0nICA8L2JwbW5kaTpCUE1OUGxhbmU+XG4nCiAgICAgIHMyKz0nIDwvYnBtbmRpOkJQTU5EaWFncmFtPlxuJwogICAgICBzMSs9czFhKycgPC9icG1uOnByb2Nlc3M+XG4nCiAgICAgIHJldHVybiBzK3MxK3MyKyc8L2JwbW46ZGVmaW5pdGlvbnM+XG4nCgplbl90aXRsZSA9ICIiCmNsYXNzIEV2ZW50TmV0d29yaygpOgogICAgICBkZWYgX19pbml0X18oc2VsZixzKToKICAgICAgICAgICAgRXZlbnQuY250LCBDdXN0b21lci5jbnQgPSAwLCAwCiAgICAgICAgICAgIFF1ZXVlZEV2ZW50Lmluc3RhbmNlcy5jbGVhcigpCiAgICAgICAgICAgIEJwbW5FdmVudC5TID0ge30KICAgICAgICAgICAgc2VsZi5lZSA9IHNlbGYuZnJvbV9zdHJpbmcocykKICAgICAgICAgICAgc2VsZi5wcCA9IHRvX3Bvc2l0aW9uKHNlbGYuZWUpCiAgICAgIGRlZiBfX2dldGl0ZW1fXyhzZWxmLGkpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5lZVtpXQogICAgICBkZWYgZnJvbV9zdHJpbmcoc2VsZixzKToKICAgICAgICAgICAgZ2xvYmFsIGVuX3RpdGxlCiAgICAgICAgICAgIGVlLCBFdmVudC5jbnQsIHlsZXZlbCwgZW5fdGl0bGUgPSBbXSwgMCwgLTEsICcnCiAgICAgICAgICAgIHNzID0gcy5zcGxpdCgnXG4nKQogICAgICAgICAgICBmb3IgczAgaW4gc3M6CiAgICAgICAgICAgICAgICAgIHMxID0gczAuc3RyaXAoKQogICAgICAgICAgICAgICAgICBpZiBsZW4oczEpPDIgb3IgczFbMF09PScjJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgczE9PXNzWzBdOiAjIHRpdGxlIGluIGZpcnN0IGxpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5fdGl0bGUgPSBzc1swXVsxOl0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgaWYgIi0+IiBpbiBzMTogIyBjb25uZWN0aW9uIGRlZmluaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgeWxldmVsICs9IDEgICAjIHVzZWQgZm9yIG1hcmtpbmcgcmVxdWlyZWQgeSBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgczFhIGluIHMxLnNwbGl0KCI7Iik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IHMxYS5zdHJpcCgpLnNwbGl0KCItPiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGNvZGUpPjE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlWzFdPWNvZGVbMV0uc3BsaXQoIiMiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSxqID0gaW50KGNvZGVbMF0pLTEsIGludChjb2RlWzFdKS0xCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpPi0xIGFuZCBqPi0xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdChlZVtpXSxlZVtqXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGk+LTEgYW5kIGVlW2ldLnBwMlsxXT09LTE6ICMgaWYgbm90IHNldCB5ZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlW2ldLnBwMlsxXT15bGV2ZWwgIyBmb3JjZSB5IHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBqPi0xIGFuZCBlZVtqXS5wcDJbMV09PS0xOiAjIGlmIG5vdCBzZXQgeWV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVtqXS5wcDJbMV09eWxldmVsICMgZm9yY2UgeSBwb3NpdGlvbiAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICBlbHNlOiAgICAgICAgICAjIGV2ZW50IGRlZmluaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgY29kZT1zMS5zcGxpdCgiICIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihjb2RlKT4xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUxPSIgIi5qb2luKGNvZGVbMTpdKS5zcGxpdCgnIycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWUuYXBwZW5kKGV2YWwoY29kZTFbMF0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS5pZDI9ZmxvYXQoY29kZVswXS5zcGxpdCgnLycpWzBdKSAjIGlkIGFzIHdyaXR0ZW4gaW4gc291cmNlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS50aXRsZT1jb2RlMVsxXS5zdHJpcCgpIGlmIGxlbihjb2RlMSk+MSBlbHNlICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2M9Y29kZVswXS5zcGxpdCgiLyIpICAjIGNoZWNrIGlkZW50aWZpZXIgZmllbGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVstMV0ucHAyWzBdID0gZmxvYXQoY2NbMV0pLTEgaWYgbGVuKGNjKT4xIGVsc2UgLTEgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbLTFdLnBwMlsxXSA9IGZsb2F0KGNjWzJdKS0xIGlmIGxlbihjYyk+MiBlbHNlIC0xCiAgICAgICAgICAgIGlmIGxlbihzZXQoW2UucHAyWzFdIGZvciBlIGluIGVlXSkpPT0xOiAjIHZlcmlmeSBpZiBtdWx0aS1saW5lIGRlc2NyaXB0aW9uCiAgICAgICAgICAgICAgICAgIGZvciBlIGluIGVlOiAgICAgICMgaWYgeWVzCiAgICAgICAgICAgICAgICAgICAgICAgIGUucHAyWzFdPS0xICMgY2xlYXIgYWxsIHktbGV2ZWxzIHRvIHVua25vd24KICAgICAgICAgICAgcmV0dXJuIGVlCiAgICAgIGRlZiB0b19zdHJpbmcoc2VsZik6CiAgICAgICAgICAgIHM9JycKICAgICAgICAgICAgZm9yIGUgaW4gc2VsZi5lZToKICAgICAgICAgICAgICAgICAgcyArPSBzdHIoZS5pZCkgKyAiICIgKyBlLl9fY2xhc3NfXy5fX25hbWVfXysiKCIKICAgICAgICAgICAgICAgICAgaWYgZS5fX2NsYXNzX18uX19uYW1lX18hPSdFbmQnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAiR2F0ZSIgbm90IGluIGUuX19jbGFzc19fLl9fbmFtZV9fOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9IGUuZnVuIGFuZCBlLmZ1bi5fX25hbWVfXyBvciAnTm9uZScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSIsIitzdHIoZS5wYXJhbSkrIiwiCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGUuX19jbGFzc19fLl9fbmFtZV9fIT0nU3RhcnQnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gZS5jb2RlIT1Ob25lIGFuZCAiXCIiK3N0cihlLmNvZGUpKyJcIiIgb3IgIk5vbmUiCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPXN0cihlLnRubWF4KQogICAgICAgICAgICAgICAgICBzICs9IilcbiIKICAgICAgICAgICAgZm9yIGUgaW4gZWU6CiAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICAgICAgICBzICs9IHN0cihlLmlkKSArICItPiIgKyBzdHIoZS5vdXRwdXRbaV0uaWQpICsnOycKICAgICAgICAgICAgcmV0dXJuIHMgKyAnXG4nCmRlZiBzdmdfcm91bmRlZFBhdGgocHAsIHIpOgogICAgICBpbXBvcnQgbWF0aAogICAgICBzLCBsID0gIiIsIGxlbihwcCktMQogICAgICBmb3IgaSBpbiByYW5nZShsKToKICAgICAgICAgICAgYSxiID0gcHBbaV0sIHBwW2krMV0KICAgICAgICAgICAgdCA9IG1pbihyIC8gbWF0aC5oeXBvdChiWzBdLWFbMF0sIGJbMV0tYVsxXSswLjAxKSwgMC41KQogICAgICAgICAgICBpZiBpPT0wOgogICAgICAgICAgICAgICAgICBzICs9ICdNJWcgJWcgJyUoYVswXSxhWzFdKQogICAgICAgICAgICBpZiBpPjA6CiAgICAgICAgICAgICAgICAgIHMgKz0gJ1ElZyAlZyAlZyAlZyAnJShhWzBdLGFbMV0sYVswXSooMS10KStiWzBdKnQsYVsxXSooMS10KStiWzFdKnQpCiAgICAgICAgICAgIGlmIGk9PWwtMToKICAgICAgICAgICAgICAgICAgcyArPSAnTCVnICVnICclKGJbMF0sYlsxXSkKICAgICAgICAgICAgZWxpZiBpPGwtMToKICAgICAgICAgICAgICAgICAgcyArPSAnTCVnICVnICclKGFbMF0qdCtiWzBdKigxLXQpLGFbMV0qdCtiWzFdKigxLXQpKQogICAgICByZXR1cm4gcwojTlNfTUFQID0gewojICAgIE5vbmU6ICdodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L01PREVMJywKIyAgICAnYnBtbmRpJzogJ2h0dHA6Ly93d3cub21nLm9yZy9zcGVjL0JQTU4vMjAxMDA1MjQvREknLAojICAgICdvbWdkYyc6ICdodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9EQycsCiMgICAgJ29tZ2RpJzogJ2h0dHA6Ly93d3cub21nLm9yZy9zcGVjL0RELzIwMTAwNTI0L0RJJywKIyAgICAneHNpJzogJ2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlJwojfQpkZWYgYnBtbl90b3N2ZzAoYnBtbmZpbGUsVz0xMDAsSD04MCk6CiAgICAgIHMgPSAnPGRlZnM+PG1hcmtlciBpZD0idHJpYW5nbGUiIHZpZXdCb3g9IjAgMCAxMCAxMCIgcmVmWD0iMTAiIHJlZlk9IjUiIG1hcmtlclVuaXRzPSJzdHJva2VXaWR0aCIgbWFya2VyV2lkdGg9IjEwIiBtYXJrZXJIZWlnaHQ9IjEwIiBvcmllbnQ9ImF1dG8iPiA8cGF0aCBkPSJNIDAgMCBMIDEwIDUgTCAwIDEwIHoiIGZpbGw9ImJsYWNrIiAvPjwvbWFya2VyPjwvZGVmcz5cbicKICAgICAgaW1wb3J0IHhtbC5ldHJlZS5FbGVtZW50VHJlZSBhcyBFVAogICAgICBmb3IgZSBpbiBFVC5wYXJzZShicG1uZmlsZSkuZ2V0cm9vdCgpOgogICAgICAgICAgICBpZiAiQlBNTkRpYWdyYW0iIGluIGUudGFnOgogICAgICAgICAgICAgICAgICBmb3IgZCBpbiBlOgogICAgICAgICAgICAgICAgICAgICAgICBpdGVtcz1bcCBmb3IgcCBpbiBkIGlmICJCUE1OUGxhbmUiIGluIGQudGFnXQogICAgICByZXR1cm4gaXRlbXMKI2RlZiBicG1uX3Rvc3ZnKGJwbW5maWxlLFc9MTAwLEg9ODApOgpkZWYgYnBtbl90b3N2ZyhicG1uc3RyaW5nLGlzYW5pbSxpc2NvbW1lbnRzLGlzc2NyaXB0cyxXPTEwMCxIPTgwKToKICAgICAgcyA9ICc8ZGVmcz48bWFya2VyIGlkPSJ0cmlhbmdsZSIgdmlld0JveD0iMCAwIDEwIDEwIiByZWZYPSIxMCIgcmVmWT0iNSIgbWFya2VyVW5pdHM9InN0cm9rZVdpZHRoIiBtYXJrZXJXaWR0aD0iMTAiIG1hcmtlckhlaWdodD0iMTAiIG9yaWVudD0iYXV0byI+IDxwYXRoIGQ9Ik0gMCAwIEwgMTAgNSBMIDAgMTAgeiIgZmlsbD0iYmxhY2siIC8+PC9tYXJrZXI+PC9kZWZzPlxuJwogICAgICBzICs9ICc8dGV4dCB4PSIxMCIgeT0iMTIiPicrZW5fdGl0bGUrJzwvdGV4dD5cbic7CiAgICAgIGltcG9ydCB4bWwuZXRyZWUuRWxlbWVudFRyZWUgYXMgRVQKICAgICAgI2ZvciBlIGluIEVULnBhcnNlKGJwbW5maWxlKS5nZXRyb290KCk6ICAjIGNvbGxlY3QgbmFtZWQgcHJvY2Vzc2VzCiAgICAgIGZvciBlIGluIEVULmZyb21zdHJpbmcoYnBtbnN0cmluZyk6ICAjIGNvbGxlY3QgbmFtZWQgcHJvY2Vzc2VzCiAgICAgICAgICAgIGlmICJwcm9jZXNzIiBpbiBlLnRhZzoKICAgICAgICAgICAgICAgICAgZWxlbXM9W2QgZm9yIGQgaW4gZSBpZiAibmFtZSIgaW4gZC5hdHRyaWJdCiAgICAgICNmb3IgZSBpbiBFVC5wYXJzZShicG1uZmlsZSkuZ2V0cm9vdCgpOiAgIyBjb2xsZWN0IGRpYWdyYW0gZWxlbWVudHMKICAgICAgZm9yIGUgaW4gRVQuZnJvbXN0cmluZyhicG1uc3RyaW5nKTogICMgY29sbGVjdCBuYW1lZCBwcm9jZXNzZXMKICAgICAgICAgICAgaWYgIkJQTU5EaWFncmFtIiBpbiBlLnRhZzoKICAgICAgICAgICAgICAgICAgZm9yIGQgaW4gZToKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM9W3AgZm9yIHAgaW4gZCBpZiAiQlBNTlBsYW5lIiBpbiBkLnRhZ10KICAgICAgZm9yIGl0IGluIGl0ZW1zOgogICAgICAgICAgICBwcCxuYW1lID0gW10sIiIKICAgICAgICAgICAgZm9yIGUgaW4gZWxlbXM6CiAgICAgICAgICAgICAgICAgIGlmIGl0LmF0dHJpYlsiYnBtbkVsZW1lbnQiXT09ZS5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9IiAiLmpvaW4oZS5hdHRyaWJbIm5hbWUiXS5zcGxpdCgiICIpWzE6XSkgIyBhc3N1bWUgImlkXG50ZXh0IgogICAgICAgICAgICBmb3IgaiBpbiByYW5nZShsZW4oaXQpKToKICAgICAgICAgICAgICAgICAgeCx5ID0gZmxvYXQoaXRbal0uYXR0cmliWyJ4Il0pLGZsb2F0KGl0W2pdLmF0dHJpYlsieSJdKQogICAgICAgICAgICAgICAgICB3LGggPSAoZmxvYXQoaXRbal0uYXR0cmliWyJ3aWR0aCJdKSxmbG9hdChpdFtqXS5hdHRyaWJbImhlaWdodCJdKSkgaWYgIkJvdW5kcyIgaW4gaXRbal0udGFnIGVsc2UgKDAsMCkKICAgICAgICAgICAgICAgICAgVyxIID0gbWF4KFcseCt3KSxtYXgoSCx5K2gpCiAgICAgICAgICAgICAgICAgICNwcmludChpdC5hdHRyaWJbImlkIl0sIjoiLHgseSx3LGgpCiAgICAgICAgICAgICAgICAgIGlmIHc9PTA6ICMgYnBtbiBmbG93CiAgICAgICAgICAgICAgICAgICAgICAgIHBwLmFwcGVuZChbeCx5XSkKICAgICAgICAgICAgICAgICAgZWxzZTogICAgIyBicG1uIGV2ZW50CiAgICAgICAgICAgICAgICAgICAgICAgIGlkcz1pdC5hdHRyaWJbImlkIl0uc3BsaXQoIl8iKQogICAgICAgICAgICAgICAgICAgICAgICBpZD1pZHNbMV0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGlkcyk+NDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0IGJhc2U2NAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHNbNF09YmFzZTY0LmIxNmRlY29kZShpZHNbNF0sJ2FzY2lpJykuZGVjb2RlKCdhc2NpaScpCiAgICAgICAgICAgICAgICAgICAgICAgIGlkMj0iXyIuam9pbihpZHNbMjpdKS5yZXBsYWNlKCc8JywnJmx0OycpLnJlcGxhY2UoJz4nLCcmZ3Q7JykKICAgICAgICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IHg9Iicrc3RyKHgtNikrJyIgeT0iJytzdHIoeStoKzEyKSsnIj4nK2lkKyc8L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzY29tbWVudHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCBmb250LXNpemU9InNtYWxsZXIiIHN0eWxlPSJmaWxsOmdyYXkiIHg9Iicrc3RyKHgtMTIpKyciIHk9Iicrc3RyKHktNikrJyI+PHRzcGFuIHhtbDpzcGFjZT0icHJlc2VydmUiPicrbmFtZSsnPC90c3Bhbj48L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgIGlkMz1pZDIuc3BsaXQoIl8iKQogICAgICAgICAgICAgICAgICAgICAgICAjaWYgbGVuKGlkMyk+MyBhbmQgaWQzWzNdICE9ICJOb25lIiA6IHMrPSc8dGV4dCBjbGFzcz0idDEiIGZvbnQtc2l6ZT0ic21hbGxlciIgc3R5bGU9ImZpbGw6Z3JheSIgeD0iJytzdHIoeCsxOCkrJyIgeT0iJytzdHIoeStoKzEyKygiRXZlbnQiIGluIGl0LmF0dHJpYlsiaWQiXSBhbmQgMTIgb3IgMCkpKyciPjx0c3BhbiB4bWw6c3BhY2U9InByZXNlcnZlIj4nK2lkM1szXSsnPC90c3Bhbj48L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzc2NyaXB0czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQzYT0iXyIuam9pbihpZHNbMjpdKS5zcGxpdCgiXyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihpZDNhKT4zIGFuZCBpZDNhWzNdICE9ICJOb25lIjogcys9Jzx0ZXh0IGNsYXNzPSJ0MSIgZm9udC1zaXplPSJzbWFsbGVyIiBzdHlsZT0iZmlsbDpncmF5IiB4PSInK3N0cih4KzE4KSsnIiB5PSInK3N0cih5K2grMTIpKyciPjx0c3BhbiB4bWw6c3BhY2U9InByZXNlcnZlIj4nK2lkM2FbM10uc3BsaXQoJzsnKVswXS5yZXBsYWNlKCc8JywnJmx0OycpLnJlcGxhY2UoJz4nLCcmZ3Q7JykrJzwvdHNwYW4+PC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICAgICAgICBpZiAiRXZlbnQiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlID0gImVuZCIgaW4gaXQuYXR0cmliWyJpZCJdIGFuZCAiMyIgb3IgIjEiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gImVuZCIgaW4gaXQuYXR0cmliWyJpZCJdIGFuZCAicmVkIiBvciAiZGFya2dyZWVuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxlbGxpcHNlIGN4PSInK3N0cih4K3cvMikrJyIgY3k9Iicrc3RyKHkraC8yKSsnIiByeD0iJytzdHIody8yKSsnIiByeT0iJytzdHIoaC8yKSsnIiBzdHJva2Utd2lkdGg9Iicrc3Ryb2tlKyciIHN0cm9rZT0iJytjb2xvcisnIiBmaWxsLW9wYWNpdHk9IjAuNiIgZmlsbD0id2hpdGUiPjx0aXRsZT4nK2lkMisnPC90aXRsZT48L2VsbGlwc2U+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJpbnRlcm1lZGlhdGUiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8ZWxsaXBzZSBjeD0iJytzdHIoeCt3LzIpKyciIGN5PSInK3N0cih5K2gvMikrJyIgcng9Iicrc3RyKHcvMi0zKSsnIiByeT0iJytzdHIoaC8yLTMpKyciIHN0cm9rZS13aWR0aD0iJytzdHJva2UrJyIgc3Ryb2tlPSJkYXJrZ3JlZW4iIGZpbGw9IndoaXRlIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJDYXRjaCIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAib25kaXRpb24iIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cmVjdCB4PSIlZyIgeT0iJWciIHdpZHRoPSIlZyIgaGVpZ2h0PSIlZyIgc3Ryb2tlPSJibGFjayIgZmlsbD0ibm9uZSIgLz4nJSh4K3cvMi03LHkraC8yLTksdy8yLTQsaC8yKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxwYXRoIGQ9IicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoNSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnTSVnICVnIEwlZyAlZyAnJSh4K3cvMi01LHkraC8yLTYrMyppLHgrdy8yKzUseStoLzItNiszKmkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPGVsbGlwc2UgY3g9Iicrc3RyKHgrdy8yKSsnIiBjeT0iJytzdHIoeStoLzIpKyciIHJ4PSInK3N0cih3LzItNikrJyIgcnk9Iicrc3RyKGgvMi02KSsnIiBzdHJva2Utd2lkdGg9Iicrc3Ryb2tlKyciIHN0cm9rZT0iYmxhY2siIGZpbGw9IndoaXRlIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHBhdGggZD0iTSVnICVnIEwlZyAlZyAlZyAlZyAnJSh4K3cvMi01LHkraC8yLTMseCt3LzIseStoLzIseCt3LzIrNix5K2gvMi02KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSgxMik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gbWF0aCBpbXBvcnQgc2luLGNvcyxwaQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gIk0lZyAlZyBMJWcgJWcgIiUoeCt3LzIrKHcvMi02KSpjb3MoaSoyKnBpLzEyKSx5K2gvMisoaC8yLTYpKnNpbihpKjIqcGkvMTIpLHgrdy8yKyh3LzItOSkqY29zKGkqMipwaS8xMikseStoLzIrKGgvMi05KSpzaW4oaSoyKnBpLzEyKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICciIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIvPicgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgImVybWluYXRlIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPGVsbGlwc2UgY3g9Iicrc3RyKHgrdy8yKSsnIiBjeT0iJytzdHIoeStoLzIpKyciIHJ4PSInK3N0cih3LzItNikrJyIgcnk9Iicrc3RyKGgvMi02KSsnIiBzdHJva2Utd2lkdGg9Iicrc3Ryb2tlKyciIHN0cm9rZT0icmVkIiBmaWxsPSJyZWQiIGZpbGwtb3BhY2l0eT0iMC42Ii8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgIkdhdGV3YXkiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSAib3JhbmdlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxwYXRoIGQ9Ik0lZyAlZyBMJWcgJWcgTCVnICVnIEwlZyAlZyBaIiBzdHJva2U9IiVzIiBmaWxsPSJ3aGl0ZSI+PHRpdGxlPiVzPC90aXRsZT48L3BhdGg+XG4nJSh4LHkraC8yLHgrdy8yLHkseCt3LHkraC8yLHgrdy8yLHkraCxjb2xvcixpZDIpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiZXhjbHVzaXZlIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSc8cGF0aCBkPSJNJWcgJWcgTCVnICVnIE0lZyAlZyBMJWcgJWciIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIgLz5cbiclKHgrdy8yLTYseStoLzItNix4K3cvMis2LHkraC8yKzYseCt3LzIrNix5K2gvMi02LHgrdy8yLTYseStoLzIrNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAicGFyYWxsZWwiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9JzxwYXRoIGQ9Ik0lZyAlZyBMJWcgJWcgTSVnICVnIEwlZyAlZyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIzIiAvPlxuJyUoeCt3LzItOCx5K2gvMix4K3cvMis4LHkraC8yLHgrdy8yLHkraC8yLTgseCt3LzIseStoLzIrOCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAiaW5jbHVzaXZlIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSc8Y2lyY2xlIGN4PSIlZyIgY3k9IiVnIiByPSI3IiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjMiIC8+XG4nJSh4K3cvMix5K2gvMikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cmVjdCByeD0iNyIgcnk9IjciIHg9Iicrc3RyKHgpKyciIHk9Iicrc3RyKHkpKyciIHdpZHRoPSInK3N0cih3KSsnIiBoZWlnaHQ9Iicrc3RyKGgpKyciIHN0cm9rZT0iZGFya2JsdWUiIGZpbGw9IndoaXRlIj48dGl0bGU+JytpZDIrJzwvdGl0bGU+PC9yZWN0PlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAic2NyaXB0IiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDQpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9JzxwYXRoIGQ9Ik0lZyAlZyBMJWcgJWciIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMSIgLz4nJSh4KzEwKzAqaSx5KzEwKzQqaSx4KzIyKzAqaSx5KzEwKzQqaSkKICAgICAgICAgICAgaWYgbGVuKHBwKT4wOiAjIHMxIT0nJzogIyBhZGQgd2hvbGUgZmxvdwogICAgICAgICAgICAgICAgICBzMT1zdmdfcm91bmRlZFBhdGgocHAsMTIpCiAgICAgICAgICAgICAgICAgIHMgKz0gJzxwYXRoIG1hcmtlci1lbmQ9InVybCgjdHJpYW5nbGUpIiBkPSInK3MxKyciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJyb3duO3N0cm9rZS13aWR0aDoxIi8+XG4nCiAgICAgIHMgKz0gIjxzY3JpcHQ+ZnVuY3Rpb24gb25fY2xpY2soKSB7Wy4uLmRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3QxJyldLmZvckVhY2goZT0+ZS5zdHlsZS5kaXNwbGF5PShlLnN0eWxlLmRpc3BsYXk9PSdub25lJz8nJzonbm9uZScpKTt9PC9zY3JpcHQ+IgogICAgICBzID0gJzxzdmcgb25jbGljaz0ib25fY2xpY2soKSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iJWQiIGhlaWdodD0iJWQiPlxuJyUoVys0MCs2MCxIKzMwKStzCiAgICAgIHJldHVybiBzICsgKHRvX2FuaW0oKSBpZiBpc2FuaW0gZWxzZSAnJykgKyAnPC9zdmc+XG4nCmRlZiB0b19hbmltKCk6CiAgICAgICNyZXR1cm4gcwogICAgICBnbG9iYWwgbmUKICAgICAgcyA9ICAnPGRlZnM+PGZpbHRlciB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiBpZD0iZmkiPlxuJwogICAgICBzICs9ICc8ZmVGbG9vZCBmbG9vZC1jb2xvcj0id2hpdGUiLz5cbicKICAgICAgcyArPSAnPGZlQ29tcG9zaXRlIGluPSJTb3VyY2VHcmFwaGljIiBvcGVyYXRvcj0iYXRvcCIvPjwvZmlsdGVyPjwvZGVmcz5cbicKICAgICAgZm9yIGUgaW4gbmUuZWU6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZSxFbmQpOgogICAgICAgICAgICAgICAgICBmb3IgYyBpbiBlLnF1ZXVlLm9iamVjdHM6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihuZS5lZSkpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LCB5LCBhID0gbmUuZWVbaV0ueCwgbmUuZWVbaV0ueSwgYy5hdHRyIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9Jzx0ZXh0IGNsYXNzPSJ0MSIgZmlsdGVyPSJ1cmwoI2ZpKSIgc3R5bGU9ImZvbnQtc2l6ZTpzbWFsbDtmaWxsOnJlZCIgeD0iJytzdHIoeC0yMCkrJyIgeT0iJytzdHIoeSsxMykrJyIgdmlzaWJpbGl0eT0iaGlkZGVuIj4nK3N0cihjLm5hbWUpKydcbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdD0iX190IitzdHIoaSsxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0KyJhIiBpbiBhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MCA9IGFbdCsiYSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gJzxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InZpc2liaWxpdHkiIGZyb209ImhpZGRlbiIgdG89InZpc2libGUiIGJlZ2luPSInK3N0cih0MCkrJ3MiIGR1cj0iMC4wMXMiIGZpbGw9ImZyZWV6ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0KyJiIiBpbiBhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IGFbdCsiYiJdIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9ICc8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJ4IiB0bz0iJytzdHIoeCszOCkrJyIgYmVnaW49Iicrc3RyKHQxKSsncyIgZHVyPSIwLjVzIiBmaWxsPSJmcmVlemUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdCsiZSIgaW4gYToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBhW3QrImUiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9ICc8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJ2aXNpYmlsaXR5IiBmcm9tPSJ2aXNpYmxlIiB0bz0iaGlkZGVuIiBiZWdpbj0iJytzdHIodDIpKydzIiBkdXI9IjAuMDFzIiBmaWxsPSJmcmVlemUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSc8L3RleHQ+XG4nCiAgICAgIHJldHVybiBzCgpuZT1bXQojIC0tLS0gc2ltdWxhdGlvbiAtLS0tLQpkZWYgbWFpbl9mdW4oZXhuLG4sYW5pbSxjb21tZW50cyxzY3JpcHRzKTogIyBzdHJpbmcgcmVwcmVzZW50YXRpb24sIG51bWJlciBvZiBzaW11bGF0aW9uCiAgICAgIGRhdGE9W10gICMgbGlzdCBvZiBldmVudHMsIGFycmF5IG9mIHJlc3VsdHMKICAgICAgcyA9ICcnCiAgICAgIGZvciBpIGluIHJhbmdlKG4pOgogICAgICAgICAgICBnbG9iYWwgbmUKICAgICAgICAgICAgbmUgPSBFdmVudE5ldHdvcmsoZXhuKQogICAgICAgICAgICBzaW0gPSBTaW11bGF0b3IoKQogICAgICAgICAgICBmb3IgZSBpbiBuZToKICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLEdlbmVyYXRvcik6ICAjIGFkZCBnZW5lcmF0aW5nIGV2ZW50cwogICAgICAgICAgICAgICAgICAgICAgICBzaW0uYWRkKGUpICAKICAgICAgICAgICAgc2ltLnJ1bigpCiAgICAgICAgICAgIGRhdGEuYXBwZW5kKFtzaW0udGltZSxCcG1uRXZlbnQuU10pICAgIyBzYXZlIGVuZCB0aW1lIG9mIHNpbXVsYXRpb24KICAgICAgICAgICAgCiAgICAgICAgICAgICNpZiBleG49PWV4NToKICAgICAgICAgICAgIyAgICAgIGRhdGEuYXBwZW5kKEJwbW5FdmVudC5TWyJTLmJBIl0pICMgc2F2ZSBnbG9iYWwgdmFyaWFibGUgUy5iQQogICAgICAgICAgICAjZWxzZToKICAgICAgICAgICAgIyAgICAgIGRhdGEuYXBwZW5kKHNpbS50aW1lKSAgICMgc2F2ZSBlbmQgdGltZSBvZiBzaW11bGF0aW9uCiAgICAgICAgICAgIGlmIGk9PTA6CiAgICAgICAgICAgICAgICAgIHMxID0gdG9fYnBtbihuZS5lZSxuZS5wcCkKICAgICAgICAgICAgICAgICAgczIgPSBicG1uX3Rvc3ZnKHMxLGFuaW0sY29tbWVudHMsc2NyaXB0cykKICAgICAgICAgICAgICAgICAgczMgPSB0b19zdmcoKQogICAgICBzICs9ICIjblx0dFx0IisiXHQiLmpvaW4oZGF0YVswXVsxXS5rZXlzKCkpKyJcbiIKICAgICAgcyArPSAiXG4iLmpvaW4oWyIlZFx0JS4yZlx0JXMiJShpKzEsZGF0YVtpXVswXSwiXHQiLmpvaW4oW3N0cih2KSBmb3IgdiBpbiBbKmRhdGFbaV1bMV0udmFsdWVzKCldXSkpIGZvciBpIGluIHJhbmdlKGxlbihkYXRhKSldKQogICAgICAjZm9yIGUgaW4gbmU6CiAgICAgICMgICAgICBpZiBsZW4oZS5xdWV1ZSk+MDoKICAgICAgIyAgICAgICAgICAgIHMgKz0gc3RyKGUuaWQpICsgKCIoJWQpOiIlbGVuKGUucXVldWUpKSArIHN0cihlLnF1ZXVlKSsnXG4nCiAgICAgICNzICs9IHN0cihzdW0oZGF0YSkvbGVuKGRhdGEpKSsnXG4nCiAgICAgICNzICs9IHN0cihCcG1uRXZlbnQuUykrJ1xuJwogICAgICAjZm9yIGUgaW4gbmU6CiAgICAgICMgICAgICBzICs9IHN0cihlLmlkKStzdHIoZS5BKSsnICcKICAgICAgIyAgICAgIGlmIGlzaW5zdGFuY2UoZSxUYXNrKToKICAgICAgIyAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlLnNlcnZlcnMpKToKICAgICAgIyAgICAgICAgICAgICAgICAgIHMgKz0gc3RyKGUuc2VydmVyc1tpXS5pZCkrJy8nK3N0cihpKzEpK3N0cihlLnNlcnZlcnNbaV0uQSkrJyAnCiAgICAgIHM0PScnCiAgICAgIGlmIGxlbihkYXRhKT49MTAwOgogICAgICAgICAgICAjaWYgZXhuPT1leDQ6CiAgICAgICAgICAgICMgICAgICBzNCA9IGhpc3QoZGF0YSw3KQogICAgICAgICAgICAjZWxzZToKICAgICAgICAgICAgIyAgICAgIHM0ID0gaGlzdChkYXRhKQogICAgICAgICAgICBwYXNzICMgczQgPSBoaXN0KGRhdGEpCiAgICAgIHJldHVybiAocyxzMSxzMixzMyxzNCkgIyBzMisnPGJyPlxuJysoczMgaWYgbj09MSBlbHNlICcnKSsnPGJyPlxuJysnPHByZT4nK3MrJzwvcHJlPicKCiIiIgppZiBfX25hbWVfXz09Il9fbWFpbl9fIjoKICAgICAgaW1wb3J0IHN5cwogICAgICAjaW1wb3J0IGV4CiAgICAgIGV4MzAgPSAnMSBTdGFydCgpXG4yIFRhc2soKVxuMyBFbmQoKVxuMS0+MjsyLT4zXG4nCiAgICAgIHMgPSBsZW4oc3lzLmFyZ3YpPjEgYW5kIGZyb21fZmlsZShzeXMuYXJndlsxXSkgb3IgZXZhbCgnZXglZCclKDMwKSkKICAgICAgbiA9IGxlbihzeXMuYXJndik+MiBhbmQgaW50KHN5cy5hcmd2WzJdKSBvciAxMDAKICAgICAgYW5pbSA9IDEKICAgICAgY29tbWVudHMgPSAxCiAgICAgIHNjcmlwdHMgPSAxCiAgICAgIG91dHB1dCA9IG1haW5fZnVuKHMsbixhbmltLGNvbW1lbnRzLHNjcmlwdHMpCiAgICAgIHByaW50KG91dHB1dFsyXSkgICAgICAKICAgICAgcHJpbnQob3V0cHV0WzNdKQogICAgICBwcmludCgnPHByZT4nLG91dHB1dFswXSwnPC9wcmU+JykKIiIiCnMgPSBpbnB1dFswXQpuID0gaW50KGlucHV0WzFdKQphbmltID0gaW50KGlucHV0WzJdKQpjb21tZW50cyA9IGludChpbnB1dFszXSkKc2NyaXB0cyA9IGludChpbnB1dFs0XSkKb3V0cHV0ID0gbWFpbl9mdW4ocywgbiwgYW5pbSwgY29tbWVudHMsIHNjcmlwdHMpCnMgPSAnJwojcyArPSAnPGRpdiBpZD0iZGl2MSIgaGlkZGVuPicrb3V0cHV0WzFdKyc8L2Rpdj48YnI+XG4nCnMgKz0gJzxkaXYgaWQ9ImRpdjIiIHRhYmluZGV4PSItMSI+JytvdXRwdXRbMl0rJzwvZGl2Pjxicj5cbicKI3MgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIGJwbW4gdG8geG1sIGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTEoKTsiPjwvaW5wdXQ+XG4nCnMgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIGJwbW4gdG8gc3ZnIGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTIoKTsiPjwvaW5wdXQ+XG4nCnMgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIGJwbW4gdG8geG1sIGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTUoKTsiPjwvaW5wdXQ+PGJyPjxicj5cbicKaWYgbj09MToKICAgICAgcyArPSAnPGRpdiBpZD0iZGl2MyI+JytvdXRwdXRbM10gKyc8L2Rpdj48YnI+XG4nCiAgICAgIHMgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIHRpbWVsaW5lIHRvIHN2ZyBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGUzKCk7Ij48L2lucHV0Pjxicj48YnI+XG4nCnMgKz0nPHRleHRhcmVhIGlkPSJ0YTQiIHJvd3M9IjEwIiBjb2xzPSI4MCI+JytvdXRwdXRbMF0rJzwvdGV4dGFyZWE+PGJyPlxuJyAjKyc8aW1nIHNyYz0iJytvdXRwdXRbM10rJyI+JwpzICs9JzxpbnB1dCB0eXBlPWJ1dHRvbiB2YWx1ZT0iU2F2ZSByZXN1bHRzIHRvIHR4dCBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGU0KCk7Ij48L2lucHV0Pjxicj48YnI+XG4nCnMgKz0nPHRleHRhcmVhIGhpZGRlbiBpZD0idGE1IiByb3dzPSIxMCIgY29scz0iODAiPicrb3V0cHV0WzFdKyc8L3RleHRhcmVhPjxicj5cbicgIysnPGltZyBzcmM9Iicrb3V0cHV0WzNdKyciPicKcwoKCg==";