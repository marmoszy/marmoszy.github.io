var pycode="IyBtbS1kZXMgLSBkaXNjcmV0ZSBldmVudCBzaW11bGF0b3IKIyAtIGJhc2UgZXZlbnRzOiBHZW5lcmF0b3IsU2VydmljZSxTaW5rLENvbmRpdGlvbmFsRXZlbnQKIyAtIGJwbW4gZXZlbnRzOiBTdGFydCxUYXNrLEVuZCxUaW1lcixYb3JHYXRlLEFuZEdhdGUsQ29uZGl0aW9uLFRlcm1pbmF0ZQojIE1NIDMxLjEuMjAyNCwgMTMuOS4yMDI1IChhZG9wdGVkIGZvciBweW9kaWRlIGluIGpzKQoKIyAtLS0tIHNpbXVsYXRpb24gb24gYW4gYWJzdHJhY3QgZXZlbnQgLS0tLQpjbGFzcyBFdmVudCgpOgogICAgICBjbnQgPSAwICAgICAgICAgICAgICAgICAgICAgICAgICMgdXNlZCBmb3IgZXZlbnQgaWRlbnRpZmllcgogICAgICBkZWYgX19pbml0X18oc2VsZiwgdGltZSwgbmFtZT1Ob25lKToKICAgICAgICAgICAgc2VsZi50aW1lID0gdGltZTsKICAgICAgICAgICAgRXZlbnQuY250ICs9IDEKICAgICAgICAgICAgc2VsZi5pZCA9IEV2ZW50LmNudAogICAgICAgICAgICBzZWxmLm5hbWUgPSAoKG5hbWU9PU5vbmUpIGFuZCAiRXZlbnQiIG9yIG5hbWUpICsgIl8iK3N0cihzZWxmLmlkKQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOiBwYXNzICAgICAgIyBhYnN0cmFjdCAKICAgICAgZGVmIF9fc3RyX18oc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLm5hbWUrICIgIisgc3RyKHNlbGYuaWQpICsiICIrc3RyKHNlbGYudGltZSkKY2xhc3MgU2ltdWxhdG9yKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAgICAgc2VsZi50aW1lID0gMAogICAgICAgICAgICBzZWxmLmV2ZW50cyA9IFtdCiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucyA9IFtdCiAgICAgIGRlZiBub3coc2VsZik6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnRpbWUKICAgICAgZGVmIGFkZChzZWxmLGUpOgogICAgICAgICAgICBzZWxmLmV2ZW50cy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBhZGRfY29uZGl0aW9uKHNlbGYsZSk6CiAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5hcHBlbmQoZSkKICAgICAgICAgICAgcmV0dXJuKHNlbGYpCiAgICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgICAgIHdoaWxlIHNlbGYuZXZlbnRzOgogICAgICAgICAgICAgICAgICBlID0gbWluKHNlbGYuZXZlbnRzLCBrZXk9bGFtYmRhIGU6IGUudGltZSkKICAgICAgICAgICAgICAgICAgc2VsZi5ldmVudHMucmVtb3ZlKGUpCiAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IGUudGltZSAgICAgICAgICMgdXBkYXRlIHNpbXVsYXRvciB0aW1lCiAgICAgICAgICAgICAgICAgIGUuZXhlYyhzZWxmKQogICAgICAgICAgICAgICAgICBmb3IgYyBpbiBzZWxmLmNvbmRpdGlvbnM6ICAjIHRlc3QgY29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICBpZiBjLmV4ZWMoc2VsZik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29uZGl0aW9ucy5yZW1vdmUoYykKIyAtLS0tIHV0aWxzIC0tLS0KaW1wb3J0IG1hdGgscmFuZG9tCmRlZiBfcHJpbnQocyk6ICAgICAgICAgICAgICAgICMgb3duIHByaW50CiAgICAgICNwcmludChzKSAgICAgICAgICAgICAgICMgY29tbWVudCBpZiBubyB2ZXJib3VzIHByaW50aW5nCiAgICAgIHBhc3MKZGVmIEUobWVhbj1bMS4wXSk6ICAgICAgICAgICAgIyBleHBvbmVudGlhbCByYW5kb20gZ2VuZXJhdG9yCiAgICAgICMgLW1lYW5bMF0qbWF0aC5sb2cocmFuZG9tLnJhbmRvbSgpKQogICAgICByZXR1cm4gcmFuZG9tLmV4cG92YXJpYXRlKDEvbWVhblswXSkgCmRlZiBVKG1pbm1heD1bMS4wXSk6ICAgICAgICAgICMgdW5pZm9ybSByYW5kb20gZ2VuZXJhdG9yCiAgICAgIHJldHVybiByYW5kb20udW5pZm9ybShtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXSkKZGVmIE4obWVhbnN0ZD1bMy4wXSk6ICAgICAgICAjIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgcmV0dXJuIHJhbmRvbS5ub3JtYWx2YXJpYXRlKG1lYW5zdGRbMF0sbGVuKG1lYW5zdGQpPjEgYW5kIG1lYW5zdGRbMV0gb3IgMS4wKQpkZWYgQihwPTAuNSk6ICAgICAgICAgICAgICAgICMgYmlub21pYWwgKDAsMSkKICAgICAgcmV0dXJuIHJhbmRvbS5yYW5kb20oKTxwCmRlZiBDKHA9WzEsMSwxXSk6ICAgICAgICAgICAgIyBjaG9pY2UgKDAsMSwyLC4uLikKICAgICAgcmV0dXJuIHJhbmRvbS5jaG9pY2VzKGxpc3QocmFuZ2UobGVuKHApKSksd2VpZ2h0cz1wKVswXQpkZWYgVChtaW5tYXg9WzEuMF0pOiAgICAgICAgICAjIHNlbWkgdHJ1bmNhdGVkIGdhdXNzaWFuIHJhbmRvbSBnZW5lcmF0b3IKICAgICAgbWksbWEgPSBtaW5tYXhbMF0sbGVuKG1pbm1heCk+MSBhbmQgbWlubWF4WzFdIG9yIG1pbm1heFswXQogICAgICBtZWFuLHN0ZCA9IChtYSttaSkvMiwobWEtbWkpLzIKICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgeCA9IE4oW21lYW4sc3RkXSkKICAgICAgICAgICAgaWYgbWkgPD0geCA8PSBtYTogYnJlYWsKICAgICAgcmV0dXJuIHgKCiMgLS0tLSBwcmltaXRpdmUgY2xhc3NlcyAtLS0tCmNsYXNzIEN1c3RvbWVyKCk6ICAgICMgYW5vbnltb3VzIGN1c3RvbWVyIHdpdGggYSBhdXRvbWF0aWMgbmFtZQogICAgICBjbnQgPSAwICAgICAgICAjIGNvdW50ZXIgY2xhc3MgdmFyaWFibGUgZm9yIGN1c3RvbWVyIG5hbWUKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBDdXN0b21lci5jbnQgKz0gMQogICAgICAgICAgICBzZWxmLm5hbWUgPSBzdHIoQ3VzdG9tZXIuY250KQogICAgICAgICAgICBzZWxmLmF0dHIgPSB7ImNuYW1lIjpzZWxmLm5hbWV9ICMgQ3VzdG9tZXIgYXR0cmlidXRlcwogICAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIHN0cihzZWxmLm5hbWUpCmNsYXNzIFF1ZXVlKCk6ICAgICAgICMgZmlmbyBvZiBjdXN0b21lcnMKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBzZWxmLm9iamVjdHMgPSBbXQogICAgICBkZWYgcHVzaChzZWxmLG9iaik6CiAgICAgICAgICAgIHNlbGYub2JqZWN0cy5hcHBlbmQob2JqKQogICAgICBkZWYgcG9wKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5vYmplY3RzLnBvcCgwKQogICAgICBkZWYgX19sZW5fXyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIGxlbihzZWxmLm9iamVjdHMpCiAgICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgICAgICByZXR1cm4gc3RyKFtzdHIobykgZm9yIG8gaW4gc2VsZi5vYmplY3RzXSkKY2xhc3MgUXVldWVkRXZlbnQoRXZlbnQpOgogICAgICBpbnN0YW5jZXM9W10KICAgICAgZGVmIF9faW5pdF9fKHNlbGYsbmFtZT1Ob25lKToKICAgICAgICAgICAgRXZlbnQuX19pbml0X18oc2VsZiwwLjAsbmFtZSkgICMgcHJlaW5pdCB0aW1lCiAgICAgICAgICAgIHNlbGYucXVldWUgPSBRdWV1ZSgpICAgICAgIyBvd24gcXVldWUKICAgICAgICAgICAgc2VsZi5vdXRwdXQgPSBbXSAgICAgICAgICAjIG5vIGNvbm5lY3RlZCBvYmplY3RzCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIgPSBOb25lICAgICAgIyBub25lIGJlaW5nIHNlcnZlZAogICAgICAgICAgICBRdWV1ZWRFdmVudC5pbnN0YW5jZXMuYXBwZW5kKHNlbGYpCiAgICAgIGRlZiBzZXROYW1lKHNlbGYsbmFtZSk6CiAgICAgICAgICAgIHNlbGYubmFtZT1uYW1lKyJfIitzZWxmLm5hbWUuc3BsaXQoIl8iKVsxXSAjLnJlcGxhY2UoIkV2ZW50IixuYW1lKS5yZXBsYWNlKCJBY3Rpdml0eSIsbmFtZSkKICAgICAgZGVmIG91dChzZWxmLHNpbSk6ICAgICAgICAgICAgICAjIHBhc3MgdG8gY29ubmVjdGVkIG9iamVjdHMKICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lciE9Tm9uZToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4wIGFuZCBpc2luc3RhbmNlKHNlbGYsWG9yR2F0ZSk6ICAKICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID0gMSAgIyBzZW5kIHRvIHNlY29uZCBvdXRwdXQKICAgICAgICAgICAgICAgICAgICAgICAgI2lmIHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgidmFsdWUiIGluIHNlbGYuY3VzdG9tZXIuYXR0ciBhbmQgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdKSBvciBsZW4oc2VsZi5vdXRwdXQpPDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeD0wICMgc2VuZCByYXRoZXIgdG8gZmlyc3Qgb3V0cHV0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLm91dHB1dCk+MjogICMgbW9yZSB0aGFuIDIgb3V0cHV0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHg9aW50KHNlbGYuY3VzdG9tZXIuYXR0clsidmFsdWUiXSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRwdXRbaWR4XS5pbnNlcnQoc2VsZi5jdXN0b21lciwgc2ltKQogICAgICAgICAgICAgICAgICBlbGlmIGxlbihzZWxmLm91dHB1dCk+MCBhbmQgaXNpbnN0YW5jZShzZWxmLE9yR2F0ZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICNwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIE4gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihzZWxmLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpbnQoc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdW2ldKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTiArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0cHV0W2ldLmluc2VydChzZWxmLmN1c3RvbWVyLCBzaW0pCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuTiA9IE4KICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHNlbGYub3V0cHV0KSk6ICAjIHNwbGl0IHRvIGFsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm91dHB1dFtpXS5pbnNlcnQoc2VsZi5jdXN0b21lcixzaW0pCiAgICAgIGRlZiBwcmV2KHNlbGYpOgogICAgICAgICAgICBlcD1bXQogICAgICAgICAgICBmb3IgZTAgaW4gUXVldWVkRXZlbnQuaW5zdGFuY2VzOgogICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZTAub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGUwLm91dHB1dFtpXT09c2VsZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXAuYXBwZW5kKGUwKQogICAgICAgICAgICByZXR1cm4gZXAKCiMgLS0tLSBiYXNpYyBtb2RlbCBjbGFzc2VzIChRdWV1ZUV2ZW50IGRlcml2ZWQpIC0tLS0KY2xhc3MgQnBtbkV2ZW50KFF1ZXVlZEV2ZW50KToKICAgICAgUyA9IHt9CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLG5hbWU9Tm9uZSxjb2RlPU5vbmUpOgogICAgICAgICAgICBRdWV1ZWRFdmVudC5fX2luaXRfXyhzZWxmLG5hbWUpCiAgICAgICAgICAgIHNlbGYuZnVuLHNlbGYucGFyYW0sc2VsZi5jb2RlID0gTm9uZSxOb25lLGNvZGUKICAgICAgICAgICAgc2VsZi5BLHNlbGYucHAsc2VsZi5wcDIsc2VsZi50aXRsZSA9IHsiQS5uIjowfSxbLTEsMF0sWy0xLC0xXSwnJwogICAgICBkZWYgX2Z1bihzZWxmKToKICAgICAgICAgICAgcCA9IHNlbGYucGFyYW0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShwLGxpc3QpOgogICAgICAgICAgICAgICAgICBwID0gW2Zsb2F0KGV2YWwoc2VsZi5hdHRyX3JlcGxhY2Uoc3RyKHMpKSkpIGZvciBzIGluIHBdCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgIHAgPSBmbG9hdChldmFsKHNlbGYuYXR0cl9yZXBsYWNlKHN0cihwKSkpKQogICAgICAgICAgICAjcHJpbnQoIl9mdW46IixzZWxmLmZ1bixwLGxlbihzZWxmLnF1ZXVlKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZnVuKHApIGlmIHNlbGYuZnVuIT1Ob25lIGVsc2UgcAogICAgICBkZWYgYXR0cl9yZXBsYWNlKHNlbGYsY2MpOgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBmb3Igayx2IGluIHNlbGYuY3VzdG9tZXIuYXR0ci5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgICAgICBjYyA9IGNjLnJlcGxhY2UoayxzdHIodikpCiAgICAgICAgICAgIGZvciBrLHYgaW4gQnBtbkV2ZW50LlMuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgY2MgPSBjYy5yZXBsYWNlKGssc3RyKHYpKQogICAgICAgICAgICBmb3Igayx2IGluIHNlbGYuQS5pdGVtcygpOgogICAgICAgICAgICAgICAgICBjYyA9IGNjLnJlcGxhY2UoayxzdHIodikpCiAgICAgICAgICAgIHJldHVybiBjYwogICAgICBkZWYgX2V2YWwoc2VsZixjb2RlLG49LTEpOgogICAgICAgICAgICBjb2Rlcz1zZWxmLmNvZGUuc3BsaXQoIjsiKQogICAgICAgICAgICBpZiBuIT0tMToKICAgICAgICAgICAgICAgICAgY29kZXM9bGVuKGNvZGVzKT5uIGFuZCBbY29kZXNbbl1dIG9yIFtdCiAgICAgICAgICAgIGZvciBjb2RlIGluIGNvZGVzOgogICAgICAgICAgICAgICAgICBjYyA9IGNvZGUuc3BsaXQoIj0iKQogICAgICAgICAgICAgICAgICBjY1swXSA9IGNjWzBdLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgaWYgbGVuKGNjKT09MToKICAgICAgICAgICAgICAgICAgICAgICAgY2M9WyJkdW1teSJdK2NjCiAgICAgICAgICAgICAgICAgIGlmIGxlbihjYyk+MToKICAgICAgICAgICAgICAgICAgICAgICAgY2NbMF0gPSBsZW4oY2NbMF0pPjAgYW5kIGNjWzBdIG9yICJ2YWx1ZSIKICAgICAgICAgICAgICAgICAgICAgICAgY2NbMV0gPSBzZWxmLmF0dHJfcmVwbGFjZSgiPSIuam9pbihjY1sxOl0pKSAjIHJlam9pbgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2PWV2YWwoY2NbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNjWzBdLnN0YXJ0c3dpdGgoIlMuIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJwbW5FdmVudC5TW2NjWzBdXT1ldgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGNjWzBdLnN0YXJ0c3dpdGgoIkEuIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuRVtjY1swXV09ZXYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyW2NjWzBdXT1ldgogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0cltjY1swXV09RmFsc2UKY2xhc3MgQ29uZGl0aW9uYWxFdmVudChCcG1uRXZlbnQpOgogICAgICBkZWYgX19pbml0X18oc2VsZiwgY29kZT1Ob25lKToKICAgICAgICAgICAgQnBtbkV2ZW50Ll9faW5pdF9fKHNlbGYsIE5vbmUsIGNvZGUpCiAgICAgIGRlZiBpbnNlcnQoc2VsZiwgY3VzdCwgc2ltKToKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IC0xCiAgICAgICAgICAgIGlmIHNlbGYuY3VzdG9tZXIgPT0gTm9uZSA6ICMgaWYgZnJlZSBhZGQgdG8gc2ltdWxhdG9yIGNvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IGN1c3QKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdPUZhbHNlCiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKQogICAgICAgICAgICAgICAgICBzaW0uYWRkX2NvbmRpdGlvbihzZWxmKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICBzZWxmLnF1ZXVlLnB1c2goY3VzdCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgZGVmIGV4ZWMoc2VsZiwgc2ltKToKICAgICAgICAgICAgYiA9IEZhbHNlCiAgICAgICAgICAgIGlmIHNlbGYuY29kZSE9Tm9uZToKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUsMCkKICAgICAgICAgICAgICAgICAgaWYgc2VsZi5jdXN0b21lci5hdHRyWyJ2YWx1ZSJdPT1UcnVlOgogICAgICAgICAgICAgICAgICAgICAgICBjYz1zZWxmLmNvZGUuc3BsaXQoJzsnKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oY2MpPjE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2V2YWwoIjsiLmpvaW4oY2NbMTpdKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiZSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0KHNpbSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IE5vbmUgICAgIyBtYXJrIHRoYXQgbm93IHRoZSBzZXJ2aWNlIGlzIGZyZWUgISEhCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLnF1ZXVlKT4wIDogICMgYnV0IGlmIGFueWJvZHkgaW4gcXVldWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pbnNlcnQoc2VsZi5xdWV1ZS5wb3AoKSwgc2ltKSAgIyBnZXQgYW5kIGluc2VydCBpbnRvIHNpbXVsYXRvcgogICAgICAgICAgICAgICAgICAgICAgICBiID0gVHJ1ZSAgIyByZWFkeSB0byBiZSByZW1vdmVkIGZyb20gc2ltdWxhdG9yIGNvbmRpdGlvbnMKICAgICAgICAgICAgcmV0dXJuIGIKY2xhc3MgR2VuZXJhdG9yKEJwbW5FdmVudCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmdW4sIHBhcmFtLCB0bWF4PTAuMCwgY29kZT1Ob25lKToKICAgICAgICAgICAgQnBtbkV2ZW50Ll9faW5pdF9fKHNlbGYsIE5vbmUsIGNvZGUpCiAgICAgICAgICAgIHNlbGYuZnVuLCBzZWxmLnBhcmFtLCBzZWxmLnRtYXgsIHNlbGYubiA9IGZ1biwgcGFyYW0sIHRtYXgsIDAKICAgICAgICAgICAgaWYgc2VsZi5jb2RlIT1Ob25lIDoKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUpICAgIyBldmFsdWF0ZSBzY3JpcHQgY29kZSAoW3Zhcl09PHZhbHVlPikKICAgICAgZGVmIGV4ZWMoc2VsZiwgc2ltKToKICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IEN1c3RvbWVyKCkKICAgICAgICAgICAgc2VsZi5jdXN0b21lci5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdID0gc2ltLm5vdygpCiAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXSA9IHNpbS5ub3coKQogICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl0gPSBzaW0ubm93KCkKICAgICAgICAgICAgc2VsZi5BWyJBLm4iXSArPSAxCiAgICAgICAgICAgIF9wcmludCgiUmVnaXN0ZXJpbmc6ICIgKyBzdHIoc2VsZi5jdXN0b21lcikgKyAiICgiK3N0cihzZWxmLnRpbWUpKyIpIikKICAgICAgICAgICAgc2VsZi5vdXQoc2ltKSAgICAgICAgICAgICAjIHBhc3MgY3VzdG9tZXIgdG8gY29ubmVjdGVkIG9iamVjdAogICAgICAgICAgICBzZWxmLnRpbWUgKz0gc2VsZi5fZnVuKCkKICAgICAgICAgICAgaWYgc2VsZi50bWF4PjAgYW5kIHNlbGYudGltZSA8PSBzZWxmLnRtYXggb3Igc2VsZi5uPC1zZWxmLnRtYXgtMToKICAgICAgICAgICAgICAgICAgc2VsZi5uICs9IDEKICAgICAgICAgICAgICAgICAgc2ltLmFkZChzZWxmKSAgICAgICAjIG5leHQgb25lIGluIHJhbmRvbSB0aW1lCmNsYXNzIFNlcnZpY2UoQnBtbkV2ZW50KToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIGZ1biwgcGFyYW0sIGNvZGU9Tm9uZSk6IAogICAgICAgICAgICBCcG1uRXZlbnQuX19pbml0X18oc2VsZiwiQWN0aXZpdHkiLGNvZGUpICAKICAgICAgICAgICAgc2VsZi5mdW4sIHNlbGYucGFyYW0gPSBmdW4sIHBhcmFtIAogICAgICAgICAgICBzZWxmLk4gPSAxICMgTiBudW1iZXIgb2YgdG9rZW5zIHRvIHdhaXQgKHVzZWQgZm9yIEFuZEdhdGUsT3JHYXRlKQogICAgICBkZWYgaW5zZXJ0KHNlbGYsIGN1c3QsIHNpbSk6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZixYb3JHYXRlKToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4xIGFuZCBzZWxmLmNvZGU9PU5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29kZT0iPUIoMC41KSIKICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKHNlbGYsT3JHYXRlKToKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNlbGYub3V0cHV0KT4xIGFuZCBzZWxmLmNvZGU9PU5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY29kZT0iPVsxLCIrIiwiLmpvaW4oWycwJ10qKGxlbihzZWxmLm91dHB1dCktMSkpKyJdIgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyID09IE5vbmU6ICMgaWYgZnJlZSBhZGQgdG8gc2ltdWxhdG9yIHdpdGggZW5kIHRpbWUKICAgICAgICAgICAgICAgICAgc2VsZi5jdXN0b21lcix0ID0gY3VzdCxzZWxmLl9mdW4oKQogICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHQsbGlzdCk6ICAjIFtjeWNsZSxiZWdpbj0wXSBjeWNsaWMgdGltZXIgKE1NIDEuMTEuMjAyNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHQpPDI6IHQuYXBwZW5kKDApCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZSA9IHRbMV0rbWF0aC5jZWlsKChzaW0ubm93KCktdFsxXSkvdFswXSkqdFswXQogICAgICAgICAgICAgICAgICAgICAgICAjX3ByaW50KCIjICIrc3RyKHNlbGYuY3VzdG9tZXIpKyI6ICIrc3RyKHNpbS5ub3coKSkrIiAiK3N0cihzZWxmLnRpbWUpKQogICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWUgPSBzaW0ubm93KCkgKyB0CiAgICAgICAgICAgICAgICAgIF9wcmludCgiIyIrc3RyKHNlbGYuaWQpKyIgc3RhcnRzIHNlcnZpbmcgIisKICAgICAgICAgICAgICAgICAgICAgICAgIHN0cihjdXN0KSsiICgiK3N0cihzaW0ubm93KCkpKyIsIitzdHIoc2VsZi50aW1lKSsiKSIpCiAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXT1zaW0ubm93KCkKICAgICAgICAgICAgICAgICAgaWYgIl9fbiIrc3RyKHNlbGYuaWQpIG5vdCBpbiBzZWxmLmN1c3RvbWVyLmF0dHI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY3VzdG9tZXIuYXR0clsiX19uIitzdHIoc2VsZi5pZCldID0gMCAjIGZpcnN0IHRpbWUKICAgICAgICAgICAgICAgICAgaWYgIl9fdCIrc3RyKHNlbGYuaWQpKyJhIiBub3QgaW4gc2VsZi5jdXN0b21lci5hdHRyOgogICAgICAgICAgICAgICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl09c2ltLm5vdygpICMgaWYgbm90IGZyb20gcXVldWUKICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzZWxmLFRpbWVyKSBhbmQgbm90IGlzaW5zdGFuY2UodCxsaXN0KTogICMgbW9kaWZ5IHJlcXVpcmVkIGZpbmFsIGV4ZWN1dGlvbiB0aW1lCiAgICAgICAgICAgICAgICAgICAgICAgIHRhPWN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImEiXSAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRiPWN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImIiXQogICAgICAgICAgICAgICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJiIl0gLT0gKHRiLXRhKSAjIGRlY3JlYXNlIGJlZ2luIHRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lIC09ICh0Yi10YSkgICMgLi4uIGJ5IHRoZSBkaWZmZXJlbmNlIGVsYXBzZWQgYWxyZWFkeQogICAgICAgICAgICAgICAgICAgICAgICAjX3ByaW50KCIjICIrc3RyKHNlbGYuY3VzdG9tZXIpKyI6ICIrc3RyKHNlbGYudGltZSkpCiAgICAgICAgICAgICAgICAgIHNpbS5hZGQoc2VsZikKICAgICAgICAgICAgZWxzZTogICAgICAgICAgICAgICAgICAgICAjIGVsc2UgaW5zZXJ0IGludG8gcXVldWUKICAgICAgICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYSJdPXNpbS5ub3coKSAgIyB3aXRoIGEgcXVldWUgYWRkaW5nIHRpbXN0YW1wCiAgICAgICAgICAgICAgICAgIHNlbGYucXVldWUucHVzaChjdXN0KQogICAgICBkZWYgZXhlYyhzZWxmLCBzaW0pOgogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJlIl09c2ltLm5vdygpCiAgICAgICAgICAgICAgICAgIHNlbGYuQVsiQS5uIl0gKz0gMQogICAgICAgICAgICBfcHJpbnQoIiMiK3N0cihzZWxmLmlkKSsiIGZpbmlzaGVkIHNlcnZpbmcgIiArIHN0cihzZWxmLmN1c3RvbWVyKSArICIgYXQgIiArIHN0cihzZWxmLnRpbWUpKQogICAgICAgICAgICBpZiBzZWxmLmNvZGUhPU5vbmUgOiAgICAgIAogICAgICAgICAgICAgICAgICBzZWxmLl9ldmFsKHNlbGYuY29kZSkgICAjIGV2YWx1YXRlIHNjcmlwdCBjb2RlIChbdmFyXT08dmFsdWU+KQogICAgICAgICAgICBpZiBzZWxmLmN1c3RvbWVyIT1Ob25lOgogICAgICAgICAgICAgICAgICBzZWxmLmN1c3RvbWVyLmF0dHJbIl9fbiIrc3RyKHNlbGYuaWQpXSArPSAxCiAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZixPckdhdGUpIGFuZCBsZW4oc2VsZi5vdXRwdXQpPT0xOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLk4gPSBzZWxmLmN1c3RvbWVyLk4KICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuY3VzdG9tZXIuYXR0clsiX19uIitzdHIoc2VsZi5pZCldJXNlbGYuTikgPT0gMDogI3NlbGYuTjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXQoc2ltKSAgICAgIyBwYXNzIGN1c3RvbWVyIHRvIGNvbm5lY3RlZCBvYmplY3QKICAgICAgICAgICAgc2VsZi5jdXN0b21lciA9IE5vbmUgICAgIyBtYXJrIHRoYXQgbm93IHRoZSBzZXJ2aWNlIGlzIGZyZWUgISEhCiAgICAgICAgICAgIGlmIGxlbihzZWxmLnF1ZXVlKT4wIDogICMgYnV0IGlmIGFueWJvZHkgaW4gcXVldWUKICAgICAgICAgICAgICAgICAgU2VydmljZS5pbnNlcnQoc2VsZixzZWxmLnF1ZXVlLnBvcCgpLCBzaW0pICAjIGdldCBhbmQgaW5zZXJ0IGludG8gc2ltdWxhdG9yCmNsYXNzIFNpbmsoQnBtbkV2ZW50KToKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOiAgICAKICAgICAgICAgICAgX3ByaW50KCJTaW5raW5nICIrc3RyKGN1c3QpKyIgOiAiK3N0cihzaW0ubm93KCkpKQogICAgICAgICAgICBjdXN0LmF0dHJbIl9fdCIrc3RyKHNlbGYuaWQpKyJhIl0gPSBzaW0ubm93KCkgICMgbWFyayB0aW1lIGluIGN1c3RvbWVyIGF0dHJpYnV0ZXMKICAgICAgICAgICAgY3VzdC5hdHRyWyJfX3QiK3N0cihzZWxmLmlkKSsiYiJdID0gc2ltLm5vdygpICAjIG1hcmsgdGltZSBpbiBjdXN0b21lciBhdHRyaWJ1dGVzCiAgICAgICAgICAgIGN1c3QuYXR0clsiX190IitzdHIoc2VsZi5pZCkrImUiXSA9IHNpbS5ub3coKSAgIyBtYXJrIHRpbWUgaW4gY3VzdG9tZXIgYXR0cmlidXRlcwogICAgICAgICAgICBzZWxmLkFbIkEubiJdICs9IDEKICAgICAgICAgICAgc2VsZi5xdWV1ZS5wdXNoKGN1c3QpICAgICAjIGluc2VydCBvbmx5IHRvIGl0cyBxdWV1ZQogICAgICAgICAgICBzZWxmLmN1c3RvbWVyPWN1c3QKICAgICAgICAgICAgaWYgc2VsZi5jb2RlIT1Ob25lIDoKICAgICAgICAgICAgICAgICAgc2VsZi5fZXZhbChzZWxmLmNvZGUpICAgIyBldmFsdWF0ZSBzY3JpcHQgY29kZQojIC0tLS0gYnBtbiBkZXJpdmVkIGNsYXNzZXMgKGZyb20gR2VuZXJhdG9yLCBTZXJ2aWNlLCBDb25kaXRpb25hbEV2ZW50IG9yIFNpbmspIC0tLS0KY2xhc3MgWG9yR2F0ZShTZXJ2aWNlKTogICAgIyByYW5kb20gb3V0cHV0IGlmIHR3byBvdXRwdXRzIAogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOiAgIyBkZWZhdWx0cyB0byBiaW5hcnkgcmFuZG9tIHNlbGVjdGlvbgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiZXhjbHVzaXZlR2F0ZXdheSIpCmNsYXNzIE9yR2F0ZShTZXJ2aWNlKTogICAgIyBvdXRwdXQgY29uZGl0aW9uIG11c3QgYmUgZGVmaW5lZCBieSBhcnJheSBvZiB2YWx1ZXMhIAogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiaW5jbHVzaXZlR2F0ZXdheSIpCmNsYXNzIEFuZEdhdGUoU2VydmljZSk6ICAgIAogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgicGFyYWxsZWxHYXRld2F5IikKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOgogICAgICAgICAgICBpZHM9W2UuaWQgZm9yIGUgaW4gc2VsZi5wcmV2KCldICMgaWRzIG9mIGlucHV0cwogICAgICAgICAgICBzZWxmLk49bGVuKHNldChpZHMpKSAjIHNldCBudW1iZXIgb2YgaW5wdXRzICh3aXRoIHVuaXF1ZSBpZHMpIHRvIHdhaXQKICAgICAgICAgICAgU2VydmljZS5pbnNlcnQoc2VsZixjdXN0LHNpbSkKY2xhc3MgU3RhcnQoR2VuZXJhdG9yKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsZnVuPUUscGFyYW09WzFdLHRubWF4PTUwLjAsY29kZT1Ob25lKToKICAgICAgICAgICAgR2VuZXJhdG9yLl9faW5pdF9fKHNlbGYsZnVuLHBhcmFtLHRubWF4LGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgic3RhcnRFdmVudCIpCmNsYXNzIFRhc2soU2VydmljZSk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGZ1bj1VLHBhcmFtPVsxLDJdLGNvZGU9Tm9uZSxNPTEpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsZnVuLHBhcmFtLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgidGFzayIpCiAgICAgICAgICAgIHNlbGYuc2VydmVycywgc2VsZi5uc2VydmVyLCBzZWxmLk0gPSBbXSwgMCwgTQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShzZWxmLk0tMSk6CiAgICAgICAgICAgICAgICAgIEV2ZW50LmNudCAtPTEKICAgICAgICAgICAgICAgICAgc2VsZi5zZXJ2ZXJzLmFwcGVuZChTZXJ2aWNlKGZ1bixwYXJhbSxjb2RlKSkKICAgICAgZGVmIGluc2VydChzZWxmLCBjdXN0LCBzaW0pOgogICAgICAgICAgICBpZihzZWxmLm5zZXJ2ZXI9PTApOiAgIyBteXNlbGYKICAgICAgICAgICAgICAgICAgU2VydmljZS5pbnNlcnQoc2VsZixjdXN0LHNpbSkKICAgICAgICAgICAgZWxzZTogICAgICAgICAgICAgICMgb3RoZXJzZWxmcwogICAgICAgICAgICAgICAgICBzZWxmLnNlcnZlcnNbc2VsZi5uc2VydmVyLTFdLmluc2VydChjdXN0LHNpbSkKICAgICAgICAgICAgc2VsZi5uc2VydmVyID0gKHNlbGYubnNlcnZlcisxKSVzZWxmLk0KY2xhc3MgVGltZXIoU2VydmljZSk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGZ1bj0xLHBhcmFtPU5vbmUsY29kZT1Ob25lKToKICAgICAgICAgICAgaWYgbm90IGNhbGxhYmxlKGZ1bik6ICAjIHdoZW4gcGFzc2luZyBmaXhlZCBkZWxheSB2YWx1ZQogICAgICAgICAgICAgICAgICBmdW4scGFyYW0sY29kZSA9IE5vbmUsZnVuLHBhcmFtCiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixmdW4scGFyYW0sY29kZSkKICAgICAgICAgICAgc2VsZi5zZXROYW1lKCJpbnRlcm1lZGlhdGVDYXRjaEV2ZW50IikKY2xhc3MgRW5kKFNpbmspOgogICAgICAjZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAjICAgICAgU2luay5fX2luaXRfXyhzZWxmKQogICAgICAjICAgICAgc2VsZi5zZXROYW1lKCJlbmRFdmVudCIpCiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLGNvZGU9Tm9uZSk6CiAgICAgICAgICAgIFNpbmsuX19pbml0X18oc2VsZiwiZW5kRXZlbnQiLGNvZGUpCmNsYXNzIFRocm93KFNlcnZpY2UpOgogICAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgICAgIFNlcnZpY2UuX19pbml0X18oc2VsZixOb25lLDApCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiaW50ZXJtZWRpYXRlVGhyb3dFdmVudCIpCmNsYXNzIFRlcm1pbmF0ZShFbmQpOgogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBFbmQuX19pbml0X18oc2VsZixjb2RlKQogICAgICAgICAgICBzZWxmLnNldE5hbWUoInRlcm1pbmF0ZUVuZEV2ZW50IikKY2xhc3MgU2NyaXB0KFNlcnZpY2UpOgogICAgICBkZWYgX19pbml0X18oc2VsZixjb2RlPU5vbmUpOgogICAgICAgICAgICBTZXJ2aWNlLl9faW5pdF9fKHNlbGYsTm9uZSwwLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgic2NyaXB0VGFzayIpCmNsYXNzIENvbmRpdGlvbihDb25kaXRpb25hbEV2ZW50KToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsY29kZT1Ob25lKToKICAgICAgICAgICAgQ29uZGl0aW9uYWxFdmVudC5fX2luaXRfXyhzZWxmLGNvZGUpCiAgICAgICAgICAgIHNlbGYuc2V0TmFtZSgiaW50ZXJtZWRpYXRlQ2F0Y2hFdmVudCIpCgojIC0tLS0gdXRpbDIgLS0tLS0tLS0gICAgICAKZGVmIGNvbm5lY3QoYSwgYik6CiAgICAgIGEub3V0cHV0LmFwcGVuZChiKQogICAgICBpZiBpc2luc3RhbmNlKGEsVGFzayk6CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihhLnNlcnZlcnMpKTogICMgZmlyc3Qgc2VydmVyIGlzIGFscmVhZHkgY29ubmVjdGVkCiAgICAgICAgICAgICAgICAgIGEuc2VydmVyc1tpXS5vdXRwdXQuYXBwZW5kKGIpCmRlZiBkaWN0X3Rvc3RyaW5nKGEpOgogICAgICByZXR1cm4gIlxuIi5qb2luKFtrKyI6XHQiK3N0cih2KSBmb3Igayx2IGluIGEuaXRlbXMoKV0pCiIiIgpkZWYgaGlzdChhPVswLDFdLCBiPTIwLCBjPSdvcmFuZ2UnKToKICAgICAgaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdAogICAgICBwbHQuaGlzdChhLGIsY29sb3I9YykKICAgICAgI3BsdC5zYXZlZmlnKCJkZXNfcGxvdC5zdmciLCBmb3JtYXQ9InN2ZyIpCiAgICAgICNwbHQuc2hvdygpCiAgICAgIGltcG9ydCBpbywgYmFzZTY0CiAgICAgIGJ1ZiA9IGlvLkJ5dGVzSU8oKQogICAgICBwbHQuc2F2ZWZpZyhidWYsIGZvcm1hdD0nc3ZnJykKICAgICAgYnVmLnNlZWsoMCkKICAgICAgcmV0dXJuICdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCcgKyBiYXNlNjQuYjY0ZW5jb2RlKGJ1Zi5yZWFkKCkpLmRlY29kZSgnVVRGLTgnKQpkZWYgZnJvbV9maWxlKGZuYW1lKToKICAgICAgd2l0aCBvcGVuKGZuYW1lLCJyIikgYXMgZnA6CiAgICAgICAgICAgIHJldHVybiBmcC5yZWFkKCkKIiIiCiMgLS0tLSBjb252ZXJzaW9ucyAtLS0tLS0tLSAgICAgIApkZWYgYXR0cl90b3N0cmluZyhhKToKICAgICAgcz0ibmFtZTogIithWyJuYW1lIl0rIlxuIgogICAgICBmb3IgaSBpbiByYW5nZSgxLDEwMCk6CiAgICAgICAgICAgIHQ9Il9fdCIrc3RyKGkpCiAgICAgICAgICAgIGlmIHQrImIiIGluIGE6CiAgICAgICAgICAgICAgICAgIHMrPXQrIiAiKyIlLjNmIiVhW3QrImIiXSsiICIrIiUuM2YiJWFbdCsiZSJdKyJcbiIKICAgICAgcmV0dXJuIHMKZGVmIGF0dHJfdG9zdmdzdHJpbmcobyx3bWF4LHc9MTYsaD0yNCk6CiAgICAgIGdsb2JhbCBuZQogICAgICBhLHMgPSBvLmF0dHIsIiIKICAgICAgYz1bJ2hvdHBpbmsnLCdsaW1lZ3JlZW4nLCdjb3JuZmxvd2VyYmx1ZScsJ2NvcmFsJywnbWVkaXVtc2VhZ3JlZW4nLCdtZWRpdW1wdXJwbGUnXQogICAgICBmb3IgaSBpbiByYW5nZSgxMDApOgogICAgICAgICAgICB0PSJfX3QiK3N0cihpKQogICAgICAgICAgICBpZiB0KyJiIiBpbiBhOgogICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iOCIgeT0iJytzdHIoMzIraCppKSsnIj4nK3N0cihpKSsnPHRpdGxlPicrc3RyKG5lLmVlW2ktMV0ubmFtZSkrJyAnK3N0cihuZS5lZVtpLTFdLnRpdGxlKSsnPC90aXRsZT48L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgIHMrPSc8dGV4dCBjbGFzcz0idDEiIHN0eWxlPSJkaXNwbGF5Om5vbmU7ZmlsbDpncmF5IiB4PSIzMiIgeT0iJytzdHIoMzIraCppKSsnIj4nK3N0cihuZS5lZVtpLTFdLnRpdGxlKSsnPHRpdGxlPicrc3RyKG5lLmVlW2ktMV0ubmFtZSkrJzwvdGl0bGU+PC90ZXh0PlxuJwogICAgICAgICAgICAgICAgICB0MCx0MSx0MiA9IGFbdCsiYSJdLGFbdCsiYiJdLGFbdCsiZSJdCiAgICAgICAgICAgICAgICAgIHMrPSc8cmVjdCB5PSInK3N0cigyMCtoKmkpKyciIHg9Iicrc3RyKDIwK3cqdDEpCiAgICAgICAgICAgICAgICAgIHMrPSciIHdpZHRoPSInK3N0cih0Mi10MT09MCBhbmQgMSBvciB3Kih0Mi10MSkpKyciIGhlaWdodD0iJytzdHIoaC0yKSsnIiBzdHJva2U9ImJsYWNrIiBmaWxsLW9wYWNpdHk9IjAuNyIgZmlsbD0iJwogICAgICAgICAgICAgICAgICBzKz0oY1tpbnQoYVsiY25hbWUiXS5zcGxpdCgnICcpWzBdKSVsZW4oYyldKSsnIj48dGl0bGU+JythWyJjbmFtZSJdKycgWycrKCIlLjJmLCAiJXQwKSsoIiUuMmYsICIldDEpKygiJS4yZiIldDIpKyddJysnPC90aXRsZT48L3JlY3Q+XG4nCiAgICAgICAgICAgICAgICAgIGlmIHQyLXQxPjAuNToKICAgICAgICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IHg9Iicrc3RyKDIwK3cqdDErMikrJyIgeT0iJytzdHIoMjAraCppKzE4KSsnIj4nK2FbImNuYW1lIl0rJzwvdGV4dD4nCiAgICAgICAgICAgICAgICAgIGlmIHcqdDE+d21heFswXToKICAgICAgICAgICAgICAgICAgICAgICAgd21heFswXSA9IHcqdDEKICAgICAgcmV0dXJuIHMKZGVmIHRvX3N2ZyhlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMpOgogICAgICB3LGgsVyxIID0gMTYsMjQsWzE2MF0sNDAgICMgV1swXSBmb3IgcGFzc2luZyBieSByZWZlcmVuY2UhISEKICAgICAgcyA9ICc8c3ZnIG9uY2xpY2s9Im9uX2NsaWNrKCkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IiVkIiBoZWlnaHQ9IiVkIj5cbicKICAgICAgZm9yIGUgaW4gZWU6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZSxFbmQpOgogICAgICAgICAgICAgICAgICBmb3IgYyBpbiBlLnF1ZXVlLm9iamVjdHM6CiAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gYXR0cl90b3N2Z3N0cmluZyhjLFcsdyxoKQogICAgICAgICAgICBIICs9IDI0CiAgICAgIEgrPTI0CiAgICAgIHMrPSAnPHJlY3QgeD0iMjAiIHk9IjEwIiB3aWR0aD0iJWQiIGhlaWdodD0iMiIvPlxuJyUoV1swXSt3KQogICAgICBzKz0gJzxyZWN0IHg9IjIwIiB5PSIlZCIgd2lkdGg9IiVkIiBoZWlnaHQ9IjIiLz5cbiclKEgrMTAsV1swXSt3KQogICAgICBmb3IgaSBpbiByYW5nZShpbnQoV1swXS93KzIpKToKICAgICAgICAgICAgcyArPSAnPHJlY3QgeD0iJytzdHIoMjArdyppKSsnIiB5PSIxMCIgd2lkdGg9IjEiIGhlaWdodD0iMTAiLz5cbicKICAgICAgICAgICAgcyArPSAnPHJlY3QgeD0iJytzdHIoMjArdyppKSsnIiB5PSIlZCIgd2lkdGg9IjEiIGhlaWdodD0iMTAiLz5cbiclKEgpCiAgICAgICAgICAgIGlmIChpJTEwKT09MDoKICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IHg9Iicrc3RyKDIwK3cqaS04KSsnIiB5PSIzMiI+JytzdHIoaSkrJzwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IHg9Iicrc3RyKDIwK3cqaS04KSsnIiB5PSIlZCI+JyUoSCkrc3RyKGkpKyc8L3RleHQ+XG4nCiAgICAgIHMgKz0gIjxzY3JpcHQ+ZnVuY3Rpb24gb25fY2xpY2soKSB7Wy4uLmRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3QxJyldLmZvckVhY2goZT0+ZS5zdHlsZS5kaXNwbGF5PShlLnN0eWxlLmRpc3BsYXk9PSdub25lJz8nJzonbm9uZScpKTt9PC9zY3JpcHQ+IgogICAgICByZXR1cm4gcyUoV1swXSs4MCxIKzIwKSArICc8L3N2Zz5cbicKZGVmIHRvX2RvdDAoZWU9UXVldWVkRXZlbnQuaW5zdGFuY2VzKToKICAgICAgcyA9J2RpZ3JhcGggQlBNTiB7IHJhbmtkaXI9IkxSIiByYW5rc2VwPTEgbm9kZXNlcD0xXG4nCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBzMSA9ICcgIHtyYW5rPXNhbWU7ICcKICAgICAgICAgICAgZm9yIGogaW4gcmFuZ2UobGVuKGVlW2ldLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICBzICs9ICIgICIrc3RyKGVlW2ldLmlkKSArICIgLT4gIiArIHN0cihlZVtpXS5vdXRwdXRbal0uaWQpICsiXG4iCiAgICAgICAgICAgICAgICAgIHMxICs9IHN0cihlZVtpXS5vdXRwdXRbal0uaWQpICsiOyAiCiAgICAgICAgICAgIGlmIGxlbihlZVtpXS5vdXRwdXQpPjE6CiAgICAgICAgICAgICAgICAgIGlmIGFicyhlZVtpXS5vdXRwdXRbMF0uaWQtZWVbaV0ub3V0cHV0WzFdLmlkKTwyOiBzICs9IHMxICsnfVxuJwogICAgICByZXR1cm4gcysnfScKZGVmIHRvX2RvdChlZT1RdWV1ZWRFdmVudC5pbnN0YW5jZXMpOgogICAgICBzID0nZGlncmFwaCBCUE1OMiB7IHJhbmtkaXI9IkxSIiBub2Rlc2VwPTAuNlxuJwogICAgICBmb3IgaSBpbiByYW5nZShsZW4oZWUpKToKICAgICAgICAgICAgbGFiZWwseGxhYmVsLHNoYXBlLHN0eWxlLGNvbG9yLHBlbiA9IHN0cihlZVtpXS5pZCksIiIsInJlY3QiLCIiLCIiLCIxIgogICAgICAgICAgICBzaXplPSIiCiAgICAgICAgICAgIGlmICJ2ZW50IiBpbiBlZVtpXS5uYW1lOiBzaGFwZT0iY2lyY2xlIgogICAgICAgICAgICBlbGlmICJhdGV3YXkiIGluIGVlW2ldLm5hbWU6IHNoYXBlPSJkaWFtb25kIjsgc2l6ZT0iaGVpZ2h0PTAuNyIKICAgICAgICAgICAgaWYgImludGVybWVkaWF0ZSIgaW4gZWVbaV0ubmFtZTogc2hhcGU9ImRvdWJsZWNpcmNsZSIKICAgICAgICAgICAgaWYgc2hhcGU9PSJyZWN0Ijogc3R5bGU9InJvdW5kZWQsZmlsbGVkIjsgY29sb3I9ImxpZ2h0Ymx1ZSI7IHNpemU9IndpZHRoPTEuMSBoZWlnaHQ9MC44IgogICAgICAgICAgICBlbGlmICJlbmQiIGluIGVlW2ldLm5hbWU6IHN0eWxlPSJmaWxsZWQiOyBwZW49IjMiCiAgICAgICAgICAgIGlmICJleGNsdXNpdmUiIGluIGVlW2ldLm5hbWU6IHhsYWJlbD1sYWJlbDsgbGFiZWw9IlgiCiAgICAgICAgICAgIGVsaWYgInBhcmFsbGVsIiBpbiBlZVtpXS5uYW1lOiB4bGFiZWw9bGFiZWw7IGxhYmVsPSIrIgogICAgICAgICAgICBlbGlmICJpbmNsdXNpdmUiIGluIGVlW2ldLm5hbWU6IHhsYWJlbD1sYWJlbDsgbGFiZWw9Ik8iCiAgICAgICAgICAgIHMgKz0gJyAgJytlZVtpXS5uYW1lICsnIFtsYWJlbD0iJytsYWJlbCsnIiB4bGFiZWw9IicreGxhYmVsCiAgICAgICAgICAgIHMgKz0gJyIgc3R5bGU9Iicrc3R5bGUrJyIgc2hhcGU9Iicrc2hhcGUrJyIgZmlsbGNvbG9yPSInCiAgICAgICAgICAgIHMgKz0gY29sb3IrJyIgcGVud2lkdGg9IicrcGVuKyciICcrc2l6ZSsnXScgKydcbicKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6CiAgICAgICAgICAgIHMxID0gJyAge3Jhbms9c2FtZTsgJwogICAgICAgICAgICBmb3IgaiBpbiByYW5nZShsZW4oZWVbaV0ub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgIHMgKz0gIiAgIitlZVtpXS5uYW1lICsgIiAtPiAiICsgZWVbaV0ub3V0cHV0W2pdLm5hbWUgKyJcbiIKICAgICAgICAgICAgICAgICAgczEgKz0gZWVbaV0ub3V0cHV0W2pdLm5hbWUgKyI7ICIKICAgICAgICAgICAgaWYgbGVuKGVlW2ldLm91dHB1dCk+MToKICAgICAgICAgICAgICAgICAgaWYgYWJzKGVlW2ldLm91dHB1dFswXS5pZC1lZVtpXS5vdXRwdXRbMV0uaWQpPDI6IHMgKz0gczEgKyd9XG4nCiAgICAgIHJldHVybiBzKyd9JwpkZWYgdG9fcG9zaXRpb24oZWU9UXVldWVkRXZlbnQuaW5zdGFuY2VzKToKICAgICAgcHA9W10KICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6ICAgIyBzZXQgeCBwb3NpdGlvbiB0byB0cmVlIGxldmVsCiAgICAgICAgICAgIHgsZXAgPSAwLGVlW2ldLnByZXYoKQogICAgICAgICAgICBmb3IgaWR4IGluIHJhbmdlKGxlbihlcCktMSwtMSwtMSk6CiAgICAgICAgICAgICAgICAgIGlmIGVwW2lkeF0ucHBbMF0hPS0xOgogICAgICAgICAgICAgICAgICAgICAgICB4PWVwW2lkeF0ucHBbMF0rMQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlZVtpXS5wcD1beCwwXQogICAgICAgICAgICBwcC5hcHBlbmQoZWVbaV0ucHApCiAgICAgICNwcmludChbXy5wcCBmb3IgXyBpbiBlZV0pCiAgICAgIGZvciBpIGluIHJhbmdlKDEsbGVuKHBwKSk6ICMgaW5jcmVhc2UgeSBwb3NpdGlvbiBmb3IgYWxsIGF0IHRoZSBzYW1lIGxldmVsCiAgICAgICAgICAgIGlmIHBwW2ldWzBdPT1wcFtpLTFdWzBdOgogICAgICAgICAgICAgICAgICBwcFtpXVsxXSA9IHBwW2ktMV1bMV0rMQogICAgICAgICAgICAgICAgICBlZVtpXS5wcD1wcFtpXQogICAgICAjcHJpbnQoW18ucHAgZm9yIF8gaW4gZWVdKQogICAgICAjIiIiCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSktMSwtMSwtMSk6ICAgIyBzZXQgeSBwb3NpdGlvbiB0byB0aGUgbGV2ZWwgb2YgcHJldmlvdXMgCiAgICAgICAgICAgIGUgPSBlZVtpXS5wcmV2KCkKICAgICAgICAgICAgaWYgbGVuKGUpPjAgYW5kIGVbMF0ub3V0cHV0WzBdPT1lZVtpXToKICAgICAgICAgICAgICAgICAgcHBbaV1bMV0gPSBlWzBdLnBwWzFdCiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwPXBwW2ldCiAgICAgICAgICAgIGlmIGxlbihlKT4wIGFuZCBsZW4oZVswXS5vdXRwdXQpPjEgYW5kIGVbMF0ub3V0cHV0WzFdPT1lZVtpXSBhbmQgbGVuKGVlW2ldLm91dHB1dCk9PTA6CiAgICAgICAgICAgICAgICAgIHBwW2ldWzBdID0gZWVbaV0ucHBbMF0tMSAgIyB3aGVuIGl0IGlzIHRoZSBzZWNvbmQgYW5kIGhhcyBubyBvdXB1dAogICAgICAgICAgICAgICAgICBlZVtpXS5wcD1wcFtpXQogICAgICAjcHJpbnQoW18ucHAgZm9yIF8gaW4gZWVdKQogICAgICAjIiIiCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSktMSwtMSwtMSk6ICMgbW92ZSBwcmV2aW91cyB0byB0aGUgbGV2ZWwgb2YgaXRzIGZpcnN0IG5leHQKICAgICAgICAgICAgZXA9ZWVbaV0ucHJldigpCiAgICAgICAgICAgIGlmIGxlbihlcCk+MCBhbmQgZXBbMF0ub3V0cHV0WzBdPT1lZVtpXSBhbmQgZXBbMF0ucHBbMF09PWVlW2ldLnBwWzBdLTE6CiAgICAgICAgICAgICAgICAgIGlmIGVwWzBdLnBwWzFdIT1lZVtpXS5wcFsxXToKICAgICAgICAgICAgICAgICAgICAgICAgZXBbMF0ucHBbMV09ZWVbaV0ucHBbMV0KICAgICAgI3ByaW50KFtfLnBwIGZvciBfIGluIGVlXSkgICAgICAKICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGVlKSk6ICAjIGZvcmNlIHBvc2l0aW9uIGZyb20gcHAyCiAgICAgICAgICAgIGlmIGVlW2ldLnBwMlswXSE9LTE6CiAgICAgICAgICAgICAgICAgIGVlW2ldLnBwWzBdPWVlW2ldLnBwMlswXQogICAgICAgICAgICBpZiBlZVtpXS5wcDJbMV0hPS0xOgogICAgICAgICAgICAgICAgICBlZVtpXS5wcFsxXT1lZVtpXS5wcDJbMV0KICAgICAgZm9yIGUgaW4gZWU6ICAgIyBjb3JyZWN0IHBvc2l0aW9uIG9mIGJvdW5kYXJ5IGV2ZW50cyAKICAgICAgICAgICAgI2lmKGUucHBbMF09PTAgYW5kIGUucHBbMV09PTApOgogICAgICAgICAgICBpZihlLmlkIT1lLmlkMik6CiAgICAgICAgICAgICAgICAgIGlkMj1pbnQoc3RyKGUuaWQyKS5zcGxpdCgiLiIpWzFdKQogICAgICAgICAgICAgICAgICBlLnBwWzBdLGUucHBbMV0gPSBlZVtpZDItMV0ucHBbMF0sZWVbaWQyLTFdLnBwWzFdCiAgICAgIHJldHVybiBbZS5wcCBmb3IgZSBpbiBlZV0KZGVmIHRvX2JwbW4oZWU9UXVldWVkRXZlbnQuaW5zdGFuY2VzLHBwPU5vbmUpOgogICAgICBzID0nPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz5cbicKICAgICAgcys9JzxicG1uOmRlZmluaXRpb25zIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiJwogICAgICBzKz0nIHhtbG5zOmJwbW49Imh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0JQTU4vMjAxMDA1MjQvTU9ERUwiJwogICAgICBzKz0nIHhtbG5zOmJwbW5kaT0iaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9ESSInCiAgICAgIHMrPScgeG1sbnM6ZGM9Imh0dHA6Ly93d3cub21nLm9yZy9zcGVjL0RELzIwMTAwNTI0L0RDIicKICAgICAgcys9JyB4bWxuczpkaT0iaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREkiJwogICAgICBzKz0nIHRhcmdldE5hbWVzcGFjZT0iaHR0cDovL2JwbW4uaW8vc2NoZW1hL2JwbW4iJwogICAgICBzKz0nIGlkPSJEZWZpbml0aW9uc18xIiBleHBvcnRlcj0iZGVzIiBleHBvcnRlclZlcnNpb249IjEuMCI+XG4nCiAgICAgIHMxPScgPGJwbW46cHJvY2VzcyBpZD0iUHJvY2Vzc18xIj5cbicKICAgICAgczI9JyA8YnBtbmRpOkJQTU5EaWFncmFtIGlkPSJCUE1ORGlhZ3JhbV8xIj5cbicKICAgICAgczIrPScgIDxicG1uZGk6QlBNTlBsYW5lIGlkPSJCUE1OUGxhbmVfMSIgYnBtbkVsZW1lbnQ9IlByb2Nlc3NfMSI+XG4nCiAgICAgIHMxYT0nJwogICAgICBqMSA9IDAgICMgZmxvdyBjb3VudGVyCiAgICAgIFcsSCxXMCxIMCA9IDEwMCwxMDAsNDAsMzAKICAgICAgaWYgbm90IHBwOgogICAgICAgICAgICBwcCA9IFtlLnBwIGZvciBlIGluIGVlXQogICAgICAgICAgICBpZiBwcFswXVswXT09LTE6CiAgICAgICAgICAgICAgICAgIHBwID0gdG9fcG9zaXRpb24oZWUpCiAgICAgIGZvciBpIGluIHJhbmdlKGxlbihlZSkpOgogICAgICAgICAgICBuYW1lID0gZWVbaV0ubmFtZQogICAgICAgICAgICBpZiAidGVybWluYXRlIiBpbiBuYW1lOgogICAgICAgICAgICAgICAgICBuYW1lPW5hbWVbbGVuKCJ0ZXJtaW5hdGUiKTpdCiAgICAgICAgICAgIGVuYW1lID0gZWVbaV0uX19jbGFzc19fLl9fbmFtZV9fKydfJytzdHIoZWVbaV0uZnVuIGFuZCBlZVtpXS5mdW4uX19uYW1lX18gb3IgTm9uZSkrJ18nCiAgICAgICAgICAgIGltcG9ydCBiYXNlNjQKICAgICAgICAgICAgZW5hbWUgKz0gYmFzZTY0LmIxNmVuY29kZShieXRlYXJyYXkoc3RyKGVlW2ldLnBhcmFtKSsnXycrc3RyKGVlW2ldLmNvZGUpLCdhc2NpaScpKS5kZWNvZGUoJ2FzY2lpJykgIyByZXF1aXJlcyBlbmNvZGluZyEKICAgICAgICAgICAgdHlwZT1uYW1lLnNwbGl0KCJfIilbMF0KICAgICAgICAgICAgZ3Q9eyJ3aSI6ODAsImgiOjYwLCJveCI6MCwib3kiOjAsImUiOig4MCwzMCksInciOigwLDMwKSwibiI6KDQwLDApLCJzIjooNDAsNjApfQogICAgICAgICAgICBnZz17IndpIjozNiwiaCI6MzYsIm94IjoyMiwib3kiOjEyLCJlIjooNTgsMzApLCJ3IjooMjIsMzApLCJuIjooNDAsMTIpLCJzIjooNDAsNDgpfQogICAgICAgICAgICBnMSA9IGd0IGlmICJhc2siIGluIHR5cGUgZWxzZSBnZwogICAgICAgICAgICB3LGggPSBnMVsid2kiXSxnMVsiaCJdICAjIGljb24gc2l6ZQogICAgICAgICAgICB4Yix5YiA9IFcwK1cqcHBbaV1bMF0sIEgwK0gqcHBbaV1bMV0KICAgICAgICAgICAgeG8seW8gPSB4YitnMVsib3giXSwgeWIrZzFbIm95Il0gIyBpY29uIG9mZnNldAogICAgICAgICAgICBpZiAidGFzayIgaW4gdHlwZToKICAgICAgICAgICAgICAgICAgaWYgbGVuKGVlW2ldLm91dHB1dCk+MTogdHlwZSA9ICJzZW5kVGFzayIKICAgICAgICAgICAgICAgICAgaWYgbGVuKHNldChbZS5pZCBmb3IgZSBpbiBlZVtpXS5wcmV2KCldKSk+MTogdHlwZSA9ICJyZWNlaXZlVGFzayIKICAgICAgICAgICAgaWYgZWVbaV0uaWQgIT0gZWVbaV0uaWQyOiAgIyBmb3IgYm91bmRhcnkgZXZlbnRzCiAgICAgICAgICAgICAgICAgIGlkMiA9IGludChzdHIoZWVbaV0uaWQyKS5zcGxpdCgnLicpWzFdKQogICAgICAgICAgICAgICAgICB4byx5byA9IGVlW2lkMi0xXS54KzIyLjUsZWVbaWQyLTFdLnkrNDIuNQogICAgICAgICAgICAgICAgICB0eXBlID0gImJvdW5kYXJ5RXZlbnQiCiAgICAgICAgICAgIGVlW2ldLngsZWVbaV0ueSA9IHhvLHlvCiAgICAgICAgICAgIHMxKz0nICA8YnBtbjonK3R5cGUrJyBpZD0iJytuYW1lKyciIG5hbWU9IicrbmFtZS5zcGxpdCgiXyIpWzFdKydcbicrZWVbaV0udGl0bGUrJyI+XG4nCiAgICAgICAgICAgIHMyKz0nICAgPGJwbW5kaTpCUE1OU2hhcGUgaWQ9IicrbmFtZSsnXycrZW5hbWUrJyIgYnBtbkVsZW1lbnQ9IicrbmFtZSsnIj5cbicKICAgICAgICAgICAgczIrPScgICAgPGRjOkJvdW5kcyB4PSInK3N0cih4bykrJyIgeT0iJytzdHIoeW8pKyciIHdpZHRoPSInK3N0cih3KSsnIiBoZWlnaHQ9Iicrc3RyKGgpKyciIC8+XG4nCiAgICAgICAgICAgIHMyKz0nICAgPC9icG1uZGk6QlBNTlNoYXBlPlxuJwogICAgICAgICAgICBmb3IgajIgaW4gcmFuZ2UobGVuKGVlW2ldLm91dHB1dCkpOgogICAgICAgICAgICAgICAgICBqMSArPSAxCiAgICAgICAgICAgICAgICAgIGZsb3csZWZsb3c9J0Zsb3dfJytzdHIoajEpLCJkaSIKICAgICAgICAgICAgICAgICAgaWkgPSBlZVtpXS5vdXRwdXRbajJdLmlkLTEKICAgICAgICAgICAgICAgICAgI3ByaW50KGVlW2ldLGoyLGVlW2ldLm91dHB1dFtqMl0saWkscHApCiAgICAgICAgICAgICAgICAgIHhlLHllID0gVzArVypwcFtpaV1bMF0sIEgwK0gqcHBbaWldWzFdCiAgICAgICAgICAgICAgICAgIG5hbWUyPWVlW2ldLm91dHB1dFtqMl0ubmFtZQogICAgICAgICAgICAgICAgICBpZiAidGVybWluYXRlIiBpbiBuYW1lMjoKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTI9bmFtZTJbbGVuKCJ0ZXJtaW5hdGUiKTpdCiAgICAgICAgICAgICAgICAgIHR5cGUyPW5hbWUyLnNwbGl0KCJfIilbMF0KICAgICAgICAgICAgICAgICAgZzIgPSBndCBpZiAiYXNrIiBpbiB0eXBlMiBlbHNlIGdnCiAgICAgICAgICAgICAgICAgIGlmIHhlPnhiOiAjIHR3byBlZGdlcwogICAgICAgICAgICAgICAgICAgICAgICBkeDEsZHkxID0gZzFbInMiXSBpZiB5Yjx5ZSBlbHNlIGcxWyJlIl0KICAgICAgICAgICAgICAgICAgICAgICAgZHgyLGR5MiA9IGcyWyJzIl0gaWYgeWI+eWUgZWxzZSBnMlsidyJdCiAgICAgICAgICAgICAgICAgIGVsc2UgOiAgICAjIHRocmVlIGVkZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgIGR4MSxkeTEgPSBnMVsicyJdIGlmIHliPHllIGVsc2UgZzFbIm4iXQogICAgICAgICAgICAgICAgICAgICAgICBkeDIsZHkyID0gZzJbInMiXSBpZiB5Yj55ZSBlbHNlIGcyWyJuIl0KICAgICAgICAgICAgICAgICAgeDEseTEgPSB4YitkeDEseWIrZHkxCiAgICAgICAgICAgICAgICAgIHgyLHkyID0geGUrZHgyLHllK2R5MgogICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOm91dGdvaW5nPicrZmxvdysnPC9icG1uOm91dGdvaW5nPlxuJwogICAgICAgICAgICAgICAgICBpZiAiaW50ZXJtZWRpYXRlQ2F0Y2giIGluIG5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICJvbmRpdGlvbiIgaW4gZW5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMxKz0nICAgPGJwbW46Y29uZGl0aW9uYWxFdmVudERlZmluaXRpb24vPlxuJwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOnRpbWVyRXZlbnREZWZpbml0aW9uLz5cbicKICAgICAgICAgICAgICAgICAgczFhKz0nICAgIDxicG1uOnNlcXVlbmNlRmxvdyBpZD0iJytmbG93KyciIHNvdXJjZVJlZj0iJytuYW1lKyciIHRhcmdldFJlZj0iJytuYW1lMisnIiAvPlxuJwogICAgICAgICAgICAgICAgICBzMis9JyAgIDxicG1uZGk6QlBNTkVkZ2UgaWQ9IicrZmxvdysnXycrZWZsb3crJyIgYnBtbkVsZW1lbnQ9IicrZmxvdysnIj5cbicKICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHgxKSsnIiB5PSInK3N0cih5MSkrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgeHgseXkgPSAwLDAKICAgICAgICAgICAgICAgICAgaWYgeTEhPXkyOiAjIHJlcXVpcmVzIGFkZGl0aW9uYWwgcG9pbnRzIChvbmUgb3IgdHdvIGltcGxlbWVudGVkKQogICAgICAgICAgICAgICAgICAgICAgICB4eCwgeXkgPSB5Mj55MSBhbmQgeDEgb3IgeDIsIHkyPnkxIGFuZCB5MiBvciB5MQogICAgICAgICAgICAgICAgICAgICAgICBpZiB4MT54MjogIyBiYWNrIGNvbm5lY3Rpb24gcmVxdWlyZXMgdHdvIGFkZGl0aW9uYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgeTE+eTI6ICMgZnJvbSBsb3dlciBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5eSAtPSAzNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDEpKyciIHk9Iicrc3RyKHl5KSsnIiAvPlxuJyAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiB5MTx5MjogIyBmcm9tIHVwcGVyIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl5IC09IDI1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4eCkrJyIgeT0iJytzdHIoeXkpKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHh4ID0geDIKICAgICAgICAgICAgICAgICAgICAgICAgczIrPScgICAgPGRpOndheXBvaW50IHg9Iicrc3RyKHh4KSsnIiB5PSInK3N0cih5eSkrJyIgLz5cbicKICAgICAgICAgICAgICAgICAgZWxpZiB5MT09eTIgYW5kIHgxPngyOiAjIGxvb3BiYWNrIC0gcmVxdWlyZXMgdHdvIGFkZGl0aW9uYWwgcG9pbnRzCiAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MSkrJyIgeT0iJytzdHIoeTEtMzApKyciIC8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgIHMyKz0nICAgIDxkaTp3YXlwb2ludCB4PSInK3N0cih4MikrJyIgeT0iJytzdHIoeTItMzApKyciIC8+XG4nICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICBpZiB4eCE9eDIgb3IgeXkhPXkyOgogICAgICAgICAgICAgICAgICAgICAgICBzMis9JyAgICA8ZGk6d2F5cG9pbnQgeD0iJytzdHIoeDIpKyciIHk9Iicrc3RyKHkyKSsnIiAvPlxuJwogICAgICAgICAgICAgICAgICBzMis9JyAgIDwvYnBtbmRpOkJQTU5FZGdlPlxuJwogICAgICAgICAgICBpZiAidGVybWluYXRlIiBpbiBlZVtpXS5uYW1lOgogICAgICAgICAgICAgICAgICBzMSs9JyAgIDxicG1uOnRlcm1pbmF0ZUV2ZW50RGVmaW5pdGlvbi8+XG4nCiAgICAgICAgICAgIHMxKz0nICA8L2JwbW46Jyt0eXBlKyc+XG4nCiAgICAgICAgICAgIHBhc3MKICAgICAgczIrPScgIDwvYnBtbmRpOkJQTU5QbGFuZT5cbicKICAgICAgczIrPScgPC9icG1uZGk6QlBNTkRpYWdyYW0+XG4nCiAgICAgIHMxKz1zMWErJyA8L2JwbW46cHJvY2Vzcz5cbicKICAgICAgcmV0dXJuIHMrczErczIrJzwvYnBtbjpkZWZpbml0aW9ucz5cbicKCmVuX3RpdGxlID0gIiIKY2xhc3MgRXZlbnROZXR3b3JrKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLHMpOgogICAgICAgICAgICBFdmVudC5jbnQsIEN1c3RvbWVyLmNudCA9IDAsIDAKICAgICAgICAgICAgUXVldWVkRXZlbnQuaW5zdGFuY2VzLmNsZWFyKCkKICAgICAgICAgICAgQnBtbkV2ZW50LlMgPSB7fQogICAgICAgICAgICBzZWxmLmVlID0gc2VsZi5mcm9tX3N0cmluZyhzKQogICAgICAgICAgICBzZWxmLnBwID0gdG9fcG9zaXRpb24oc2VsZi5lZSkKICAgICAgZGVmIF9fZ2V0aXRlbV9fKHNlbGYsaSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmVlW2ldCiAgICAgIGRlZiBmcm9tX3N0cmluZyhzZWxmLHMpOgogICAgICAgICAgICBnbG9iYWwgZW5fdGl0bGUKICAgICAgICAgICAgZWUsIEV2ZW50LmNudCwgeWxldmVsLCBlbl90aXRsZSA9IFtdLCAwLCAtMSwgJycKICAgICAgICAgICAgc3MgPSBzLnNwbGl0KCdcbicpCiAgICAgICAgICAgIGZvciBzMCBpbiBzczoKICAgICAgICAgICAgICAgICAgczEgPSBzMC5zdHJpcCgpCiAgICAgICAgICAgICAgICAgIGlmIGxlbihzMSk8MiBvciBzMVswXT09JyMnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzMT09c3NbMF06ICMgdGl0bGUgaW4gZmlyc3QgbGluZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbl90aXRsZSA9IHNzWzBdWzE6XQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICBpZiAiLT4iIGluIHMxOiAjIGNvbm5lY3Rpb24gZGVmaW5pdGlvbgogICAgICAgICAgICAgICAgICAgICAgICB5bGV2ZWwgKz0gMSAgICMgdXNlZCBmb3IgbWFya2luZyByZXF1aXJlZCB5IHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBzMWEgaW4gczEuc3BsaXQoIjsiKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlID0gczFhLnN0cmlwKCkuc3BsaXQoIi0+IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oY29kZSk+MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVbMV09Y29kZVsxXS5zcGxpdCgiIyIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLGogPSBpbnQoY29kZVswXSktMSwgaW50KGNvZGVbMV0pLTEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGk+LTEgYW5kIGo+LTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0KGVlW2ldLGVlW2pdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaT4tMSBhbmQgZWVbaV0ucHAyWzFdPT0tMTogIyBpZiBub3Qgc2V0IHlldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbaV0ucHAyWzFdPXlsZXZlbCAjIGZvcmNlIHkgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGo+LTEgYW5kIGVlW2pdLnBwMlsxXT09LTE6ICMgaWYgbm90IHNldCB5ZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlW2pdLnBwMlsxXT15bGV2ZWwgIyBmb3JjZSB5IHBvc2l0aW9uICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgIGVsc2U6ICAgICAgICAgICMgZXZlbnQgZGVmaW5pdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBjb2RlPXMxLnNwbGl0KCIgIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGNvZGUpPjE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTE9IiAiLmpvaW4oY29kZVsxOl0pLnNwbGl0KCcjJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZS5hcHBlbmQoZXZhbChjb2RlMVswXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbLTFdLmlkMj1mbG9hdChjb2RlWzBdLnNwbGl0KCcvJylbMF0pICMgaWQgYXMgd3JpdHRlbiBpbiBzb3VyY2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWVbLTFdLnRpdGxlPWNvZGUxWzFdLnN0cmlwKCkgaWYgbGVuKGNvZGUxKT4xIGVsc2UgJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYz1jb2RlWzBdLnNwbGl0KCIvIikgICMgY2hlY2sgaWRlbnRpZmllciBmaWVsZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVlWy0xXS5wcDJbMF0gPSBmbG9hdChjY1sxXSktMSBpZiBsZW4oY2MpPjEgZWxzZSAtMSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZVstMV0ucHAyWzFdID0gZmxvYXQoY2NbMl0pLTEgaWYgbGVuKGNjKT4yIGVsc2UgLTEKICAgICAgICAgICAgaWYgbGVuKHNldChbZS5wcDJbMV0gZm9yIGUgaW4gZWVdKSk9PTE6ICMgdmVyaWZ5IGlmIG11bHRpLWxpbmUgZGVzY3JpcHRpb24KICAgICAgICAgICAgICAgICAgZm9yIGUgaW4gZWU6ICAgICAgIyBpZiB5ZXMKICAgICAgICAgICAgICAgICAgICAgICAgZS5wcDJbMV09LTEgIyBjbGVhciBhbGwgeS1sZXZlbHMgdG8gdW5rbm93bgogICAgICAgICAgICByZXR1cm4gZWUKICAgICAgZGVmIHRvX3N0cmluZyhzZWxmKToKICAgICAgICAgICAgcz0nJwogICAgICAgICAgICBmb3IgZSBpbiBzZWxmLmVlOgogICAgICAgICAgICAgICAgICBzICs9IHN0cihlLmlkKSArICIgIiArIGUuX19jbGFzc19fLl9fbmFtZV9fKyIoIgogICAgICAgICAgICAgICAgICBpZiBlLl9fY2xhc3NfXy5fX25hbWVfXyE9J0VuZCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICJHYXRlIiBub3QgaW4gZS5fX2NsYXNzX18uX19uYW1lX186CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gZS5mdW4gYW5kIGUuZnVuLl9fbmFtZV9fIG9yICdOb25lJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9IiwiK3N0cihlLnBhcmFtKSsiLCIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZS5fX2NsYXNzX18uX19uYW1lX18hPSdTdGFydCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSBlLmNvZGUhPU5vbmUgYW5kICJcIiIrc3RyKGUuY29kZSkrIlwiIiBvciAiTm9uZSIKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9c3RyKGUudG5tYXgpCiAgICAgICAgICAgICAgICAgIHMgKz0iKVxuIgogICAgICAgICAgICBmb3IgZSBpbiBlZToKICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGUub3V0cHV0KSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gc3RyKGUuaWQpICsgIi0+IiArIHN0cihlLm91dHB1dFtpXS5pZCkgKyc7JwogICAgICAgICAgICByZXR1cm4gcyArICdcbicKZGVmIHN2Z19yb3VuZGVkUGF0aChwcCwgcik6CiAgICAgIGltcG9ydCBtYXRoCiAgICAgIHMsIGwgPSAiIiwgbGVuKHBwKS0xCiAgICAgIGZvciBpIGluIHJhbmdlKGwpOgogICAgICAgICAgICBhLGIgPSBwcFtpXSwgcHBbaSsxXQogICAgICAgICAgICB0ID0gbWluKHIgLyBtYXRoLmh5cG90KGJbMF0tYVswXSwgYlsxXS1hWzFdKzAuMDEpLCAwLjUpCiAgICAgICAgICAgIGlmIGk9PTA6CiAgICAgICAgICAgICAgICAgIHMgKz0gJ00lZyAlZyAnJShhWzBdLGFbMV0pCiAgICAgICAgICAgIGlmIGk+MDoKICAgICAgICAgICAgICAgICAgcyArPSAnUSVnICVnICVnICVnICclKGFbMF0sYVsxXSxhWzBdKigxLXQpK2JbMF0qdCxhWzFdKigxLXQpK2JbMV0qdCkKICAgICAgICAgICAgaWYgaT09bC0xOgogICAgICAgICAgICAgICAgICBzICs9ICdMJWcgJWcgJyUoYlswXSxiWzFdKQogICAgICAgICAgICBlbGlmIGk8bC0xOgogICAgICAgICAgICAgICAgICBzICs9ICdMJWcgJWcgJyUoYVswXSp0K2JbMF0qKDEtdCksYVsxXSp0K2JbMV0qKDEtdCkpCiAgICAgIHJldHVybiBzCiNOU19NQVAgPSB7CiMgICAgTm9uZTogJ2h0dHA6Ly93d3cub21nLm9yZy9zcGVjL0JQTU4vMjAxMDA1MjQvTU9ERUwnLAojICAgICdicG1uZGknOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9ESScsCiMgICAgJ29tZ2RjJzogJ2h0dHA6Ly93d3cub21nLm9yZy9zcGVjL0RELzIwMTAwNTI0L0RDJywKIyAgICAnb21nZGknOiAnaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvREQvMjAxMDA1MjQvREknLAojICAgICd4c2knOiAnaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UnCiN9CmRlZiBicG1uX3Rvc3ZnMChicG1uZmlsZSxXPTEwMCxIPTgwKToKICAgICAgcyA9ICc8ZGVmcz48bWFya2VyIGlkPSJ0cmlhbmdsZSIgdmlld0JveD0iMCAwIDEwIDEwIiByZWZYPSIxMCIgcmVmWT0iNSIgbWFya2VyVW5pdHM9InN0cm9rZVdpZHRoIiBtYXJrZXJXaWR0aD0iMTAiIG1hcmtlckhlaWdodD0iMTAiIG9yaWVudD0iYXV0byI+IDxwYXRoIGQ9Ik0gMCAwIEwgMTAgNSBMIDAgMTAgeiIgZmlsbD0iYmxhY2siIC8+PC9tYXJrZXI+PC9kZWZzPlxuJwogICAgICBpbXBvcnQgeG1sLmV0cmVlLkVsZW1lbnRUcmVlIGFzIEVUCiAgICAgIGZvciBlIGluIEVULnBhcnNlKGJwbW5maWxlKS5nZXRyb290KCk6CiAgICAgICAgICAgIGlmICJCUE1ORGlhZ3JhbSIgaW4gZS50YWc6CiAgICAgICAgICAgICAgICAgIGZvciBkIGluIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zPVtwIGZvciBwIGluIGQgaWYgIkJQTU5QbGFuZSIgaW4gZC50YWddCiAgICAgIHJldHVybiBpdGVtcwojZGVmIGJwbW5fdG9zdmcoYnBtbmZpbGUsVz0xMDAsSD04MCk6CmRlZiBicG1uX3Rvc3ZnKGJwbW5zdHJpbmcsaXNhbmltLGlzY29tbWVudHMsaXNzY3JpcHRzLFc9MTAwLEg9ODApOgogICAgICBzID0gJzxkZWZzPjxtYXJrZXIgaWQ9InRyaWFuZ2xlIiB2aWV3Qm94PSIwIDAgMTAgMTAiIHJlZlg9IjEwIiByZWZZPSI1IiBtYXJrZXJVbml0cz0ic3Ryb2tlV2lkdGgiIG1hcmtlcldpZHRoPSIxMCIgbWFya2VySGVpZ2h0PSIxMCIgb3JpZW50PSJhdXRvIj4gPHBhdGggZD0iTSAwIDAgTCAxMCA1IEwgMCAxMCB6IiBmaWxsPSJibGFjayIgLz48L21hcmtlcj48L2RlZnM+XG4nCiAgICAgIHMgKz0gJzx0ZXh0IHg9IjEwIiB5PSIxMiI+Jytlbl90aXRsZSsnPC90ZXh0PlxuJzsKICAgICAgaW1wb3J0IHhtbC5ldHJlZS5FbGVtZW50VHJlZSBhcyBFVAogICAgICAjZm9yIGUgaW4gRVQucGFyc2UoYnBtbmZpbGUpLmdldHJvb3QoKTogICMgY29sbGVjdCBuYW1lZCBwcm9jZXNzZXMKICAgICAgZm9yIGUgaW4gRVQuZnJvbXN0cmluZyhicG1uc3RyaW5nKTogICMgY29sbGVjdCBuYW1lZCBwcm9jZXNzZXMKICAgICAgICAgICAgaWYgInByb2Nlc3MiIGluIGUudGFnOgogICAgICAgICAgICAgICAgICBlbGVtcz1bZCBmb3IgZCBpbiBlIGlmICJuYW1lIiBpbiBkLmF0dHJpYl0KICAgICAgI2ZvciBlIGluIEVULnBhcnNlKGJwbW5maWxlKS5nZXRyb290KCk6ICAjIGNvbGxlY3QgZGlhZ3JhbSBlbGVtZW50cwogICAgICBmb3IgZSBpbiBFVC5mcm9tc3RyaW5nKGJwbW5zdHJpbmcpOiAgIyBjb2xsZWN0IG5hbWVkIHByb2Nlc3NlcwogICAgICAgICAgICBpZiAiQlBNTkRpYWdyYW0iIGluIGUudGFnOgogICAgICAgICAgICAgICAgICBmb3IgZCBpbiBlOgogICAgICAgICAgICAgICAgICAgICAgICBpdGVtcz1bcCBmb3IgcCBpbiBkIGlmICJCUE1OUGxhbmUiIGluIGQudGFnXQogICAgICBmb3IgaXQgaW4gaXRlbXM6CiAgICAgICAgICAgIHBwLG5hbWUgPSBbXSwiIgogICAgICAgICAgICBmb3IgZSBpbiBlbGVtczoKICAgICAgICAgICAgICAgICAgaWYgaXQuYXR0cmliWyJicG1uRWxlbWVudCJdPT1lLmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT0iICIuam9pbihlLmF0dHJpYlsibmFtZSJdLnNwbGl0KCIgIilbMTpdKSAjIGFzc3VtZSAiaWRcbnRleHQiCiAgICAgICAgICAgIGZvciBqIGluIHJhbmdlKGxlbihpdCkpOgogICAgICAgICAgICAgICAgICB4LHkgPSBmbG9hdChpdFtqXS5hdHRyaWJbIngiXSksZmxvYXQoaXRbal0uYXR0cmliWyJ5Il0pCiAgICAgICAgICAgICAgICAgIHcsaCA9IChmbG9hdChpdFtqXS5hdHRyaWJbIndpZHRoIl0pLGZsb2F0KGl0W2pdLmF0dHJpYlsiaGVpZ2h0Il0pKSBpZiAiQm91bmRzIiBpbiBpdFtqXS50YWcgZWxzZSAoMCwwKQogICAgICAgICAgICAgICAgICBXLEggPSBtYXgoVyx4K3cpLG1heChILHkraCkKICAgICAgICAgICAgICAgICAgI3ByaW50KGl0LmF0dHJpYlsiaWQiXSwiOiIseCx5LHcsaCkKICAgICAgICAgICAgICAgICAgaWYgdz09MDogIyBicG1uIGZsb3cKICAgICAgICAgICAgICAgICAgICAgICAgcHAuYXBwZW5kKFt4LHldKQogICAgICAgICAgICAgICAgICBlbHNlOiAgICAjIGJwbW4gZXZlbnQKICAgICAgICAgICAgICAgICAgICAgICAgaWRzPWl0LmF0dHJpYlsiaWQiXS5zcGxpdCgiXyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlkPWlkc1sxXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oaWRzKT40OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgYmFzZTY0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkc1s0XT1iYXNlNjQuYjE2ZGVjb2RlKGlkc1s0XSwnYXNjaWknKS5kZWNvZGUoJ2FzY2lpJykKICAgICAgICAgICAgICAgICAgICAgICAgaWQyPSJfIi5qb2luKGlkc1syOl0pLnJlcGxhY2UoJzwnLCcmbHQ7JykucmVwbGFjZSgnPicsJyZndDsnKQogICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHRleHQgeD0iJytzdHIoeC02KSsnIiB5PSInK3N0cih5K2grMTIpKyciPicraWQrJzwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNjb21tZW50czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9Jzx0ZXh0IGZvbnQtc2l6ZT0ic21hbGxlciIgc3R5bGU9ImZpbGw6Z3JheSIgeD0iJytzdHIoeC0xMikrJyIgeT0iJytzdHIoeS02KSsnIj48dHNwYW4geG1sOnNwYWNlPSJwcmVzZXJ2ZSI+JytuYW1lKyc8L3RzcGFuPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWQzPWlkMi5zcGxpdCgiXyIpCiAgICAgICAgICAgICAgICAgICAgICAgICNpZiBsZW4oaWQzKT4zIGFuZCBpZDNbM10gIT0gIk5vbmUiIDogcys9Jzx0ZXh0IGNsYXNzPSJ0MSIgZm9udC1zaXplPSJzbWFsbGVyIiBzdHlsZT0iZmlsbDpncmF5IiB4PSInK3N0cih4KzE4KSsnIiB5PSInK3N0cih5K2grMTIrKCJFdmVudCIgaW4gaXQuYXR0cmliWyJpZCJdIGFuZCAxMiBvciAwKSkrJyI+PHRzcGFuIHhtbDpzcGFjZT0icHJlc2VydmUiPicraWQzWzNdKyc8L3RzcGFuPjwvdGV4dD5cbicKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNzY3JpcHRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDNhPSJfIi5qb2luKGlkc1syOl0pLnNwbGl0KCJfIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGlkM2EpPjMgYW5kIGlkM2FbM10gIT0gIk5vbmUiOiBzKz0nPHRleHQgY2xhc3M9InQxIiBmb250LXNpemU9InNtYWxsZXIiIHN0eWxlPSJmaWxsOmdyYXkiIHg9Iicrc3RyKHgrMTgpKyciIHk9Iicrc3RyKHkraCsxMikrJyI+PHRzcGFuIHhtbDpzcGFjZT0icHJlc2VydmUiPicraWQzYVszXS5zcGxpdCgnOycpWzBdLnJlcGxhY2UoJzwnLCcmbHQ7JykucmVwbGFjZSgnPicsJyZndDsnKSsnPC90c3Bhbj48L3RleHQ+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICJFdmVudCIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2UgPSAiZW5kIiBpbiBpdC5hdHRyaWJbImlkIl0gYW5kICIzIiBvciAiMSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSAiZW5kIiBpbiBpdC5hdHRyaWJbImlkIl0gYW5kICJyZWQiIG9yICJkYXJrZ3JlZW4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPGVsbGlwc2UgY3g9Iicrc3RyKHgrdy8yKSsnIiBjeT0iJytzdHIoeStoLzIpKyciIHJ4PSInK3N0cih3LzIpKyciIHJ5PSInK3N0cihoLzIpKyciIHN0cm9rZS13aWR0aD0iJytzdHJva2UrJyIgc3Ryb2tlPSInK2NvbG9yKyciIGZpbGwtb3BhY2l0eT0iMC42IiBmaWxsPSJ3aGl0ZSI+PHRpdGxlPicraWQyKyc8L3RpdGxlPjwvZWxsaXBzZT5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgImludGVybWVkaWF0ZSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxlbGxpcHNlIGN4PSInK3N0cih4K3cvMikrJyIgY3k9Iicrc3RyKHkraC8yKSsnIiByeD0iJytzdHIody8yLTMpKyciIHJ5PSInK3N0cihoLzItMykrJyIgc3Ryb2tlLXdpZHRoPSInK3N0cm9rZSsnIiBzdHJva2U9ImRhcmtncmVlbiIgZmlsbD0id2hpdGUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIkNhdGNoIiBpbiBpdC5hdHRyaWJbImlkIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJvbmRpdGlvbiIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxyZWN0IHg9IiVnIiB5PSIlZyIgd2lkdGg9IiVnIiBoZWlnaHQ9IiVnIiBzdHJva2U9ImJsYWNrIiBmaWxsPSJub25lIiAvPiclKHgrdy8yLTcseStoLzItOSx3LzItNCxoLzIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHBhdGggZD0iJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSg1KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICdNJWcgJWcgTCVnICVnICclKHgrdy8yLTUseStoLzItNiszKmkseCt3LzIrNSx5K2gvMi02KzMqaSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8ZWxsaXBzZSBjeD0iJytzdHIoeCt3LzIpKyciIGN5PSInK3N0cih5K2gvMikrJyIgcng9Iicrc3RyKHcvMi02KSsnIiByeT0iJytzdHIoaC8yLTYpKyciIHN0cm9rZS13aWR0aD0iJytzdHJva2UrJyIgc3Ryb2tlPSJibGFjayIgZmlsbD0id2hpdGUiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8cGF0aCBkPSJNJWcgJWcgTCVnICVnICVnICVnICclKHgrdy8yLTUseStoLzItMyx4K3cvMix5K2gvMix4K3cvMis2LHkraC8yLTYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEyKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBtYXRoIGltcG9ydCBzaW4sY29zLHBpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAiTSVnICVnIEwlZyAlZyAiJSh4K3cvMisody8yLTYpKmNvcyhpKjIqcGkvMTIpLHkraC8yKyhoLzItNikqc2luKGkqMipwaS8xMikseCt3LzIrKHcvMi05KSpjb3MoaSoyKnBpLzEyKSx5K2gvMisoaC8yLTkpKnNpbihpKjIqcGkvMTIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIi8+JyAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiZXJtaW5hdGUiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9ICc8ZWxsaXBzZSBjeD0iJytzdHIoeCt3LzIpKyciIGN5PSInK3N0cih5K2gvMikrJyIgcng9Iicrc3RyKHcvMi02KSsnIiByeT0iJytzdHIoaC8yLTYpKyciIHN0cm9rZS13aWR0aD0iJytzdHJva2UrJyIgc3Ryb2tlPSJyZWQiIGZpbGw9InJlZCIgZmlsbC1vcGFjaXR5PSIwLjYiLz5cbicKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAiR2F0ZXdheSIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICJvcmFuZ2UiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMrPSAnPHBhdGggZD0iTSVnICVnIEwlZyAlZyBMJWcgJWcgTCVnICVnIFoiIHN0cm9rZT0iJXMiIGZpbGw9IndoaXRlIj48dGl0bGU+JXM8L3RpdGxlPjwvcGF0aD5cbiclKHgseStoLzIseCt3LzIseSx4K3cseStoLzIseCt3LzIseStoLGNvbG9yLGlkMikgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJleGNsdXNpdmUiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9JzxwYXRoIGQ9Ik0lZyAlZyBMJWcgJWcgTSVnICVnIEwlZyAlZyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIzIiAvPlxuJyUoeCt3LzItNix5K2gvMi02LHgrdy8yKzYseStoLzIrNix4K3cvMis2LHkraC8yLTYseCt3LzItNix5K2gvMis2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICJwYXJhbGxlbCIgaW4gaXQuYXR0cmliWyJpZCJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0nPHBhdGggZD0iTSVnICVnIEwlZyAlZyBNJWcgJWcgTCVnICVnIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjMiIC8+XG4nJSh4K3cvMi04LHkraC8yLHgrdy8yKzgseStoLzIseCt3LzIseStoLzItOCx4K3cvMix5K2gvMis4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICJpbmNsdXNpdmUiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcys9JzxjaXJjbGUgY3g9IiVnIiBjeT0iJWciIHI9IjciIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIgLz5cbiclKHgrdy8yLHkraC8yKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzKz0gJzxyZWN0IHJ4PSI3IiByeT0iNyIgeD0iJytzdHIoeCkrJyIgeT0iJytzdHIoeSkrJyIgd2lkdGg9Iicrc3RyKHcpKyciIGhlaWdodD0iJytzdHIoaCkrJyIgc3Ryb2tlPSJkYXJrYmx1ZSIgZmlsbD0id2hpdGUiPjx0aXRsZT4nK2lkMisnPC90aXRsZT48L3JlY3Q+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJzY3JpcHQiIGluIGl0LmF0dHJpYlsiaWQiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoNCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0nPHBhdGggZD0iTSVnICVnIEwlZyAlZyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxIiAvPiclKHgrMTArMCppLHkrMTArNCppLHgrMjIrMCppLHkrMTArNCppKQogICAgICAgICAgICBpZiBsZW4ocHApPjA6ICMgczEhPScnOiAjIGFkZCB3aG9sZSBmbG93CiAgICAgICAgICAgICAgICAgIHMxPXN2Z19yb3VuZGVkUGF0aChwcCwxMikKICAgICAgICAgICAgICAgICAgcyArPSAnPHBhdGggbWFya2VyLWVuZD0idXJsKCN0cmlhbmdsZSkiIGQ9IicrczErJyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YnJvd247c3Ryb2tlLXdpZHRoOjEiLz5cbicKICAgICAgcyArPSAiPHNjcmlwdD5mdW5jdGlvbiBvbl9jbGljaygpIHtbLi4uZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndDEnKV0uZm9yRWFjaChlPT5lLnN0eWxlLmRpc3BsYXk9KGUuc3R5bGUuZGlzcGxheT09J25vbmUnPycnOidub25lJykpO308L3NjcmlwdD4iCiAgICAgIHMgPSAnPHN2ZyBvbmNsaWNrPSJvbl9jbGljaygpIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIlZCIgaGVpZ2h0PSIlZCI+XG4nJShXKzQwKzYwLEgrMzApK3MKICAgICAgcmV0dXJuIHMgKyAodG9fYW5pbSgpIGlmIGlzYW5pbSBlbHNlICcnKSArICc8L3N2Zz5cbicKZGVmIHRvX2FuaW0oKToKICAgICAgI3JldHVybiBzCiAgICAgIGdsb2JhbCBuZQogICAgICBzID0gICc8ZGVmcz48ZmlsdGVyIHg9IjAiIHk9IjAiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGlkPSJmaSI+XG4nCiAgICAgIHMgKz0gJzxmZUZsb29kIGZsb29kLWNvbG9yPSJ3aGl0ZSIvPlxuJwogICAgICBzICs9ICc8ZmVDb21wb3NpdGUgaW49IlNvdXJjZUdyYXBoaWMiIG9wZXJhdG9yPSJhdG9wIi8+PC9maWx0ZXI+PC9kZWZzPlxuJwogICAgICBmb3IgZSBpbiBuZS5lZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLEVuZCk6CiAgICAgICAgICAgICAgICAgIGZvciBjIGluIGUucXVldWUub2JqZWN0czoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKG5lLmVlKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgsIHksIGEgPSBuZS5lZVtpXS54LCBuZS5lZVtpXS55LCBjLmF0dHIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0nPHRleHQgY2xhc3M9InQxIiBmaWx0ZXI9InVybCgjZmkpIiBzdHlsZT0iZm9udC1zaXplOnNtYWxsO2ZpbGw6cmVkIiB4PSInK3N0cih4LTIwKSsnIiB5PSInK3N0cih5KzEzKSsnIiB2aXNpYmlsaXR5PSJoaWRkZW4iPicrc3RyKGMubmFtZSkrJ1xuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0PSJfX3QiK3N0cihpKzEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQrImEiIGluIGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQwID0gYVt0KyJhIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAnPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0idmlzaWJpbGl0eSIgZnJvbT0iaGlkZGVuIiB0bz0idmlzaWJsZSIgYmVnaW49Iicrc3RyKHQwKSsncyIgZHVyPSIwLjAxcyIgZmlsbD0iZnJlZXplIi8+XG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQrImIiIGluIGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gYVt0KyJiIl0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gJzxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9IngiIHRvPSInK3N0cih4KzM4KSsnIiBiZWdpbj0iJytzdHIodDEpKydzIiBkdXI9IjAuNXMiIGZpbGw9ImZyZWV6ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0KyJlIiBpbiBhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IGFbdCsiZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gJzxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InZpc2liaWxpdHkiIGZyb209InZpc2libGUiIHRvPSJoaWRkZW4iIGJlZ2luPSInK3N0cih0MikrJ3MiIGR1cj0iMC4wMXMiIGZpbGw9ImZyZWV6ZSIvPlxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9JzwvdGV4dD5cbicKICAgICAgcmV0dXJuIHMKCm5lPVtdCiMgLS0tLSBzaW11bGF0aW9uIC0tLS0tCmRlZiBtYWluX2Z1bihleG4sbixhbmltLGNvbW1lbnRzLHNjcmlwdHMpOiAjIHN0cmluZyByZXByZXNlbnRhdGlvbiwgbnVtYmVyIG9mIHNpbXVsYXRpb24KICAgICAgZGF0YT1bXSAgIyBsaXN0IG9mIGV2ZW50cywgYXJyYXkgb2YgcmVzdWx0cwogICAgICBzID0gJycKICAgICAgZm9yIGkgaW4gcmFuZ2Uobik6CiAgICAgICAgICAgIGdsb2JhbCBuZQogICAgICAgICAgICBuZSA9IEV2ZW50TmV0d29yayhleG4pCiAgICAgICAgICAgIHNpbSA9IFNpbXVsYXRvcigpCiAgICAgICAgICAgIGZvciBlIGluIG5lOgogICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGUsR2VuZXJhdG9yKTogICMgYWRkIGdlbmVyYXRpbmcgZXZlbnRzCiAgICAgICAgICAgICAgICAgICAgICAgIHNpbS5hZGQoZSkgIAogICAgICAgICAgICBzaW0ucnVuKCkKICAgICAgICAgICAgZGF0YS5hcHBlbmQoW3NpbS50aW1lLEJwbW5FdmVudC5TXSkgICAjIHNhdmUgZW5kIHRpbWUgb2Ygc2ltdWxhdGlvbgogICAgICAgICAgICAKICAgICAgICAgICAgI2lmIGV4bj09ZXg1OgogICAgICAgICAgICAjICAgICAgZGF0YS5hcHBlbmQoQnBtbkV2ZW50LlNbIlMuYkEiXSkgIyBzYXZlIGdsb2JhbCB2YXJpYWJsZSBTLmJBCiAgICAgICAgICAgICNlbHNlOgogICAgICAgICAgICAjICAgICAgZGF0YS5hcHBlbmQoc2ltLnRpbWUpICAgIyBzYXZlIGVuZCB0aW1lIG9mIHNpbXVsYXRpb24KICAgICAgICAgICAgaWYgaT09MDoKICAgICAgICAgICAgICAgICAgczEgPSB0b19icG1uKG5lLmVlLG5lLnBwKQogICAgICAgICAgICAgICAgICBzMiA9IGJwbW5fdG9zdmcoczEsYW5pbSxjb21tZW50cyxzY3JpcHRzKQogICAgICAgICAgICAgICAgICBzMyA9IHRvX3N2ZygpCiAgICAgIHMgKz0gIiNuXHR0XHQiKyJcdCIuam9pbihkYXRhWzBdWzFdLmtleXMoKSkrIlxuIgogICAgICBzICs9ICJcbiIuam9pbihbIiVkXHQlLjJmXHQlcyIlKGkrMSxkYXRhW2ldWzBdLCJcdCIuam9pbihbc3RyKHYpIGZvciB2IGluIFsqZGF0YVtpXVsxXS52YWx1ZXMoKV1dKSkgZm9yIGkgaW4gcmFuZ2UobGVuKGRhdGEpKV0pCiAgICAgICNmb3IgZSBpbiBuZToKICAgICAgIyAgICAgIGlmIGxlbihlLnF1ZXVlKT4wOgogICAgICAjICAgICAgICAgICAgcyArPSBzdHIoZS5pZCkgKyAoIiglZCk6IiVsZW4oZS5xdWV1ZSkpICsgc3RyKGUucXVldWUpKydcbicKICAgICAgI3MgKz0gc3RyKHN1bShkYXRhKS9sZW4oZGF0YSkpKydcbicKICAgICAgI3MgKz0gc3RyKEJwbW5FdmVudC5TKSsnXG4nCiAgICAgICNmb3IgZSBpbiBuZToKICAgICAgIyAgICAgIHMgKz0gc3RyKGUuaWQpK3N0cihlLkEpKycgJwogICAgICAjICAgICAgaWYgaXNpbnN0YW5jZShlLFRhc2spOgogICAgICAjICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGUuc2VydmVycykpOgogICAgICAjICAgICAgICAgICAgICAgICAgcyArPSBzdHIoZS5zZXJ2ZXJzW2ldLmlkKSsnLycrc3RyKGkrMSkrc3RyKGUuc2VydmVyc1tpXS5BKSsnICcKICAgICAgczQ9JycKICAgICAgaWYgbGVuKGRhdGEpPj0xMDA6CiAgICAgICAgICAgICNpZiBleG49PWV4NDoKICAgICAgICAgICAgIyAgICAgIHM0ID0gaGlzdChkYXRhLDcpCiAgICAgICAgICAgICNlbHNlOgogICAgICAgICAgICAjICAgICAgczQgPSBoaXN0KGRhdGEpCiAgICAgICAgICAgIHBhc3MgIyBzNCA9IGhpc3QoZGF0YSkKICAgICAgcmV0dXJuIChzLHMxLHMyLHMzLHM0KSAjIHMyKyc8YnI+XG4nKyhzMyBpZiBuPT0xIGVsc2UgJycpKyc8YnI+XG4nKyc8cHJlPicrcysnPC9wcmU+JwoKCiIiIgppZiBfX25hbWVfXz09Il9fbWFpbl9fIjoKICAgICAgaW1wb3J0IHN5cwogICAgICAjaW1wb3J0IGV4CiAgICAgIGV4MzAgPSAnMSBTdGFydCgpXG4yIFRhc2soKVxuMyBFbmQoKVxuMS0+MjsyLT4zXG4nCiAgICAgIHMgPSBsZW4oc3lzLmFyZ3YpPjEgYW5kIGZyb21fZmlsZShzeXMuYXJndlsxXSkgb3IgZXZhbCgnZXglZCclKDMwKSkKICAgICAgbiA9IGxlbihzeXMuYXJndik+MiBhbmQgaW50KHN5cy5hcmd2WzJdKSBvciAxMDAKICAgICAgcyA9IG1haW5fZnVuKHMsbikKICAgICAgcHJpbnQoc1szXSkKIiIiCnMgPSBpbnB1dFswXQpuID0gaW50KGlucHV0WzFdKQphbmltID0gaW50KGlucHV0WzJdKQpjb21tZW50cyA9IGludChpbnB1dFszXSkKc2NyaXB0cyA9IGludChpbnB1dFs0XSkKb3V0cHV0ID0gbWFpbl9mdW4ocywgbiwgYW5pbSwgY29tbWVudHMsIHNjcmlwdHMpCnMgPSAnJwojcyArPSAnPGRpdiBpZD0iZGl2MSIgaGlkZGVuPicrb3V0cHV0WzFdKyc8L2Rpdj48YnI+XG4nCnMgKz0gJzxkaXYgaWQ9ImRpdjIiIHRhYmluZGV4PSItMSI+JytvdXRwdXRbMl0rJzwvZGl2Pjxicj5cbicKI3MgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIGJwbW4gdG8geG1sIGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTEoKTsiPjwvaW5wdXQ+XG4nCnMgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIGJwbW4gdG8gc3ZnIGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTIoKTsiPjwvaW5wdXQ+XG4nCnMgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIGJwbW4gdG8geG1sIGZpbGUiIG9uY2xpY2s9IndyaXRlRmlsZTUoKTsiPjwvaW5wdXQ+PGJyPjxicj5cbicKaWYgbj09MToKICAgICAgcyArPSAnPGRpdiBpZD0iZGl2MyI+JytvdXRwdXRbM10gKyc8L2Rpdj48YnI+XG4nCiAgICAgIHMgKz0nPGlucHV0IHR5cGU9YnV0dG9uIHZhbHVlPSJTYXZlIHRpbWVsaW5lIHRvIHN2ZyBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGUzKCk7Ij48L2lucHV0Pjxicj48YnI+XG4nCnMgKz0nPHRleHRhcmVhIGlkPSJ0YTQiIHJvd3M9IjEwIiBjb2xzPSI4MCI+JytvdXRwdXRbMF0rJzwvdGV4dGFyZWE+PGJyPlxuJyAjKyc8aW1nIHNyYz0iJytvdXRwdXRbM10rJyI+JwpzICs9JzxpbnB1dCB0eXBlPWJ1dHRvbiB2YWx1ZT0iU2F2ZSByZXN1bHRzIHRvIHR4dCBmaWxlIiBvbmNsaWNrPSJ3cml0ZUZpbGU0KCk7Ij48L2lucHV0Pjxicj48YnI+XG4nCnMgKz0nPHRleHRhcmVhIGhpZGRlbiBpZD0idGE1IiByb3dzPSIxMCIgY29scz0iODAiPicrb3V0cHV0WzFdKyc8L3RleHRhcmVhPjxicj5cbicgIysnPGltZyBzcmM9Iicrb3V0cHV0WzNdKyciPicKcwoKCg==";